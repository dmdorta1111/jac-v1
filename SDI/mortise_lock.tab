BEGIN_GUI_DESCR

	SHOW_PARAM STRING LOCK_MANUFACTURER
	SHOW_PARAM STRING LOCK_TYPE
	SHOW_PARAM STRING LOCK_MODEL
	SHOW_PARAM STRING	LOCK_FUNCTION
	SHOW_PARAM STRING LOCK_TRIM
	SHOW_PARAM STRING LOCK_TRIM_UDF
	SHOW_PARAM STRING LOCK_TRIM_INST
	SHOW_PARAM STRING LOCK_TRIM_OFFSET
	SHOW_PARAM DOUBLE	LOCK_BACKSET
	SHOW_PARAM STRING	LOCK_UDF
	SHOW_PARAM STRING	LOCK_INST
	SHOW_PARAM DOUBLE	LOCK_ARMOR_WIDTH
	SHOW_PARAM DOUBLE	LOCK_ARMOR_HEIGHT
	SHOW_PARAM DOUBLE	LOCK_ARMOR_THICKNESS
	SHOW_PARAM DOUBLE	LOCK_OFFSET
	SHOW_PARAM STRING	LOCK_REINFORCEMENT
	

	CHECKBOX_PARAM INTEGER SPECIAL_BOX_DEPTH "YES/NO"
	CHECKBOX_PARAM INTEGER SELECT_LOCK
	CHECKBOX_PARAM INTEGER SELECT_TRIM
	
	IF SPECIAL_BOX_DEPTH == 1
		USER_INPUT_PARAM DOUBLE MORTISE_BOX_DEPTH
	END_IF
	
END_GUI_DESCR

BEGIN_ASM_DESCR

	DECLARE_ARRAY LOCK_INFO
	DECLARE_ARRAY LOCKCELLS
	DECLARE_ARRAY TRIM_INFO
	DECLARE_ARRAY TRIMCELLS
	DECLARE_ARRAY SELCELLS
	
	! DECLARE_VARIABLE INTEGER EXCEL_LOCK_INFO
	DECLARE_VARIABLE INTEGER COLX
	DECLARE_VARIABLE INTEGER COLY
	DECLARE_VARIABLE INTEGER COLSHAPE
	DECLARE_VARIABLE INTEGER COLDIA
	DECLARE_VARIABLE INTEGER COLSIDE
	DECLARE_VARIABLE DOUBLE LOCX
	DECLARE_VARIABLE DOUBLE LOCY
	DECLARE_VARIABLE STRING SHAPE
	DECLARE_VARIABLE DOUBLE DIA
	DECLARE_VARIABLE INTEGER SIDE
	DECLARE_VARIABLE INTEGER HTP
	DECLARE_VARIABLE INTEGER HINDEX
	DECLARE_VARIABLE DOUBLE OS
	DECLARE_VARIABLE DOUBLE IS
	
	DECLARE_VARIABLE STRING LOCK_SHEET_NAME
	DECLARE_VARIABLE INTEGER LOCK_ROW
	DECLARE_VARIABLE STRING LOCK_TRIM_SHEET_NAME
	DECLARE_VARIABLE INTEGER LOCK_TRIM_ROW

	
	DECLARE_VARIABLE	INTEGER		LOCK_INDEX
	DECLARE_VARIABLE	DOUBLE		BEVEL
	DECLARE_VARIABLE	DOUBLE		BEVEL_CALC
	DECLARE_VARIABLE	DOUBLE		DOOR_THICKNESS
	DECLARE_VARIABLE	INTEGER		OPERATION
	DECLARE_VARIABLE	DOUBLE		STOPP
	DECLARE_VARIABLE	STRING 		PROCESS_MESSAGE
	DECLARE_VARIABLE 	INTEGER		SPECIAL_BOX_DEPTH
	DECLARE_VARIABLE 	DOUBLE		MORTISE_BOX_DEPTH
	
	DECLARE_VARIABLE	STRING 		LOCK_MANUFACTURER
	DECLARE_VARIABLE	STRING 		LOCK_DESC
	DECLARE_VARIABLE	DOUBLE		LOCK_OFFSET
	DECLARE_VARIABLE	DOUBLE		LOCK_BACKSET
	DECLARE_VARIABLE	DOUBLE		LOCK_ARMOR_HEIGHT
	DECLARE_VARIABLE	DOUBLE		LOCK_ARMOR_THICKNESS
	DECLARE_VARIABLE	DOUBLE		LOCK_ARMOR_WIDTH
	DECLARE_VARIABLE	STRING 		LOCK_REINFORCEMENT
	DECLARE_VARIABLE	STRING 		LOCK_TRIM_MANUFACTURER
	DECLARE_VARIABLE	STRING 		LOCK_TRIM_DESC
	DECLARE_VARIABLE	DOUBLE		LOCK_TRIM_OFFSET
	DECLARE_VARIABLE	DOUBLE		LOCK_TRIM_BACKSET
	DECLARE_VARIABLE	STRING		LOCK_INST

	
	DECLARE_VARIABLE	STRING		STRIKE_DESC
	DECLARE_VARIABLE	DOUBLE		STRIKE_GAP
	DECLARE_VARIABLE	STRING 		STRIKE_EDGE_SHAPE
	DECLARE_VARIABLE	DOUBLE		STRIKE_CENTER
	DECLARE_VARIABLE	DOUBLE		STRIKE_HEIGHT
	DECLARE_VARIABLE	DOUBLE		STRIKE_WIDTH
	DECLARE_VARIABLE	DOUBLE		STRIKE_LIP_HEIGHT
	DECLARE_VARIABLE	DOUBLE		STRIKE_LIP_THICKNESS
	DECLARE_VARIABLE	DOUBLE		STRIKE_PLATE_THICKNESS
	DECLARE_VARIABLE	INTEGER		STRIKE_TYPE
	DECLARE_VARIABLE	STRING		STRIKE_UDF
	DECLARE_VARIABLE	STRING		STRIKE_REINF_MODEL
	DECLARE_VARIABLE	DOUBLE		STRIKE_BACKSET
	DECLARE_VARIABLE	STRING		STRIKE_MODEL
	! DECLARE_VARIABLE	INTEGER		VERIFY_STRIKE

	DECLARE_REFERENCE LOCREF
	
IF OPERATION == 0 
	! IF EXCEL_LOCK_INFO == 0
		! LOCK_ROW = 0
		! LOCK_TRIM_ROW = 0
	! END_IF
	
	CONFIG_ELEM	
END_IF	

IF OPERATION == 0 AND SELECT_LOCK == 1
	PRINT "SELECT ONE CELL IN THE ROW YOU WANT"
	WAIT
	EXCEL_GET_ACTIVE_SHEET EXCEL_INDEX
	EXCEL_GET_SHEET_NAME EXCEL_INDEX LOCK_SHEET_NAME
	
	CLEAR_ARRAY LOCKCELLS
	EXCEL_GET_SELECTION LOCKCELLS
	FOR CELL REF ARRAY LOCKCELLS
		GET_ARRAY_ELEM CELL 0 LOCK_ROW
		BREAK
	END_FOR
	
	CLEAR_ARRAY SELCELLS
	EXCEL_GET_VALUES CELL_BY_INDEX LOCK_ROW 0 CELL_BY_INDEX LOCK_ROW 255 SELCELLS
	
	CLEAR_ARRAY LOCK_INFO
	FOR CELL REF ARRAY SELCELLS
		GET_ARRAY_ELEM CELL 2 content
		
		IF content == ""
			BREAK
		ELSE
			ADD_ARRAY_ELEM LOCK_INFO content
			PRINT "CONTENT - %  " content
		END_IF
	END_FOR

	GET_ARRAY_ELEM LOCK_INFO 2 LOCK_MANUFACTURER
	GET_ARRAY_ELEM LOCK_INFO 3 LOCK_MODEL
	GET_ARRAY_ELEM LOCK_INFO 4 LOCK_DESC
	GET_ARRAY_ELEM LOCK_INFO 6 LOCK_REINFORCEMENT
	GET_ARRAY_ELEM LOCK_INFO 7 LOCK_OFFSET
	GET_ARRAY_ELEM LOCK_INFO 8 LOCK_BACKSET
	GET_ARRAY_ELEM LOCK_INFO 9 LOCK_ARMOR_HEIGHT
	GET_ARRAY_ELEM LOCK_INFO 10 LOCK_ARMOR_WIDTH
	GET_ARRAY_ELEM LOCK_INFO 11 LOCK_ARMOR_THICKNESS


	PRINT "LOCK SHEET NAME  %" LOCK_SHEET_NAME
	PRINT "LOCK ROW  %" LOCK_ROW			
	
	EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "OPENING"
END_IF

IF OPERATION == 0 AND SELECT_TRIM == 1
	PRINT "SELECT ONE CELL IN THE ROW YOU WANT"
	WAIT
	EXCEL_GET_ACTIVE_SHEET EXCEL_INDEX
	EXCEL_GET_SHEET_NAME EXCEL_INDEX LOCK_TRIM_SHEET_NAME
	
	CLEAR_ARRAY TRIMCELLS
	EXCEL_GET_SELECTION TRIMCELLS
	FOR CELL REF ARRAY TRIMCELLS
		GET_ARRAY_ELEM CELL 0 LOCK_TRIM_ROW
		BREAK
	END_FOR

	CLEAR_ARRAY SELCELLS
	EXCEL_GET_VALUES CELL_BY_INDEX LOCK_TRIM_ROW 0 CELL_BY_INDEX LOCK_TRIM_ROW 255 SELCELLS
	
	CLEAR_ARRAY TRIM_INFO
	FOR CELL REF ARRAY SELCELLS
		GET_ARRAY_ELEM CELL 2 content
		
		IF content == ""
			BREAK
		ELSE
			ADD_ARRAY_ELEM TRIM_INFO content
			PRINT "CONTENT - %  " content
		END_IF
	END_FOR

	GET_ARRAY_ELEM TRIM_INFO 2 LOCK_TRIM_MANUFACTURER
	GET_ARRAY_ELEM TRIM_INFO 3 LOCK_TRIM_MODEL
	GET_ARRAY_ELEM TRIM_INFO 4 LOCK_TRIM_DESC
	GET_ARRAY_ELEM TRIM_INFO 6 LOCK_TRIM_REINFORCEMENT
	GET_ARRAY_ELEM TRIM_INFO 7 LOCK_TRIM_OFFSET
	GET_ARRAY_ELEM TRIM_INFO 8 LOCK_TRIM_BACKSET

	PRINT "LOCK SHEET NAME  %" LOCK_TRIM_SHEET_NAME
	PRINT "LOCK ROW  %" LOCK_TRIM_ROW			
	
	EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "OPENING"
END_IF				


IF OPERATION == 1
	IF LOCK_INDEX == 1
		LOCK_MANUFACTURER = PRIMARY_LOCK_MANUFACTURER
		LOCK_TYPE = PRIMARY_LOCK_TYPE
		LOCK_MODEL = PRIMARY_LOCK_MODEL
		LOCK_BACKSET = PRIMARY_LOCK_BACKSET
		LOCK_OFFSET = PRIMARY_LOCK_OFFSET
		LOCK_TRIM = PRIMARY_LOCK_TRIM
		LOCK_UDF = PRIMARY_LOCK_UDF
		LOCK_INST = PRIMARY_LOCK_INST
		LOCK_ARMOR_HEIGHT = PRIMARY_LOCK_ARMOR_HEIGHT
		LOCK_ARMOR_WIDTH = PRIMARY_LOCK_ARMOR_WIDTH
		LOCK_ARMOR_THICKNESS = PRIMARY_LOCK_ARMOR_THICKNESS
		LOCK_REINFORCEMENT = PRIMARY_LOCK_REINFORCEMENT
		LOCK_TRIM_OFFSET = PRIMARY_LOCK_TRIM_OFFSET
		LOCK_TRIM_UDF = PRIMARY_LOCK_TRIM_UDF
		LOCK_TRIM_INST = PRIMARY_LOCK_TRIM_INST
		LOCK_SHEET_NAME = PRIMARY_LOCK_SHEET_NAME
		LOCK_ROW = PRIMARY_LOCK_ROW
		LOCK_TRIM_SHEET_NAME	= PRIMARY_LOCK_TRIM_SHEET_NAME
		LOCK_TRIM_ROW = PRIMARY_LOCK_TRIM_ROW		
		LOCK_TRIM_MANUFACTURER = PRIMARY_LOCK_TRIM_MANUFACTURER
		LOCK_TRIM_DESC = PRIMARY_LOCK_TRIM_DESC
		LOCK_TRIM_BACKSET = PRIMARY_LOCK_TRIM_BACKSET
	ELSE_IF LOCK_INDEX == 2
		LOCK_MANUFACTURER = SECONDARY_LOCK_MANUFACTURER
		LOCK_TYPE = SECONDARY_LOCK_TYPE
		LOCK_MODEL = SECONDARY_LOCK_MODEL
		LOCK_BACKSET = SECONDARY_LOCK_BACKSET
		LOCK_OFFSET = SECONDARY_LOCK_OFFSET
		LOCK_TRIM = SECONDARY_LOCK_TRIM
		LOCK_UDF = SECONDARY_LOCK_UDF
		LOCK_INST = SECONDARY_LOCK_INST
		LOCK_ARMOR_HEIGHT = SECONDARY_LOCK_ARMOR_HEIGHT
		LOCK_ARMOR_WIDTH = SECONDARY_LOCK_ARMOR_WIDTH
		LOCK_ARMOR_THICKNESS = SECONDARY_LOCK_ARMOR_THICKNESS
		LOCK_REINFORCEMENT = SECONDARY_LOCK_REINFORCEMENT
		LOCK_TRIM_OFFSET = SECONDARY_LOCK_TRIM_OFFSET
		LOCK_TRIM_UDF = SECONDARY_LOCK_TRIM_UDF
		LOCK_TRIM_INST = SECONDARY_LOCK_TRIM_INST
		LOCK_SHEET_NAME = SECONDARY_LOCK_SHEET_NAME
		LOCK_ROW = SECONDARY_LOCK_ROW
		LOCK_TRIM_SHEET_NAME	= SECONDARY_LOCK_TRIM_SHEET_NAME
		LOCK_TRIM_ROW = SECONDARY_LOCK_TRIM_ROW
		LOCK_TRIM_MANUFACTURER = SECONDARY_LOCK_TRIM_MANUFACTURER
		LOCK_TRIM_DESC = SECONDARY_LOCK_TRIM_DESC
		LOCK_TRIM_BACKSET = SECONDARY_LOCK_TRIM_BACKSET
	 END_IF

	IF	HAND_ == "LHR" OR HAND_ == "LHRA1"
		SEARCH_MDL_REF DOOR_ASM CSYS "ACS4" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
		IF DOOR_CONSTRUCTION == "SEAMLESS"
			SEARCH_MDL_REF BODY SURFACE "SURFACE_S2" BODY_ARMOR
			SEARCH_MDL_REF COVER SURFACE "SURFACE_S2" COVER_ARMOR
			BODY_ROTATION = 180
			COVER_ROTATION = 0
		END_IF
		IF STRIKE_EDGE_SHAPE == "BEVEL"
			ARMOR_BEVEL = -4
		ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
			ARMOR_BEVEL = 0
		END_IF
	END_IF

	IF	HAND_ == "RH" OR HAND_ == "RHA2"
		SEARCH_MDL_REF DOOR_ASM CSYS "ACS4" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
		IF DOOR_CONSTRUCTION == "SEAMLESS"
			SEARCH_MDL_REF BODY SURFACE "SURFACE_S2" BODY_ARMOR
			SEARCH_MDL_REF COVER SURFACE "SURFACE_S2" COVER_ARMOR
			BODY_ROTATION = 180
			COVER_ROTATION = 0
		END_IF
		IF STRIKE_EDGE_SHAPE == "BEVEL"
			ARMOR_BEVEL = -4
		ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
			ARMOR_BEVEL = 0
		END_IF
	END_IF

	IF	HAND_ == "RHR" OR HAND_ == "RHRA2"
		SEARCH_MDL_REF DOOR_ASM CSYS "ACS3" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
		IF DOOR_CONSTRUCTION == "SEAMLESS"
			SEARCH_MDL_REF BODY SURFACE "SURFACE_S1" BODY_ARMOR
			SEARCH_MDL_REF COVER SURFACE "SURFACE_S1" COVER_ARMOR
			BODY_ROTATION = 0
			COVER_ROTATION = 180
		END_IF
		IF STRIKE_EDGE_SHAPE == "BEVEL"
			ARMOR_BEVEL = 4
		ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
			ARMOR_BEVEL = 0
		END_IF
	END_IF

	IF	HAND_ == "LH" OR HAND_ == "LHA1"
		SEARCH_MDL_REF DOOR_ASM CSYS "ACS3" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
		IF DOOR_CONSTRUCTION == "SEAMLESS"
			SEARCH_MDL_REF BODY SURFACE "SURFACE_S1" BODY_ARMOR
			SEARCH_MDL_REF COVER SURFACE "SURFACE_S1" COVER_ARMOR
			BODY_ROTATION = 0
			COVER_ROTATION = 180
		END_IF
		IF STRIKE_EDGE_SHAPE == "BEVEL"
			ARMOR_BEVEL = 4
		ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
			ARMOR_BEVEL =  0
		END_IF
	END_IF

	IF WELDED_PREPS == 1
		LOCK_ARMOR_HEIGHT = LOCK_ARMOR_HEIGHT + .18
		LOCK_ARMOR_WIDTH = LOCK_ARMOR_WIDTH +.18
		! LOCK_REINFORCEMENT = PRIMARY_LOCK_INST + ".ASM"
		LOCK_REINFORCEMENT = PRIMARY_LOCK_REINFORCEMENT
	ELSE
		LOCK_ARMOR_HEIGHT = LOCK_ARMOR_HEIGHT +.015
		LOCK_ARMOR_WIDTH = LOCK_ARMOR_WIDTH +.015
		LOCK_REINFORCEMENT = PRIMARY_LOCK_REINFORCEMENT
	END_IF

	IF DOOR_CONSTRUCTION == "SEAMLESS" 
		IF DOOR_GAUGE == 18 AND LOCK_ARMOR_WIDTH <= 1.265
			ARMOR_INST = "NO_TAB"
		ELSE_IF DOOR_GAUGE == 18 AND LOCK_ARMOR_WIDTH > 1.265
			ARMOR_INST = "WITH_TAB"
		ELSE_IF DOOR_GAUGE == 16 AND LOCK_ARMOR_WIDTH <= 1.265
			ARMOR_INST = "NO_TAB"
		ELSE_IF DOOR_GAUGE == 16 AND LOCK_ARMOR_WIDTH > 1.265
			ARMOR_INST = "WITH_TAB"
		ELSE_IF DOOR_GAUGE == 14 AND LOCK_ARMOR_WIDTH <= 1.140
			ARMOR_INST = "NO_TAB"
		ELSE_IF DOOR_GAUGE == 14 AND LOCK_ARMOR_WIDTH > 1.140
			ARMOR_INST = "WITH_TAB"
		ELSE_IF DOOR_GAUGE == 12
			ARMOR_INST = "WITH_TAB"
		END_IF
	END_IF

	IF LOCK_ARMOR_WIDTH > DOOR_THICKNESS - 75 AND DOOR_CONSTRUCTION == "LOCKSEAM"
		IF HAND == "LHR" OR HAND == "LHRA"
			ARMOR_INST = "ARMOR_L2"
		ELSE_IF HAND == "RHR" OR HAND == "RHRA"
			ARMOR_INST = "ARMOR_L1"
		ELSE_IF HAND == "LH" OR HAND == "LHA"
			ARMOR_INST = "ARMOR_L1"
		ELSE_IF HAND == "RH" OR HAND == "RHA"
			ARMOR_INST = "ARMOR_L2"
		END_IF
	END_IF

! LOCK	
	IF LOCK_ROW <> 0 AND LOCK_ROW <> ""
	
		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME LOCK_SHEET_NAME
		CLEAR_ARRAY SELCELLS
		EXCEL_GET_VALUES CELL_BY_INDEX LOCK_ROW 0 CELL_BY_INDEX LOCK_ROW 255 SELCELLS
		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "OPENING"
	
		CLEAR_ARRAY LOCK_INFO
		FOR CELL REF ARRAY SELCELLS
			! GET_ARRAY_ELEM CELL 0 row
			! GET_ARRAY_ELEM CELL 1 col
			GET_ARRAY_ELEM CELL 2 content
			
			IF content == ""
				BREAK
			ELSE
				ADD_ARRAY_ELEM LOCK_INFO content
				PRINT "CONTENT - %  " content
			END_IF
		END_FOR
	
		! GET_ARRAY_ELEM LOCK_INFO 7 LOCK_OFFSET
		! GET_ARRAY_ELEM LOCK_INFO 8 LOCK_BACKSET
		! GET_ARRAY_ELEM LOCK_INFO 9 LOCK_ARMOR_HEIGHT
		! GET_ARRAY_ELEM LOCK_INFO 10 LOCK_ARMOR_WIDTH
		! GET_ARRAY_ELEM LOCK_INFO 11 LOCK_ARMOR_THICKNESS

			CREATE_UDF udf\lock_dtms DOOR_ASM
				UDF_REF ATTACH1 ATTACH
				UDF_REF ATTACH2 ATTACH1
				UDF_DIM STRIKE_CTR STRIKE_CENTER
				UDF_DIM OFFSET -LOCK_OFFSET
				UDF_DIM BACKSET LOCK_BACKSET
				UDF_EXP_REF ATTACH2 CSYS 2
				UDF_EXP_REF ODCTR PLANE 3
				UDF_EXP_REF TOPP PLANE 4
			END_CREATE_UDF

		GET_ARRAY_SIZE LOCK_INFO SIZE
		HTP = (SIZE-8)/5
		HINDEX = 1
		COLX = 12
		COLY = 13
		COLSHAPE = 14
		COLDIA = 15
		COLSIDE = 16

		WHILE HINDEX <= HTP	
			GET_ARRAY_ELEM LOCK_INFO COLX LOCX
			GET_ARRAY_ELEM LOCK_INFO COLY LOCY
			GET_ARRAY_ELEM LOCK_INFO COLSHAPE SHAPE
			GET_ARRAY_ELEM LOCK_INFO COLDIA DIA
			GET_ARRAY_ELEM LOCK_INFO COLSIDE SIDE
			
			CREATE_UDF udf\xycsys DOOR_ASM
				UDF_REF ATTACH ATTACH2
				UDF_DIM	DIMX LOCX
				UDF_DIM	DIMY LOCY
				UDF_EXP_REF LOCREF CSYS 0
			END_CREATE_UDF
			
			IF SIDE == 0
				OS = 1
				IS = .1
			END_IF
			IF SIDE == 1
				OS = .1
				IS = 1
			END_IF
			IF SIDE == 2
				OS = 1
				IS = 1
			END_IF
			
			IF SHAPE == 1
				IF WELDED_PREPS == 1
					DIA = DIA+.0625
				END_IF
				CREATE_UDF udf\circle DOOR_ASM
					UDF_REF ODCTR ODCTR
					UDF_REF TOPP TOPP
					UDF_REF LOCREF LOCREF
					UDF_DIM DIA DIA
					UDF_DIM IS IS
					UDF_DIM OS OS
					UDF_INTERSECTION * PART_LEVEL		
				END_CREATE_UDF
			END_IF
			
			HINDEX++
			COLX = COLX + 5
			COLY = COLY + 5
			COLSHAPE = COLSHAPE + 5
			COLDIA = COLDIA + 5
			COLSIDE = COLSIDE + 5
		END_WHILE
		
		IF ((EPT == 1 OR EPT == 3) AND DOOR_INDEX == 1) OR ((EPT == 2 OR EPT == 3) AND DOOR_INDEX == 2) OR ELECTRIC_HINGE_POSITION > 0
			SET_REF_NAME LOCREF "ELEC2"
		END_IF
	END_IF

! LOCK TRIM	
	IF LOCK_TRIM_ROW <> 0 AND LOCK_TRIM_ROW <> ""
		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME LOCK_TRIM_SHEET_NAME
		CLEAR_ARRAY SELCELLS
		EXCEL_GET_VALUES CELL_BY_INDEX LOCK_TRIM_ROW 0 CELL_BY_INDEX LOCK_TRIM_ROW 255 SELCELLS
		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "OPENING"
	
		CLEAR_ARRAY TRIM_INFO
		FOR CELL REF ARRAY SELCELLS
			! GET_ARRAY_ELEM CELL 0 row
			! GET_ARRAY_ELEM CELL 1 col
			GET_ARRAY_ELEM CELL 2 content
			
			IF content == ""
				BREAK
			ELSE
				ADD_ARRAY_ELEM TRIM_INFO content
				PRINT "CONTENT - %  " content
			END_IF
		END_FOR
	
		! GET_ARRAY_ELEM TRIM_INFO 7 TRIM_OFFSET
		! GET_ARRAY_ELEM TRIM_INFO 8 TRIM_BACKSET

			CREATE_UDF udf\lock_dtms DOOR_ASM
				UDF_REF ATTACH1 ATTACH
				UDF_REF ATTACH2 ATTACH1
				UDF_DIM STRIKE_CTR STRIKE_CENTER
				UDF_DIM OFFSET - LOCK_TRIM_OFFSET
				UDF_DIM BACKSET LOCK_TRIM_BACKSET
				UDF_EXP_REF ATTACH2 CSYS 2
				UDF_EXP_REF ODCTR PLANE 3
				UDF_EXP_REF TOPP PLANE 4
			END_CREATE_UDF

		GET_ARRAY_SIZE TRIM_INFO SIZE
		HTP = (SIZE-8)/5
		HINDEX = 1
		COLX = 12
		COLY = 13
		COLSHAPE = 14
		COLDIA = 15
		COLSIDE = 16

		WHILE HINDEX <= HTP	
			GET_ARRAY_ELEM TRIM_INFO COLX LOCX
			GET_ARRAY_ELEM TRIM_INFO COLY LOCY
			GET_ARRAY_ELEM TRIM_INFO COLSHAPE SHAPE
			GET_ARRAY_ELEM TRIM_INFO COLDIA DIA
			GET_ARRAY_ELEM TRIM_INFO COLSIDE SIDE
			
			CREATE_UDF udf\xycsys DOOR_ASM
				UDF_REF ATTACH ATTACH2
				UDF_DIM	DIMX LOCX
				UDF_DIM	DIMY LOCY
				UDF_EXP_REF LOCREF CSYS 0
			END_CREATE_UDF
			
			IF SIDE == 0
				OS = 1
				IS = .1
			END_IF
			IF SIDE == 1
				OS = .1
				IS = 1
			END_IF
			IF SIDE == 2
				OS = 1
				IS = 1
			END_IF
			
			IF SHAPE == 1
				CREATE_UDF udf\circle DOOR_ASM
					UDF_REF ODCTR ODCTR
					UDF_REF TOPP TOPP
					UDF_REF LOCREF LOCREF
					UDF_DIM DIA DIA
					UDF_DIM IS IS
					UDF_DIM OS OS
					UDF_INTERSECTION * PART_LEVEL		
				END_CREATE_UDF
			END_IF
			
			HINDEX++
			COLX = COLX + 5
			COLY = COLY + 5
			COLSHAPE = COLSHAPE + 5
			COLDIA = COLDIA + 5
			COLSIDE = COLSIDE + 5
		END_WHILE		
	END_IF

! AMOR PLATE	
	IF DOOR_CONSTRUCTION == "LOCKSEAM"
		CREATE_UDF udf\armor_plate DOOR_ASM
			UDF_INSTANCE ARMOR_INST
			UDF_REF ATTACH ATTACH
			UDF_DIM STRIKE_CTR STRIKE_CENTER
			UDF_DIM OFFSET -LOCK_OFFSET
			UDF_DIM ARMOR_BEVEL ARMOR_BEVEL
			UDF_DIM ARMOR_WIDTH LOCK_ARMOR_WIDTH
			UDF_DIM ARMOR_HEIGHT LOCK_ARMOR_HEIGHT
			UDF_EXP_REF ATTACH2 CSYS 1
			UDF_INTERSECTION * PART_LEVEL
		END_CREATE_UDF
	END_IF
		
	IF DOOR_CONSTRUCTION == "SEAMLESS"
		CREATE_UDF udf\face_plate BODY
			UDF_INSTANCE ARMOR_INST
			UDF_REF ATTACH ATTACH
			UDF_REF ARMOR_SURFACE BODY_ARMOR		
			UDF_DIM STRIKE_CTR STRIKE_CENTER
			UDF_DIM OFFSET -LOCK_OFFSET
			UDF_DIM ROTATION BODY_ROTATION
			UDF_DIM BEVEL ARMOR_BEVEL
			UDF_DIM ARMOR_WIDTH LOCK_ARMOR_WIDTH
			UDF_DIM ARMOR_HEIGHT LOCK_ARMOR_HEIGHT
			UDF_EXP_REF ATTACH2 CSYS 1
			UDF_INTERSECTION * PART_LEVEL
		END_CREATE_UDF

		CREATE_UDF udf\face_plate COVER
			UDF_INSTANCE ARMOR_INST
			UDF_REF ATTACH ATTACH
			UDF_REF ARMOR_SURFACE COVER_ARMOR		
			UDF_DIM STRIKE_CTR STRIKE_CENTER
			UDF_DIM OFFSET -LOCK_OFFSET
			UDF_DIM ROTATION COVER_ROTATION
			UDF_DIM BEVEL ARMOR_BEVEL
			UDF_DIM ARMOR_WIDTH LOCK_ARMOR_WIDTH
			UDF_DIM ARMOR_HEIGHT LOCK_ARMOR_HEIGHT
			UDF_EXP_REF ATTACH2 CSYS 1
			UDF_INTERSECTION * PART_LEVEL
		END_CREATE_UDF
	END_IF

! REINFORCEMENT	
	IF	HAND_ == "RHR" OR HAND_ == "LH" OR \
		HAND_ == "RHR2" OR HAND_ == "RHRA2" OR \
		HAND_ == "LH1" OR HAND_ == "LHA1"
			CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ATTACH2
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX 0
				UDF_DIM	LOCY 0
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ATTACH2 CSYS 0
			END_CREATE_UDF
	END_IF

	IF	HAND_ == "LHR" OR HAND_ == "RH" OR \
		HAND_ == "LHR1" OR HAND_ == "LHRA1" OR \
		HAND_ == "RH2" OR HAND_ == "RHA2"

			CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ATTACH2
				UDF_DIM	ROTX 180
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX 0
				UDF_DIM	LOCY 0
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ATTACH2 CSYS 0
			END_CREATE_UDF
	END_IF

	PRINT "%" LOCK_REINFORCEMENT	
	RETRIEVE_MDL &LOCK_REINFORCEMENT COMP
	
	SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT

	ASSEMBLE COMP DOOR_ASM
		 CSYS ATTACH2 PLACEMENT
	END_ASSEMBLE

	IF SPECIAL_BOX_DEPTH == 1
		SET_MDL_PARAM COMP "STOCKTYPE" 1
		SET_MDL_PARAM COMP "EMJACNUM" "999"
		SET_MDL_PARAM COMP "BOX_DEPTH" MORTISE_BOX_DEPTH
		
		CALL_EX instantiate.tab
			VAR_IN	COMP	COMP
		END_CALL_EX	
	END_IF
	
! ELECTRIC	
	! BEGIN_CATCH_ERROR							
		! SEARCH_MDL_REF COMP CSYS "ELEC" MORT_ELEC	
		! IF EPT > 0 AND EPT_ELEC <> "" AND MORT_ELEC <> ""
			! CREATE_UDF udf\wire DOOR_ASM
			! UDF_REF ATTACH MORT_ELEC
			! UDF_DIM d1329 -10
			! UDF_DIM d1334 DOOR_WIDTH - 6.75 - 2
			! UDF_DIM d1335 -10
			! UDF_DIM d1339 DOOR_WIDTH - 6.5 - .6875
			! UDF_DIM d1340 (JOH-EPT_CTR-3.9375)-(PRIMARY_STRIKE_CENTER+PRIMARY_LOCK_OFFSET+3) -.668
			! END_CREATE_UDF
		! END_IF
	! END_CATCH_ERROR
END_IF

END_ASM_DESCR
