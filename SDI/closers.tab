BEGIN_GUI_DESCR

	SHOW_PARAM STRING 	PROCESS_MESSAGE
	SHOW_PARAM STRING 	ITEM_NUM
	SHOW_PARAM STRING 	SUB_TYPE
	SHOW_PARAM INTEGER	OPENING_TYPE
	SHOW_PARAM STRING 	DOOR_ITEM_DESC
	SHOW_PARAM STRING 	FRAME_ITEM_DESC
		
	IF SUB_TYPE == "P"
		CHECKBOX_PARAM INTEGER EQUAL_CLOSERS "YES/NO"
	END_IF

	IF CLOSER_TYPE <> 0
		USER_INPUT_PARAM STRING CLOSER_MODEL
	END_IF
	
	IF CLOSER_TYPE == 1
		USER_INPUT_PARAM DOUBLE	SURFACE_CLOSER_LENGTH
		USER_INPUT_PARAM DOUBLE	SURFACE_CLOSER_WIDTH
	END_IF
	
	IF CLOSER_TYPE == 2
		USER_INPUT_PARAM STRING	CONCEALED_CLOSER_MANUFACTURER	
		USER_INPUT_PARAM STRING	CONCEALED_CLOSER_MODEL_NUMBER	
	END_IF	
	
	RADIOBUTTON_PARAM INTEGER CLOSER_TYPE "NONE" "SURFACE" "CONCEALED"

	IF CLOSER_TYPE == 3
		SURFACE_CLOSER_LENGTH = 99
	END_IF
	
END_GUI_DESCR

BEGIN_ASM_DESCR

	DECLARE_VARIABLE INTEGER 	OPERATION
	DECLARE_VARIABLE STRING 	PROCESS_MESSAGE
	DECLARE_VARIABLE STRING 	ITEM_NUM
	DECLARE_VARIABLE STRING 	SUB_TYPE
	DECLARE_VARIABLE INTEGER 	OPENING_TYPE
	DECLARE_VARIABLE STRING 	DOOR_ITEM_DESC
	DECLARE_VARIABLE STRING 	FRAME_ITEM_DESC
	DECLARE_VARIABLE DOUBLE	LEAD_ALLOWANCE

	DECLARE_VARIABLE INTEGER	EQUAL_CLOSERS
	DECLARE_VARIABLE STRING	CLOSER_MODEL
	DECLARE_VARIABLE INTEGER	CLOSER_TYPE
	DECLARE_VARIABLE INTEGER	CLOSER_SIDE
	DECLARE_VARIABLE STRING	CLOSER_DESC
	DECLARE_VARIABLE DOUBLE	SURFACE_CLOSER_LENGTH
	DECLARE_VARIABLE DOUBLE	SURFACE_CLOSER_WIDTH	
	DECLARE_VARIABLE STRING	CONCEALED_CLOSER_MANUFACTURER	
	DECLARE_VARIABLE STRING	CONCEALED_CLOSER_MODEL_NUMBER	

	DECLARE_VARIABLE STRING	CLOSER_TYPE_DESC
	DECLARE_VARIABLE STRING	CLOSER_SIDE_DESC
	DECLARE_VARIABLE DOUBLE	LOCX
	
	IF OPERATION == 0
		SURFACE_CLOSER_LENGTH = 21
		! CONFIG_ELEM

		IF CLOSER_TYPE == 1
			CLOSER_TYPE_DESC = "SURFACE CLOSER"
		ELSE_IF CLOSER_TYPE == 2
			CLOSER_TYPE_DESC = "CONCEALED CLOSER"
		ELSE_IF CLOSER_TYPE == 3
			CLOSER_TYPE_DESC = "SURFACE HOLDER/STOP"
		ELSE_IF CLOSER_TYPE == 0
			CLOSER_TYPE_DESC = ""
		END_IF
				
		IF CLOSER_TYPE > 0
			CLOSER_DESC = CLOSER_TYPE_DESC
		ELSE
			CLOSER_DESC = ""
		END_IF		
	END_IF
	
	IF OPERATION == 1
	
		IF LEAD_LINED == ""
			LEAD_LINED = 0
		END_IF
		
		IF LEAD_LINED == 0
			LEAD_ALLOWANCE = 0
		ELSE_IF LEAD_LINED == 1
			LEAD_ALLOWANCE = .0625
		ELSE_IF LEAD_LINED == 2
			LEAD_ALLOWANCE = .125
		ELSE_IF LEAD_LINED == 3
			LEAD_ALLOWANCE = .25
		END_IF
	
		!BEGIN DOOR CLOSERS
		IF DOOR_INDEX == 2
			CLOSER_MODEL 					= 	CLOSER_MODEL_2
			CLOSER_TYPE 						=	CLOSER_TYPE_2
			CLOSER_SIDE 						=	CLOSER_SIDE_2
			CLOSER_DESC 						=	CLOSER_DESC_2
			SURFACE_CLOSER_LENGTH 			=	SURFACE_CLOSER_LENGTH_2
			CONCEALED_CLOSER_MANUFACTURER 	=	CONCEALED_CLOSER_MANUFACTURER_2
			CONCEALED_CLOSER_MODEL_NUMBER 	=	CONCEALED_CLOSER_MODEL_NUMBER_2
			
			IF AUTO_OPERATOR == 0 AND HOLDER_STOP == 0
				SURFACE_CLOSER_WIDTH 			=	SURFACE_CLOSER_WIDTH_2
			END_IF
		END_IF

	! 	CORE
	! 0 	"STYRENE" 
	! 1 	"URETHANE" 
	! 2 	"STEEL STIFFENED" 
	! 3 	"450 TEMPERATURE RISE" 
	! 4 	"250 TEMPERATURE RISE"
	! 5 	"HONECOMB"
	! 6 	"BULLET" 
	! 7 	"STEEL STIFF/BULLET" 
	!8	"3 HOUR"
	!9	"STC 45"
		
		IF  HOLDER_STOP == 1 AND HS_TYPE == 1
			SURFACE_CLOSER_LENGTH = DOOR_WIDTH - 3
		END_IF
		
		IF AUTO_OPERATOR == 1 OR MAG_LOCK > 0
				SURFACE_CLOSER_LENGTH = DOOR_WIDTH - 3
				SURFACE_CLOSER_WIDTH = 5.25
		END_IF
		
		IF SURFACE_CLOSER_LENGTH >= DOOR_WIDTH - 3
			SURFACE_CLOSER_LENGTH = DOOR_WIDTH - 3
				IF PRIMARY_STRIKE_TYPE == 83
					SURFACE_CLOSER_LENGTH = SURFACE_CLOSER_LENGTH - 4
				END_IF			
		END_IF
		
		IF CLOSER_TYPE == 1 OR CLOSER_TYPE == 3 OR AUTO_OPERATOR == 1 OR MAG_LOCK == 1
															
			IF	HAND_ == "LHR" OR HAND_ == "RH" OR \
				HAND_ == "LHR1" OR HAND_ == "LHRA1" OR HAND_ == "LHRI1" OR \
				HAND_ == "RH2" OR HAND_ == "RHA2" OR HAND_ == "RHI2"

				SEARCH_MDL_REF DOOR_ASM CSYS "ORIENT" ASM_CSYS
				CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ASM_CSYS
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 180
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX ((DOOR_WIDTH/2) - (SURFACE_CLOSER_LENGTH/2) - 1.5)
				UDF_DIM	LOCY JOH - TOP_GAP - TOP_CHANNEL_DEPTH - (SURFACE_CLOSER_WIDTH/2) - .25
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
			END_IF

			IF	HAND_ == "RHR" OR HAND_ == "LH" OR \
				HAND_ == "RHR2" OR HAND_ == "RHRA2" OR HAND_ == "RHRI2" OR \
				HAND_ == "LH1" OR HAND_ == "LHA1" OR HAND_ == "LHI1"

PRINT "%" DOOR_WIDTH
PRINT "%" SURFACE_CLOSER_LENGTH
PRINT "%" SURFACE_CLOSER_WIDTH
PRINT "%" TOP_CHANNEL_DEPTH
PRINT "%" TOP_GAP
PRINT "%" JOH

				SEARCH_MDL_REF DOOR_ASM CSYS "ORIENT" ASM_CSYS
				CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ASM_CSYS
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX -((DOOR_WIDTH/2) - (SURFACE_CLOSER_LENGTH/2) - 1.5)
				UDF_DIM	LOCY JOH - TOP_GAP - TOP_CHANNEL_DEPTH - (SURFACE_CLOSER_WIDTH/2) - .25
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
			END_IF
			
				RETRIEVE_MDL REINFORCEMENT.ASM COMP							
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP DOOR_ASM
						 CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				
					SET_MDL_PARAM COMP "STOCKTYPE" 2
					SET_MDL_PARAM COMP "EMJACNUM" ""
					SET_MDL_PARAM COMP "EMJACDESC" "Surface Mounted Closer Reinf"
					SET_MDL_PARAM COMP "DOOR_THICKNESS" DOOR_THICKNESS - LEAD_ALLOWANCE
					SET_MDL_PARAM COMP "LENGTH" SURFACE_CLOSER_LENGTH
					SET_MDL_PARAM COMP "WIDTH" SURFACE_CLOSER_WIDTH

					! IF DPS == 1 
						! IF DPS_POSITION == 0 AND SURFACE_CLOSER_LENGTH > DOOR_WIDTH - DPS_CTR - 3
							! SET_MDL_PARAM COMP "DPS" 1
							! SET_MDL_PARAM COMP "COMMENTS" "LASER"
						! END_IF
					! ELSE
						SET_MDL_PARAM COMP "DPS" 0
						SET_MDL_PARAM COMP "COMMENTS" "SHEAR"
					! END_IF
						
					SEARCH_MDL_REF ALLOW_SUPPRESSED COMP FEATURE "LOCK_NOTE" FEAT
					SET_FEATURE_STATE FEAT SUPPRESSED
					
					SET_MDL_PARAM COMP "XX_ORIENT" "H"
					
					CALL_EX instantiate.tab
						VAR_IN	COMP	COMP
					END_CALL_EX	
							
				REGEN_MDL COMP FORCE
				REGEN_MDL COMP FORCE
		END_IF
	END_IF
	
	IF OPERATION == 2
	! FRAME CLOSERS
		IF CLOSER_TYPE == 1 OR CLOSER_TYPE_2 == 1 OR AUTO_OPERATOR == 1
						
			IF SUB_TYPE == "S"
				IF AUTO_OPERATOR == 1 OR MAG_LOCK == 1 OR SURFACE_CLOSER_LENGTH > JOW - 1.55 OR HS_TYPE == 1
					SURFACE_CLOSER_LENGTH = JOW - 1.5
				END_IF
				IF SURFACE_CLOSER_LENGTH > DOOR_WIDTH - 1.55
					SURFACE_CLOSER_LENGTH = DOOR_WIDTH - 1.5
				END_IF
			END_IF
			
			IF SUB_TYPE == "P"			
				IF SURFACE_CLOSER_LENGTH > DOOR_WIDTH - 1.55
					SURFACE_CLOSER_LENGTH = DOOR_WIDTH - 1.5
				END_IF
				IF SURFACE_CLOSER_LENGTH_2 > DOOR_WIDTH_2 - 1.55
					SURFACE_CLOSER_LENGTH_2 = DOOR_WIDTH_2 - 1.5
				END_IF
				IF AUTO_OPERATOR == 1 OR MAG_LOCK == 1 OR COORDINATOR == 1 OR HS_TYPE == 1 OR HS_TYPE_2 == 1
						SURFACE_CLOSER_LENGTH = JOW - 1.5
				END_IF				
			END_IF
				
			SEARCH_MDL_REF FRAME_ASM CSYS "CLSR" CLSR_REF
			IF SUB_TYPE == "S"
				IF HAND == "LHR" OR HAND == "RH"
					CREATE_UDF udf\csys FRAME_ASM
						UDF_REF ATTACH CLSR_REF
						UDF_DIM	ROTX 90
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX  -((JOW/2) - (SURFACE_CLOSER_LENGTH/2) - STOPP)
						UDF_DIM	LOCY FR_THICKNESS + .03
						UDF_DIM	LOCZ FR_THICKNESS + .03
						UDF_EXP_REF ATTACH CSYS 0
					END_CREATE_UDF
				END_IF
				IF HAND == "RHR" OR HAND == "LH"
					CREATE_UDF udf\csys FRAME_ASM
						UDF_REF ATTACH CLSR_REF
						UDF_DIM	ROTX 90
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX (JOW/2) - (SURFACE_CLOSER_LENGTH/2) - STOPP
						UDF_DIM	LOCY FR_THICKNESS + .03
						UDF_DIM	LOCZ FR_THICKNESS + .03
						UDF_EXP_REF ATTACH CSYS 0
					END_CREATE_UDF
				END_IF
		
				RETRIEVE_MDL SMCR.PRT COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT1" PLACEMENT
					ASSEMBLE COMP FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				
						SET_MDL_PARAM COMP "d41" SURFACE_CLOSER_LENGTH
						IF HEAD < 2
							SET_MDL_PARAM COMP "d40" HEAD - .375
						ELSE
							SET_MDL_PARAM COMP "d40" 1.625
						END_IF
						
						CALL_EX instantiate.tab
							VAR_IN	COMP	COMP
						END_CALL_EX
						
						! SET_ON_LAYER COMP "COMPONENTS"
						
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX -90
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 180
					UDF_DIM	LOCX 0
					UDF_DIM	LOCY -STOPP
					UDF_DIM	LOCZ -RABBET
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
						
				RETRIEVE_MDL SMCR.PRT COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT1" PLACEMENT
					ASSEMBLE COMP FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				
						SET_MDL_PARAM COMP "d41" SURFACE_CLOSER_LENGTH
						IF SOFFIT < 1.870
							SET_MDL_PARAM COMP "d40" SOFFIT - .25
						ELSE
							SET_MDL_PARAM COMP "d40" 1.625
						END_IF
							
						CALL_EX instantiate.tab
							VAR_IN	COMP	COMP
						END_CALL_EX
						SET_ON_LAYER COMP "COMPONENTS"					
			END_IF

			IF SUB_TYPE == "P" AND (CLOSER_TYPE == 1 OR AUTO_OPERATOR == 1 OR MAG_LOCK == 1 OR COORDINATOR == 1)
				IF STD_REV == "STD"
					CREATE_UDF udf\csys FRAME_ASM
						UDF_REF ATTACH CLSR_REF
						UDF_DIM	ROTX 90
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX  -((JOW/2) - (SURFACE_CLOSER_LENGTH/2) - STOPP)
						UDF_DIM	LOCY FR_THICKNESS + .03
						UDF_DIM	LOCZ FR_THICKNESS + .03
						UDF_EXP_REF ATTACH CSYS 0
					END_CREATE_UDF
				END_IF
				IF STD_REV == "REV"
					CREATE_UDF udf\csys FRAME_ASM
						UDF_REF ATTACH CLSR_REF
						UDF_DIM	ROTX 90
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX (JOW/2) - (SURFACE_CLOSER_LENGTH/2) - STOPP
						UDF_DIM	LOCY FR_THICKNESS + .03
						UDF_DIM	LOCZ FR_THICKNESS + .03
						UDF_EXP_REF ATTACH CSYS 0
					END_CREATE_UDF
				END_IF
				RETRIEVE_MDL SMCR.PRT COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT1" PLACEMENT
					ASSEMBLE COMP FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				
						SET_MDL_PARAM COMP "d41" SURFACE_CLOSER_LENGTH
						IF HEAD < 2
							SET_MDL_PARAM COMP "d40" HEAD - .375
						ELSE
							SET_MDL_PARAM COMP "d40" 1.625
						END_IF
				
						CALL_EX instantiate.tab
							VAR_IN	COMP	COMP
						END_CALL_EX
						! SET_ON_LAYER COMP "COMPONENTS"
						
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX -90
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 180
					UDF_DIM	LOCX 0
					UDF_DIM	LOCY -STOPP
					UDF_DIM	LOCZ -RABBET
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
						
				RETRIEVE_MDL SMCR.PRT COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT1" PLACEMENT
					ASSEMBLE COMP FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				
						SET_MDL_PARAM COMP "d41" SURFACE_CLOSER_LENGTH
						IF SOFFIT < 1.870
							SET_MDL_PARAM COMP "d40" SOFFIT - .25
						ELSE
							SET_MDL_PARAM COMP "d40" 1.625
						END_IF
				
						CALL_EX instantiate.tab
							VAR_IN	COMP	COMP
						END_CALL_EX
						SET_ON_LAYER COMP "COMPONENTS"				
			END_IF
			
			IF SUB_TYPE == "P" AND CLOSER_TYPE_2 == 1 AND AUTO_OPERATOR <> 1 AND MAG_LOCK <> 1 AND COORDINATOR <> 1
				SEARCH_MDL_REF FRAME_ASM CSYS "CLSR" CLSR_REF		
				IF STD_REV == "REV"
					CREATE_UDF udf\csys FRAME_ASM
						UDF_REF ATTACH CLSR_REF
						UDF_DIM	ROTX 90
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX  -((JOW/2) - (SURFACE_CLOSER_LENGTH_2/2) -STOPP)
						UDF_DIM	LOCY FR_THICKNESS + .03
						UDF_DIM	LOCZ FR_THICKNESS + .03
						UDF_EXP_REF ATTACH CSYS 0
					END_CREATE_UDF
				END_IF
				IF STD_REV == "STD"
					CREATE_UDF udf\csys FRAME_ASM
						UDF_REF ATTACH CLSR_REF
						UDF_DIM	ROTX 90
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX (JOW/2) - (SURFACE_CLOSER_LENGTH_2/2) - STOPP
						UDF_DIM	LOCY FR_THICKNESS + .03
						UDF_DIM	LOCZ FR_THICKNESS + .03
						UDF_EXP_REF ATTACH CSYS 0
					END_CREATE_UDF
				END_IF
				
				RETRIEVE_MDL SMCR.PRT COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT1" PLACEMENT
					ASSEMBLE COMP FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				
						SET_MDL_PARAM COMP "d41" SURFACE_CLOSER_LENGTH_2
						IF HEAD < 2
							SET_MDL_PARAM COMP "d40" HEAD - .375
						ELSE
							SET_MDL_PARAM COMP "d40" 1.625
						END_IF
				
						CALL_EX instantiate.tab
							VAR_IN	COMP	COMP
						END_CALL_EX
						! SET_ON_LAYER COMP "COMPONENTS"
						
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX -90
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 180
					UDF_DIM	LOCX 0
					UDF_DIM	LOCY -STOPP
					UDF_DIM	LOCZ -RABBET
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
						
				RETRIEVE_MDL SMCR.PRT COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT1" PLACEMENT
					ASSEMBLE COMP FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				
						SET_MDL_PARAM COMP "d41" SURFACE_CLOSER_LENGTH_2
						IF SOFFIT < 1.870
							SET_MDL_PARAM COMP "d40" SOFFIT - .25
						ELSE
							SET_MDL_PARAM COMP "d40" 1.625
						END_IF
				
						CALL_EX instantiate.tab
							VAR_IN	COMP	COMP
						END_CALL_EX
						SET_ON_LAYER COMP "COMPONENTS"
			END_IF			
		END_IF
	END_IF		
END_ASM_DESCR	

