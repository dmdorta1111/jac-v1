
BEGIN_ASM_DESCR
	IF DOOR_CONSTRUCTION == "LOCKSEAM"
		HINGE_UDF = "LOCKSEAM"
	END_IF

	IF DOOR_CONSTRUCTION == "SEAMLESS"
		IF WELDED_BOXES == 1
			HINGE_UDF = "WELDED"
		ELSE
			HINGE_UDF = "SEAMLESS"
		END_IF
		IF DOOR_GAUGE == 12
			HINGE_UDF = "SEAMLESS12"
		END_IF
	END_IF

	IF DOOR_GAUGE == 18
		SM_THICK = .05
	ELSE_IF DOOR_GAUGE == 16
		SM_THICK = .06
	ELSE_IF DOOR_GAUGE == 14
		SM_THICK = .075
	ELSE_IF DOOR_GAUGE == 12
		SM_THICK = .105
	END_IF

	DOOR_HEIGHT = JOH - TOP_GAP - UNDERCUT
	
	IF SUB_TYPE == "S"
		DOOR_QTY = 1
		DOOR_WIDTH = JOW - HINGE_GAP - STRIKE_GAP
		HAND_ = HAND
	ELSE_IF SUB_TYPE == "P"
		DOOR_QTY = 2
	END_IF

	DOOR_INDEX = 1
	WHILE DOOR_INDEX <= DOOR_QTY

		SEARCH_MDL_REF ASSEM CSYS "DOOR" ATTACH

		IF DOOR_QTY == 2 AND DOOR_INDEX == 1
			IF ACTIVE_LEAF < 1 OR ACTIVE_LEAF == JOW/2 OR ACTIVE_LEAF == 99
				DOOR_WIDTH = (JOW - HINGE_GAP - HINGE_GAP - STRIKE_GAP)/2
			ELSE_IF HAND == "LHA" OR HAND == "LHRA"
				DOOR_WIDTH = (ACTIVE_LEAF - HINGE_GAP - (STRIKE_GAP/2))
			ELSE_IF HAND == "RHA" OR HAND == "RHRA"
				DOOR_WIDTH = JOW - ACTIVE_LEAF - HINGE_GAP - (STRIKE_GAP/2)
			ELSE
				DOOR_WIDTH = (JOW - HINGE_GAP - HINGE_GAP - STRIKE_GAP)/2
			END_IF

			IF HAND == "LH/RH"
				HAND_ = "LH1"
			ELSE_IF HAND == "LHA"
				HAND_ = "LHA1"
			ELSE_IF HAND == "RHA"
				HAND_ = "LHI1"
			ELSE_IF HAND == "LHR/RHR"
				HAND_ = "LHR1"
			ELSE_IF HAND == "LHRA"
				HAND_ = "LHRA1"
			ELSE_IF HAND == "RHRA"
				HAND_ = "LHRI1"
			END_IF

			CREATE_UDF udf\csys ASSEM
				UDF_REF ATTACH ATTACH
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX -((JOW/2) - HINGE_GAP - (DOOR_WIDTH/2))
				UDF_DIM	LOCY 0
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ATTACH CSYS 0
			END_CREATE_UDF
		ELSE_IF DOOR_QTY == 2 AND DOOR_INDEX == 2
			IF ACTIVE_LEAF < 1 OR ACTIVE_LEAF == JOW/2 OR ACTIVE_LEAF == 99
				DOOR_WIDTH = (JOW - HINGE_GAP - HINGE_GAP - STRIKE_GAP)/2
			ELSE_IF HAND == "LHA" OR HAND == "LHRA"
				DOOR_WIDTH = JOW - ACTIVE_LEAF - HINGE_GAP - (STRIKE_GAP/2)
			ELSE_IF HAND == "RHA" OR HAND == "RHRA"
				DOOR_WIDTH = (ACTIVE_LEAF - HINGE_GAP - (STRIKE_GAP/2))
			ELSE
				DOOR_WIDTH = (JOW - HINGE_GAP - HINGE_GAP - STRIKE_GAP)/2
			END_IF

			IF HAND == "LH/RH"
				HAND_ = "RH2"
			ELSE_IF HAND == "LHA"
				HAND_ = "RHI2"
			ELSE_IF HAND == "RHA"
				HAND_ = "RHA2"
			ELSE_IF HAND == "LHR/RHR"
				HAND_ = "RHR2"
			ELSE_IF HAND == "LHRA"
				HAND_ = "RHRI2"
			ELSE_IF HAND == "RHRA"
				HAND_ = "RHRA2"
			END_IF

			CREATE_UDF udf\csys ASSEM
				UDF_REF ATTACH ATTACH
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX ((JOW/2) - HINGE_GAP - (DOOR_WIDTH/2))
				UDF_DIM	LOCY 0
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ATTACH CSYS 0
			END_CREATE_UDF
		END_IF

		RETRIEVE_MDL DOOR_S.ASM DOOR_ASM

		! SEARCH_MDL_REF ASSEM CSYS "DOOR" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" PLACEMENT
			ASSEMBLE DOOR_ASM ASSEM
				CSYS ATTACH PLACEMENT
			END_ASSEMBLE
		SET_MDL_NAME DOOR_ASM "DOOR_ASM_"+itos(DOOR_INDEX)+"_"+SO_NUM+"_"+ ITEM_NUM
		SEARCH_MDL_REF RECURSIVE ASSEM COMPONENT "*DOOR_ASM_"+itos(DOOR_INDEX)+"_*" DOOR_ASM
		REGEN_MDL ASSEM

		SEARCH_MDL_REF DOOR_ASM COMPONENT "BODY*" BODY
		SET_MDL_NAME BODY "BODY_"+itos(DOOR_INDEX)+"_"+SO_NUM+"_"+ITEM_NUM
		SEARCH_MDL_REF RECURSIVE ASSEM COMPONENT "BODY_"+itos(DOOR_INDEX)+"_"+SO_NUM+"_"+ITEM_NUM BODY
		SET_MDL_PARAM BODY "FINISH" BODY_SIDE_FINISH
		SET_MDL_PARAM BODY "GRADE" DOOR_GRADE
		SET_MDL_PARAM BODY "SMT_THICKNESS" SM_THICK
		! SET_MDL_PARAM BODY "EMJACNUM" "BODY_"+itos(DOOR_INDEX)+"_"+ITEM_NUM

		SEARCH_MDL_REF DOOR_ASM COMPONENT "COVER*" COVER
		SET_MDL_NAME COVER "COVER_"+itos(DOOR_INDEX)+"_"+SO_NUM+"_"+ITEM_NUM
		SEARCH_MDL_REF RECURSIVE ASSEM COMPONENT "COVER_"+itos(DOOR_INDEX)+"_"+SO_NUM+"_"+ITEM_NUM COVER
		SET_MDL_PARAM COVER "FINISH" COVER_SIDE_FINISH
		SET_MDL_PARAM COVER "GRADE" DOOR_GRADE
		SET_MDL_PARAM COVER "SMT_THICKNESS" SM_THICK
		! SET_MDL_PARAM COVER "EMJACNUM" "COVER_"+itos(DOOR_INDEX)+"_"+ITEM_NUM

		SET_MDL_PARAM DOOR_ASM "CUSTOMER_NAME" CUSTOMER_NAME
		SET_MDL_PARAM DOOR_ASM "JOB_NAME" JOB_NAME
		SET_MDL_PARAM DOOR_ASM "SO_NUM" SO_NUM

		SET_MDL_PARAM DOOR_ASM "SUB_JOB_NAME" SUB_JOB_NAME
		SET_MDL_PARAM DOOR_ASM "ITEM_NUM" ITEM_NUM
		SET_MDL_PARAM DOOR_ASM "QTY" QTY
		SET_MDL_PARAM DOOR_ASM "ITEM_DESC" DOOR_ITEM_DESC

		SET_MDL_PARAM DOOR_ASM "DOOR_WIDTH" DOOR_WIDTH
		SET_MDL_PARAM DOOR_ASM "DOOR_HEIGHT" DOOR_HEIGHT
		SET_MDL_PARAM DOOR_ASM "HAND" HAND_
		SET_MDL_PARAM DOOR_ASM "UNDERCUT" UNDERCUT
		SET_MDL_PARAM DOOR_ASM "DR_THICKNESS" DOOR_THICKNESS
		SET_MDL_PARAM DOOR_ASM "SM_THICK" SM_THICK

		IF	HAND_ == "LHR" OR HAND_ == "RH" OR \
			HAND_ == "LHR1" OR HAND_ == "LHRA1" OR HAND_ == "LHRI1" OR \
			HAND_ == "RH2" OR HAND_ == "RHA2" OR HAND_ == "RHI2"

			IF HINGE_EDGE_SHAPE == "BEVEL"
				SET_MDL_PARAM DOOR_ASM "BEVEL1" 4
			ELSE_IF HINGE_EDGE_SHAPE == "SQUARE"
				SET_MDL_PARAM DOOR_ASM "BEVEL1" 0
			END_IF
			IF STRIKE_EDGE_SHAPE == "BEVEL"
				SET_MDL_PARAM DOOR_ASM "BEVEL2" -4
			ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
				SET_MDL_PARAM DOOR_ASM "BEVEL2" 0
			END_IF
		END_IF

		IF	HAND_ == "RHR" OR HAND_ == "LH" OR \
			HAND_ == "RHR2" OR HAND_ == "RHRA2" OR HAND_ == "RHRI2" OR \
			HAND_ == "LH1" OR HAND_ == "LHA1" OR HAND_ == "LHI1"

			IF HINGE_EDGE_SHAPE == "BEVEL"
				SET_MDL_PARAM DOOR_ASM "BEVEL2" -4
			ELSE_IF HINGE_EDGE_SHAPE == "SQUARE"
				SET_MDL_PARAM DOOR_ASM "BEVEL2" 0
			END_IF
			IF STRIKE_EDGE_SHAPE == "BEVEL"
				SET_MDL_PARAM DOOR_ASM "BEVEL1" 4
			ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
				SET_MDL_PARAM DOOR_ASM "BEVEL1" 0
			END_IF
		END_IF

		SET_CURRENT_MDL ASSEM
		REGEN_MDL ASSEM

		IF DOOR_CONSTRUCTION == "SEAMLESS"
			SEARCH_MDL_REF DOOR_ASM COMPONENT "BODY*" BODY
			SEARCH_MDL_REF ALLOW_SUPPRESSED BODY FEATURE "SEAMLESS_1" refFeat
			SET_FEATURE_STATE refFeat RESUMED
			SEARCH_MDL_REF ALLOW_SUPPRESSED BODY FEATURE "SEAMLESS_2" refFeat
			SET_FEATURE_STATE refFeat RESUMED
			IF TOP_EDGE == "SEAMLESS"
				SEARCH_MDL_REF ALLOW_SUPPRESSED BODY FEATURE "TOP_SEAMLESS" refFeat
				SET_FEATURE_STATE refFeat RESUMED
			END_IF
			IF BOTTOM_EDGE == "SEAMLESS"
				IF AUTO_BOTTOM == 2
					SEARCH_MDL_REF ALLOW_SUPPRESSED BODY FEATURE "SEAMLESS_AUTO_BOTTOM" refFeat
					SET_FEATURE_STATE refFeat RESUMED
				ELSE
					SEARCH_MDL_REF ALLOW_SUPPRESSED BODY FEATURE "BOTTOM_SEAMLESS" refFeat
					SET_FEATURE_STATE refFeat RESUMED
				END_IF
			END_IF
			SEARCH_MDL_REF DOOR_ASM COMPONENT "COVER*" COVER
			SEARCH_MDL_REF ALLOW_SUPPRESSED COVER FEATURE "SEAMLESS_2" refFeat
			SET_FEATURE_STATE refFeat RESUMED
			SEARCH_MDL_REF ALLOW_SUPPRESSED COVER FEATURE "SEAMLESS_1" refFeat
			SET_FEATURE_STATE refFeat RESUMED
			IF TOP_EDGE == "SEAMLESS"
				SEARCH_MDL_REF ALLOW_SUPPRESSED COVER FEATURE "TOP_SEAMLESS" refFeat
				SET_FEATURE_STATE refFeat RESUMED
			END_IF
			IF BOTTOM_EDGE == "SEAMLESS"
				IF AUTO_BOTTOM == 2
					SEARCH_MDL_REF ALLOW_SUPPRESSED COVER FEATURE "SEAMLESS_AUTO_BOTTOM" refFeat
					SET_FEATURE_STATE refFeat RESUMED
				ELSE
					SEARCH_MDL_REF ALLOW_SUPPRESSED COVER FEATURE "BOTTOM_SEAMLESS" refFeat
					SET_FEATURE_STATE refFeat RESUMED
				END_IF
			END_IF
		ELSE_IF DOOR_CONSTRUCTION == "LOCKSEAM"
			SEARCH_MDL_REF DOOR_ASM COMPONENT "BODY*" BODY
			SEARCH_MDL_REF ALLOW_SUPPRESSED BODY FEATURE "LOCKSEAM_1" refFeat
			SET_FEATURE_STATE refFeat RESUMED
			SEARCH_MDL_REF ALLOW_SUPPRESSED BODY FEATURE "LOCKSEAM_2" refFeat
			SET_FEATURE_STATE refFeat RESUMED
			SEARCH_MDL_REF DOOR_ASM COMPONENT "COVER*" COVER
			SEARCH_MDL_REF ALLOW_SUPPRESSED COVER FEATURE "LOCKSEAM_1" refFeat
			SET_FEATURE_STATE refFeat RESUMED
			SEARCH_MDL_REF ALLOW_SUPPRESSED COVER FEATURE "LOCKSEAM_2" refFeat
			SET_FEATURE_STATE refFeat RESUMED
		ELSE_IF DOOR_CONSTRUCTION == "BULLNOSE"
			SEARCH_MDL_REF DOOR_ASM COMPONENT "BODY*" BODY
			SEARCH_MDL_REF ALLOW_SUPPRESSED BODY FEATURE "BULLNOSE_1" refFeat
			SET_FEATURE_STATE refFeat RESUMED
			SEARCH_MDL_REF ALLOW_SUPPRESSED BODY FEATURE "BULLNOSE_2" refFeat
			SET_FEATURE_STATE refFeat RESUMED
			SEARCH_MDL_REF DOOR_ASM COMPONENT "COVER*" COVER
			SEARCH_MDL_REF ALLOW_SUPPRESSED COVER FEATURE "BULLNOSE_1" refFeat
			SET_FEATURE_STATE refFeat RESUMED
			SEARCH_MDL_REF ALLOW_SUPPRESSED COVER FEATURE "BULLNOSE_2" refFeat
			SET_FEATURE_STATE refFeat RESUMED
		END_IF
		
		REGEN_MDL ASSEM
		
		IF DOOR_LITE == 2 OR (HAND_ == "*A*" AND DOOR_LITE == 0) OR (HAND_ == "*I*" AND DOOR_LITE == 1)					
			IF DOOR_ELEVATION == "M1-1"
				CALL m1_1.tab
			END_IF

			IF DOOR_ELEVATION == "M1-3"
				CALL m1_3.tab
			END_IF

			IF DOOR_ELEVATION == "M2"
				CALL M2.tab
			END_IF
			
			IF VISION_SHAPE == "SQUARE" AND DOOR_LITE_TRIM_TYPE == "B"
				CALL vision_b.tab
			END_IF

			IF VISION_SHAPE == "SQUARE" AND DOOR_LITE_TRIM_TYPE == "C"
				CALL vision_c.tab
			END_IF

			IF VISION_SHAPE == "SQUARE" AND DOOR_LITE_TRIM_TYPE == "D" AND DOOR_ELEVATION <> "M*"
				CALL vision_d.tab
			END_IF
										
			IF VISION_SHAPE == "SQUARE" AND DOOR_LITE_TRIM_TYPE == "E"
				CALL vision_e.tab
			END_IF
			
			IF VISION_SHAPE == "SQUARE" AND DOOR_LITE_TRIM_TYPE == "F" AND DOOR_ELEVATION <> "M*"
				CALL vision_f.tab
			END_IF							
		END_IF

		IF SUB_TYPE == "P" AND ASTRAGAL == "YES"	AND (HAND_ == "LHRA1" OR 	HAND_ == "RHRA2")
			IF	HAND_ == "LHRA1"
				SEARCH_MDL_REF DOOR_ASM CSYS "ACS4" ASM_CSYS
				CREATE_UDF udf\csys DOOR_ASM
					UDF_REF ATTACH ASM_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX .125
					UDF_DIM	LOCY UNDERCUT + (DOOR_HEIGHT/2)
					UDF_DIM	LOCZ 1
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
			END_IF

			IF	HAND_ == "RHRA2"
				SEARCH_MDL_REF DOOR_ASM CSYS "ACS3" ASM_CSYS
				CREATE_UDF udf\csys DOOR_ASM
					UDF_REF ATTACH ASM_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX .125
					UDF_DIM	LOCY UNDERCUT + (DOOR_HEIGHT/2)
					UDF_DIM	LOCZ -1
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
			END_IF

			RETRIEVE_MDL ASTRAGAL.PRT COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			ASSEMBLE COMP DOOR_ASM
				 CSYS ATTACH PLACEMENT
			END_ASSEMBLE

			INSERT_FAMINSTANCE COMP "ASTRAGAL_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
			SET_FAMITEM_VALUE COMP "ASTRAGAL_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" DOOR_HEIGHT
			SET_FAMITEM_VALUE COMP "ASTRAGAL_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" ASTRAGAL_WIDTH
			SET_FAMITEM_VALUE COMP "ASTRAGAL_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "GRADE" DOOR_GRADE
			SET_FAMITEM_VALUE COMP "ASTRAGAL_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "FINISH" BODY_SIDE_FINISH
			GET_REF_FAMINSTANCE COMP "ASTRAGAL_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
			REPLACE_COMPONENT COMP INST
		END_IF

		IF SUB_TYPE == "P" AND ASTRAGAL == "YES"	AND (HAND_ == "LHA1" OR 	HAND_ == "RHA2")
			IF	HAND_ == "RHA2"
				SEARCH_MDL_REF DOOR_ASM CSYS "ACS4" ASM_CSYS
				CREATE_UDF udf\csys DOOR_ASM
					UDF_REF ATTACH ASM_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 180
					UDF_DIM	LOCX .125
					UDF_DIM	LOCY UNDERCUT + ((DOOR_HEIGHT-STOPP)/2)
					UDF_DIM	LOCZ -1
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
			END_IF

			IF	HAND_ == "LHA1"
				SEARCH_MDL_REF DOOR_ASM CSYS "ACS3" ASM_CSYS
				CREATE_UDF udf\csys DOOR_ASM
					UDF_REF ATTACH ASM_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 180
					UDF_DIM	LOCX .125
					UDF_DIM	LOCY UNDERCUT + ((DOOR_HEIGHT-STOPP)/2)
					UDF_DIM	LOCZ 1
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
			END_IF

			RETRIEVE_MDL ASTRAGAL.PRT COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			ASSEMBLE COMP DOOR_ASM
				 CSYS ATTACH PLACEMENT
			END_ASSEMBLE

			INSERT_FAMINSTANCE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
			SET_FAMITEM_VALUE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" DOOR_HEIGHT - STOPP
			SET_FAMITEM_VALUE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" ASTRAGAL_WIDTH
			SET_FAMITEM_VALUE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "GRADE" DOOR_GRADE
			SET_FAMITEM_VALUE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "FINISH" COVER_SIDE_FINISH
			GET_REF_FAMINSTANCE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
			REPLACE_COMPONENT COMP INST
		END_IF

		IF HINGE_TYPE == "BUTT"
			DECLARE_VARIABLE STRING LOOKUPSTRINGNO
							LOOKUPSTRINGNO = "HINGE_HEIGHT == " + ftos(HINGE_HEIGHT,3) + " AND HINGE_THICKNESS == " + ftos(HINGE_THICKNESS,3) + \
							 " AND DR_GA == " + ftos(SM_THICK,3) + " AND GRADE == " + DOOR_GRADE + " AND ELEC == 0"+ " AND WELDED_BOX == " + itos(WELDED_BOXES)
			DECLARE_VARIABLE STRING LOOKUPSTRINGYES
							LOOKUPSTRINGYES = "HINGE_HEIGHT == " + ftos(HINGE_HEIGHT,3) + " AND HINGE_THICKNESS == " + ftos(HINGE_THICKNESS,3)	 + \
							" AND DR_GA == " + ftos(SM_THICK,3) + " AND GRADE == " + DOOR_GRADE	+ " AND ELEC == 1"+ " AND WELDED_BOX == " + itos(WELDED_BOXES)

			IF	HAND_ == "LHR" OR HAND_ == "RH" OR \
				HAND_ == "LHR1" OR HAND_ == "LHRA1" OR HAND_ == "LHRI1" OR \
				HAND_ == "RH2" OR HAND_ == "RHA2" OR HAND_ == "RHI2"

				SEARCH_MDL_REF DOOR_ASM CSYS "ACS11" ASM_CSYS
				CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ASM_CSYS
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX 0
				UDF_DIM	LOCY JOH
				UDF_DIM	LOCZ 0
				UDF_EXP_REF refCsys CSYS 0
				END_CREATE_UDF

					HINGE_INDEX = 1
				FOR LOCY REF ARRAY HINGE_LOCATIONS_ARRAY
					CREATE_UDF udf\door_hinge DOOR_ASM
					UDF_INSTANCE HINGE_UDF
					UDF_REF ATTACH refCsys
					UDF_DIM LOCY -LOCY
					UDF_DIM HINGE_Z SM_THICK + SM_THICK + DOOR_THICKNESS -.12 - DOOR_HINGE_SETBACK
					UDF_DIM HINGE_Y HINGE_HEIGHT + DOOR_HINGE_HEIGHT_ALLOWANCE
					UDF_DIM HINGE_X -(HINGE_THICKNESS+ DOOR_HINGE_THICKNESS_ALLOWANCE)
					UDF_EXP_REF LOC+itos(HINGE_INDEX) CSYS 0
					UDF_INTERSECTION * PART_LEVEL
					END_CREATE_UDF

					RETRIEVE_MDL door_hinge_asm.asm HINGE_ASM
					SEARCH_MDL_REF HINGE_ASM CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE HINGE_ASM DOOR_ASM
						CSYS LOC+itos(HINGE_INDEX) PLACEMENT
					END_ASSEMBLE

					IF ELECTRIC_HINGE_POSITION == HINGE_INDEX
						LOOKUP_FAMINSTANCE HINGE_ASM LOOKUPSTRINGYES instance_name
						GET_REF_FAMINSTANCE HINGE_ASM instance_name instance
						REPLACE_COMPONENT HINGE_ASM instance

					ELSE
						LOOKUP_FAMINSTANCE HINGE_ASM LOOKUPSTRINGNO instance_name
						GET_REF_FAMINSTANCE HINGE_ASM instance_name instance
						REPLACE_COMPONENT HINGE_ASM instance
					END_IF

					REGEN_MDL DOOR_ASM
					COPY_REF LOC+itos(HINGE_INDEX) DIM_REF
					HINGE_INDEX ++
				END_FOR
			END_IF

			IF	HAND_ == "RHR" OR HAND_ == "LH" OR \
				HAND_ == "RHR2" OR HAND_ == "RHRA2" OR HAND_ == "RHRI2" OR \
				HAND_ == "LH1" OR HAND_ == "LHA1" OR HAND_ == "LHI1"

				SEARCH_MDL_REF DOOR_ASM CSYS "ACS12" ASM_CSYS
				CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ASM_CSYS
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX 0
				UDF_DIM	LOCY -JOH
				UDF_DIM	LOCZ 0
				UDF_EXP_REF refCsys CSYS 0
				END_CREATE_UDF

					HINGE_INDEX = 1
				FOR LOCY REF ARRAY HINGE_LOCATIONS_ARRAY
					CREATE_UDF udf\door_hinge DOOR_ASM
					UDF_INSTANCE HINGE_UDF
					UDF_REF ATTACH refCsys
					UDF_DIM LOCY LOCY
					UDF_DIM HINGE_Z SM_THICK + SM_THICK + DOOR_THICKNESS -.12 - DOOR_HINGE_SETBACK
					UDF_DIM HINGE_Y HINGE_HEIGHT + DOOR_HINGE_HEIGHT_ALLOWANCE
					UDF_DIM HINGE_X -(HINGE_THICKNESS+ DOOR_HINGE_THICKNESS_ALLOWANCE)
					UDF_EXP_REF LOC+itos(HINGE_INDEX) CSYS 0
					UDF_INTERSECTION * PART_LEVEL
					END_CREATE_UDF

					RETRIEVE_MDL door_hinge_asm.asm HINGE_ASM
					SEARCH_MDL_REF HINGE_ASM CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE HINGE_ASM DOOR_ASM
						CSYS LOC+itos(HINGE_INDEX) PLACEMENT
					END_ASSEMBLE

					IF ELECTRIC_HINGE_POSITION == HINGE_INDEX
						LOOKUP_FAMINSTANCE HINGE_ASM LOOKUPSTRINGYES instance_name
						GET_REF_FAMINSTANCE HINGE_ASM instance_name instance
						REPLACE_COMPONENT HINGE_ASM instance
					ELSE
						LOOKUP_FAMINSTANCE HINGE_ASM LOOKUPSTRINGNO instance_name
						GET_REF_FAMINSTANCE HINGE_ASM instance_name instance
						REPLACE_COMPONENT HINGE_ASM instance
					END_IF

					REGEN_MDL DOOR_ASM
					COPY_REF LOC+itos(HINGE_INDEX) DIM_REF
					HINGE_INDEX ++
				END_FOR
			END_IF
		END_IF
		! END DOOR BUTT HINGE PREPS

		! BEGIN DOOR PREPS - CONTINUOUS HINGE
		IF HINGE_TYPE == "CONTINUOUS"

			DECLARE_VARIABLE DOUBLE BU_WIDTH
			DECLARE_VARIABLE DOUBLE BU_LOC

			IF DOOR_CONSTRUCTION == "SEAMLESS"
				BU_WIDTH = DOOR_THICKNESS - .25
				BU_LOC = SM_THICK - .0625 + (DOOR_THICKNESS/2)
			ELSE_IF DOOR_CONSTRUCTION == "LOCKSEAM"
				BU_WIDTH = DOOR_THICKNESS - .4375
				BU_LOC = (SM_THICK - .0625 + (DOOR_THICKNESS/2)) - .09375
			END_IF

			IF	HAND_ == "LHR" OR HAND_ == "RH" OR \
				HAND_ == "LHR1" OR HAND_ == "LHRA1" OR HAND_ == "LHRI1" OR \
				HAND_ == "RH2" OR HAND_ == "RHA2" OR HAND_ == "RHI2"

				SEARCH_MDL_REF DOOR_ASM CSYS "ACS11" ASM_CSYS
				CREATE_UDF udf\csys DOOR_ASM
					UDF_REF ATTACH ASM_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX -SM_THICK
					UDF_DIM	LOCY JOH - TOP_GAP -.25
					UDF_DIM	LOCZ BU_LOC
					UDF_EXP_REF ASM_CSYS CSYS 0
				END_CREATE_UDF

				RETRIEVE_MDL BU_FLAT.PRT COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
				ASSEMBLE COMP DOOR_ASM
					 CSYS ASM_CSYS PLACEMENT
				END_ASSEMBLE

				INSERT_FAMINSTANCE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
					IF EPT == 1
						SET_FAMITEM_VALUE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" EPT_CTR - (EPT_HEIGHT/2) - .5
					ELSE
						SET_FAMITEM_VALUE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" JOH - TOP_GAP - TOP_CHANNEL_DEPTH - UNDERCUT - BOTTOM_CHANNEL_DEPTH
					END_IF
				SET_FAMITEM_VALUE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" BU_WIDTH
				SET_FAMITEM_VALUE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "SMT_THICKNESS" .075
				GET_REF_FAMINSTANCE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
				REPLACE_COMPONENT COMP INST
				
				IF EPT == 1
					CREATE_UDF udf\csys DOOR_ASM
						UDF_REF ATTACH ASM_CSYS
						UDF_DIM	ROTX 0
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX 0
						UDF_DIM	LOCY -(EPT_CTR + (EPT_HEIGHT/2)-.25)
						UDF_DIM	LOCZ 0
						UDF_EXP_REF ASM_CSYS CSYS 0
					END_CREATE_UDF

					RETRIEVE_MDL BU_FLAT.PRT COMP
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP DOOR_ASM
						 CSYS ASM_CSYS PLACEMENT
					END_ASSEMBLE

					INSERT_FAMINSTANCE COMP "COMP_1A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
					SET_FAMITEM_VALUE COMP "COMP_1A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" JOH - TOP_GAP - TOP_CHANNEL_DEPTH - UNDERCUT - EPT_CTR - (EPT_HEIGHT/2) - BOTTOM_CHANNEL_DEPTH
					SET_FAMITEM_VALUE COMP "COMP_1A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" BU_WIDTH
					SET_FAMITEM_VALUE COMP "COMP_1A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "SMT_THICKNESS" 0.075
					GET_REF_FAMINSTANCE COMP "COMP_1A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
					REPLACE_COMPONENT COMP INST
					INVALIDATE_REF COMP
				END_IF							
				
			END_IF

			IF	HAND_ == "RHR" OR HAND_ == "LH" OR \
				HAND_ == "RHR2" OR HAND_ == "RHRA2" OR HAND_ == "RHRI2" OR \
				HAND_ == "LH1" OR HAND_ == "LHA1" OR HAND_ == "LHI1"

				SEARCH_MDL_REF DOOR_ASM CSYS "ACS12" ASM_CSYS
				CREATE_UDF udf\csys DOOR_ASM
					UDF_REF ATTACH ASM_CSYS
					UDF_DIM	ROTX 180
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX -SM_THICK
					UDF_DIM	LOCY -(JOH - TOP_GAP -.25)
					UDF_DIM	LOCZ BU_LOC
					UDF_EXP_REF ASM_CSYS CSYS 0
				END_CREATE_UDF

				RETRIEVE_MDL BU_FLAT.PRT COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
				ASSEMBLE COMP DOOR_ASM
					 CSYS ASM_CSYS PLACEMENT
				END_ASSEMBLE

				INSERT_FAMINSTANCE COMP "COMP_2_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
				IF EPT == 1
					SET_FAMITEM_VALUE COMP "COMP_2_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" EPT_CTR - (EPT_HEIGHT/2) - .5
				ELSE
					SET_FAMITEM_VALUE COMP "COMP_2_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" JOH - TOP_GAP - TOP_CHANNEL_DEPTH - UNDERCUT - BOTTOM_CHANNEL_DEPTH
				END_IF
				SET_FAMITEM_VALUE COMP "COMP_2_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" BU_WIDTH
				SET_FAMITEM_VALUE COMP "COMP_2_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "SMT_THICKNESS" .075
				GET_REF_FAMINSTANCE COMP "COMP_2_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
				REPLACE_COMPONENT COMP INST
				INVALIDATE_REF COMP
				
				IF EPT == 1
					CREATE_UDF udf\csys DOOR_ASM
						UDF_REF ATTACH ASM_CSYS
						UDF_DIM	ROTX 0
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX 0
						UDF_DIM	LOCY -(EPT_CTR + (EPT_HEIGHT/2)-.25)
						UDF_DIM	LOCZ 0
						UDF_EXP_REF ASM_CSYS CSYS 0
					END_CREATE_UDF

					RETRIEVE_MDL BU_FLAT.PRT COMP
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP DOOR_ASM
						 CSYS ASM_CSYS PLACEMENT
					END_ASSEMBLE

					INSERT_FAMINSTANCE COMP "COMP_2A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
					SET_FAMITEM_VALUE COMP "COMP_2A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" JOH - TOP_GAP - TOP_CHANNEL_DEPTH - UNDERCUT - EPT_CTR - (EPT_HEIGHT/2) - BOTTOM_CHANNEL_DEPTH
					SET_FAMITEM_VALUE COMP "COMP_2A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" BU_WIDTH
					SET_FAMITEM_VALUE COMP "COMP_2A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "SMT_THICKNESS" .075
					GET_REF_FAMINSTANCE COMP "COMP_2A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
					REPLACE_COMPONENT COMP INST
					INVALIDATE_REF COMP
				END_IF							
			END_IF
		END_IF
		! END DOOR PREPS - CONTINUOUS HINGE

		IF TOP_EDGE == "INVERTED" OR TOP_EDGE == "FLUSH"
			SEARCH_MDL_REF DOOR_ASM CSYS "TOP_CHANNEL" ATTACH

			RETRIEVE_MDL CLOSURE_CHANNEL.PRT COMP
			IF OPERATION == 4
				SET_MDL_PARAM COMP "CUSTOMER_NAME" CUSTOMER_NAME
				SET_MDL_PARAM COMP "JOB_NAME" JOB_NAME
				SET_MDL_PARAM COMP "SUB_JOB_NAME" SUB_JOB_NAME
				RETRIEVE_MDL CLOSURE_CHANNEL.DRW COMPD
				SAVE_MDL COMPD
				ERASE_MDL COMPD
			END_IF

			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
				ASSEMBLE COMP DOOR_ASM
					 CSYS ATTACH PLACEMENT
				END_ASSEMBLE

			SEARCH_MDL_PARAM COMP "EMJACNUM" EMJACNUM
			INSERT_FAMINSTANCE COMP "TOP_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
			SET_FAMITEM_VALUE COMP "TOP_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "STOCKTYPE" 1
			SET_FAMITEM_VALUE COMP "TOP_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "EMJACNUM" EMJACNUM+"-"+itos(DOOR_INDEX)+"-"+ITEM_NUM
			SET_FAMITEM_VALUE COMP "TOP_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "GRADE" DOOR_GRADE
			SET_FAMITEM_VALUE COMP "TOP_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" DOOR_WIDTH - CLOSURE_CHANNEL_CLEARANCE
			SET_FAMITEM_VALUE COMP "TOP_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" DOOR_THICKNESS - .125
			SET_FAMITEM_VALUE COMP "TOP_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "DEPTH" TOP_CHANNEL_DEPTH
			SET_FAMITEM_VALUE COMP "TOP_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "SMT_THICKNESS"  .05
			GET_REF_FAMINSTANCE COMP "TOP_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
			REPLACE_COMPONENT COMP INST

			IF TOP_EDGE == "FLUSH"
				SEARCH_MDL_REF COMP CSYS "ATTACH" ATTACH

				RETRIEVE_MDL FLUSHING_CHANNEL.PRT COMP
				IF OPERATION == 4
					SET_MDL_PARAM COMP "CUSTOMER_NAME" CUSTOMER_NAME
					SET_MDL_PARAM COMP "JOB_NAME" JOB_NAME
					SET_MDL_PARAM COMP "SUB_JOB_NAME" SUB_JOB_NAME
					RETRIEVE_MDL FLUSHING_CHANNEL.DRW COMPD
					SAVE_MDL COMPD
					ERASE_MDL COMPD
				END_IF

				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP DOOR_ASM
						 CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				SEARCH_MDL_PARAM COMP "EMJACNUM" EMJACNUM
				INSERT_FAMINSTANCE COMP "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
				SET_FAMITEM_VALUE COMP "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "STOCKTYPE" 1
				SET_FAMITEM_VALUE COMP "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "EMJACNUM" EMJACNUM+"-"+itos(DOOR_INDEX)+"-"+ITEM_NUM
				SET_FAMITEM_VALUE COMP "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "GRADE" DOOR_GRADE
				SET_FAMITEM_VALUE COMP "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" DOOR_WIDTH - SM_THICK - SM_THICK - .06
				SET_FAMITEM_VALUE COMP "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" DOOR_THICKNESS - .25
				SET_FAMITEM_VALUE COMP "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "DEPTH" TOP_CHANNEL_DEPTH
				SET_FAMITEM_VALUE COMP "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "BEVEL1"  4
				SET_FAMITEM_VALUE COMP "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "BEVEL2"  4
				SET_FAMITEM_VALUE COMP "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "FLUSH_BOLT_A"  "N"
				SET_FAMITEM_VALUE COMP "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "FLUSH_BOLT_B"  "N"

				IF DOOR_CONSTRUCTION == "SEAMLESS"
					SET_FAMITEM_VALUE COMP "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LOCKSEAM"  "N"
				ELSE_IF DOOR_CONSTRUCTION == "LOCKSEAM"
					SET_FAMITEM_VALUE COMP "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LOCKSEAM"  "Y"
				END_IF

				GET_REF_FAMINSTANCE COMP "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
				REPLACE_COMPONENT COMP INST
			END_IF
		END_IF

		IF BOTTOM_EDGE == "INVERTED" OR BOTTOM_EDGE == "FLUSH"
			SEARCH_MDL_REF DOOR_ASM CSYS "BOTTOM_CHANNEL" ATTACH

			RETRIEVE_MDL CLOSURE_CHANNEL.PRT COMP
			IF OPERATION == 4
				SET_MDL_PARAM COMP "CUSTOMER_NAME" CUSTOMER_NAME
				SET_MDL_PARAM COMP "JOB_NAME" JOB_NAME
				SET_MDL_PARAM COMP "SUB_JOB_NAME" SUB_JOB_NAME
				RETRIEVE_MDL CLOSURE_CHANNEL.DRW COMPD
				SAVE_MDL COMPD
				ERASE_MDL COMPD
			END_IF
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
				ASSEMBLE COMP DOOR_ASM
					 CSYS ATTACH PLACEMENT
				END_ASSEMBLE
			SEARCH_MDL_PARAM COMP "EMJACNUM" EMJACNUM
			INSERT_FAMINSTANCE COMP "BOTTOM_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
			SET_FAMITEM_VALUE COMP "BOTTOM_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "STOCKTYPE" 1
			SET_FAMITEM_VALUE COMP "BOTTOM_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "EMJACNUM" EMJACNUM+"-"+itos(DOOR_INDEX)+"-"+ITEM_NUM
			SET_FAMITEM_VALUE COMP "BOTTOM_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "GRADE" DOOR_GRADE
			SET_FAMITEM_VALUE COMP "BOTTOM_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" DOOR_WIDTH - CLOSURE_CHANNEL_CLEARANCE
			SET_FAMITEM_VALUE COMP "BOTTOM_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" DOOR_THICKNESS - .125
			SET_FAMITEM_VALUE COMP "BOTTOM_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "DEPTH" BOTTOM_CHANNEL_DEPTH
			SET_FAMITEM_VALUE COMP "BOTTOM_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "SMT_THICKNESS"  .05
			GET_REF_FAMINSTANCE COMP "BOTTOM_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
			REPLACE_COMPONENT COMP INST

			IF BOTTOM_EDGE == "FLUSH"
				SEARCH_MDL_REF COMP CSYS "ATTACH" ATTACH

				RETRIEVE_MDL FLUSHING_CHANNEL.PRT COMP
				IF OPERATION == 4
					SET_MDL_PARAM COMP "CUSTOMER_NAME" CUSTOMER_NAME
					SET_MDL_PARAM COMP "JOB_NAME" JOB_NAME
					SET_MDL_PARAM COMP "SUB_JOB_NAME" SUB_JOB_NAME
					RETRIEVE_MDL FLUSHING_CHANNEL.DRW COMPD
					SAVE_MDL COMPD
					ERASE_MDL COMPD
				END_IF

				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP DOOR_ASM
						 CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				SEARCH_MDL_PARAM COMP "EMJACNUM" EMJACNUM
				INSERT_FAMINSTANCE COMP "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
				SET_FAMITEM_VALUE COMP "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "STOCKTYPE" 1
				SET_FAMITEM_VALUE COMP "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "EMJACNUM" EMJACNUM+"-"+itos(DOOR_INDEX)+"-"+ITEM_NUM
				SET_FAMITEM_VALUE COMP "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "GRADE" DOOR_GRADE
				SET_FAMITEM_VALUE COMP "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" DOOR_WIDTH - SM_THICK - SM_THICK - .06
				SET_FAMITEM_VALUE COMP "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" DOOR_THICKNESS - .25
				SET_FAMITEM_VALUE COMP "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "DEPTH" BOTTOM_CHANNEL_DEPTH
				SET_FAMITEM_VALUE COMP "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "BEVEL1"  4
				SET_FAMITEM_VALUE COMP "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "BEVEL2"  4
				SET_FAMITEM_VALUE COMP "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "FLUSH_BOLT_A"  "N"
				SET_FAMITEM_VALUE COMP "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "FLUSH_BOLT_B"  "N"

				IF DOOR_CONSTRUCTION == "SEAMLESS"
					SET_FAMITEM_VALUE COMP "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LOCKSEAM"  "N"
				ELSE_IF DOOR_CONSTRUCTION == "LOCKSEAM"
					SET_FAMITEM_VALUE COMP "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LOCKSEAM"  "Y"
				END_IF

				GET_REF_FAMINSTANCE COMP "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
				REPLACE_COMPONENT COMP INST
			END_IF
			REGEN_MDL ASSEM FORCE
		END_IF

		IF BOTTOM_EDGE == "SEAMLESS" AND AUTO_BOTTOM == 2
			SEARCH_MDL_REF DOOR_ASM CSYS "BOTTOM_CHANNEL" ATTACH

			RETRIEVE_MDL SEAMLESS_AUTO_BOTTOM.PRT GENERIC
			INSERT_FAMINSTANCE GENERIC "SAB_"+itos(DOOR_INDEX)+"_" + ITEM_NUM
			SET_FAMITEM_VALUE GENERIC "SAB_"+itos(DOOR_INDEX)+"_" + ITEM_NUM "DOOR_WIDTH" DOOR_WIDTH
			SET_FAMITEM_VALUE GENERIC "SAB_"+itos(DOOR_INDEX)+"_" + ITEM_NUM "SM_THICK" SM_THICK
			GET_REF_FAMINSTANCE GENERIC "SAB_"+itos(DOOR_INDEX)+"_" + ITEM_NUM INST
			SEARCH_MDL_REF INST CSYS "PLACEMENT" PLACEMENT

				ASSEMBLE INST DOOR_ASM
					 CSYS ATTACH PLACEMENT
				END_ASSEMBLE

				IF HAND_ == "LH" OR HAND_ == "RHR"
					IF STRIKE_EDGE_SHAPE == "BEVEL"
						SET_FAMITEM_VALUE GENERIC "SAB_"+itos(DOOR_INDEX)+"_" + ITEM_NUM "BEVEL_R" 4
					ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
						SET_FAMITEM_VALUE GENERIC "SAB_"+itos(DOOR_INDEX)+"_" + ITEM_NUM "BEVEL_R" 0
					END_IF
					
					IF HINGE_EDGE_SHAPE == "BEVEL"
						SET_FAMITEM_VALUE GENERIC "SAB_"+itos(DOOR_INDEX)+"_" + ITEM_NUM "BEVEL_L" 4
					ELSE_IF HINGE_EDGE_SHAPE == "SQUARE"
						SET_FAMITEM_VALUE GENERIC "SAB_"+itos(DOOR_INDEX)+"_" + ITEM_NUM "BEVEL_L" 0
					END_IF
					REGEN_MDL INST FORCE

					RETRIEVE_MDL END_AUTO_BOTT_STRIKE<END_AUTO_BOTT>.PRT FILLER
					SEARCH_MDL_REF FILLER CSYS "PLACEMENT" PLACEMENT
					SEARCH_MDL_REF RECURSIVE DOOR_ASM CSYS "HOLE_R" ATTACH
					
						ASSEMBLE FILLER DOOR_ASM
							 CSYS ATTACH PLACEMENT
						END_ASSEMBLE
						
					RETRIEVE_MDL END_AUTO_BOTT_HINGE<END_AUTO_BOTT>.PRT FILLER
					SEARCH_MDL_REF FILLER CSYS "PLACEMENT" PLACEMENT
					SEARCH_MDL_REF RECURSIVE DOOR_ASM CSYS "HOLE_L" ATTACH
					
						ASSEMBLE FILLER DOOR_ASM
							 CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				ELSE_IF HAND_ == "RH" OR HAND_ == "LHR"
					IF STRIKE_EDGE_SHAPE == "BEVEL"
						SET_FAMITEM_VALUE GENERIC "SAB_"+itos(DOOR_INDEX)+"_" + ITEM_NUM "BEVEL_L" 4
					ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
						SET_FAMITEM_VALUE GENERIC "SAB_"+itos(DOOR_INDEX)+"_" + ITEM_NUM "BEVEL_L" 0
					END_IF
					
					IF HINGE_EDGE_SHAPE == "BEVEL"
						SET_FAMITEM_VALUE GENERIC "SAB_"+itos(DOOR_INDEX)+"_" + ITEM_NUM "BEVEL_R" 4
					ELSE_IF HINGE_EDGE_SHAPE == "SQUARE"
						SET_FAMITEM_VALUE GENERIC "SAB_"+itos(DOOR_INDEX)+"_" + ITEM_NUM "BEVEL_R" 0
					END_IF
					REGEN_MDL INST FORCE

					SEARCH_MDL_REF RECURSIVE DOOR_ASM CSYS "HOLE_L" ATTACH
					RETRIEVE_MDL END_AUTO_BOTT_STRIKE<END_AUTO_BOTT>.PRT FILLER
					SEARCH_MDL_REF FILLER CSYS "PLACEMENT" PLACEMENT
					
						ASSEMBLE FILLER DOOR_ASM
							 CSYS ATTACH PLACEMENT
						END_ASSEMBLE
						
					SEARCH_MDL_REF RECURSIVE DOOR_ASM CSYS "HOLE_R" ATTACH
					RETRIEVE_MDL END_AUTO_BOTT_HINGE<END_AUTO_BOTT>.PRT FILLER
					SEARCH_MDL_REF FILLER CSYS "PLACEMENT" PLACEMENT
					
						ASSEMBLE FILLER DOOR_ASM
							 CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				END_IF							

				CREATE_UDF udf\auto_bott_hole DOOR_ASM
					UDF_REF ATTACH ATTACH
					UDF_INTERSECTION BODY PART_LEVEL
				END_CREATE_UDF
				
				CREATE_UDF udf\auto_bott_hole DOOR_ASM
					UDF_REF ATTACH ATTACH
					UDF_INTERSECTION COVER PART_LEVEL
				END_CREATE_UDF				
		END_IF
		
		CALL smcr_door.tab

		IF HOLDER_STOP_MANUFACTURER_ == "ABH"
			SEARCH_MDL_REF ASSEM COMPONENT "DOOR_ASM_"+itos(DOOR_INDEX)+"_"+SO_NUM+"_"+ ITEM_NUM DOOR_ASM
			IF HOLDER_STOP_TYPE_ == "CONCEALED"
				IF	HAND_ == "LHR" OR HAND_ == "RH" OR \
					HAND_ == "LHR1" OR HAND_ == "LHRA1" OR HAND_ == "LHRI1" OR \
					HAND_ == "RH2" OR HAND_ == "RHA2" OR HAND_ == "RHI2"

					SEARCH_MDL_REF DOOR_ASM CSYS "ACS3" ASM_CSYS
					CREATE_UDF udf\csys DOOR_ASM
						UDF_REF ATTACH ASM_CSYS
						UDF_DIM	ROTX 0
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX -( ABH_DIM_C - HINGE_GAP + (ABH_DIM_E/2))
						UDF_DIM	LOCY JOH - TOP_GAP - .115
						UDF_DIM	LOCZ DOOR_THICKNESS/2
						UDF_EXP_REF ATTACH CSYS 0
					END_CREATE_UDF

					CREATE_UDF udf\rect_cut DOOR_ASM
						UDF_REF ATTACH ATTACH
						UDF_DIM	DIMY .27
						UDF_DIM	DIMZ 1.3125
						UDF_DIM	DIMX ABH_DIM_E
						UDF_INTERSECTION * PART_LEVEL
					END_CREATE_UDF
				END_IF

				IF	HAND_ == "RHR" OR HAND_ == "LH" OR \
					HAND_ == "RHR2" OR HAND_ == "RHRA2" OR HAND_ == "RHRI2" OR \
					HAND_ == "LH1" OR HAND_ == "LHA1" OR HAND_ == "LHI1"

					SEARCH_MDL_REF DOOR_ASM CSYS "ACS4" ASM_CSYS
					CREATE_UDF udf\csys DOOR_ASM
						UDF_REF ATTACH ASM_CSYS
						UDF_DIM	ROTX 0
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX -(ABH_DIM_C - HINGE_GAP + (ABH_DIM_E/2))
						UDF_DIM	LOCY JOH - TOP_GAP - .115
						UDF_DIM	LOCZ -DOOR_THICKNESS/2
						UDF_EXP_REF ATTACH CSYS 0
					END_CREATE_UDF

					CREATE_UDF udf\rect_cut DOOR_ASM
						UDF_REF ATTACH ATTACH
						UDF_DIM	DIMY .27
						UDF_DIM	DIMZ 1.3125
						UDF_DIM	DIMX ABH_DIM_E
						UDF_INTERSECTION * PART_LEVEL
					END_CREATE_UDF
				END_IF
			END_IF

			IF TOP_EDGE == "INVERTED" OR TOP_EDGE == "FLUSH"
				SEARCH_MDL_REF DOOR_ASM COMPONENT "TOP_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM TOP_CHAN
				GET_REF_GENERIC TOP_CHAN TOP_CHAN_GENERIC
				SET_FAMITEM_VALUE TOP_CHAN_GENERIC "TOP_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "SMT_THICKNESS"  .075
				SET_FAMITEM_VALUE TOP_CHAN_GENERIC "TOP_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "DEPTH"  .85
			END_IF
			REGEN_MDL ASSEM FORCE
		END_IF

		! IF DPS_MODEL <> ""
			! SEARCH_MDL_REF ASSEM COMPONENT "DOOR_ASM_"+itos(DOOR_INDEX)+"_"+SO_NUM+"_"+ ITEM_NUM DOOR_ASM
			! SEARCH_MDL_REF DOOR_ASM CSYS "ORIENT" ASM_CSYS
			! IF DPS_POSITION == "HEAD"
				! IF	HAND_ == "LHR" OR HAND_ == "RH" OR \
					! HAND_ == "LHR1" OR HAND_ == "LHRA1" OR HAND_ == "LHRI1" OR \
					! HAND_ == "RH2" OR HAND_ == "RHA2" OR HAND_ == "RHI2"

					! CREATE_UDF udf\csys DOOR_ASM
						! UDF_REF ATTACH ASM_CSYS
						! UDF_DIM	ROTX 0
						! UDF_DIM	ROTY 0
						! UDF_DIM	ROTZ -90
						! UDF_DIM	LOCX -((DOOR_WIDTH/2) - DPS_LOCATION + .125)
						! UDF_DIM	LOCY UNDERCUT + DOOR_HEIGHT
						! UDF_DIM	LOCZ 0
						! UDF_EXP_REF ATTACH CSYS 0
					! END_CREATE_UDF

					! IF TOP_EDGE == "INVERTED"

						! RETRIEVE_MDL FLUSHING_CHANNEL.PRT COMP
						! IF OPERATION == 4
							! RETRIEVE_MDL FLUSHING_CHANNEL.DRW COMPD
							! SAVE_MDL COMPD
							! ERASE_MDL COMPD
							! SET_MDL_PARAM COMP "CUSTOMER_NAME" CUSTOMER_NAME
							! SET_MDL_PARAM COMP "JOB_NAME" JOB_NAME
							! SET_MDL_PARAM COMP "SUB_JOB_NAME" SUB_JOB_NAME
						! END_IF

						! SEARCH_MDL_REF COMP CSYS "PLACEMENT2" PLACEMENT
							! ASSEMBLE COMP DOOR_ASM
								 ! CSYS ATTACH PLACEMENT
							! END_ASSEMBLE

						! INSERT_FAMINSTANCE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "GRADE" DOOR_GRADE
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" 10
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" DOOR_THICKNESS - .25
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "DEPTH" TOP_CHANNEL_DEPTH - .0625
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "BEVEL1"  0
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "BEVEL2"  0
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "FLUSH_BOLT_A"  "Y"
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "FLUSH_BOLT_B"  "Y"
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LOCKSEAM"  "N"
						! GET_REF_FAMINSTANCE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
						! REPLACE_COMPONENT COMP INST
					! END_IF

					! CREATE_UDF &DPS_UDF DOOR_ASM
						! UDF_REF ATTACH ATTACH
						! UDF_DIM	DIM SM_THICK
						! UDF_INTERSECTION * PART_LEVEL
					! END_CREATE_UDF
				! END_IF

				! IF	HAND_ == "RHR" OR HAND_ == "LH" OR \
					! HAND_ == "RHR2" OR HAND_ == "RHRA2" OR HAND_ == "RHRI2" OR \
					! HAND_ == "LH1" OR HAND_ == "LHA1" OR HAND_ == "LHI1"

					! CREATE_UDF udf\csys DOOR_ASM
						! UDF_REF ATTACH ASM_CSYS
						! UDF_DIM	ROTX 0
						! UDF_DIM	ROTY 0
						! UDF_DIM	ROTZ -90
						! UDF_DIM	LOCX (DOOR_WIDTH/2) - DPS_LOCATION + .125
						! UDF_DIM	LOCY UNDERCUT + DOOR_HEIGHT
						! UDF_DIM	LOCZ 0
						! UDF_EXP_REF ATTACH CSYS 0
					! END_CREATE_UDF

					! IF TOP_EDGE == "INVERTED"

						! RETRIEVE_MDL FLUSHING_CHANNEL.PRT COMP
						! IF OPERATION == 4
							! RETRIEVE_MDL FLUSHING_CHANNEL.DRW COMPD
							! SAVE_MDL COMPD
							! ERASE_MDL COMPD
							! SET_MDL_PARAM COMP "CUSTOMER_NAME" CUSTOMER_NAME
							! SET_MDL_PARAM COMP "JOB_NAME" JOB_NAME
							! SET_MDL_PARAM COMP "SUB_JOB_NAME" SUB_JOB_NAME
						! END_IF

						! SEARCH_MDL_REF COMP CSYS "PLACEMENT2" PLACEMENT
							! ASSEMBLE COMP DOOR_ASM
								 ! CSYS ATTACH PLACEMENT
							! END_ASSEMBLE

						! INSERT_FAMINSTANCE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "GRADE" DOOR_GRADE
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" 10
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" DOOR_THICKNESS - .25
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "DEPTH" TOP_CHANNEL_DEPTH - .0625
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "BEVEL1"  0
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "BEVEL2"  0
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "FLUSH_BOLT_A"  "Y"
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "FLUSH_BOLT_B"  "Y"
						! SET_FAMITEM_VALUE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LOCKSEAM"  "N"
						! GET_REF_FAMINSTANCE COMP "DPS_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
						! REPLACE_COMPONENT COMP INST
					! END_IF

					! CREATE_UDF &DPS_UDF DOOR_ASM
						! UDF_REF ATTACH ATTACH
						! UDF_DIM	DIM SM_THICK
						! UDF_INTERSECTION * PART_LEVEL
					! END_CREATE_UDF
				! END_IF
			! END_IF
		! END_IF

		IF SUB_TYPE == "P" AND HAND_ == "*I*" AND FLUSH_BOLTS > 0
			DECLARE_VARIABLE DOUBLE ARMOR_BEVEL
			DECLARE_VARIABLE STRING ARMOR_INST

			IF	HAND_ == "LHRI1" OR HAND_ == "RHI2"
				SEARCH_MDL_REF DOOR_ASM CSYS "ACS4" ATTACH
				SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1

				IF STRIKE_EDGE_SHAPE == "BEVEL"
					ARMOR_BEVEL = -4
				ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
					ARMOR_BEVEL = 0
				END_IF
			END_IF

			IF	HAND_ == "RHRI2" OR HAND_ == "LHI1"
				SEARCH_MDL_REF DOOR_ASM CSYS "ACS3" ATTACH
				SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1

				IF STRIKE_EDGE_SHAPE == "BEVEL"
					ARMOR_BEVEL = 4
				ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
					ARMOR_BEVEL =  0
				END_IF
			END_IF

			IF ARMOR_WIDTH > DOOR_THICKNESS - 75 AND DOOR_CONSTRUCTION == "LOCKSEAM"
				IF HAND == "LHR"
					ARMOR_INST = "ARMOR_L2"
				ELSE_IF HAND == "RHR"
					ARMOR_INST = "ARMOR_L1"
				ELSE_IF HAND == "LH"
					ARMOR_INST = "ARMOR_L1"
				ELSE_IF HAND == "RH"
					ARMOR_INST = "ARMOR_L2"
				END_IF
			END_IF
			
			IF DOOR_CONSTRUCTION == "SEAMLESS" AND SM_THICK <= .07
					ARMOR_INST = "SEAMLESS"
			ELSE_IF DOOR_CONSTRUCTION == "SEAMLESS" AND SM_THICK == .075 AND (HAND == "LHR" OR HAND == "RH") AND WELDED_PREPS == 0
					ARMOR_INST = "SEAMLESS1"
			ELSE_IF DOOR_CONSTRUCTION == "SEAMLESS" AND SM_THICK == .075 AND (HAND == "RHR" OR HAND == "LH") AND WELDED_PREPS == 0
					ARMOR_INST = "SEAMLESS2"
			ELSE_IF DOOR_CONSTRUCTION == "SEAMLESS" AND SM_THICK == .105 AND WELDED_PREPS == 0
					ARMOR_INST = "SEAMLESS12"
			ELSE_IF DOOR_CONSTRUCTION == "SEAMLESS" AND WELDED_PREPS == 1
					ARMOR_INST = "SEAMLESS12"
			END_IF

			IF FLUSH_BOLTS == 1 OR FLUSH_BOLTS == 3
				CREATE_UDF udf\face_plate DOOR_ASM
					UDF_INSTANCE ARMOR_INST
					UDF_REF ATTACH ATTACH
					UDF_DIM STRIKE_CTR UNDERCUT + DOOR_HEIGHT - FLUSH_BOLT_CENTER_TOP
					UDF_DIM OFFSET 0
					UDF_DIM ARMOR_BEVEL ARMOR_BEVEL
					UDF_DIM ARMOR_WIDTH 1.0 + .03
					UDF_DIM ARMOR_HEIGHT 6.75 + .03
					UDF_EXP_REF ATTACH2 CSYS 1
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF

				IF	HAND_ == "LHI1" OR HAND_ == "RHRI2"
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH ATTACH2
							UDF_DIM	ROTX 180
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX 0
							UDF_DIM	LOCY 0
							UDF_DIM	LOCZ 0
							UDF_EXP_REF FBTC CSYS 0
						END_CREATE_UDF
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH FBTC
							UDF_DIM	ROTX 180
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX -.75
							UDF_DIM	LOCY -(FLUSH_BOLT_CENTER_TOP-.125)
							UDF_DIM	LOCZ 0
							UDF_EXP_REF ATTACH3 CSYS 0
						END_CREATE_UDF
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH FBTC
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX -4
							UDF_DIM	LOCY -(FLUSH_BOLT_CENTER_TOP/2)-(.1/Scale)
							UDF_DIM	LOCZ 0
							UDF_EXP_REF FBTD CSYS 0
						END_CREATE_UDF
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH FBTC
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX 0
							UDF_DIM	LOCY -(FLUSH_BOLT_CENTER_TOP)
							UDF_DIM	LOCZ 0
							UDF_EXP_REF FBT CSYS 0
						END_CREATE_UDF
				END_IF

				IF	HAND_ == "LHRI1" OR HAND_ == "RHI2"
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH ATTACH2
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX 0
							UDF_DIM	LOCY 0
							UDF_DIM	LOCZ 0
							UDF_EXP_REF FBTC CSYS 0
						END_CREATE_UDF
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH FBTC
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX -.75
							UDF_DIM	LOCY FLUSH_BOLT_CENTER_TOP-.125
							UDF_DIM	LOCZ 0
							UDF_EXP_REF ATTACH3 CSYS 0
						END_CREATE_UDF
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH FBTC
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX -4
							UDF_DIM	LOCY (FLUSH_BOLT_CENTER_TOP/2)+(.1/Scale)
							UDF_DIM	LOCZ 0
							UDF_EXP_REF FBTD CSYS 0
						END_CREATE_UDF
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH FBTC
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX 0
							UDF_DIM	LOCY FLUSH_BOLT_CENTER_TOP
							UDF_DIM	LOCZ 0
							UDF_EXP_REF FBT CSYS 0
						END_CREATE_UDF
					END_IF

				RETRIEVE_MDL FLUSH_BOLT_BOX.PRT COMP
				IF OPERATION == 4
					RETRIEVE_MDL FLUSH_BOLT_BOX.DRW COMPD
					SAVE_MDL COMPD
					ERASE_MDL COMPD
					SET_MDL_PARAM COMP "CUSTOMER_NAME" CUSTOMER_NAME
					SET_MDL_PARAM COMP "JOB_NAME" JOB_NAME
					SET_MDL_PARAM COMP "SUB_JOB_NAME" SUB_JOB_NAME
				END_IF
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP DOOR_ASM
						 CSYS ATTACH2 PLACEMENT
					END_ASSEMBLE

				IF TOP_EDGE == "FLUSH"
					SEARCH_MDL_REF DOOR_ASM COMPONENT "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM TOP_CHAN
					GET_REF_GENERIC TOP_CHAN TOP_CHAN_GENERIC

					IF	HAND_ == "LHI1" OR HAND_ == "RHRI2"
						SET_FAMITEM_VALUE TOP_CHAN_GENERIC "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "FLUSH_BOLT_A"  "Y"
					ELSE_IF HAND_ == "LHRI1" OR HAND_ == "RHI2"
						SET_FAMITEM_VALUE TOP_CHAN_GENERIC "TOP_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "FLUSH_BOLT_B"  "Y"
					END_IF
				END_IF

				IF TOP_EDGE <> "SEAMLESS"
					IF TOP_BOLT_TYPE == 0
						FB_MODEL = "FB_BRKT.PRT"
					ELSE_IF TOP_BOLT_TYPE == 1
						FB_MODEL = "FB_BU.PRT"
					END_IF

					RETRIEVE_MDL &FB_MODEL COMP
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP DOOR_ASM
						 CSYS ATTACH3 PLACEMENT
					END_ASSEMBLE

					IF TOP_BOLT_TYPE == 0
						INSERT_FAMINSTANCE COMP "FB_BRKT_TOP_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
						SET_FAMITEM_VALUE COMP "FB_BRKT_TOP_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "STOCKTYPE" 1
						SET_FAMITEM_VALUE COMP "FB_BRKT_TOP_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" DOOR_THICKNESS - .25
						SET_FAMITEM_VALUE COMP "FB_BRKT_TOP_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "DEPTH" TOP_CHANNEL_DEPTH - .1875
						GET_REF_FAMINSTANCE COMP "FB_BRKT_TOP_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
						REPLACE_COMPONENT COMP INST
					END_IF
				END_IF
			END_IF
			IF FLUSH_BOLTS == 2 OR FLUSH_BOLTS == 3
				CREATE_UDF udf\face_plate DOOR_ASM
					UDF_INSTANCE ARMOR_INST
					UDF_REF ATTACH ATTACH
					UDF_DIM STRIKE_CTR UNDERCUT + FLUSH_BOLT_CENTER_BOTTOM
					UDF_DIM OFFSET 0
					UDF_DIM ARMOR_BEVEL ARMOR_BEVEL
					UDF_DIM ARMOR_WIDTH 1.0 + .03
					UDF_DIM ARMOR_HEIGHT 6.75 + .03
					UDF_EXP_REF ATTACH2 CSYS 1
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF

				IF	HAND_ == "LHI1" OR HAND_ == "RHRI2"
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH ATTACH2
							UDF_DIM	ROTX 180
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX 0
							UDF_DIM	LOCY 0
							UDF_DIM	LOCZ 0
							UDF_EXP_REF FBBC CSYS 0
						END_CREATE_UDF
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH FBBC
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX -.75
							UDF_DIM	LOCY FLUSH_BOLT_CENTER_BOTTOM-.125
							UDF_DIM	LOCZ 0
							UDF_EXP_REF ATTACH3 CSYS 0
						END_CREATE_UDF
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH FBBC
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX -4
							UDF_DIM	LOCY (FLUSH_BOLT_CENTER_BOTTOM/2)-(.1/Scale)
							UDF_DIM	LOCZ 0
							UDF_EXP_REF FBBD CSYS 0
						END_CREATE_UDF
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH FBBC
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX 0
							UDF_DIM	LOCY FLUSH_BOLT_CENTER_BOTTOM
							UDF_DIM	LOCZ 0
							UDF_EXP_REF FBB CSYS 0
						END_CREATE_UDF
				END_IF

				IF	HAND_ == "LHRI1" OR HAND_ == "RHI2"
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH ATTACH2
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX 0
							UDF_DIM	LOCY 0
							UDF_DIM	LOCZ 0
							UDF_EXP_REF FBBC CSYS 0
						END_CREATE_UDF
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH FBBC
							UDF_DIM	ROTX 180
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX -.75
							UDF_DIM	LOCY -FLUSH_BOLT_CENTER_BOTTOM - .125
							UDF_DIM	LOCZ 0
							UDF_EXP_REF ATTACH3 CSYS 0
						END_CREATE_UDF
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH FBBC
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX -4
							UDF_DIM	LOCY -(FLUSH_BOLT_CENTER_BOTTOM/2)+(.1/Scale)
							UDF_DIM	LOCZ 0
							UDF_EXP_REF FBBD CSYS 0
						END_CREATE_UDF
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH FBBC
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX 0
							UDF_DIM	LOCY -FLUSH_BOLT_CENTER_BOTTOM
							UDF_DIM	LOCZ 0
							UDF_EXP_REF FBB CSYS 0
						END_CREATE_UDF
				END_IF

				RETRIEVE_MDL FLUSH_BOLT_BOX.PRT COMP
				IF OPERATION == 4
					RETRIEVE_MDL FLUSH_BOLT_BOX.DRW COMPD
					SAVE_MDL COMPD
					ERASE_MDL COMPD
					SET_MDL_PARAM COMP "CUSTOMER_NAME" CUSTOMER_NAME
					SET_MDL_PARAM COMP "JOB_NAME" JOB_NAME
					SET_MDL_PARAM COMP "SUB_JOB_NAME" SUB_JOB_NAME
				END_IF
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP DOOR_ASM
						 CSYS ATTACH2 PLACEMENT
					END_ASSEMBLE

				IF BOTTOM_EDGE == "FLUSH"
					SEARCH_MDL_REF DOOR_ASM COMPONENT "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM BOT_CHAN
					GET_REF_GENERIC BOT_CHAN BOT_CHAN_GENERIC

					IF	HAND_ == "LHI1" OR HAND_ == "RHRI2"
						SET_FAMITEM_VALUE BOT_CHAN_GENERIC "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "FLUSH_BOLT_B"  "Y"
					ELSE_IF HAND_ == "LHRI1" OR HAND_ == "RHI2"
						SET_FAMITEM_VALUE BOT_CHAN_GENERIC "BOTTOM_FLUSH_CHAN_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "FLUSH_BOLT_A"  "Y"
					END_IF
				END_IF
				IF BOTTOM_EDGE <> "SEAMLESS"
					IF BOTTOM_BOLT_TYPE == 0
						FB_MODEL = "FB_BRKT.PRT"
					ELSE_IF BOTTOM_BOLT_TYPE == 1
						FB_MODEL = "FB_BU.PRT"
					END_IF

					RETRIEVE_MDL &FB_MODEL COMP
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP DOOR_ASM
						 CSYS ATTACH3 PLACEMENT
					END_ASSEMBLE

					IF BOTTOM_BOLT_TYPE == 0
						INSERT_FAMINSTANCE COMP "FB_BRKT_BOT_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
						SET_FAMITEM_VALUE COMP "FB_BRKT_BOT_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "STOCKTYPE" 1
						SET_FAMITEM_VALUE COMP "FB_BRKT_BOT_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" DOOR_THICKNESS - .25
						SET_FAMITEM_VALUE COMP "FB_BRKT_BOT_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "DEPTH" TOP_CHANNEL_DEPTH - .1875
						GET_REF_FAMINSTANCE COMP "FB_BRKT_BOT_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
						REPLACE_COMPONENT COMP INST
					END_IF
				END_IF
			END_IF
			REGEN_MDL ASSEM FORCE
		END_IF

		IF EPT > 0
			CALL ept.tab
		END_IF
		
		IF SUB_TYPE == "S" OR HAND_ == "*A*"
												
			IF PUSH_PULL == 1
				CALL push_pull.tab
			END_IF					
			
			IF	PRIMARY_LOCK_TYPE == "ROLLER LATCH" OR \
				PRIMARY_LOCK_TYPE == "MORTISE LOCK" OR \
				PRIMARY_LOCK_TYPE == "CYLINDER LOCK" OR \
				PRIMARY_LOCK_TYPE == "HOSPITAL LATCH" AND \
				( HAND_ == "LHR" OR HAND_ == "RHR" OR HAND_ == "LHRA1" OR  HAND_ == "RHRA2" OR \
				HAND_ == "LH" OR HAND_ == "RH" OR HAND_ == "LHA1"  OR HAND_ == "RHA2")

				IF	HAND_ == "LHR" OR HAND_ == "LHRA1"
					SEARCH_MDL_REF DOOR_ASM CSYS "ACS4" ATTACH
					SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
					IF DOOR_CONSTRUCTION == "SEAMLESS"
						SEARCH_MDL_REF BODY SURFACE "SURFACE_S2" BODY_ARMOR
						SEARCH_MDL_REF COVER SURFACE "SURFACE_S2" COVER_ARMOR
						BODY_ROTATION = 180
						COVER_ROTATION = 0
					END_IF
					IF STRIKE_EDGE_SHAPE == "BEVEL"
						ARMOR_BEVEL = -4
					ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
						ARMOR_BEVEL = 0
					END_IF
				END_IF

				
				IF	HAND_ == "RH" OR HAND_ == "RHA2"
					SEARCH_MDL_REF DOOR_ASM CSYS "ACS4" ATTACH
					SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
					IF DOOR_CONSTRUCTION == "SEAMLESS"
						SEARCH_MDL_REF BODY SURFACE "SURFACE_S2" BODY_ARMOR
						SEARCH_MDL_REF COVER SURFACE "SURFACE_S2" COVER_ARMOR
						BODY_ROTATION = 180
						COVER_ROTATION = 0
					END_IF
					IF STRIKE_EDGE_SHAPE == "BEVEL"
						ARMOR_BEVEL = -4
					ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
						ARMOR_BEVEL = 0
					END_IF
				END_IF
				
				IF	HAND_ == "RHR" OR HAND_ == "RHRA2"
					SEARCH_MDL_REF DOOR_ASM CSYS "ACS3" ATTACH
					SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
					IF DOOR_CONSTRUCTION == "SEAMLESS"
						SEARCH_MDL_REF BODY SURFACE "SURFACE_S1" BODY_ARMOR
						SEARCH_MDL_REF COVER SURFACE "SURFACE_S1" COVER_ARMOR
						BODY_ROTATION = 0
						COVER_ROTATION = 180
					END_IF
					IF STRIKE_EDGE_SHAPE == "BEVEL"
						ARMOR_BEVEL = 4
					ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
						ARMOR_BEVEL = 0
					END_IF
				END_IF

				IF	HAND_ == "LH" OR HAND_ == "LHA1"
					SEARCH_MDL_REF DOOR_ASM CSYS "ACS3" ATTACH
					SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
					IF DOOR_CONSTRUCTION == "SEAMLESS"
						SEARCH_MDL_REF BODY SURFACE "SURFACE_S1" BODY_ARMOR
						SEARCH_MDL_REF COVER SURFACE "SURFACE_S1" COVER_ARMOR
						BODY_ROTATION = 0
						COVER_ROTATION = 180
					END_IF
					IF STRIKE_EDGE_SHAPE == "BEVEL"
						ARMOR_BEVEL = 4
					ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
						ARMOR_BEVEL =  0
					END_IF
				END_IF

				IF WELDED_PREPS == 1
					ARMOR_HEIGHT = PRIMARY_LOCK_ARMOR_HEIGHT + .18
					ARMOR_WIDTH = PRIMARY_LOCK_ARMOR_WIDTH +.18
					LOCK_REINFORCEMENT = PRIMARY_LOCK_INST + ".ASM"
				ELSE
					ARMOR_HEIGHT = PRIMARY_LOCK_ARMOR_HEIGHT +.03
					ARMOR_WIDTH = PRIMARY_LOCK_ARMOR_WIDTH +.03
					LOCK_REINFORCEMENT = PRIMARY_LOCK_REINFORCEMENT
				END_IF

				IF DOOR_CONSTRUCTION == "SEAMLESS" AND DOOR_THICKNESS - .125 - ARMOR_WIDTH <= .4
						ARMOR_INST = "WITH_TAB"
				ELSE_IF DOOR_CONSTRUCTION == "SEAMLESS" AND DOOR_THICKNESS - .125 - ARMOR_WIDTH > .4
						ARMOR_INST = "NO_TAB"
				END_IF
				
				! IF ARMOR_WIDTH > DOOR_THICKNESS - 75 AND DOOR_CONSTRUCTION == "LOCKSEAM"
					! IF HAND == "LHR"
						! ARMOR_INST = "ARMOR_L2"
					! ELSE_IF HAND == "RHR"
						! ARMOR_INST = "ARMOR_L1"
					! ELSE_IF HAND == "LH"
						! ARMOR_INST = "ARMOR_L1"
					! ELSE_IF HAND == "RH"
						! ARMOR_INST = "ARMOR_L2"
					! END_IF
				! END_IF
											
				STRIKE_CENTER = PRIMARY_STRIKE_CENTER
				LOCK_OFFSET = PRIMARY_LOCK_OFFSET
				LOCK_BACKSET = PRIMARY_LOCK_BACKSET		
				LOCK_UDF = "udf\\"+ PRIMARY_LOCK_UDF
				LOCK_INST = PRIMARY_LOCK_INST							
				
				IF PRIMARY_LOCK_TYPE == "ROLLER LATCH"
					CALL roller_latch.tab
				END_IF
				
				IF PRIMARY_LOCK_TYPE == "MORTISE LOCK"
					CALL mortise_lock.tab
				END_IF
				
				IF PRIMARY_LOCK_TYPE == "CYLINDER LOCK"
					CALL cylinder_lock.tab
				END_IF
				
				IF PRIMARY_LOCK_TYPE == "HOSPITAL LATCH"
					CALL hospital_latch.tab
				END_IF
			END_IF

		!BEGIN PRIMARY EXIT DEVICES
			IF PRIMARY_LOCK_TYPE == "EXIT DEVICE" AND ( HAND_ == "LHR" OR HAND_ == "RHR" OR HAND_ == "LHR1" OR HAND_ == "LHRA1" OR HAND_ == "RHR2" OR HAND_ == "RHRA2")
				LOCK_UDF = "udf\\"+ PRIMARY_LOCK_UDF
				CREATE_UDF &LOCK_UDF DOOR_ASM
					UDF_INSTANCE PRIMARY_LOCK_INST
					UDF_REF ATTACH1 ATTACH
					UDF_REF ATTACH2 ATTACH1
					UDF_DIM STRIKE_CTR PRIMARY_STRIKE_CENTER
					UDF_DIM OFFSET -PRIMARY_LOCK_OFFSET
					UDF_DIM BACKSET PRIMARY_LOCK_BACKSET
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF

				IF PRIMARY_LOCK_TRIM_UDF <> ""
					TRIM_UDF = "udf\\"+ PRIMARY_LOCK_TRIM_UDF
					CREATE_UDF &TRIM_UDF DOOR_ASM
						UDF_INSTANCE PRIMARY_LOCK_TRIM_INST
						UDF_REF ATTACH1 ATTACH
						UDF_REF ATTACH2 ATTACH1
						UDF_DIM STRIKE_CTR PRIMARY_STRIKE_CENTER
						UDF_DIM OFFSET -PRIMARY_LOCK_OFFSET - PRIMARY_LOCK_TRIM_OFFSET
						UDF_DIM BACKSET PRIMARY_LOCK_BACKSET
						UDF_INTERSECTION * PART_LEVEL
					END_CREATE_UDF
				END_IF
				IF PRIMARY_LOCK_ARMOR_WIDTH > 0 AND PRIMARY_LOCK_ARMOR_HEIGHT > 0
					CREATE_UDF udf\face_plate DOOR_ASM
						UDF_INSTANCE ARMOR_INST
						UDF_REF ATTACH ATTACH
						UDF_DIM STRIKE_CTR PRIMARY_STRIKE_CENTER
						UDF_DIM OFFSET -PRIMARY_LOCK_OFFSET
						UDF_DIM ARMOR_BEVEL ARMOR_BEVEL
						UDF_DIM ARMOR_WIDTH PRIMARY_LOCK_ARMOR_WIDTH + .03
						UDF_DIM ARMOR_HEIGHT PRIMARY_LOCK_ARMOR_HEIGHT + .03
						UDF_EXP_REF ATTACH2 CSYS 1
						UDF_INTERSECTION * PART_LEVEL
					END_CREATE_UDF

					CREATE_UDF udf\csys DOOR_ASM
						UDF_REF ATTACH ATTACH2
						UDF_DIM	ROTX 0
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX 0
						UDF_DIM	LOCY 0
						UDF_DIM	LOCZ 0
						UDF_EXP_REF ATTACH2 CSYS 0
					END_CREATE_UDF

					RETRIEVE_MDL &PRIMARY_LOCK_REINFORCEMENT COMP
					IF OPERATION == 4
						SET_MDL_PARAM COMP "CUSTOMER_NAME" CUSTOMER_NAME
						SET_MDL_PARAM COMP "JOB_NAME" JOB_NAME
						SET_MDL_PARAM COMP "SUB_JOB_NAME" SUB_JOB_NAME
						GET_MDL_NAME COMP CompName
						! DRW = CompName + ".DRW"
						! RETRIEVE_MDL &DRW COMPD
						! SAVE_MDL COMPD
					END_IF

					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE COMP DOOR_ASM
							 CSYS ATTACH2 PLACEMENT
						END_ASSEMBLE
				ELSE
					CREATE_UDF udf\csys DOOR_ASM
						UDF_REF ATTACH ATTACH
						UDF_DIM	ROTX 0
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX -PRIMARY_LOCK_BACKSET
						UDF_DIM	LOCY PRIMARY_STRIKE_CENTER
						UDF_DIM	LOCZ 0
						UDF_EXP_REF ATTACH2 CSYS 0
					END_CREATE_UDF

					RETRIEVE_MDL &PRIMARY_LOCK_REINFORCEMENT COMP
					IF OPERATION == 4
						SET_MDL_PARAM COMP "CUSTOMER_NAME" CUSTOMER_NAME
						SET_MDL_PARAM COMP "JOB_NAME" JOB_NAME
						SET_MDL_PARAM COMP "SUB_JOB_NAME" SUB_JOB_NAME
						GET_MDL_NAME COMP CompName
						! DRW = CompName + ".DRW"
						! RETRIEVE_MDL &DRW COMPD
						! SAVE_MDL COMPD
					END_IF

					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE COMP DOOR_ASM
							 CSYS ATTACH2 PLACEMENT
						END_ASSEMBLE

					CREATE_UDF udf\csys DOOR_ASM
						UDF_REF ATTACH ATTACH2
						UDF_DIM	ROTX 0
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX -(DOOR_WIDTH - PRIMARY_LOCK_BACKSET - 4)
						UDF_DIM	LOCY 0
						UDF_DIM	LOCZ 0
						UDF_EXP_REF ATTACH2 CSYS 0
					END_CREATE_UDF

					RETRIEVE_MDL EXIT_REINFORCEMENT_TAIL.ASM COMP
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE COMP DOOR_ASM
							 CSYS ATTACH2 PLACEMENT
						END_ASSEMBLE
				END_IF

				IF SURFACE_VERTICAL_RODS > 0
					IF	HAND_ == "LHR" OR HAND_ == "LHR1" OR HAND_ == "LHRA1"
						FLIP = 180
					END_IF
					IF HAND_ == "RHR" OR HAND_ == "RHR2" OR HAND_ == "RHRA2"
						FLIP = 0
					END_IF

					IF SURFACE_VERTICAL_RODS == 1 OR 	SURFACE_VERTICAL_RODS == 3
						IF SURFACE_CLOSER_LENGTH > DOOR_WIDTH - 8
							SURFACE_CLOSER_LENGTH = DOOR_WIDTH - 2.25
						ELSE
							CREATE_UDF udf\csys DOOR_ASM
								UDF_REF ATTACH ATTACH
								UDF_DIM	ROTX FLIP
								UDF_DIM	ROTY 0
								UDF_DIM	ROTZ 0
								UDF_DIM	LOCX -PRIMARY_LOCK_BACKSET
								UDF_DIM	LOCY UNDERCUT + DOOR_HEIGHT - TOP_CHANNEL_DEPTH - 3.5
								UDF_DIM	LOCZ 0
								UDF_EXP_REF ATTACH2 CSYS 0
							END_CREATE_UDF

							RETRIEVE_MDL SVR_BOX.PRT COMP
							IF OPERATION == 4
								SET_MDL_PARAM COMP "CUSTOMER_NAME" CUSTOMER_NAME
								SET_MDL_PARAM COMP "JOB_NAME" JOB_NAME
								SET_MDL_PARAM COMP "SUB_JOB_NAME" SUB_JOB_NAME
								RETRIEVE_MDL SVR_BOX.DRW COMPD
								SAVE_MDL COMPD
								ERASE_MDL COMPD
							END_IF

							SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
								ASSEMBLE COMP DOOR_ASM
									 CSYS ATTACH2 PLACEMENT
								END_ASSEMBLE
						END_IF
							CREATE_UDF udf\csys DOOR_ASM
								UDF_REF ATTACH ATTACH2
								UDF_DIM	ROTX 0
								UDF_DIM	ROTY 0
								UDF_DIM	ROTZ 0
								UDF_DIM	LOCX 0
								UDF_DIM	LOCY ((UNDERCUT + DOOR_HEIGHT - TOP_CHANNEL_DEPTH - 3.5) - PRIMARY_STRIKE_CENTER) /2
								UDF_DIM	LOCZ 0
								UDF_EXP_REF ATTACH2 CSYS 0
							END_CREATE_UDF

							RETRIEVE_MDL SVR_BOX.PRT COMP
							IF OPERATION == 4
								RETRIEVE_MDL SVR_BOX.DRW COMPD
								SET_MDL_PARAM COMP "CUSTOMER_NAME" CUSTOMER_NAME
								SET_MDL_PARAM COMP "JOB_NAME" JOB_NAME
								SET_MDL_PARAM COMP "SUB_JOB_NAME" SUB_JOB_NAME
								SAVE_MDL COMPD
								ERASE_MDL COMPD
							END_IF

							SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
								ASSEMBLE COMP DOOR_ASM
									 CSYS ATTACH2 PLACEMENT
								END_ASSEMBLE
					END_IF

					IF SURFACE_VERTICAL_RODS == 2 OR 	SURFACE_VERTICAL_RODS == 3
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH ATTACH
							UDF_DIM	ROTX FLIP
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX -PRIMARY_LOCK_BACKSET
							UDF_DIM	LOCY UNDERCUT + BOTTOM_CHANNEL_DEPTH + 3.5
							UDF_DIM	LOCZ 0
							UDF_EXP_REF ATTACH2 CSYS 0
						END_CREATE_UDF

						RETRIEVE_MDL SVR_BOX.PRT COMP
							IF OPERATION == 4
								SET_MDL_PARAM COMP "CUSTOMER_NAME" CUSTOMER_NAME
								SET_MDL_PARAM COMP "JOB_NAME" JOB_NAME
								SET_MDL_PARAM COMP "SUB_JOB_NAME" SUB_JOB_NAME
								RETRIEVE_MDL SVR_BOX.DRW COMPD
								SAVE_MDL COMPD
								ERASE_MDL COMPD
							END_IF

						SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
							ASSEMBLE COMP DOOR_ASM
								 CSYS ATTACH2 PLACEMENT
							END_ASSEMBLE
					END_IF
				END_IF
			END_IF

			IF SECONDARY_LOCK_TYPE == "MORTISE DEADBOLT" AND SECONDARY_LOCK_MANUFACTURER == "HAGER"
				CREATE_UDF udf\HS3800 DOOR_ASM
					UDF_INSTANCE SECONDARY_LOCK_INST
					UDF_REF ATTACH1 ATTACH1
					UDF_REF ATTACH ATTACH
					UDF_DIM STRIKE_CTR SECONDARY_STRIKE_CENTER
					UDF_DIM OFFSET -SECONDARY_LOCK_OFFSET
					UDF_DIM BACKSET SECONDARY_LOCK_BACKSET
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF

				CREATE_UDF udf\face_plate DOOR_ASM
					UDF_INSTANCE ARMOR_INST
					UDF_REF ATTACH ATTACH
					UDF_DIM STRIKE_CTR SECONDARY_STRIKE_CENTER
					UDF_DIM OFFSET -SECONDARY_LOCK_OFFSET
					UDF_DIM ARMOR_BEVEL ARMOR_BEVEL
					UDF_DIM ARMOR_WIDTH SECONDARY_LOCK_ARMOR_WIDTH + .03
					UDF_DIM ARMOR_HEIGHT SECONDARY_LOCK_ARMOR_HEIGHT + .03
					UDF_EXP_REF ATTACH2 CSYS 1
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF

				IF	HAND_ == "RHR" OR HAND_ == "LH" OR \
					HAND_ == "RHR2" OR HAND_ == "RHRA2" OR HAND_ == "RHRI2" OR \
					HAND_ == "LH1" OR HAND_ == "LHA1" OR HAND_ == "LHI1"
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH ATTACH2
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX 0
							UDF_DIM	LOCY 0
							UDF_DIM	LOCZ 0
							UDF_EXP_REF ATTACH2 CSYS 0
						END_CREATE_UDF
				END_IF

				IF	HAND_ == "LHR" OR HAND_ == "RH" OR \
					HAND_ == "LHR1" OR HAND_ == "LHRA1" OR HAND_ == "LHRI1" OR \
					HAND_ == "RH2" OR HAND_ == "RHA2" OR HAND_ == "RHI2"
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH ATTACH2
							UDF_DIM	ROTX 180
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX 0
							UDF_DIM	LOCY 0
							UDF_DIM	LOCZ 0
							UDF_EXP_REF ATTACH2 CSYS 0
						END_CREATE_UDF
				END_IF

				RETRIEVE_MDL MORTISE_BOX.ASM COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP DOOR_ASM
						 CSYS ATTACH2 PLACEMENT
					END_ASSEMBLE
			END_IF

			IF SECONDARY_LOCK_TYPE == "*CYLINDER*"
				CREATE_UDF udf\cylinder DOOR_ASM
					UDF_INSTANCE SECONDARY_LOCK_INST
					UDF_REF ATTACH ATTACH
					UDF_DIM STRIKE_CTR SECONDARY_STRIKE_CENTER
					UDF_DIM OFFSET -SECONDARY_LOCK_OFFSET
					UDF_DIM BACKSET SECONDARY_LOCK_BACKSET
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF

				CREATE_UDF udf\face_plate DOOR_ASM
					UDF_INSTANCE ARMOR_INST
					UDF_REF ATTACH ATTACH
					UDF_DIM STRIKE_CTR SECONDARY_STRIKE_CENTER
					UDF_DIM OFFSET -SECONDARY_LOCK_OFFSET
					UDF_DIM ARMOR_BEVEL ARMOR_BEVEL
					UDF_DIM ARMOR_WIDTH SECONDARY_LOCK_ARMOR_WIDTH + .03
					UDF_DIM ARMOR_HEIGHT SECONDARY_LOCK_ARMOR_HEIGHT + .03
					UDF_EXP_REF ATTACH2 CSYS 1
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF

				IF	HAND_ == "RHR" OR HAND_ == "LH" OR \
					HAND_ == "RHR2" OR HAND_ == "RHRA2" OR HAND_ == "RHRI2" OR \
					HAND_ == "LH1" OR HAND_ == "LHA1" OR HAND_ == "LHI1"
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH ATTACH2
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX 0
							UDF_DIM	LOCY 0
							UDF_DIM	LOCZ 0
							UDF_EXP_REF ATTACH2 CSYS 0
						END_CREATE_UDF
				END_IF

				IF	HAND_ == "LHR" OR HAND_ == "RH" OR \
					HAND_ == "LHR1" OR HAND_ == "LHRA1" OR HAND_ == "LHRI1" OR \
					HAND_ == "RH2" OR HAND_ == "RHA2" OR HAND_ == "RHI2"
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH ATTACH2
							UDF_DIM	ROTX 180
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX 0
							UDF_DIM	LOCY 0
							UDF_DIM	LOCZ 0
							UDF_EXP_REF ATTACH2 CSYS 0
						END_CREATE_UDF
				END_IF

				RETRIEVE_MDL CYLINDER_BOX.PRT COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP DOOR_ASM
						 CSYS ATTACH2 PLACEMENT
					END_ASSEMBLE
			END_IF

			IF SECONDARY_LOCK_TYPE == "MORTISE*" AND SECONDARY_LOCK_MANUFACTURER == "SARGENT"
				CREATE_UDF udf\sargent7800 DOOR_ASM
					UDF_INSTANCE SECONDARY_LOCK_INST
					UDF_REF ATTACH1 ATTACH1
					UDF_REF ATTACH ATTACH
					UDF_DIM STRIKE_CTR SECONDARY_STRIKE_CENTER
					UDF_DIM OFFSET -SECONDARY_LOCK_OFFSET
					UDF_DIM BACKSET SECONDARY_LOCK_BACKSET
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF

				CREATE_UDF udf\face_plate DOOR_ASM
					UDF_INSTANCE ARMOR_INST
					UDF_REF ATTACH ATTACH
					UDF_DIM STRIKE_CTR SECONDARY_STRIKE_CENTER
					UDF_DIM OFFSET -SECONDARY_LOCK_OFFSET
					UDF_DIM ARMOR_BEVEL ARMOR_BEVEL
					UDF_DIM ARMOR_WIDTH SECONDARY_LOCK_ARMOR_WIDTH + .03
					UDF_DIM ARMOR_HEIGHT SECONDARY_LOCK_ARMOR_HEIGHT + .03
					UDF_EXP_REF ATTACH2 CSYS 1
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF

				IF	HAND_ == "RHR" OR HAND_ == "LH" OR \
					HAND_ == "RHR2" OR HAND_ == "RHRA2" OR HAND_ == "RHRI2" OR \
					HAND_ == "LH1" OR HAND_ == "LHA1" OR HAND_ == "LHI1"
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH ATTACH2
							UDF_DIM	ROTX 0
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX 0
							UDF_DIM	LOCY 0
							UDF_DIM	LOCZ 0
							UDF_EXP_REF ATTACH2 CSYS 0
						END_CREATE_UDF
				END_IF

				IF	HAND_ == "LHR" OR HAND_ == "RH" OR \
					HAND_ == "LHR1" OR HAND_ == "LHRA1" OR HAND_ == "LHRI1" OR \
					HAND_ == "RH2" OR HAND_ == "RHA2" OR HAND_ == "RHI2"
						CREATE_UDF udf\csys DOOR_ASM
							UDF_REF ATTACH ATTACH2
							UDF_DIM	ROTX 180
							UDF_DIM	ROTY 0
							UDF_DIM	ROTZ 0
							UDF_DIM	LOCX 0
							UDF_DIM	LOCY 0
							UDF_DIM	LOCZ 0
							UDF_EXP_REF ATTACH2 CSYS 0
						END_CREATE_UDF
				END_IF

				RETRIEVE_MDL MORTISE_DEADBOLT_BOX.ASM COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP DOOR_ASM
						 CSYS ATTACH2 PLACEMENT
					END_ASSEMBLE
			END_IF
		END_IF

		IF (PRIMARY_STRIKE_TYPE == "ASA 4*" OR PRIMARY_STRIKE_TYPE == "ASA 2*") AND \
		  (HAND_ == "LHI1" OR HAND_ == "RHRI2"  OR HAND_ == "RHI2" OR HAND_ == "LHRI1")
			IF HAND_ == "LHI1" OR HAND_ == "RHRI2"
				SEARCH_MDL_REF DOOR_ASM CSYS "ORIENT" REF1
				SEARCH_MDL_REF DOOR_ASM CSYS "ACS3" REF2
				GET_REF_POS REF1 REF2 pos

				CREATE_UDF udf\csys DOOR_ASM
					UDF_REF ATTACH REF2
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX 0
					UDF_DIM	LOCY PRIMARY_STRIKE_CENTER
					UDF_DIM	LOCZ 0
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF

				CREATE_UDF udf\strike4	DOOR_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM D966 ARMOR_BEVEL
					UDF_DIM D968 0
					UDF_DIM D969 0
					UDF_DIM LIP_HEIGHT PRIMARY_STRIKE_LIP_HEIGHT
					UDF_DIM STRIKE_WIDTH PRIMARY_STRIKE_WIDTH
					UDF_DIM STRIKE_HEIGHT PRIMARY_STRIKE_HEIGHT
					UDF_DIM LIP_DEPTH_X PRIMARY_STRIKE_LIP_THICKNESS
					UDF_DIM LIP_DEPTHX .03
					UDF_EXP_REF ATTACH CSYS 5
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF
			END_IF

			IF HAND_ == "RHI2" OR HAND_ == "LHRI1"
				SEARCH_MDL_REF DOOR_ASM CSYS "ORIENT" REF1
				SEARCH_MDL_REF DOOR_ASM CSYS "ACS4" REF2
				GET_REF_POS REF1 REF2 pos

				CREATE_UDF udf\csys DOOR_ASM
					UDF_REF ATTACH REF2
					UDF_DIM	ROTX 180
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX 0
					UDF_DIM	LOCY PRIMARY_STRIKE_CENTER
					UDF_DIM	LOCZ 0
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF

				CREATE_UDF udf\strike4	DOOR_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM D966 -ARMOR_BEVEL
					UDF_DIM D968 0
					UDF_DIM D969 0
					UDF_DIM LIP_HEIGHT PRIMARY_STRIKE_LIP_HEIGHT
					UDF_DIM STRIKE_WIDTH PRIMARY_STRIKE_WIDTH
					UDF_DIM STRIKE_HEIGHT PRIMARY_STRIKE_HEIGHT
					UDF_DIM LIP_DEPTH_X PRIMARY_STRIKE_LIP_THICKNESS
					UDF_DIM LIP_DEPTHX .03
					UDF_EXP_REF ATTACH CSYS 5
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF
			END_IF

			IF PRIMARY_STRIKE_TYPE == "ASA 4*"
				RETRIEVE_MDL STRIKE_BOX_4875.PRT STRIKE
				SEARCH_MDL_REF STRIKE CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE STRIKE DOOR_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
			END_IF

			IF PRIMARY_STRIKE_TYPE == "ASA 2*"
				RETRIEVE_MDL STRIKE_BOX_2750.PRT STRIKE
				SEARCH_MDL_REF STRIKE CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE STRIKE DOOR_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
			END_IF
		END_IF

		IF DPS > 0 AND DPS_POSITION == "HEAD"
			SEARCH_MDL_REF DOOR_ASM CSYS "ORIENT" ASM_CSYS
			IF	HAND_ == "RHR" OR HAND_ == "LH" OR \
				HAND_ == "RHR2" OR HAND_ == "RHRA2" OR HAND_ == "RHRI2" OR \
				HAND_ == "LH1" OR HAND_ == "LHA1" OR HAND_ == "LHI1"
					CREATE_UDF udf\csys DOOR_ASM
						UDF_REF ATTACH ASM_CSYS
						UDF_DIM	ROTX 0
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX (JOW/2) - DPS_LOCATION
						UDF_DIM	LOCY JOH-TOP_GAP
						UDF_DIM	LOCZ 0
						UDF_EXP_REF ATTACH CSYS 0
					END_CREATE_UDF
			END_IF

			IF	HAND_ == "LHR" OR HAND_ == "RH" OR \
				HAND_ == "LHR1" OR HAND_ == "LHRA1" OR HAND_ == "LHRI1" OR \
				HAND_ == "RH2" OR HAND_ == "RHA2" OR HAND_ == "RHI2"
					CREATE_UDF udf\csys DOOR_ASM
						UDF_REF ATTACH ASM_CSYS
						UDF_DIM	ROTX 0
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX -(JOW/2) + DPS_LOCATION
						UDF_DIM	LOCY JOH-TOP_GAP
						UDF_DIM	LOCZ 0
						UDF_EXP_REF ATTACH CSYS 0
					END_CREATE_UDF
			END_IF

				CREATE_UDF &DPS_UDF DOOR_ASM
				UDF_REF ATTACH ATTACH
				UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF
		END_IF

		IF SUB_JOB_NAME == "BSL4" AND DOOR_ELEVATION == "C"
			SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ASM_CSYS
			CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ASM_CSYS
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX 0
				UDF_DIM	LOCY UNDERCUT
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ASM_CSYS CSYS 0
			END_CREATE_UDF
		
			CREATE_UDF udf\port_10_wo_stop DOOR_ASM
				UDF_REF ATTACH ASM_CSYS
				UDF_INTERSECTION * PART_LEVEL
			END_CREATE_UDF
		END_IF
		IF SUB_JOB_NAME == "BSL3" AND DOOR_ELEVATION == "C"
			SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ASM_CSYS
			CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ASM_CSYS
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX 0
				UDF_DIM	LOCY UNDERCUT
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ASM_CSYS CSYS 0
			END_CREATE_UDF
	
			CREATE_UDF udf\port_10_w_stop DOOR_ASM
				UDF_REF ATTACH ASM_CSYS
				UDF_INTERSECTION * PART_LEVEL
			END_CREATE_UDF
		END_IF

		CALL core.tab
		
		DOOR_INDEX ++
	END_WHILE
END_ASM_DESCR
