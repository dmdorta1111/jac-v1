BEGIN_ASM_DESCR

IF HINGE_TYPE == "BUTT"
		
	CLEAR_ARRAY HINGE_LOCATIONS_ARRAY
	IF OPENING_TYPE == 1 OR OPENING_TYPE == 3
		IF HINGE_LOCATION_1 > 0 AND HINGE_QTY >= 1
			HINGE_LOCATION_1 = HINGE_LOCATION_1 !- TOP_GAP
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_1
		END_IF
		IF HINGE_LOCATION_2 > 0 AND HINGE_QTY >= 2
			HINGE_LOCATION_2 = HINGE_LOCATION_2 !- TOP_GAP
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_2
		END_IF
		IF HINGE_LOCATION_3 > 0 AND HINGE_QTY >= 3
			HINGE_LOCATION_3 = HINGE_LOCATION_3 !- TOP_GAP
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_3
		END_IF
		IF HINGE_LOCATION_4 > 0 AND HINGE_QTY >= 4
			HINGE_LOCATION_4 = HINGE_LOCATION_4 !- TOP_GAP
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_4
		END_IF
		IF HINGE_LOCATION_5 > 0 AND HINGE_QTY >= 5
			HINGE_LOCATION_5 = HINGE_LOCATION_5 !- TOP_GAP
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_5
		END_IF
		IF HINGE_LOCATION_6 > 0 AND HINGE_QTY >= 6
			HINGE_LOCATION_6 = HINGE_LOCATION_6 !- TOP_GAP
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_6
		END_IF
		IF HINGE_LOCATION_7 > 0 AND HINGE_QTY >= 7
			HINGE_LOCATION_7 = HINGE_LOCATION_7 !- TOP_GAP
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_7
		END_IF
		IF HINGE_LOCATION_8 > 0 AND HINGE_QTY >= 8
			HINGE_LOCATION_8 = HINGE_LOCATION_8 !- TOP_GAP
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_8
		END_IF
		IF HINGE_LOCATION_9 > 0 AND HINGE_QTY >= 9
			HINGE_LOCATION_9 = HINGE_LOCATION_9 !- TOP_GAP
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_9
		END_IF
	ELSE
		IF HINGE_LOCATION_1 > 0 AND HINGE_QTY >= 1
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_1
		END_IF
		IF HINGE_LOCATION_2 > 0 AND HINGE_QTY >= 2
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_2
		END_IF
		IF HINGE_LOCATION_3 > 0 AND HINGE_QTY >= 3
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_3
		END_IF
		IF HINGE_LOCATION_4 > 0 AND HINGE_QTY >= 4
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_4
		END_IF
		IF HINGE_LOCATION_5 > 0 AND HINGE_QTY >= 5
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_5
		END_IF
		IF HINGE_LOCATION_6 > 0 AND HINGE_QTY >= 6
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_6
		END_IF
		IF HINGE_LOCATION_7 > 0 AND HINGE_QTY >= 7
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_7
		END_IF
		IF HINGE_LOCATION_8 > 0 AND HINGE_QTY >= 8
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_8
		END_IF
		IF HINGE_LOCATION_9 > 0 AND HINGE_QTY >= 9
			ADD_ARRAY_ELEM HINGE_LOCATIONS_ARRAY HINGE_LOCATION_9
		END_IF
	END_IF

	DECLARE_VARIABLE STRING LOOKUPSTRINGNO
					LOOKUPSTRINGNO = "HINGE_HEIGHT == " + ftos(HINGE_HEIGHT,3) + " AND HINGE_THICKNESS == " + ftos(HINGE_THICKNESS,3) + \
					 " AND FR_GA == " + ftos(FR_THICKNESS,3) + " AND GRADE == " +FRAME_GRADE + " AND ELEC == 0" + " AND WELDED_BOX == " + itos(WELDED_BOXES)
	DECLARE_VARIABLE STRING LOOKUPSTRINGYES
					LOOKUPSTRINGYES = "HINGE_HEIGHT == " + ftos(HINGE_HEIGHT,3) + " AND HINGE_THICKNESS == " + ftos(HINGE_THICKNESS,3)	 + \
					" AND FR_GA == " + ftos(FR_THICKNESS,3) + " AND GRADE == " +FRAME_GRADE	+ " AND ELEC == 1" + " AND WELDED_BOX == " + itos(WELDED_BOXES)
					
	IF HAND == "LHR" OR HAND == "RH" OR HAND == "LHRA" OR HAND == "RHRA" OR \
	   HAND == "LHR/RHR" OR HAND == "LHA"  OR HAND == "RHA" OR HAND == "LH/RH"
		SEARCH_MDL_REF ASSEM ASSEMBLY "FRAME_ASM_"+SO_NUM+"_"+ ITEM_NUM FRAME_ASM
		SEARCH_MDL_REF FRAME_ASM CSYS "ORIENT" ASM_CSYS
		CREATE_UDF udf\csys FRAME_ASM
		UDF_REF ATTACH ASM_CSYS
		UDF_DIM	ROTX 0
		UDF_DIM	ROTY 0
		UDF_DIM	ROTZ 0
		UDF_DIM	LOCX -(JOW/2)
		UDF_DIM	LOCY JOH
		UDF_DIM	LOCZ (JD/2)
		UDF_EXP_REF refCsys CSYS 0
		END_CREATE_UDF

		HINGE_INDEX = 1
		FOR LOCY REF ARRAY HINGE_LOCATIONS_ARRAY
			CREATE_UDF udf\frame_hinge FRAME_ASM
			UDF_REF ATTACH refCsys
			UDF_DIM LOCY -LOCY
			UDF_DIM DIMX HINGE_THICKNESS + BUTT_HINGE_THICKNESS_ALLOWANCE
			UDF_DIM DIMY HINGE_HEIGHT + BUTT_HINGE_HEIGHT_ALLOWANCE
			UDF_DIM DIMZ RABBET - JAMB_HINGE_SETBACK + BUTT_HINGE_WIDTH_ALLOWANCE
			UDF_EXP_REF LOC+itos(HINGE_INDEX) CSYS 0
			UDF_INTERSECTION * PART_LEVEL
			END_CREATE_UDF

			RETRIEVE_MDL frame_hinge_asm.asm HINGE_ASM
			SEARCH_MDL_REF HINGE_ASM CSYS "PLACEMENT" PLACEMENT
			ASSEMBLE HINGE_ASM FRAME_ASM
				CSYS LOC+itos(HINGE_INDEX) PLACEMENT
			END_ASSEMBLE

			IF ELECTRIC_HINGE_POSITION == HINGE_INDEX AND SUB_TYPE == "S"
				LOOKUP_FAMINSTANCE HINGE_ASM LOOKUPSTRINGYES instance_name
				GET_REF_FAMINSTANCE HINGE_ASM instance_name instance
				REPLACE_COMPONENT HINGE_ASM instance
				
					RETRIEVE_MDL DUST_BOX_ELEC.PRT COMP
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP FRAME_ASM
						CSYS LOC+itos(HINGE_INDEX) PLACEMENT
					END_ASSEMBLE
					
				SET_REF_NAME LOC+itos(HINGE_INDEX) "ELEC1F"					
			ELSE_IF ELECTRIC_HINGE_POSITION == HINGE_INDEX AND SUB_TYPE == "P" AND \
				(((HAND == "LHA" OR HAND == "LH/RH") AND (ELEC_HINGE_DOOR == 1 OR ELEC_HINGE_DOOR == 2)) OR \
				((HAND == "RHRA" OR HAND == "LHR/RHR") AND (ELEC_HINGE_DOOR == 0 OR ELEC_HINGE_DOOR == 2)) OR \
				(HAND == "LHRA" AND (ELEC_HINGE_DOOR == 1 OR ELEC_HINGE_DOOR == 2)) OR \
				(HAND == "RHA" AND (ELEC_HINGE_DOOR == 1 OR ELEC_HINGE_DOOR == 2)))

				LOOKUP_FAMINSTANCE HINGE_ASM LOOKUPSTRINGYES instance_name
				GET_REF_FAMINSTANCE HINGE_ASM instance_name instance
				REPLACE_COMPONENT HINGE_ASM instance
				! IF DUST_BOXES == 1
					RETRIEVE_MDL DUST_BOX_ELEC.PRT COMP
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP FRAME_ASM
						CSYS LOC+itos(HINGE_INDEX) PLACEMENT
					END_ASSEMBLE
				! END_IF
				
				IF ((HAND == "LHA" OR HAND == "LH/RH") AND (ELEC_HINGE_DOOR == 1 OR ELEC_HINGE_DOOR == 2))
					SET_REF_NAME LOC+itos(HINGE_INDEX) "ELECRF"
				ELSE_IF ((HAND == "RHRA" OR HAND == "LHR/RHR") AND (ELEC_HINGE_DOOR == 0 OR ELEC_HINGE_DOOR == 2))
					SET_REF_NAME LOC+itos(HINGE_INDEX) "ELECLF"
				ELSE_IF (HAND == "LHRA" AND (ELEC_HINGE_DOOR == 1 OR ELEC_HINGE_DOOR == 2))
					SET_REF_NAME LOC+itos(HINGE_INDEX) "ELECRF"
				ELSE_IF (HAND == "RHA" AND (ELEC_HINGE_DOOR == 1 OR ELEC_HINGE_DOOR == 2))
					SET_REF_NAME LOC+itos(HINGE_INDEX) "ELECLF"
				END_IF	   
			ELSE
				LOOKUP_FAMINSTANCE HINGE_ASM LOOKUPSTRINGNO instance_name
				GET_REF_FAMINSTANCE HINGE_ASM instance_name instance
				REPLACE_COMPONENT HINGE_ASM instance
				IF DUST_BOXES == 1
					RETRIEVE_MDL DUST_BOX.PRT COMP
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP FRAME_ASM
						CSYS LOC+itos(HINGE_INDEX) PLACEMENT
					END_ASSEMBLE
				END_IF
			END_IF
			HINGE_INDEX ++
		END_FOR
	END_IF
	
	IF HAND == "RHR" OR HAND == "LH" OR HAND == "LHRA" OR HAND == "RHRA" OR \
	   HAND == "LHR/RHR" OR HAND == "LHA"  OR HAND == "RHA" OR HAND == "LH/RH"
		SEARCH_MDL_REF ASSEM ASSEMBLY "FRAME_ASM_"+SO_NUM+"_"+ ITEM_NUM FRAME_ASM
		SEARCH_MDL_REF FRAME_ASM CSYS "ORIENT" ASM_CSYS
		CREATE_UDF udf\csys FRAME_ASM
		UDF_REF ATTACH ASM_CSYS
		UDF_DIM	ROTX 0
		UDF_DIM	ROTY 0
		UDF_DIM	ROTZ 180
		UDF_DIM	LOCX (JOW/2)
		UDF_DIM	LOCY JOH
		UDF_DIM	LOCZ (JD/2)
		UDF_EXP_REF refCsys CSYS 0
		END_CREATE_UDF

		HINGE_INDEX = 1
		FOR LOCY REF ARRAY HINGE_LOCATIONS_ARRAY
			CREATE_UDF udf\frame_hinge FRAME_ASM
			UDF_REF ATTACH refCsys
			UDF_DIM LOCY LOCY
			UDF_DIM DIMX HINGE_THICKNESS + BUTT_HINGE_THICKNESS_ALLOWANCE
			UDF_DIM DIMY HINGE_HEIGHT + BUTT_HINGE_HEIGHT_ALLOWANCE
			UDF_DIM DIMZ RABBET - JAMB_HINGE_SETBACK + BUTT_HINGE_WIDTH_ALLOWANCE
			UDF_EXP_REF LOC+itos(HINGE_INDEX) CSYS 0
			UDF_INTERSECTION * PART_LEVEL
			END_CREATE_UDF

			RETRIEVE_MDL frame_hinge_asm.asm HINGE_ASM
			SEARCH_MDL_REF HINGE_ASM CSYS "PLACEMENT" PLACEMENT
			ASSEMBLE HINGE_ASM FRAME_ASM
				CSYS LOC+itos(HINGE_INDEX) PLACEMENT
			END_ASSEMBLE

			IF ELECTRIC_HINGE_POSITION == HINGE_INDEX AND SUB_TYPE == "S"
				LOOKUP_FAMINSTANCE HINGE_ASM LOOKUPSTRINGYES instance_name
				GET_REF_FAMINSTANCE HINGE_ASM instance_name instance
				REPLACE_COMPONENT HINGE_ASM instance
				! IF DUST_BOXES == 1			
					RETRIEVE_MDL DUST_BOX_ELEC.PRT COMP
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP FRAME_ASM
						CSYS LOC+itos(HINGE_INDEX) PLACEMENT
					END_ASSEMBLE
				! END_IF
				SET_REF_NAME LOC+itos(HINGE_INDEX) "ELEC1F"									
			ELSE_IF ELECTRIC_HINGE_POSITION == HINGE_INDEX AND SUB_TYPE == "P" AND \
				(((HAND == "LHA" OR HAND == "LH/RH") AND (ELEC_HINGE_DOOR == 0 OR ELEC_HINGE_DOOR == 2)) OR \
				((HAND == "RHRA" OR HAND == "LHR/RHR") AND (ELEC_HINGE_DOOR == 1 OR ELEC_HINGE_DOOR == 2)) OR \
				(HAND == "LHRA" AND (ELEC_HINGE_DOOR == 0 OR ELEC_HINGE_DOOR == 2)) OR \
				(HAND == "RHA" AND (ELEC_HINGE_DOOR == 0 OR ELEC_HINGE_DOOR == 2)))
					
				LOOKUP_FAMINSTANCE HINGE_ASM LOOKUPSTRINGYES instance_name
				GET_REF_FAMINSTANCE HINGE_ASM instance_name instance
				REPLACE_COMPONENT HINGE_ASM instance

					RETRIEVE_MDL DUST_BOX_ELEC.PRT COMP
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP FRAME_ASM
						CSYS LOC+itos(HINGE_INDEX) PLACEMENT
					END_ASSEMBLE
				IF ((HAND == "LHA" OR HAND == "LH/RH") AND (ELEC_HINGE_DOOR == 0 OR ELEC_HINGE_DOOR == 2))
					SET_REF_NAME LOC+itos(HINGE_INDEX) "ELECLF"
				ELSE_IF ((HAND == "RHRA" OR HAND == "LHR/RHR") AND (ELEC_HINGE_DOOR == 1 OR ELEC_HINGE_DOOR == 2))
					SET_REF_NAME LOC+itos(HINGE_INDEX) "ELECRF"
				ELSE_IF (HAND == "LHRA" AND (ELEC_HINGE_DOOR == 0 OR ELEC_HINGE_DOOR == 2))
					SET_REF_NAME LOC+itos(HINGE_INDEX) "ELECLF"
				ELSE_IF (HAND == "RHA" AND (ELEC_HINGE_DOOR == 0 OR ELEC_HINGE_DOOR == 2))
					SET_REF_NAME LOC+itos(HINGE_INDEX) "ELECRF"
				END_IF
			ELSE
				LOOKUP_FAMINSTANCE HINGE_ASM LOOKUPSTRINGNO instance_name
				GET_REF_FAMINSTANCE HINGE_ASM instance_name instance
				REPLACE_COMPONENT HINGE_ASM instance
				IF DUST_BOXES == 1
					RETRIEVE_MDL DUST_BOX.PRT COMP
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP FRAME_ASM
						CSYS LOC+itos(HINGE_INDEX) PLACEMENT
					END_ASSEMBLE
				END_IF
			END_IF
			HINGE_INDEX ++
		END_FOR
	END_IF
END_IF

BEGIN_CATCH_ERROR
SEARCH_MDL_REFS FRAME_ASM COMPONENT "DUST*" COMPS
FOR COMP REF ARRAY COMPS
	SET_ON_LAYER COMP "COMPONENTS"
END_FOR
END_CATCH_ERROR
CLEAR_CATCH_ERROR

! END FRAME BUTT HINGE PREPS

END_ASM_DESCR
