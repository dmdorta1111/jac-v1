BEGIN_ASM_DESCR
	DECLARE_VARIABLE INTEGER ROW
	DECLARE_VARIABLE INTEGER TEST_ROW
	DECLARE_VARIABLE INTEGER QUANTITY
	DECLARE_VARIABLE STRING EXCEL_COMPONENT_NAME ""
	DECLARE_VARIABLE INTEGER STOCKTYPE
	DECLARE_VARIABLE STRING MATCH
	DECLARE_VARIABLE STRING INSTANCE_NAME
	DECLARE_VARIABLE STRING COMPONENT_NAME
	DECLARE_VARIABLE STRING STATE
	DECLARE_VARIABLE DOUBLE LENGTH
	DECLARE_VARIABLE DOUBLE WIDTH
	DECLARE_VARIABLE DOUBLE X
	DECLARE_VARIABLE DOUBLE Y
	DECLARE_VARIABLE DOUBLE Z
	DECLARE_VARIABLE STRING EXCEL_DOCUMENT
	DECLARE_VARIABLE STRING TEST_EOF
	DECLARE_VARIABLE STRING TEST_COMPONENT
	DECLARE_VARIABLE DOUBLE TEST_THICKNESS
	DECLARE_VARIABLE STRING TEST_TYPE
	DECLARE_VARIABLE INTEGER TEST_GRADE
	DECLARE_VARIABLE INTEGER TEST_FINISH
	DECLARE_VARIABLE DOUBLE TEST_LENGTH
	DECLARE_VARIABLE DOUBLE TEST_WIDTH
	DECLARE_VARIABLE DOUBLE THICKNESS
	DECLARE_VARIABLE STRING TYPE
	DECLARE_VARIABLE INTEGER GRADE
	DECLARE_VARIABLE INTEGER FINISH
	DECLARE_VARIABLE STRING PROCESS_STATE
	DECLARE_VARIABLE STRING SO_NUM
	DECLARE_VARIABLE STRING PROJECT_FOLDER
	DECLARE_VARIABLE STRING DXF_FOLDER
	DECLARE_VARIABLE STRING FRAME_WO
	DECLARE_VARIABLE STRING DOOR_WO
	DECLARE_VARIABLE STRING WO_NUM
	DECLARE_VARIABLE INTEGER SHEET_QTY 0

	IF SHEET_QTY == 0
		PRINT "ENTER QUANTITY"
		USER_INPUT_PARAM INTEGER SHEET_QTY
	END_IF
	
	ROW = 5
	SO_NUM = "27655"
	EXCEL_DOCUMENT = "BOM_27655.xls"

	PROJECT_FOLDER = "C:"+\+"00WF4"+\+SO_NUM+\+"ProE Models"
	DXF_FOLDER = PROJECT_FOLDER+"\DXF"

	SET_WORKING_DIRECTORY PROJECT_FOLDER	
	! CREATE_DIRECTORY DXF_FOLDER	
	
	DECLARE_REFERENCE ASSEM THIS
	SEARCH_MDL_REFS RECURSIVE ASSEM COMPONENT "*" ALL_COMPONENTS

	EXCEL_CONNECT
	EXCEL_LOAD_DOCUMENT EXCEL_DOCUMENT
	
	FOR EACH_COMPONENT REF ARRAY ALL_COMPONENTS
		GET_REF_PARENT EACH_COMPONENT PARENT
		GET_REF_NAME PARENT PARENT_NAME
		
		WHILE PARENT_NAME <> "FRAME_ASM*" AND PARENT_NAME <> "DOOR_ASM*" AND PARENT_NAME <> "ASM*"
			GET_REF_PARENT PARENT PARENT
			GET_REF_NAME PARENT PARENT_NAME
		END_WHILE	
		
		IF PARENT_NAME == "FRAME_ASM*"
			EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "FRAME"
		ELSE_IF PARENT_NAME == "DOOR_ASM*"
			EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "DOOR"
		ELSE
			EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "MISC"
		END_IF

		GET_REF_PARENT EACH_COMPONENT PARENT
		GET_REF_NAME PARENT PARENT_NAME

		SEARCH_MDL_PARAM PARENT "STOCKTYPE" PARENT_STOCKTYPE
		IF PARENT_STOCKTYPE <> 3 AND PARENT_STOCKTYPE <> 0
			GET_REF_NAME EACH_COMPONENT COMPONENT_NAME
			SEARCH_MDL_PARAM EACH_COMPONENT "STOCKTYPE" STOCKTYPE
			GET_MDL_EXTENSION EACH_COMPONENT EXTENSION
			IF (STOCKTYPE == 3 AND (EXTENSION == "asm" OR EXTENSION == "prt")) OR (STOCKTYPE == 1 AND EXTENSION == "prt")
				PROCESS_STATE = ""
				WHILE COMPONENT_NAME <> EXCEL_COMPONENT_NAME AND PROCESS_STATE <> "DONE"
					EXCEL_GET_STRING ROW 1 EXCEL_COMPONENT_NAME
					IF COMPONENT_NAME == EXCEL_COMPONENT_NAME
						EXCEL_GET_VALUE ROW 3 QUANTITY
						EXCEL_SET_VALUE ROW 3 QUANTITY + SHEET_QTY
					ELSE_IF COMPONENET_NAME <> EXCEL_COMPONENT_NAME AND EXCEL_COMPONENT_NAME <> ""
						ROW++
					ELSE_IF EXCEL_COMPONENT_NAME == ""
						EXCEL_SET_VALUE ROW 1 COMPONENT_NAME
						EXCEL_SET_VALUE ROW 2 STOCKTYPE
						EXCEL_SET_VALUE ROW 3 SHEET_QTY
						PROCESS_STATE = "DONE"
					END_IF
				END_WHILE
			END_IF
		END_IF
		ROW = 5
		EXCEL_COMPONENT_NAME = ""
	END_FOR
	
EXCEL_SAVE_DOCUMENT EXCEL_DOCUMENT
EXCEL_DISCONNECT
WINDOW_CLOSE
END_ASM_DESCR
