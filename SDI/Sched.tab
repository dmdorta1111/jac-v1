BEGIN_GUI_DESCR

	GLOBAL_PICTURE drwhistory.gif

	SHOW_PARAM STRING CUSTOMER_NAME
	SHOW_PARAM STRING JOB_NAME
	SHOW_PARAM STRING SO_NUM

	IF REV1_NUM <> "1"
		USER_INPUT_PARAM	STRING		REV0_NUM
		USER_INPUT_PARAM	STRING		REV0_DATE
		! USER_INPUT_PARAM	STRING		REV0_BY
	END_IF

	RADIOBUTTON_PARAM INTEGER ADD_REVISION "NO" "YES"
	IF REV0 <> "" AND REV1_NUM == "" AND ADD_REV <> 1 AND ADD_REVISION == 1
		REV1_NUM = "1"
		REV1_DATE = date
		ADD_REVISION = 0
		USER_INPUT_PARAM	STRING		REV1_NUM
		USER_INPUT_PARAM	STRING		REV1_DATE
		REV1_BY = DRAWN_BY
		! USER_INPUT_PARAM	STRING		REV1_BY
	ELSE_IF REV1 <> "" AND REV2_NUM == "" AND ADD_REV <> 1 AND ADD_REVISION == 1
		REV2_NUM = "2"
		REV2_DATE = date
		ADD_REVISION = 0
		USER_INPUT_PARAM	STRING		REV2_NUM
		USER_INPUT_PARAM	STRING		REV2_DATE
		REV2_BY = DRAWN_BY
		! USER_INPUT_PARAM	STRING		REV2_BY
	ELSE_IF REV2 <> "" AND REV3_NUM == "" AND ADD_REV <> 1 AND ADD_REVISION == 1
		REV3_NUM = "3"
		REV3_DATE = date
		ADD_REVISION = 0
		USER_INPUT_PARAM	STRING		REV3_NUM
		USER_INPUT_PARAM	STRING		REV3_DATE
		REV3_BY = DRAWN_BY
		! USER_INPUT_PARAM	STRING		REV3_BY
	ELSE_IF REV3 <> "" AND REV4_NUM == "" AND ADD_REV <> 1 AND ADD_REVISION == 1
		REV4_NUM = "4"
		REV4_DATE = date
		ADD_REVISION = 0
		USER_INPUT_PARAM	STRING		REV4_NUM
		USER_INPUT_PARAM	STRING		REV4_DATE
		REV4_BY = DRAWN_BY
		! USER_INPUT_PARAM	STRING		REV4_BY
	END_IF

END_GUI_DESCR


BEGIN_ASM_DESCR

DECLARE_VARIABLE INTEGER 	COLUMNS 0
DECLARE_VARIABLE INTEGER	COVER_SHEETS
DECLARE_VARIABLE STRING		CUSTOMER_NAME
DECLARE_VARIABLE BOOL 		EOF FALSE
DECLARE_VARIABLE INTEGER 	EXCEL_COLUMN
DECLARE_VARIABLE STRING		EXCEL_DOCUMENT_NAME
DECLARE_VARIABLE INTEGER 	EXISTING_DIRECTORY
DECLARE_VARIABLE INTEGER 	EXISTING_EXCEL
DECLARE_VARIABLE INTEGER 	ITEM_CELL
DECLARE_VARIABLE INTEGER	ITEM_INDEX 1
DECLARE_VARIABLE STRING		ITEM_NUM
DECLARE_VARIABLE INTEGER	ITEM_SHEET
DECLARE_VARIABLE INTEGER	ITEMS_PER_SHEET 50
DECLARE_VARIABLE INTEGER	ITP   !ITEMS_TO_PROCESS
DECLARE_VARIABLE STRING		JOB_NAME
DECLARE_VARIABLE INTEGER	MASTER_TAG
DECLARE_VARIABLE STRING 	MATCH
DECLARE_VARIABLE STRING 	PARAMETERS
DECLARE_VARIABLE STRING 	PROJECT_DIRECTORY
DECLARE_VARIABLE INTEGER 	ROW
DECLARE_VARIABLE INTEGER 	ROWS 0
DECLARE_VARIABLE INTEGER	SHEET
DECLARE_VARIABLE INTEGER	SHEET_INDEX
DECLARE_VARIABLE INTEGER	SHEET_ITEM_INDEX
DECLARE_VARIABLE INTEGER 	SIZE
DECLARE_VARIABLE STRING		SO_NUM
DECLARE_VARIABLE INTEGER	SUB_TAGS
DECLARE_VARIABLE INTEGER 	TEST_ITEM_CELL
DECLARE_VARIABLE STRING		TEST_EOF
DECLARE_VARIABLE INTEGER	TEST_ITEM_INDEX 2
DECLARE_VARIABLE STRING		TEST_ITEM_MASTER_TAG
DECLARE_VARIABLE STRING		TESTED_ITEM_NUM
DECLARE_VARIABLE STRING		REV0_NUM ""
DECLARE_VARIABLE STRING		REV0_DATE ""
DECLARE_VARIABLE STRING		REV0_BY ""
DECLARE_VARIABLE STRING		REV1_NUM ""
DECLARE_VARIABLE STRING		REV1_DATE ""
DECLARE_VARIABLE STRING		REV1_BY
DECLARE_VARIABLE STRING		REV2_NUM ""
DECLARE_VARIABLE STRING		REV2_DATE ""
DECLARE_VARIABLE STRING		REV2_BY
DECLARE_VARIABLE STRING		REV3_NUM ""
DECLARE_VARIABLE STRING		REV3_DATE ""
DECLARE_VARIABLE STRING		REV3_BY
DECLARE_VARIABLE STRING		REV4_NUM ""
DECLARE_VARIABLE STRING		REV4_DATE ""
DECLARE_VARIABLE STRING		REV4_BY
DECLARE_VARIABLE STRING		REV5_NUM ""
DECLARE_VARIABLE STRING		REV5_DATE ""
DECLARE_VARIABLE STRING		REV5_BY
DECLARE_VARIABLE STRING		HISTORY
DECLARE_VARIABLE STRING		AS_BUILT
DECLARE_VARIABLE INTEGER	AS_BUILT_
DECLARE_VARIABLE INTEGER	TEXT_LEN
DECLARE_VARIABLE INTEGER	TEXT_LEN_A
DECLARE_VARIABLE INTEGER	TEXT_LEN_B
DECLARE_VARIABLE INTEGER	TEXT_INDEX
DECLARE_VARIABLE INTEGER	HISTORY_INDEX
DECLARE_VARIABLE INTEGER	OPERATION
DECLARE_VARIABLE STRING		VALUE1 ""
DECLARE_VARIABLE STRING		VALUE2 ""
DECLARE_VARIABLE STRING		VALUE3 ""
DECLARE_VARIABLE INTEGER	ADD_REV
	ADD_REV = 0

IF SHEETT == "COVER"
	EXCEL_GET_VALUE 301	1	HISTORY
END_IF

IF SHEETT == "MODELS"
	EXCEL_GET_VALUE 298	EXCEL_COLUMN HISTORY
END_IF

TEXT_INDEX = 0
TEXT_LEN_A = strlen(HISTORY)
!REV0
IF TEXT_LEN_A == 0
	REV0_NUM = "0"
	GET_TIME_STRING "%x" date
	REV0_DATE = date
	REV0_BY = DRAWN_BY
ELSE
	IF TEXT_INDEX < TEXT_LEN_A
	VALUE1 = ""
	! TEXT_INDEX++
	WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
		VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
		TEXT_INDEX++
	END_WHILE
	REV0_NUM = VALUE1
		IF TEXT_INDEX < TEXT_LEN_A
			VALUE1 = ""
			TEXT_INDEX++
			WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
				VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
				TEXT_INDEX++
			END_WHILE
			REV0_DATE = VALUE1
			IF TEXT_INDEX < TEXT_LEN_A
				VALUE1 = ""
				TEXT_INDEX++
				WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
					VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
					TEXT_INDEX++
				END_WHILE
				REV0_BY = VALUE1
				IF TEXT_INDEX < TEXT_LEN_A
					VALUE1 = ""
					TEXT_INDEX++
					WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
						VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
						TEXT_INDEX++
					END_WHILE
					REV1_NUM = VALUE1
					IF TEXT_INDEX < TEXT_LEN_A
						VALUE1 = ""
						TEXT_INDEX++
						WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
							VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
							TEXT_INDEX++
						END_WHILE
						REV1_DATE = VALUE1
						IF TEXT_INDEX < TEXT_LEN_A
							VALUE1 = ""
							TEXT_INDEX++
							WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
								VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
								TEXT_INDEX++
							END_WHILE
							REV1_BY = VALUE1
							IF TEXT_INDEX < TEXT_LEN_A
								VALUE1 = ""
								TEXT_INDEX++
								WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
									VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
									TEXT_INDEX++
								END_WHILE
								REV2_NUM = VALUE1
								IF TEXT_INDEX < TEXT_LEN_A
									VALUE1 = ""
									TEXT_INDEX++
									WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
										VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
										TEXT_INDEX++
									END_WHILE
									REV2_DATE = VALUE1
									IF TEXT_INDEX < TEXT_LEN_A
										VALUE1 = ""
										TEXT_INDEX++
										WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
											VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
											TEXT_INDEX++
										END_WHILE
										REV2_BY = VALUE1
										IF TEXT_INDEX < TEXT_LEN_A
											VALUE1 = ""
											TEXT_INDEX++
											WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
												VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
												TEXT_INDEX++
											END_WHILE
											REV3_NUM = VALUE1
											IF TEXT_INDEX < TEXT_LEN_A
												VALUE1 = ""
												TEXT_INDEX++
												WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
													VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
													TEXT_INDEX++
												END_WHILE
												REV3_DATE = VALUE1
												IF TEXT_INDEX < TEXT_LEN_A
													VALUE1 = ""
													TEXT_INDEX++
													WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
														VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
														TEXT_INDEX++
													END_WHILE
													REV3_BY = VALUE1
													IF TEXT_INDEX < TEXT_LEN_A
														VALUE1 = ""
														TEXT_INDEX++
														WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
															VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
															TEXT_INDEX++
														END_WHILE
														REV4_NUM = VALUE1
														IF TEXT_INDEX < TEXT_LEN_A
															VALUE1 = ""
															TEXT_INDEX++
															WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
																VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
																TEXT_INDEX++
															END_WHILE
															REV4_DATE = VALUE1
															IF TEXT_INDEX < TEXT_LEN_A
																VALUE1 = ""
																TEXT_INDEX++
																WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
																	VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
																	TEXT_INDEX++
																END_WHILE
																REV4_BY = VALUE1
															END_IF
														END_IF
													END_IF
												END_IF
											END_IF
										END_IF
									END_IF
								END_IF
							END_IF
						END_IF
					END_IF
				END_IF
			END_IF
		END_IF
	END_IF
END_IF

GET_TIME_STRING "%x" date

IF OPERATION == 1 AND TEXT_LEN_A == 0
	CONFIG_ELEM AUTO_COMMIT
ELSE_IF (OPERATION == 1 AND TEXT_LEN_A > 1) OR (OPERATION <> 1 AND OPERATION <> 3)
	CONFIG_ELEM
END_IF

IF REV0_NUM <> ""
	HISTORY = REV0_NUM+"^"+REV0_DATE+"^"+REV0_BY
END_IF
IF REV1_NUM <> ""
	HISTORY = HISTORY +"^"+REV1_NUM+"^"+REV1_DATE+"^"+REV1_BY
END_IF
IF REV2_NUM <> ""
	HISTORY = HISTORY +"^"+REV2_NUM+"^"+REV2_DATE+"^"+REV2_BY
END_IF
IF REV3_NUM <> ""
	HISTORY = HISTORY +"^"+REV3_NUM+"^"+REV3_DATE+"^"+REV3_BY
END_IF
IF REV4_NUM <> ""
	HISTORY = HISTORY +"^"+REV4_NUM+"^"+REV4_DATE+"^"+REV4_BY
END_IF

IF OPERATION == 3
	AS_BUILT = "AS BUILT"+"^"+date+"^"+AS_BUILT_BY
END_IF

IF SHEETT == "COVER"
	EXCEL_SET_VALUE 301	1 HISTORY
	IF OPERATION == 3
		EXCEL_SET_VALUE 302	1 AS_BUILT
	END_IF
END_IF

IF SHEETT == "MODELS"
	EXCEL_SET_VALUE 298	EXCEL_COLUMN HISTORY
	IF OPERATION == 3
		EXCEL_SET_VALUE 299	EXCEL_COLUMN AS_BUILT
	END_IF
END_IF

IF SHEETT == "COVER"
	ITEM_INDEX = 1
	TEST_ITEM_INDEX = 2

	EXCEL_COLUMN = 1
	COLUMNS = 0
	EOF = FALSE
	WHILE EOF == FALSE
		EXCEL_GET_VALUE 0 EXCEL_COLUMN CUSTOMER_NAME
		IF CUSTOMER_NAME == ""
			EOF = TRUE
		ELSE
			COLUMNS++
			EXCEL_COLUMN ++
		END_IF
	END_WHILE
	ITP = COLUMNS

	EXCEL_COLUMN = 1
	COLUMNS = 0
	EOF = FALSE
	WHILE EOF == FALSE
		EXCEL_GET_VALUE 0 EXCEL_COLUMN CUSTOMER_NAME
		IF CUSTOMER_NAME == ""
			EOF = TRUE
		ELSE
			EXCEL_GET_VALUE 5 EXCEL_COLUMN ITEM_NUN
			EXCEL_SET_VALUE 293 EXCEL_COLUMN MASTER_TAG
			EXCEL_SET_VALUE 294 EXCEL_COLUMN ""
			COLUMNS++
			EXCEL_COLUMN ++
		END_IF
	END_WHILE

	ROW = 6
	ROWS = 0
	EOF = FALSE
	WHILE EOF == FALSE
		EXCEL_GET_VALUE ROW 0 PARAMETERS
		IF PARAMETERS == "" OR PARAMETERS == 0
			EOF = TRUE
		ELSE
			ROWS++
			ROW ++
		END_IF
	END_WHILE

	DECLARE_ARRAY arrayData
	EXCEL_GET_VALUES CELL_BY_INDEX 6 1 CELL_BY_INDEX (ROW-1) ITP arrayData
	GET_ARRAY_SIZE arrayData SIZE

	COVER_SHEETS = CEIL(ITP/50)
	SHEET = COVER_SHEETS + 1

	WHILE ITEM_INDEX <= ITP
		IF ITEM_INDEX == ITP
			EXCEL_GET_VALUE 293 ITEM_INDEX MASTER_TAG
			IF MASTER_TAG == ""
				EXCEL_GET_VALUE 5 ITEM_INDEX ITEM_NUM
				EXCEL_GET_VALUE 8 ITEM_INDEX SHEET_QTY
				EXCEL_SET_VALUE 293 ITEM_INDEX ITEM_NUM
				EXCEL_SET_VALUE 295 ITEM_INDEX SHEET
				EXCEL_SET_VALUE 296 ITEM_INDEX SHEET_QTY
				SHEET = SHEET+1
			END_IF
		ELSE_IF ITEM_INDEX < ITP
			EXCEL_GET_VALUE 293 ITEM_INDEX MASTER_TAG
			IF MASTER_TAG == ""
				EXCEL_GET_VALUE 5 ITEM_INDEX ITEM_NUM
				EXCEL_GET_VALUE 8 ITEM_INDEX SHEET_QTY
				EXCEL_SET_VALUE 293 ITEM_INDEX ITEM_NUM
				EXCEL_SET_VALUE 295 ITEM_INDEX SHEET
				EXCEL_SET_VALUE 296 ITEM_INDEX SHEET_QTY
				SHEET = SHEET+1
				TEST_ITEM_INDEX = ITEM_INDEX+1
				WHILE TEST_ITEM_INDEX <= ITP
					EXCEL_GET_VALUE 293 TEST_ITEM_INDEX TEST_ITEM_MASTER_TAG
					IF TEST_ITEM_MASTER_TAG == ""
						MATCH = "YES"
						ITEM_CELL = ITEM_INDEX-1
						TEST_ITEM_CELL = TEST_ITEM_INDEX-1
						WHILE TEST_ITEM_CELL <= SIZE AND MATCH == "YES"
							IF ITEM_CELL < (ITP*2) OR ITEM_CELL > (ITP*2)
							GET_ARRAY_ELEM arrayData ITEM_CELL data1
								GET_ARRAY_ELEM arrayData TEST_ITEM_CELL data2
									GET_ARRAY_ELEM data1 2 value1
									GET_ARRAY_ELEM data2 2 value2
								IF value1 == value2
									MATCH = "YES"
								ELSE
									MATCH = "NO"
								END_IF
							END_IF
								ITEM_CELL = ITEM_CELL+ITP
								TEST_ITEM_CELL = TEST_ITEM_CELL+ITP
						END_WHILE
						IF MATCH == "YES"
							EXCEL_GET_VALUE 295 ITEM_INDEX ITEM_SHEET
							EXCEL_GET_VALUE 296 ITEM_INDEX SHEET_QTY
							EXCEL_GET_VALUE 8 TEST_ITEM_INDEX TEST_ITEM_QTY
							EXCEL_GET_VALUE 5 TEST_ITEM_INDEX TESTED_ITEM_NUM
							EXCEL_GET_VALUE 294 ITEM_INDEX SUB_TAGS
							EXCEL_SET_VALUE 295 TEST_ITEM_INDEX ITEM_SHEET
							EXCEL_SET_VALUE 293 TEST_ITEM_INDEX ITEM_NUM
							EXCEL_SET_VALUE 296 ITEM_INDEX SHEET_QTY + TEST_ITEM_QTY
							IF SUB_TAGS == ""
								SUB_TAGS = TESTED_ITEM_NUM+"^"+itos(TEST_ITEM_QTY)
							ELSE
								SUB_TAGS = SUB_TAGS+"^"+TESTED_ITEM_NUM+"^"+itos(TEST_ITEM_QTY)
							END_IF
							EXCEL_SET_VALUE 294 ITEM_INDEX SUB_TAGS
						END_IF
					END_IF
					TEST_ITEM_INDEX++
				END_WHILE
			END_IF
		END_IF
		ITEM_INDEX++
	END_WHILE

	DECLARE_VARIABLE INTEGER TOTAL_SHEETS
	TOTAL_SHEETS = SHEET - 1

	EXCEL_COLUMN = 1
	EXCEL_GET_VALUE 0 EXCEL_COLUMN TEST_EOF

	IF TEST_EOF == ""
		EOF = TRUE
	ELSE
		EOF = FALSE
	END_IF

	WHILE EOF == FALSE
		EXCEL_SET_VALUE 297 EXCEL_COLUMN TOTAL_SHEETS
		EXCEL_COLUMN++
		EXCEL_GET_VALUE 0 EXCEL_COLUMN TEST_EOF

		IF TEST_EOF == ""
			EOF = TRUE
		ELSE
			EOF = FALSE
		END_IF
	END_WHILE

	EXCEL_GET_VALUE 0 1 CUSTOMER_NAME
	RETRIEVE_MDL ASSEM.ASM ASSEM
	SET_MDL_NAME ASSEM "ASM_"+SO_NUM
	SET_MDL_PARAM ASSEM "CUSTOMER_NAME" CUSTOMER_NAME
	SET_MDL_PARAM ASSEM "JOB_NAME" JOB_NAME
	SET_MDL_PARAM ASSEM "SO_NUM" SO_NUM
	SET_MDL_PARAM ASSEM "ITEM_NUM" " "
	SET_MDL_PARAM ASSEM "ITEM_DESC" "SEE TABLE"

	CREATE_DRW ASSEM sdi_b_template.drw refDrawing

	SHEET_INDEX = 1
	ITEM_INDEX = 1
	WHILE SHEET_INDEX <= COVER_SHEETS
		IF SHEET_INDEX > 1
			INSERT_DRW_SHEET refDrawing SHEET_INDEX
		END_IF

		CREATE_DRW_TABLE refDrawing ASSEM SHEET_INDEX .5625 10.4375 "lib:cover.tbl" COVER
		SHEET_ITEM_INDEX = 1
		WHILE ITEM_INDEX <= (ITEMS_PER_SHEET * SHEET_INDEX)+1 AND ITEM_INDEX <= ITP
			INSERT_DRW_TABLE_ROW refDrawing COVER SHEET_ITEM_INDEX .912 ROW_ID
			EXCEL_GET_VALUE 5 ITEM_INDEX ITEM_NUM
			IF ITEM_NUM <> ""
				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 1 ITEM_NUM
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 1 HEIGHT .08 HORIZONTAL LEFT
			END_IF

			EXCEL_GET_VALUE 9 ITEM_INDEX JOW
			IF JOW > 0
				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 2 ftos(JOW,0)
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 2 HEIGHT .08 HORIZONTAL RIGHT
			END_IF

			EXCEL_GET_VALUE 10 ITEM_INDEX JOH
			IF JOH > 0
				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 3 ftos(JOH,0)
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 3 HEIGHT .08 HORIZONTAL RIGHT
			END_IF

			EXCEL_GET_VALUE 54 ITEM_INDEX SUB_TYPE
			IF SUB_TYPE <> ""
				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 4 SUB_TYPE
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 4 HEIGHT .08 HORIZONTAL CENTER
			END_IF

			EXCEL_GET_VALUE 7 ITEM_INDEX HAND
			IF HAND <> ""
				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 5 HAND
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 5 HEIGHT .08 HORIZONTAL CENTER
			END_IF

			EXCEL_GET_VALUE 8 ITEM_INDEX QTY
			IF QTY > 0
				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 6 itos(QTY)
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 6 HEIGHT .08 HORIZONTAL CENTER
			END_IF

			EXCEL_GET_VALUE 53 ITEM_INDEX DOOR_GRADE
			EXCEL_GET_VALUE 55 ITEM_INDEX DOOR_ITEM_DESC
			EXCEL_GET_VALUE 56 ITEM_INDEX DOOR_ELEVATION
			EXCEL_GET_VALUE 57 ITEM_INDEX DOOR_GAUGE
			EXCEL_GET_VALUE 58 ITEM_INDEX BODY_SIDE_FINISH
			EXCEL_GET_VALUE 59 ITEM_INDEX COVER_SIDE_FINISH
			EXCEL_GET_VALUE 60 ITEM_INDEX DOOR_CONSTRUCTION
			EXCEL_GET_VALUE 63 ITEM_INDEX TOP_EDGE
			EXCEL_GET_VALUE 64 ITEM_INDEX BOTTOM_EDGE
			EXCEL_GET_VALUE 65 ITEM_INDEX DOOR_THICKNESS
			EXCEL_GET_VALUE 71 ITEM_INDEX CORE

			IF DOOR_ITEM_DESC == "DOOR"
				IF BODY_SIDE_FINISH == COVER_SIDE_FINISH
					SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 7 itos(DOOR_GAUGE) +"GA  SS" + "  T" + DOOR_GRADE +"  #" + BODY_SIDE_FINISH
				ELSE
					SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 7 itos(DOOR_GAUGE) +"GA  SS" + "  T" + DOOR_GRADE +"  #" + BODY_SIDE_FINISH + "/#" + COVER_SIDE_FINISH
				END_IF
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 7 HEIGHT .08 HORIZONTAL CENTER

				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 8 ftos(DOOR_THICKNESS,2)
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 8 HEIGHT .08 HORIZONTAL CENTER

				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 9 DOOR_ELEVATION
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 9 HEIGHT .08 HORIZONTAL CENTER

				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 10 DOOR_CONSTRUCTION
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 10 HEIGHT .08 HORIZONTAL CENTER

				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 11 CORE
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 11 HEIGHT .08 HORIZONTAL CENTER

				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 12 TOP_EDGE
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 12 HEIGHT .08 HORIZONTAL CENTER

				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 13 BOTTOM_EDGE
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 13 HEIGHT .08 HORIZONTAL CENTER
			END_IF

			EXCEL_GET_VALUE 126 ITEM_INDEX FRAME_ITEM_DESC
			EXCEL_GET_VALUE 127 ITEM_INDEX FRAME_ELEVATION
			EXCEL_GET_VALUE 128 ITEM_INDEX FRAME_GAUGE
			EXCEL_GET_VALUE 129 ITEM_INDEX FRAME_GRADE
			EXCEL_GET_VALUE 130 ITEM_INDEX FRAME_FINISH
			EXCEL_GET_VALUE 131 ITEM_INDEX FRAME_CONSTRUCTION
			EXCEL_GET_VALUE 132 ITEM_INDEX JD
			EXCEL_GET_VALUE 133 ITEM_INDEX SECTION
			EXCEL_GET_VALUE 186 ITEM_INDEX ANCHOR_DESC
			EXCEL_GET_VALUE 138 ITEM_INDEX DUST_BOXES
			EXCEL_GET_VALUE 136 ITEM_INDEX FLOOR_CLIPS

			IF FRAME_ITEM_DESC == "FRAME"
				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 14 itos(FRAME_GAUGE) +"GA  SS" + "  T" + FRAME_GRADE +"  #" + FRAME_FINISH
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 14 HEIGHT .08 HORIZONTAL CENTER

				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 15 ftos(JD,2)
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 15 HEIGHT .08 HORIZONTAL CENTER

				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 16 ftos(SECTION,1)
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 16 HEIGHT .08 HORIZONTAL CENTER

				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 17 itos(FRAME_ELEVATION)
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 17 HEIGHT .08 HORIZONTAL CENTER

				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 18 FRAME_CONSTRUCTION
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 18 HEIGHT .08 HORIZONTAL CENTER

				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 19 ANCHOR_DESC
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 19 HEIGHT .08 HORIZONTAL CENTER

				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 20 DUST_BOXES
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 20 HEIGHT .08 HORIZONTAL CENTER

				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 21 FLOOR_CLIPS
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 21 HEIGHT .08 HORIZONTAL CENTER
			END_IF


			EXCEL_GET_VALUE 11 ITEM_INDEX FIRE_RATING
			IF FIRE_RATING > -1
				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 22 itos(FIRE_RATING)
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 22 HEIGHT .08 HORIZONTAL CENTER
			END_IF

			EXCEL_GET_VALUE 12 ITEM_INDEX HARDWARE_SCHEDULE_ID
			IF HARDWARE_SCHEDULE_ID <> ""
				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 23 HARDWARE_SCHEDULE_ID
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 23 HEIGHT .08 HORIZONTAL CENTER
			END_IF

			EXCEL_GET_VALUE 295 ITEM_INDEX SHEET
			IF SHEET > 0
				! SHEET = SHEET + 1
				SET_DRW_TABLE_TEXT refDrawing COVER SHEET_ITEM_INDEX+1 24 itos(SHEET)
				SET_DRW_TABLE_FORMAT refDrawing COVER SHEET_ITEM_INDEX+1 24 HEIGHT .08 HORIZONTAL CENTER
			END_IF

			ITEM_INDEX++
			SHEET_ITEM_INDEX++
		END_WHILE
		SHEET_INDEX++
	END_WHILE

	SHEET_INDEX = 1
	CREATE_DRW_TABLE refDrawing ASSEM SHEET_INDEX 13.96875 10.4375 "lib:Drwhistory.tbl" HIST

	HISTORY_INDEX = 2
	TEXT_INDEX = 0
	TEXT_LEN = strlen(HISTORY)
	WHILE TEXT_INDEX < TEXT_LEN
		VALUE1 = ""
		VALUE2 = ""
		VALUE3 = ""
		WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN
			VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
			TEXT_INDEX++
		END_WHILE
		TEXT_INDEX++
		WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN
			VALUE2 = VALUE2+strmid(HISTORY, TEXT_INDEX,1)
			TEXT_INDEX++
		END_WHILE
		TEXT_INDEX++
		WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN
			VALUE3 = VALUE3+strmid(HISTORY, TEXT_INDEX,1)
			TEXT_INDEX++
		END_WHILE
			TEXT_INDEX++
		INSERT_DRW_TABLE_ROW refDrawing HIST HISTORY_INDEX .465 ROW_ID
		SET_DRW_TABLE_TEXT refDrawing HIST HISTORY_INDEX + 1 1 VALUE1
		SET_DRW_TABLE_FORMAT refDrawing HIST HISTORY_INDEX + 1 1 HEIGHT .09 HORIZONTAL CENTER VERTICAL MIDDLE
		SET_DRW_TABLE_TEXT refDrawing HIST HISTORY_INDEX + 1 2 VALUE2
		SET_DRW_TABLE_FORMAT refDrawing HIST HISTORY_INDEX + 1 2 HEIGHT .09 HORIZONTAL CENTER VERTICAL MIDDLE
		SET_DRW_TABLE_TEXT refDrawing HIST HISTORY_INDEX + 1 3 VALUE3
		SET_DRW_TABLE_FORMAT refDrawing HIST HISTORY_INDEX + 1 3 HEIGHT .09 HORIZONTAL CENTER VERTICAL MIDDLE

		HISTORY_INDEX++
	END_WHILE

	IF OPERATION == 3
		TEXT_INDEX = 0
		TEXT_LEN = strlen(AS_BUILT)
		IF TEXT_LEN > 1
			VALUE1 = ""
			VALUE2 = ""
			VALUE3 = ""
			WHILE strmid(AS_BUILT, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN
				VALUE1 = VALUE1+strmid(AS_BUILT, TEXT_INDEX,1)
				TEXT_INDEX++
			END_WHILE
			TEXT_INDEX++
			WHILE strmid(AS_BUILT, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN
				VALUE2 = VALUE2+strmid(AS_BUILT, TEXT_INDEX,1)
				TEXT_INDEX++
			END_WHILE
			TEXT_INDEX++
			WHILE strmid(AS_BUILT, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN
				VALUE3 = VALUE3+strmid(AS_BUILT, TEXT_INDEX,1)
				TEXT_INDEX++
			END_WHILE
			INSERT_DRW_TABLE_ROW refDrawing HIST HISTORY_INDEX .465 ROW_ID
			SET_DRW_TABLE_TEXT refDrawing HIST HISTORY_INDEX + 1 1 VALUE1
			SET_DRW_TABLE_FORMAT refDrawing HIST HISTORY_INDEX + 1 1 HEIGHT .09 HORIZONTAL CENTER VERTICAL MIDDLE
			SET_DRW_TABLE_TEXT refDrawing HIST HISTORY_INDEX + 1 2 VALUE2
			SET_DRW_TABLE_FORMAT refDrawing HIST HISTORY_INDEX + 1 2 HEIGHT .09 HORIZONTAL CENTER VERTICAL MIDDLE
			SET_DRW_TABLE_TEXT refDrawing HIST HISTORY_INDEX + 1 3 VALUE3
			SET_DRW_TABLE_FORMAT refDrawing HIST HISTORY_INDEX + 1 3 HEIGHT .09 HORIZONTAL CENTER VERTICAL MIDDLE
		END_IF
	END_IF

	SHEET = 1
	CREATE_DRW_NOTE refDrawing 15.25 .6875 "SHEET   " + itos(SHEET) + "   OF   " + itos(TOTAL_SHEETS)

	REGEN_MDL refDrawing
	SAVE_MDL refDrawing
	SLEEP 2

	DECLARE_STRUCT PDF_OPTION option
	option.title = "sample drawing"
	option.author = "DRAFTER"
	option.subject = "detail"
	option.keywords = "SmartAssembly example"
	option.launch_viewer = "FALSE"
	option.color_depth = "Gray"
	EXPORT_DRW_PDF refDrawing option "00"+itos(SHEET)+"_"+SO_NUM+"_SCHEDULE"

	WINDOW_CLOSE
	ERASE_NOT_DISPLAYED
	EXCEL_SAVE_DOCUMENT EXCEL_DOCUMENT_NAME
END_IF

END_ASM_DESCR
