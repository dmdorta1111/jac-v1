BEGIN_GUI_DESCR

	SHOW_PARAM	STRING		ITEM_NUM
	SHOW_PARAM	STRING		SUB_TYPE
	SHOW_PARAM	INTEGER		OPENING_TYPE
	SHOW_PARAM	STRING		DOOR_ITEM_DESC
	SHOW_PARAM	STRING		FRAME_ITEM_DESC
	SHOW_PARAM	STRING		LOCK_SHEET_NAME
	SHOW_PARAM	INTEGER		LOCK_ROW
	SHOW_PARAM	STRING		LOCK_DESC
	SHOW_PARAM	STRING		LOCK_TRIM_SHEET_NAME
	SHOW_PARAM	INTEGER		LOCK_TRIM_ROW
	SHOW_PARAM	STRING		LOCK_TRIM_DESC
	
	IF FRAME_PROCESSED <> "PROCESSED"
		USER_INPUT_PARAM DOUBLE STRIKE_CENTER
	END_IF
	
	RADIOBUTTON_PARAM INTEGER LOCK_TYPE 	"NONE"\				!0
											"CYLINDER"\ 			!1
											"MORTISE"\			!2
											"RIM EXIT"\ 			!3
											"MORTISED EXIT"\ 		!4
											"CYLINDER DEADBOLT"\	!5
											"MORTISE DEADBOLT"\	!6
											"ROLLER LATCH"		!7

	RADIOBUTTON_PARAM INTEGER	LOCK_ELECTRIFIED	"NONE" "BOX" "TAIL"

	IF SUB_TYPE == "P" AND (LOCK_TYPE == 3 OR LOCK_TYPE == 4)
		CHECKBOX_PARAM INTEGER EXIT_MULLION "YES/NO"
		CHECKBOX_PARAM INTEGER UNEQUAL_EXITS "YES/NO"
		CHECKBOX_PARAM INTEGER FIRE_BOLT "YES/NO"
		IF EXIT_MULLION == 1
			USER_INPUT_PARAM DOUBLE MULLION_ADD_PER_DOOR
		END_IF
	END_IF
		
	CHECKBOX_PARAM INTEGER SPECIAL_BOX_DEPTH "YES/NO"
	CHECKBOX_PARAM INTEGER SELECT_LOCK "YES/NO"
	CHECKBOX_PARAM INTEGER SELECT_TRIM "YES/NO"
	! CHECKBOX_PARAM INTEGER LOCK_ELECTRIFIED "YES/NO"
	CHECKBOX_PARAM INTEGER VERIFY_STRIKE "YES/NO"
	CHECKBOX_PARAM INTEGER VERIFY_LOCK "YES/NO"
	
	IF SPECIAL_BOX_DEPTH == 1
		USER_INPUT_PARAM DOUBLE MORTISE_BOX_DEPTH
	END_IF
	
	IF LOCK_TYPE == 3
		RADIOBUTTON_PARAM INTEGER BACKSET_REFERENCE "STOP" "DOOR EDGE" "DOOR BEVEL CL"
	END_IF
	
END_GUI_DESCR

BEGIN_ASM_DESCR

DECLARE_ARRAY 			LOCK_INFO
DECLARE_ARRAY			LOCKCELLS
DECLARE_ARRAY			SELCELLS
DECLARE_ARRAY			TRIM_INFO
DECLARE_ARRAY			TRIMCELLS

DECLARE_REFERENCE 	LOCREF

DECLARE_VARIABLE	INTEGER		OPERATION
DECLARE_VARIABLE	INTEGER		LOCK_INDEX
DECLARE_VARIABLE	STRING		ITEM_NUM
DECLARE_VARIABLE	STRING		SUB_TYPE
DECLARE_VARIABLE	INTEGER		OPENING_TYPE
DECLARE_VARIABLE	STRING		DOOR_ITEM_DESC
DECLARE_VARIABLE	STRING		FRAME_ITEM_DESC
DECLARE_VARIABLE	DOUBLE		BEVEL
DECLARE_VARIABLE	DOUBLE		STOPP
DECLARE_VARIABLE	DOUBLE		STRIKE_GAP
DECLARE_VARIABLE	STRING		STRIKE_EDGE_SHAPE
DECLARE_VARIABLE	DOUBLE		DOOR_THICKNESS
DECLARE_VARIABLE	DOUBLE		STRIKE_CENTER
DECLARE_VARIABLE	STRING		FRAME_PROCESSED

DECLARE_VARIABLE	INTEGER		LOCK_TYPE
DECLARE_VARIABLE	STRING 		LOCK_SHEET_NAME
DECLARE_VARIABLE	INTEGER		LOCK_ROW
DECLARE_VARIABLE	STRING		LOCK_DESC
DECLARE_VARIABLE	STRING 		LOCK_TRIM_SHEET_NAME
DECLARE_VARIABLE	INTEGER		LOCK_TRIM_ROW
DECLARE_VARIABLE	STRING 		LOCK_TRIM_DESC
DECLARE_VARIABLE	DOUBLE		LOCK_OFFSET
DECLARE_VARIABLE 	INTEGER		VERIFY_LOCK
DECLARE_VARIABLE	INTEGER		VERIFY_STRIKE
DECLARE_VARIABLE	INTEGER		UNEQUAL_EXITS
DECLARE_VARIABLE	DOUBLE		ALT_STRIKE_CENTER
DECLARE_VARIABLE	INTEGER		ALT_STRIKE_CENTER_

DECLARE_VARIABLE	STRING		LOCK_SHEET_NAME_X2
DECLARE_VARIABLE	INTEGER		LOCK_ROW_X2
DECLARE_VARIABLE	STRING		LOCK_DESC_X2
DECLARE_VARIABLE	DOUBLE		LOCK_OFFSET_X2

DECLARE_VARIABLE	STRING		LOCK_TRIM_SHEET_NAME_X2
DECLARE_VARIABLE	INTEGER		LOCK_TRIM_ROW_X2
DECLARE_VARIABLE	STRING 		LOCK_TRIM_DESC_X2

DECLARE_VARIABLE 	INTEGER 	BACKSET_REFERENCE
DECLARE_VARIABLE	DOUBLE		BEVEL_CALC
DECLARE_VARIABLE 	INTEGER 	COLDIA
DECLARE_VARIABLE 	INTEGER 	COLSHAPE
DECLARE_VARIABLE 	INTEGER 	COLSIDE
DECLARE_VARIABLE 	INTEGER 	COLX
DECLARE_VARIABLE 	INTEGER 	COLY
DECLARE_VARIABLE 	INTEGER 	COLW
DECLARE_VARIABLE 	INTEGER 	COLH
DECLARE_VARIABLE 	DOUBLE 	DIA
DECLARE_VARIABLE	INTEGER		EXIT_MULLION
DECLARE_VARIABLE 	INTEGER 	HINDEX
DECLARE_VARIABLE 	INTEGER 	HTP
DECLARE_VARIABLE 	DOUBLE 	IS
DECLARE_VARIABLE	DOUBLE		LOCK_ARMOR_HEIGHT
DECLARE_VARIABLE	DOUBLE		LOCK_ARMOR_THICKNESS
DECLARE_VARIABLE	DOUBLE		LOCK_ARMOR_WIDTH
DECLARE_VARIABLE	DOUBLE		LOCK_BACKSET
DECLARE_VARIABLE	STRING		LOCK_REINFORCEMENT
DECLARE_VARIABLE	DOUBLE		LOCK_TRIM_BACKSET
DECLARE_VARIABLE	STRING 		LOCK_TRIM_MANUFACTURER
DECLARE_VARIABLE	DOUBLE		LOCK_TRIM_OFFSET
DECLARE_VARIABLE	INTEGER		LOCK_ELECTRIFIED
DECLARE_VARIABLE	STRING		LOCK_TRIM_REINFORCEMENT 
DECLARE_VARIABLE 	DOUBLE		LOCX
DECLARE_VARIABLE 	DOUBLE 	LOCY
DECLARE_VARIABLE 	DOUBLE		MORTISE_BOX_DEPTH
DECLARE_VARIABLE	DOUBLE		MULLION_ADD_PER_DOOR
DECLARE_VARIABLE 	DOUBLE 	OS
DECLARE_VARIABLE 	STRING 		SHAPE
DECLARE_VARIABLE 	INTEGER 	SIDE
DECLARE_VARIABLE 	INTEGER		SPECIAL_BOX_DEPTH
DECLARE_VARIABLE	STRING		SHAPE_UDF
DECLARE_VARIABLE	STRING		SHAPE_UDF_INST
DECLARE_VARIABLE 	INTEGER 	CHECK_LOCK
DECLARE_VARIABLE 	INTEGER 	TEMP_CHECK_LOCK
DECLARE_VARIABLE 	INTEGER 	CHECK_TRIM
DECLARE_VARIABLE 	INTEGER 	CHECK_LOCK_X2
DECLARE_VARIABLE 	INTEGER 	CHECK_TRIM_X2
DECLARE_VARIABLE 	INTEGER 	STRLENGTH
DECLARE_VARIABLE 	INTEGER 	FIRE_BOLT

IF ALT_STRIKE_CENTER_ == 1
	STRIKE_CENTER = ALT_STRIKE_CENTER
END_IF

IF OPERATION == 0
	! CONFIG_ELEM

	IF SELECT_LOCK == 1
		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "LOCKS_AND_EXITS"
		PRINT "SELECT ONE CELL IN THE ROW YOU WANT"
		WAIT
		EXCEL_GET_ACTIVE_SHEET EXCEL_INDEX
		EXCEL_GET_SHEET_NAME EXCEL_INDEX LOCK_SHEET_NAME
		
		CLEAR_ARRAY LOCKCELLS
		EXCEL_GET_SELECTION LOCKCELLS
		FOR CELL REF ARRAY LOCKCELLS
			GET_ARRAY_ELEM CELL 0 LOCK_ROW
			BREAK
		END_FOR
		EXCEL_GET_VALUE LOCK_ROW 1 CHECK_LOCK
		EXCEL_GET_VALUE LOCK_ROW 5 LOCK_DESC
		EXCEL_GET_VALUE LOCK_ROW 8 LOCK_OFFSET

		PRINT "LOCK SHEET NAME  %" LOCK_SHEET_NAME
		PRINT "LOCK ROW  %" LOCK_ROW			
		PRINT "LOCK DESC  %" LOCK_DESC
		
		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "OPENING"
	END_IF

	IF SELECT_TRIM == 1
		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "LOCKS_AND_EXITS"
		PRINT "SELECT ONE CELL IN THE ROW YOU WANT"
		WAIT
		EXCEL_GET_ACTIVE_SHEET EXCEL_INDEX
		EXCEL_GET_SHEET_NAME EXCEL_INDEX LOCK_TRIM_SHEET_NAME
		
		CLEAR_ARRAY TRIMCELLS
		EXCEL_GET_SELECTION TRIMCELLS
		FOR CELL REF ARRAY TRIMCELLS
			GET_ARRAY_ELEM CELL 0 LOCK_TRIM_ROW
			BREAK
		END_FOR
		EXCEL_GET_VALUE LOCK_TRIM_ROW 1 CHECK_TRIM
		EXCEL_GET_VALUE LOCK_TRIM_ROW 5 LOCK_TRIM_DESC

		PRINT "LOCK TRIM SHEET NAME  %" LOCK_TRIM_SHEET_NAME
		PRINT "LOCK TRIM ROW  %" LOCK_TRIM_ROW			
		PRINT "LOCK TRIM DESC  %" LOCK_TRIM_DESC

		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "OPENING"
	END_IF

	IF SUB_TYPE == "P" AND (LOCK_TYPE == 3 OR LOCK_TYPE == 4) AND UNEQUAL_EXITS == 1
		IF SELECT_LOCK == 1
			EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "LOCKS_AND_EXITS"
			PRINT "SELECT ONE CELL IN THE ROW YOU WANT"
			WAIT
			EXCEL_GET_ACTIVE_SHEET EXCEL_INDEX
			EXCEL_GET_SHEET_NAME EXCEL_INDEX LOCK_SHEET_NAME_X2
			
			CLEAR_ARRAY LOCKCELLS
			EXCEL_GET_SELECTION LOCKCELLS
			FOR CELL REF ARRAY LOCKCELLS
				GET_ARRAY_ELEM CELL 0 LOCK_ROW_X2
				BREAK
			END_FOR
			EXCEL_GET_VALUE LOCK_ROW_X2 1 CHECK_LOCK_X2
			EXCEL_GET_VALUE LOCK_ROW_X2 5 LOCK_DESC_X2
			EXCEL_GET_VALUE LOCK_ROW_X2 8 LOCK_OFFSET_X2

			PRINT "LOCK SHEET NAME_X2  %" LOCK_SHEET_NAME_X2
			PRINT "LOCK ROW_X2  %" LOCK_ROW_X2			
			PRINT "LOCK DESC_X2  %" LOCK_DESC_X2
			
			EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "OPENING"
		END_IF

		IF SELECT_TRIM == 1
			EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "LOCKS_AND_EXITS"
			PRINT "SELECT ONE CELL IN THE ROW YOU WANT"
			WAIT
			EXCEL_GET_ACTIVE_SHEET EXCEL_INDEX
			EXCEL_GET_SHEET_NAME EXCEL_INDEX LOCK_TRIM_SHEET_NAME_X2
			
			CLEAR_ARRAY TRIMCELLS
			EXCEL_GET_SELECTION TRIMCELLS
			FOR CELL REF ARRAY TRIMCELLS
				GET_ARRAY_ELEM CELL 0 LOCK_TRIM_ROW_X2
				BREAK
			END_FOR
			EXCEL_GET_VALUE LOCK_TRIM_ROW_X2 1 CHECK_TRIM_X2
			EXCEL_GET_VALUE LOCK_TRIM_ROW_X2 5 LOCK_TRIM_DESC_X2

			PRINT "LOCK TRIM SHEET NAME_X2  %" LOCK_TRIM_SHEET_NAME_X2
			PRINT "LOCK TRIM ROW_X2  %" LOCK_TRIM_ROW_X2			
			PRINT "LOCK TRIM DESC_X2  %" LOCK_TRIM_DESC_X2
			
			EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "OPENING"
		END_IF
	END_IF
	
	IF LOCK_ROW == 0
		LOCK_SHEET_NAME = ""
		LOCK_ROW = ""
		LOCK_DESC = ""
	END_IF
	
	IF LOCK_TRIM_ROW == 0
		LOCK_TRIM_SHEET_NAME = ""
		LOCK_TRIM_ROW = ""
		LOCK_TRIM_DESC = ""
	END_IF

	IF LOCK_ROW_X2 == 0
		LOCK_SHEET_NAME_X2 = ""
		LOCK_ROW_X2 = ""
		LOCK_DESC_X2 = ""
	END_IF
	
	IF LOCK_TRIM_ROW_X2 == 0
		LOCK_TRIM_SHEET_NAME_X2 = ""
		LOCK_TRIM_ROW_X2 = ""
		LOCK_TRIM_DESC_X2 = ""
	END_IF
	
	IF CHECK_LOCK == 1 OR CHECK_TRIM == 1 OR CHECK_LOCK_X2 == 1 OR CHECK_TRIM_X2 == 1
		CHECK_LOCK = 1
	ELSE
		CHECK_LOCK = 0
	END_IF
END_IF				

IF OPERATION == 1
	IF LOCK_INDEX == 1
		LOCK_TYPE = PRIMARY_LOCK_TYPE
		LOCK_SHEET_NAME = PRIMARY_LOCK_SHEET_NAME
		LOCK_ROW = PRIMARY_LOCK_ROW
		LOCK_TRIM_SHEET_NAME	= PRIMARY_LOCK_TRIM_SHEET_NAME
		LOCK_TRIM_ROW = PRIMARY_LOCK_TRIM_ROW
		LOCK_ELECTRIFIED = PRIMARY_LOCK_ELECTRIFIED
	ELSE_IF LOCK_INDEX == 2
		LOCK_TYPE = SECONDARY_LOCK_TYPE
		LOCK_SHEET_NAME = SECONDARY_LOCK_SHEET_NAME
		LOCK_ROW = SECONDARY_LOCK_ROW
		LOCK_TRIM_SHEET_NAME	= SECONDARY_LOCK_TRIM_SHEET_NAME
		LOCK_TRIM_ROW = SECONDARY_LOCK_TRIM_ROW
	 END_IF

	IF DOOR_INDEX == 2 AND (PRIMARY_LOCK_TYPE == 3 OR PRIMARY_LOCK_TYPE == 4) AND UNEQUAL_EXITS == 1
		LOCK_TYPE = PRIMARY_LOCK_TYPE
		LOCK_SHEET_NAME = LOCK_SHEET_NAME_X2
		LOCK_ROW = LOCK_ROW_X2
		LOCK_TRIM_SHEET_NAME	= LOCK_TRIM_SHEET_NAME_X2
		LOCK_TRIM_ROW = LOCK_TRIM_ROW_X2
		! LOCK_ELECTRIFIED = PRIMARY_LOCK_ELECTRIFIED
	END_IF
	 
	IF	HAND_ == "LHR" OR HAND_ == "LHRA1" OR HAND_ == "LHR1"
		SEARCH_MDL_REF DOOR_ASM CSYS "ACS4" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
		IF DOOR_CONSTRUCTION == "SEAMLESS"
			SEARCH_MDL_REF BODY SURFACE "SURFACE_S2" BODY_ARMOR
			SEARCH_MDL_REF COVER SURFACE "SURFACE_S2" COVER_ARMOR
			BODY_ROTATION = 180
			COVER_ROTATION = 0
		END_IF
		IF STRIKE_EDGE_SHAPE == "BEVEL"
			ARMOR_BEVEL = -4
		ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
			ARMOR_BEVEL = 0
		END_IF
	END_IF

	IF	HAND_ == "RH" OR HAND_ == "RHA2"
		SEARCH_MDL_REF DOOR_ASM CSYS "ACS4" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
		IF DOOR_CONSTRUCTION == "SEAMLESS"
			SEARCH_MDL_REF BODY SURFACE "SURFACE_S2" BODY_ARMOR
			SEARCH_MDL_REF COVER SURFACE "SURFACE_S2" COVER_ARMOR
			BODY_ROTATION = 180
			COVER_ROTATION = 0
		END_IF
		IF STRIKE_EDGE_SHAPE == "BEVEL"
			ARMOR_BEVEL = -4
		ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
			ARMOR_BEVEL = 0
		END_IF
	END_IF

	IF	HAND_ == "RHR" OR HAND_ == "RHRA2" OR HAND_ == "RHR2"
		SEARCH_MDL_REF DOOR_ASM CSYS "ACS3" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
		IF DOOR_CONSTRUCTION == "SEAMLESS"
			SEARCH_MDL_REF BODY SURFACE "SURFACE_S1" BODY_ARMOR
			SEARCH_MDL_REF COVER SURFACE "SURFACE_S1" COVER_ARMOR
			BODY_ROTATION = 0
			COVER_ROTATION = 180
		END_IF
		IF STRIKE_EDGE_SHAPE == "BEVEL"
			ARMOR_BEVEL = 4
		ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
			ARMOR_BEVEL = 0
		END_IF
	END_IF

	IF	HAND_ == "LH" OR HAND_ == "LHA1"
		SEARCH_MDL_REF DOOR_ASM CSYS "ACS3" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
		IF DOOR_CONSTRUCTION == "SEAMLESS"
			SEARCH_MDL_REF BODY SURFACE "SURFACE_S1" BODY_ARMOR
			SEARCH_MDL_REF COVER SURFACE "SURFACE_S1" COVER_ARMOR
			BODY_ROTATION = 0
			COVER_ROTATION = 180
		END_IF
		IF STRIKE_EDGE_SHAPE == "BEVEL"
			ARMOR_BEVEL = 4
		ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
			ARMOR_BEVEL =  0
		END_IF
	END_IF

! LOCK	
	IF LOCK_ROW <> 0 AND LOCK_ROW <> ""
	
		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME LOCK_SHEET_NAME
		CLEAR_ARRAY SELCELLS
		EXCEL_GET_VALUES CELL_BY_INDEX LOCK_ROW 0 CELL_BY_INDEX LOCK_ROW 152 SELCELLS
		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "OPENING"
	
		CLEAR_ARRAY LOCK_INFO
		FOR CELL REF ARRAY SELCELLS
			! GET_ARRAY_ELEM CELL 0 row
			! GET_ARRAY_ELEM CELL 1 col
			GET_ARRAY_ELEM CELL 2 content
			
			IF content == ""
				BREAK
			ELSE
				ADD_ARRAY_ELEM LOCK_INFO content
				PRINT "CONTENT - %  " content
			END_IF
		END_FOR
	
		GET_ARRAY_ELEM LOCK_INFO 2 LOCK_TYPE_DESC
		GET_ARRAY_ELEM LOCK_INFO 7 LOCK_REINFORCEMENT
		GET_ARRAY_ELEM LOCK_INFO 8 LOCK_OFFSET
		GET_ARRAY_ELEM LOCK_INFO 9 LOCK_BACKSET
		GET_ARRAY_ELEM LOCK_INFO 10 LOCK_ARMOR_HEIGHT
		GET_ARRAY_ELEM LOCK_INFO 11 LOCK_ARMOR_WIDTH
		GET_ARRAY_ELEM LOCK_INFO 12 LOCK_ARMOR_THICKNESS

		IF LOCK_TYPE == 3 AND SUB_TYPE == "S" AND STRIKE_EDGE_SHAPE == "BEVEL" AND LOCK_TYPE_DESC <> "*MORTISE*"
			IF BACKSET_REFERENCE == 0
				IF STOPP < .625
					PRINT " PLEASE CONFIRM FRAME STOP DIMENSION"
					USER_INPUT_PARAM DOUBLE STOPP
				END_IF
				
				PRINT "%" BEVEL
				PRINT "%" DOOR_THICKNESS
				BEVEL_CALC = BEVEL*PI/180*(DOOR_THICKNESS/2)
				PRINT "%" LOCK_BACKSET
				PRINT "%" STOPP
				PRINT "%" STRIKE_GAP
				PRINT "%" BEVEL_CALC
				LOCK_BACKSET = LOCK_BACKSET + STOPP - STRIKE_GAP - BEVEL_CALC
			ELSE_IF BACKSET_REFERENCE == 1
				PRINT "%" BEVEL
				PRINT "%" DOOR_THICKNESS
				BEVEL_CALC = BEVEL*PI/180*(DOOR_THICKNESS/2)
				PRINT "%" LOCK_BACKSET
				PRINT "%" STOPP
				PRINT "%" STRIKE_GAP
				PRINT "%" BEVEL_CALC
				LOCK_BACKSET = LOCK_BACKSET - BEVEL_CALC
			ELSE_IF BACKSET_REFERENCE == 2
				LOCK_BACKSET = LOCK_BACKSET
			END_IF
		END_IF
	
		CREATE_UDF udf\lock_dtms DOOR_ASM
			UDF_REF ATTACH1 ATTACH
			UDF_REF ATTACH2 ATTACH1
			UDF_DIM STRIKE_CTR STRIKE_CENTER
			UDF_DIM OFFSET -LOCK_OFFSET
			UDF_DIM BACKSET LOCK_BACKSET
			UDF_EXP_REF ATTACH2 CSYS 2
			UDF_EXP_REF ODCTR PLANE 3
			UDF_EXP_REF TOPP PLANE 4
		END_CREATE_UDF

		GET_ARRAY_SIZE LOCK_INFO SIZE
		HTP = (SIZE-13)/7
		HINDEX = 1
		COLX = 13
		COLY = 14
		COLSHAPE = 15
		COLDIA = 16
		COLW = 17
		COLH = 18
		COLSIDE = 19

		WHILE HINDEX <= HTP	
			GET_ARRAY_ELEM LOCK_INFO COLX LOCX
			GET_ARRAY_ELEM LOCK_INFO COLY LOCY
			GET_ARRAY_ELEM LOCK_INFO COLSHAPE SHAPE
			GET_ARRAY_ELEM LOCK_INFO COLDIA DIA
			GET_ARRAY_ELEM LOCK_INFO COLW WIDTH
			GET_ARRAY_ELEM LOCK_INFO COLH HEIGHT
			GET_ARRAY_ELEM LOCK_INFO COLSIDE SIDE
			
			CREATE_UDF udf\xycsys DOOR_ASM
				UDF_REF ATTACH ATTACH2
				UDF_DIM	DIMX LOCX
				UDF_DIM	DIMY LOCY
				UDF_EXP_REF LOCREF CSYS 0
			END_CREATE_UDF
			
			IF SIDE == 0
				OS = 1
				IS = .1
			END_IF
			IF SIDE == 1
				OS = .1
				IS = 1
			END_IF
			IF SIDE == 2
				OS = 1
				IS = 1
			END_IF

			IF SHAPE == 1
				SHAPE_UDF = "udf\circle"
			ELSE_IF SHAPE == 2
				SHAPE_UDF = "udf\square"
			ELSE 
				GET_PARAM_TYPE SHAPE SHAPE_TYPE
				IF SHAPE_TYPE == "INTEGER"
					SHAPE_UDF = "udf\\" + itos(SHAPE)
				ELSE_IF SHAPE_TYPE == "STRING"
					SHAPE_UDF = "udf\\" + SHAPE
				ELSE_IF SHAPE_TYPE == "DOUBLE"
					SHAPE_UDF = "udf\\" + ftos(SHAPE,0)
				END_IF
				IF strfind(SHAPE_UDF, "^") > 0
					STRLENGTH = strlen(SHAPE_UDF)
					SHAPE_UDF_INST = strright(SHAPE_UDF, STRLENGTH-(strfind(SHAPE_UDF, "^")+1))
					SHAPE_UDF = strleft(SHAPE_UDF,(strfind(SHAPE_UDF, "^")))
				END_IF
			END_IF
			
			IF WELDED_PREPS == 1
				DIA = DIA+.0625
			END_IF

			IF SHAPE == 1
				CREATE_UDF &SHAPE_UDF DOOR_ASM
					UDF_REF ODCTR ODCTR
					UDF_REF TOPP TOPP
					UDF_REF LOCREF LOCREF
					UDF_DIM DIA DIA
					UDF_DIM IS IS
					UDF_DIM OS OS
					UDF_INTERSECTION * PART_LEVEL		
				END_CREATE_UDF
			END_IF

			IF SHAPE == 2
				CREATE_UDF &SHAPE_UDF DOOR_ASM
					UDF_REF ODCTR ODCTR
					UDF_REF TOPP TOPP
					UDF_REF LOCREF LOCREF
					UDF_DIM IS IS
					UDF_DIM OS OS
					UDF_DIM HEIGHT HEIGHT
					UDF_DIM WIDTH WIDTH
					UDF_INTERSECTION * PART_LEVEL		
				END_CREATE_UDF
			END_IF
			
			IF SHAPE <> 0 AND SHAPE <> 1 AND SHAPE <> 2 AND SHAPE_UDF_INST == ""
				CREATE_UDF &SHAPE_UDF DOOR_ASM
					UDF_REF ODCTR ODCTR
					UDF_REF TOPP TOPP
					UDF_REF LOCREF LOCREF
					UDF_DIM IS IS
					UDF_DIM OS OS
					UDF_INTERSECTION * PART_LEVEL		
				END_CREATE_UDF
			END_IF

			IF SHAPE <> 0 AND SHAPE <> 1 AND SHAPE <> 2 AND SHAPE_UDF_INST <> ""
				CREATE_UDF &SHAPE_UDF DOOR_ASM
					UDF_INSTANCE SHAPE_UDF_INST
					UDF_REF ODCTR ODCTR
					UDF_REF TOPP TOPP
					UDF_REF LOCREF LOCREF
					UDF_DIM IS IS
					UDF_DIM OS OS
					UDF_INTERSECTION * PART_LEVEL		
				END_CREATE_UDF
			END_IF
			
			HINDEX++
			COLX = COLX + 7
			COLY = COLY + 7
			COLSHAPE = COLSHAPE + 7
			COLDIA = COLDIA + 7
			COLW = COLW + 7
			COLH = COLH + 7
			COLSIDE = COLSIDE + 7
		END_WHILE
	END_IF

! LOCK TRIM
	IF LOCK_TRIM_ROW <> 0 AND LOCK_TRIM_ROW <> ""
		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME LOCK_TRIM_SHEET_NAME
		CLEAR_ARRAY SELCELLS
		EXCEL_GET_VALUES CELL_BY_INDEX LOCK_TRIM_ROW 0 CELL_BY_INDEX LOCK_TRIM_ROW 152 SELCELLS
		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "OPENING"
	
		CLEAR_ARRAY TRIM_INFO
		FOR CELL REF ARRAY SELCELLS
			! GET_ARRAY_ELEM CELL 0 row
			! GET_ARRAY_ELEM CELL 1 col
			GET_ARRAY_ELEM CELL 2 content
			
			IF content == ""
				BREAK
			ELSE
				ADD_ARRAY_ELEM TRIM_INFO content
				PRINT "CONTENT - %  " content
			END_IF
		END_FOR

		GET_ARRAY_ELEM TRIM_INFO 1 CHECK_LOCK
		GET_ARRAY_ELEM TRIM_INFO 7 LOCK_TRIM_REINFORCEMENT
		
		LOCK_TRIM_OFFSET = LOCK_OFFSET
		LOCK_TRIM_BACKSET = LOCK_BACKSET
		
		! IF LOCK_BACKSET == ""
			! GET_ARRAY_ELEM TRIM_INFO 8 LOCK_TRIM_BACKSET
			! IF LOCK_TYPE == 3 AND SUB_TYPE == "S" AND STRIKE_EDGE_SHAPE == "BEVEL" AND LOCK_TYPE_DESC <> "*MORTISE*"
				! IF BACKSET_REFERENCE == 0
					! IF STOPP < .625
						! PRINT " PLEASE CONFIRM FRAME STOP DIMENSION"
						! USER_INPUT_PARAM DOUBLE STOPP
					! END_IF
					
					! PRINT "%" BEVEL
					! PRINT "%" DOOR_THICKNESS
					! BEVEL_CALC = BEVEL*PI/180*(DOOR_THICKNESS/2)
					! PRINT "%" LOCK_TRIM_BACKSET
					! PRINT "%" STOPP
					! PRINT "%" STRIKE_GAP
					! PRINT "%" BEVEL_CALC
					
					! LOCK_TRIM_BACKSET = LOCK_TRIM_BACKSET + STOPP - STRIKE_GAP - BEVEL_CALC
				! ELSE_IF BACKSET_REFERENCE == 1
					! PRINT "%" BEVEL
					! PRINT "%" DOOR_THICKNESS
					! BEVEL_CALC = BEVEL*PI/180*(DOOR_THICKNESS/2)
					! PRINT "%" LOCK_TRIM_BACKSET
					! PRINT "%" STOPP
					! PRINT "%" STRIKE_GAP
					! PRINT "%" BEVEL_CALC
					
					! LOCK_TRIM_BACKSET = LOCK_TRIM_BACKSET - BEVEL_CALC
				! ELSE_IF BACKSET_REFERENCE == 2
					! LOCK_TRIM_BACKSET = LOCK_TRIM_BACKSET
				! END_IF
			! END_IF
		! ELSE 
			! LOCK_TRIM_BACKSET = LOCK_BACKSET
		! END_IF
				
		CREATE_UDF udf\lock_dtms DOOR_ASM
			UDF_REF ATTACH1 ATTACH
			UDF_REF ATTACH2 ATTACH1
			UDF_DIM STRIKE_CTR STRIKE_CENTER
			UDF_DIM OFFSET - LOCK_TRIM_OFFSET
			UDF_DIM BACKSET LOCK_TRIM_BACKSET
			UDF_EXP_REF ATTACH2 CSYS 2
			UDF_EXP_REF ODCTR PLANE 3
			UDF_EXP_REF TOPP PLANE 4
		END_CREATE_UDF

		GET_ARRAY_SIZE TRIM_INFO SIZE
		HTP = (SIZE-13)/7
		HINDEX = 1
		COLX = 13
		COLY = 14
		COLSHAPE = 15
		COLDIA = 16
		COLW = 17
		COLH = 18
		COLSIDE = 19

		WHILE HINDEX <= HTP	
			GET_ARRAY_ELEM TRIM_INFO COLX LOCX
			GET_ARRAY_ELEM TRIM_INFO COLY LOCY
			GET_ARRAY_ELEM TRIM_INFO COLSHAPE SHAPE
			GET_ARRAY_ELEM TRIM_INFO COLDIA DIA
			GET_ARRAY_ELEM TRIM_INFO COLW WIDTH
			GET_ARRAY_ELEM TRIM_INFO COLH HEIGHT
			GET_ARRAY_ELEM TRIM_INFO COLSIDE SIDE
			
			CREATE_UDF udf\xycsys DOOR_ASM
				UDF_REF ATTACH ATTACH2
				UDF_DIM	DIMX LOCX
				UDF_DIM	DIMY LOCY
				UDF_EXP_REF LOCREF CSYS 0
			END_CREATE_UDF
			
			IF SIDE == 0
				OS = 1
				IS = .1
			END_IF
			IF SIDE == 1
				OS = .1
				IS = 1
			END_IF
			IF SIDE == 2
				OS = 1
				IS = 1
			END_IF

			IF SHAPE == 1
				SHAPE_UDF = "udf\circle"
			ELSE_IF SHAPE == 2
				SHAPE_UDF = "udf\square"
			ELSE 
				GET_PARAM_TYPE SHAPE SHAPE_TYPE
				IF SHAPE_TYPE == "INTEGER"
					SHAPE_UDF = "udf\\" + itos(SHAPE)
				ELSE_IF SHAPE_TYPE == "STRING"
					SHAPE_UDF = "udf\\" + SHAPE
				ELSE_IF SHAPE_TYPE == "DOUBLE"
					SHAPE_UDF = "udf\\" + ftos(SHAPE,0)
				END_IF
				IF strfind(SHAPE_UDF, "^") > 0
					STRLENGTH = strlen(SHAPE_UDF)
					SHAPE_UDF_INST = strright(SHAPE_UDF, STRLENGTH-(strfind(SHAPE_UDF, "^")+1))
					SHAPE_UDF = strleft(SHAPE_UDF,(strfind(SHAPE_UDF, "^")))
				END_IF
			END_IF
			
			IF WELDED_PREPS == 1
				DIA = DIA+.0625
			END_IF
			
			IF SHAPE == 1
				CREATE_UDF &SHAPE_UDF DOOR_ASM
					UDF_REF ODCTR ODCTR
					UDF_REF TOPP TOPP
					UDF_REF LOCREF LOCREF
					UDF_DIM DIA DIA
					UDF_DIM IS IS
					UDF_DIM OS OS
					UDF_INTERSECTION * PART_LEVEL		
				END_CREATE_UDF
			END_IF

			IF SHAPE == 2
				CREATE_UDF &SHAPE_UDF DOOR_ASM
					UDF_REF ODCTR ODCTR
					UDF_REF TOPP TOPP
					UDF_REF LOCREF LOCREF
					UDF_DIM IS IS
					UDF_DIM OS OS
					UDF_DIM HEIGHT HEIGHT
					UDF_DIM WIDTH WIDTH
					UDF_INTERSECTION * PART_LEVEL		
				END_CREATE_UDF
			END_IF
			
			IF SHAPE <> 0 AND SHAPE <> 1 AND SHAPE <> 2 AND SHAPE_UDF_INST == ""
				CREATE_UDF &SHAPE_UDF DOOR_ASM
					UDF_REF ODCTR ODCTR
					UDF_REF TOPP TOPP
					UDF_REF LOCREF LOCREF
					UDF_DIM IS IS
					UDF_DIM OS OS
					UDF_INTERSECTION * PART_LEVEL		
				END_CREATE_UDF
			END_IF

			IF SHAPE <> 0 AND SHAPE <> 1 AND SHAPE <> 2 AND SHAPE_UDF_INST <> ""
				CREATE_UDF &SHAPE_UDF DOOR_ASM
					UDF_INSTANCE SHAPE_UDF_INST
					UDF_REF ODCTR ODCTR
					UDF_REF TOPP TOPP
					UDF_REF LOCREF LOCREF
					UDF_DIM IS IS
					UDF_DIM OS OS
					UDF_INTERSECTION * PART_LEVEL		
				END_CREATE_UDF
			END_IF
			
			HINDEX++
			COLX = COLX + 7
			COLY = COLY + 7
			COLSHAPE = COLSHAPE + 7
			COLDIA = COLDIA + 7
			COLW = COLW + 7
			COLH = COLH + 7
			COLSIDE = COLSIDE + 7
		END_WHILE		
	END_IF

! AMOR PLATE	
	IF LOCK_ARMOR_HEIGHT > 0 AND LOCK_ARMOR_WIDTH > 0
		IF WELDED_PREPS == 1
			LOCK_ARMOR_HEIGHT = LOCK_ARMOR_HEIGHT + .18
			LOCK_ARMOR_WIDTH = LOCK_ARMOR_WIDTH +.18
		ELSE
			LOCK_ARMOR_HEIGHT = LOCK_ARMOR_HEIGHT +.015
			LOCK_ARMOR_WIDTH = LOCK_ARMOR_WIDTH +.015
		END_IF

		IF DOOR_CONSTRUCTION == "SEAMLESS" 
			IF DOOR_GAUGE == 18 AND LOCK_ARMOR_WIDTH <= 1.265
				ARMOR_INST = "NO_TAB"
			ELSE_IF DOOR_GAUGE == 18 AND LOCK_ARMOR_WIDTH > 1.265
				ARMOR_INST = "WITH_TAB"
			ELSE_IF DOOR_GAUGE == 16 AND LOCK_ARMOR_WIDTH <= 1.265
				ARMOR_INST = "NO_TAB"
			ELSE_IF DOOR_GAUGE == 16 AND LOCK_ARMOR_WIDTH > 1.265
				ARMOR_INST = "WITH_TAB"
			ELSE_IF DOOR_GAUGE == 14 AND LOCK_ARMOR_WIDTH <= 1.140
				ARMOR_INST = "NO_TAB"
			ELSE_IF DOOR_GAUGE == 14 AND LOCK_ARMOR_WIDTH > 1.140
				ARMOR_INST = "WITH_TAB"
			ELSE_IF DOOR_GAUGE == 12
				ARMOR_INST = "WITH_TAB"
			END_IF
		END_IF

		IF LOCK_ARMOR_WIDTH > DOOR_THICKNESS - 75 AND DOOR_CONSTRUCTION == "LOCKSEAM"
			IF HAND == "LHR" OR HAND == "LHRA"
				ARMOR_INST = "ARMOR_L2"
			ELSE_IF HAND == "RHR" OR HAND == "RHRA"
				ARMOR_INST = "ARMOR_L1"
			ELSE_IF HAND == "LH" OR HAND == "LHA"
				ARMOR_INST = "ARMOR_L1"
			ELSE_IF HAND == "RH" OR HAND == "RHA"
				ARMOR_INST = "ARMOR_L2"
			END_IF
		END_IF

		IF DOOR_CONSTRUCTION == "LOCKSEAM"
			CREATE_UDF udf\armor_plate DOOR_ASM
				UDF_INSTANCE ARMOR_INST
				UDF_REF ATTACH ATTACH
				UDF_DIM STRIKE_CTR STRIKE_CENTER
				UDF_DIM OFFSET -LOCK_OFFSET
				UDF_DIM ARMOR_BEVEL ARMOR_BEVEL
				UDF_DIM ARMOR_WIDTH LOCK_ARMOR_WIDTH
				UDF_DIM ARMOR_HEIGHT LOCK_ARMOR_HEIGHT
				UDF_EXP_REF ATTACH2 CSYS 1
				UDF_INTERSECTION * PART_LEVEL
			END_CREATE_UDF
		END_IF
			
		IF DOOR_CONSTRUCTION == "SEAMLESS"
			CREATE_UDF udf\face_plate BODY
				UDF_INSTANCE ARMOR_INST
				UDF_REF ATTACH ATTACH
				UDF_REF ARMOR_SURFACE BODY_ARMOR		
				UDF_DIM STRIKE_CTR STRIKE_CENTER
				UDF_DIM OFFSET -LOCK_OFFSET
				UDF_DIM ROTATION BODY_ROTATION
				UDF_DIM BEVEL ARMOR_BEVEL
				UDF_DIM ARMOR_WIDTH LOCK_ARMOR_WIDTH
				UDF_DIM ARMOR_HEIGHT LOCK_ARMOR_HEIGHT
				UDF_EXP_REF ATTACH2 CSYS 1
				UDF_INTERSECTION * PART_LEVEL
			END_CREATE_UDF

			CREATE_UDF udf\face_plate COVER
				UDF_INSTANCE ARMOR_INST
				UDF_REF ATTACH ATTACH
				UDF_REF ARMOR_SURFACE COVER_ARMOR		
				UDF_DIM STRIKE_CTR STRIKE_CENTER
				UDF_DIM OFFSET -LOCK_OFFSET
				UDF_DIM ROTATION COVER_ROTATION
				UDF_DIM BEVEL ARMOR_BEVEL
				UDF_DIM ARMOR_WIDTH LOCK_ARMOR_WIDTH
				UDF_DIM ARMOR_HEIGHT LOCK_ARMOR_HEIGHT
				UDF_EXP_REF ATTACH2 CSYS 1
				UDF_INTERSECTION * PART_LEVEL
			END_CREATE_UDF
		END_IF
	END_IF

! REINFORCEMENT	
	IF	HAND_ == "RHR" OR HAND_ == "LH" OR \
		HAND_ == "RHR2" OR HAND_ == "RHRA2" OR \
		HAND_ == "LH1" OR HAND_ == "LHA1"
			CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ATTACH2
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX 0
				UDF_DIM	LOCY 0
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ATTACH2 CSYS 0
			END_CREATE_UDF
	END_IF

	IF	HAND_ == "LHR" OR HAND_ == "RH" OR \
		HAND_ == "LHR1" OR HAND_ == "LHRA1" OR \
		HAND_ == "RH2" OR HAND_ == "RHA2"

			CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ATTACH2
				UDF_DIM	ROTX 180
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX 0
				UDF_DIM	LOCY 0
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ATTACH2 CSYS 0
			END_CREATE_UDF
	END_IF

	PRINT "%" LOCK_REINFORCEMENT
	PRINT "%" LOCK_TRIM_REINFORCEMENT
	
	IF LOCK_TRIM_ROW <> 0 AND LOCK_TRIM_ROW <> ""		
		IF LOCK_TRIM_REINFORCEMENT <> "NO_VALUE"
			LOCK_REINFORCEMENT = LOCK_TRIM_REINFORCEMENT
		END_IF
	END_IF
	
	! IF LOCK_TYPE <> 3 AND LOCK_TYPE <> 4
		PRINT "%" LOCK_REINFORCEMENT	
		RETRIEVE_MDL &LOCK_REINFORCEMENT COMP
		
		SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
		
		ASSEMBLE COMP DOOR_ASM
			 CSYS ATTACH2 PLACEMENT
		END_ASSEMBLE

		IF LOCK_ELECTRIFIED == 1
			SET_REF_NAME ATTACH2 "ELEC2D"
		END_IF	
		
		IF SPECIAL_BOX_DEPTH == 1
			SET_MDL_PARAM COMP "STOCKTYPE" 1
			SET_MDL_PARAM COMP "EMJACNUM" "999"
			SET_MDL_PARAM COMP "BOX_DEPTH" MORTISE_BOX_DEPTH
			
			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX	
		END_IF
	! END_IF

	IF LOCK_TYPE == 3 OR LOCK_TYPE == 4
		CREATE_UDF udf\lock_dtms DOOR_ASM
			UDF_REF ATTACH1 ATTACH
			UDF_REF ATTACH2 ATTACH1
			UDF_DIM STRIKE_CTR STRIKE_CENTER
			UDF_DIM OFFSET -LOCK_OFFSET
			UDF_DIM BACKSET DOOR_WIDTH - 3
			UDF_EXP_REF ATTACH2 CSYS 2
			UDF_EXP_REF ODCTR PLANE 3
			UDF_EXP_REF TOPP PLANE 4
		END_CREATE_UDF
	
		CREATE_UDF udf\csys DOOR_ASM
			UDF_REF ATTACH ATTACH2
			UDF_DIM	ROTX 0
			UDF_DIM	ROTY 0
			UDF_DIM	ROTZ 90
			UDF_DIM	LOCX 0
			UDF_DIM	LOCY 0
			UDF_DIM	LOCZ 0
			UDF_EXP_REF ATTACH2 CSYS 0
		END_CREATE_UDF
		
		RETRIEVE_MDL EXIT_REINFORCEMENT_TAIL.ASM COMP
		
		SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT

		ASSEMBLE COMP DOOR_ASM
			 CSYS ATTACH2 PLACEMENT
		END_ASSEMBLE
		
		IF LOCK_ELECTRIFIED == 2
			SET_REF_NAME ATTACH2 "ELEC2D"
		END_IF
	END_IF
	
	IF FIRE_BOLT == 1
		SEARCH_MDL_REF ASSEM CSYS "DOOR_CTR_CSYS" ATTACH
		IF DOOR_INDEX == 1
			CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ATTACH
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 4
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX 0
				UDF_DIM	LOCY UNDERCUT + 6
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ATTACH CSYS 0				
			END_CREATE_UDF
			SET_REF_NAME ATTACH "FIRE_BOLT_REF"
			
			CREATE_UDF udf\fire_bolt DOOR_ASM
				UDF_REF ATTACH ATTACH
				UDF_DIM	DIA .875
				UDF_INTERSECTION * PART_LEVEL
			END_CREATE_UDF
		END_IF
		IF DOOR_INDEX == 2
			CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ATTACH
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 176
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX 0
				UDF_DIM	LOCY UNDERCUT + 6
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ATTACH CSYS 0
			END_CREATE_UDF
			
			CREATE_UDF udf\fire_bolt DOOR_ASM
				UDF_REF ATTACH ATTACH
				UDF_DIM	DIA 1.0
				UDF_INTERSECTION * PART_LEVEL
			END_CREATE_UDF
		END_IF
	END_IF
END_IF

END_ASM_DESCR
