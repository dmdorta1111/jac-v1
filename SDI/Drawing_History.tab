BEGIN_GUI_DESCR

	GLOBAL_PICTURE drwhistory.gif

	SHOW_PARAM STRING CUSTOMER_NAME
	SHOW_PARAM STRING JOB_NAME
	SHOW_PARAM STRING SO_NUM

	IF REV1_NUM <> "1"
		USER_INPUT_PARAM	STRING		REV0_NUM
		USER_INPUT_PARAM	STRING		REV0_DATE
		USER_INPUT_PARAM	STRING		REV0_BY
	END_IF

	RADIOBUTTON_PARAM INTEGER ADD_REVISION "NO" "YES"
	IF REV0 <> "" AND REV1_NUM == "" AND ADD_REV <> 1 AND ADD_REVISION == 1
		REV1_NUM = "1"
		REV1_DATE = date
		ADD_REVISION = 0
		USER_INPUT_PARAM	STRING		REV1_NUM
		USER_INPUT_PARAM	STRING		REV1_DATE
		REV1_BY = DRAWN_BY
		USER_INPUT_PARAM	STRING		REV1_BY
	ELSE_IF REV1 <> "" AND REV2_NUM == "" AND ADD_REV <> 1 AND ADD_REVISION == 1
		REV2_NUM = "2"
		REV2_DATE = date
		ADD_REVISION = 0
		USER_INPUT_PARAM	STRING		REV2_NUM
		USER_INPUT_PARAM	STRING		REV2_DATE
		REV2_BY = DRAWN_BY
		USER_INPUT_PARAM	STRING		REV2_BY
	ELSE_IF REV2 <> "" AND REV3_NUM == "" AND ADD_REV <> 1 AND ADD_REVISION == 1
		REV3_NUM = "3"
		REV3_DATE = date
		ADD_REVISION = 0
		USER_INPUT_PARAM	STRING		REV3_NUM
		USER_INPUT_PARAM	STRING		REV3_DATE
		REV3_BY = DRAWN_BY
		USER_INPUT_PARAM	STRING		REV3_BY
	ELSE_IF REV3 <> "" AND REV4_NUM == "" AND ADD_REV <> 1 AND ADD_REVISION == 1
		REV4_NUM = "4"
		REV4_DATE = date
		ADD_REVISION = 0
		USER_INPUT_PARAM	STRING		REV4_NUM
		USER_INPUT_PARAM	STRING		REV4_DATE
		REV4_BY = DRAWN_BY
		USER_INPUT_PARAM	STRING		REV4_BY
	END_IF

END_GUI_DESCR


BEGIN_ASM_DESCR

DECLARE_VARIABLE INTEGER 	COLUMNS 0
DECLARE_VARIABLE INTEGER	COVER_SHEETS
DECLARE_VARIABLE STRING	CUSTOMER_NAME
DECLARE_VARIABLE STRING	DRAWN_BY "SA"
DECLARE_VARIABLE BOOL 		EOF FALSE
DECLARE_VARIABLE INTEGER 	EXCEL_COLUMN
DECLARE_VARIABLE STRING	EXCEL_DOCUMENT_NAME
DECLARE_VARIABLE INTEGER 	EXISTING_DIRECTORY
DECLARE_VARIABLE INTEGER 	EXISTING_EXCEL
DECLARE_VARIABLE INTEGER 	ITEM_CELL
DECLARE_VARIABLE INTEGER	ITEM_INDEX 1
DECLARE_VARIABLE STRING	ITEM_NUM
DECLARE_VARIABLE INTEGER	ITEM_SHEET
DECLARE_VARIABLE INTEGER	ITEMS_PER_SHEET 50
DECLARE_VARIABLE INTEGER	ITP
DECLARE_VARIABLE STRING	JOB_NAME
DECLARE_VARIABLE STRING 	PARAMETERS
DECLARE_VARIABLE STRING 	PROJECT_DIRECTORY
DECLARE_VARIABLE INTEGER 	ROW
DECLARE_VARIABLE INTEGER 	ROWS 0
DECLARE_VARIABLE INTEGER 	SIZE
DECLARE_VARIABLE STRING	SO_NUM
DECLARE_VARIABLE INTEGER 	TEST_ITEM_CELL
DECLARE_VARIABLE STRING	TEST_EOF
DECLARE_VARIABLE STRING	REV_NUM ""
DECLARE_VARIABLE STRING	REV0_NUM ""
DECLARE_VARIABLE STRING	REV0_DATE ""
DECLARE_VARIABLE STRING	REV0_BY ""
DECLARE_VARIABLE STRING	REV1_NUM ""
DECLARE_VARIABLE STRING	REV1_DATE ""
DECLARE_VARIABLE STRING	REV1_BY
DECLARE_VARIABLE STRING	REV2_NUM ""
DECLARE_VARIABLE STRING	REV2_DATE ""
DECLARE_VARIABLE STRING	REV2_BY
DECLARE_VARIABLE STRING	REV3_NUM ""
DECLARE_VARIABLE STRING	REV3_DATE ""
DECLARE_VARIABLE STRING	REV3_BY
DECLARE_VARIABLE STRING	REV4_NUM ""
DECLARE_VARIABLE STRING	REV4_DATE ""
DECLARE_VARIABLE STRING	REV4_BY
DECLARE_VARIABLE STRING	REV5_NUM ""
DECLARE_VARIABLE STRING	REV5_DATE ""
DECLARE_VARIABLE STRING	REV5_BY
DECLARE_VARIABLE STRING	HISTORY
DECLARE_VARIABLE STRING	AS_BUILT
DECLARE_VARIABLE INTEGER	AS_BUILT_
DECLARE_VARIABLE INTEGER	TEXT_LEN
DECLARE_VARIABLE INTEGER	TEXT_LEN_A
DECLARE_VARIABLE INTEGER	TEXT_LEN_B
DECLARE_VARIABLE INTEGER	TEXT_INDEX
DECLARE_VARIABLE INTEGER	HISTORY_INDEX
DECLARE_VARIABLE INTEGER	OPERATION
DECLARE_VARIABLE STRING	VALUE1 ""
DECLARE_VARIABLE STRING	VALUE2 ""
DECLARE_VARIABLE STRING	VALUE3 ""
DECLARE_VARIABLE INTEGER	ADD_REV
	ADD_REV = 0
	
TEXT_INDEX = 0
TEXT_LEN_A = strlen(HISTORY)
!REV0
IF TEXT_LEN_A == 0
	REV0_NUM = "0"
	GET_TIME_STRING "%x" date
	REV0_DATE = date
	REV0_BY = DRAWN_BY
ELSE
	IF TEXT_INDEX < TEXT_LEN_A
	VALUE1 = ""
	! TEXT_INDEX++
	WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
		VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
		TEXT_INDEX++
	END_WHILE
	REV0_NUM = VALUE1
		IF TEXT_INDEX < TEXT_LEN_A
			VALUE1 = ""
			TEXT_INDEX++
			WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
				VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
				TEXT_INDEX++
			END_WHILE
			REV0_DATE = VALUE1
			IF TEXT_INDEX < TEXT_LEN_A
				VALUE1 = ""
				TEXT_INDEX++
				WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
					VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
					TEXT_INDEX++
				END_WHILE
				REV0_BY = VALUE1
				IF TEXT_INDEX < TEXT_LEN_A
					VALUE1 = ""
					TEXT_INDEX++
					WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
						VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
						TEXT_INDEX++
					END_WHILE
					REV1_NUM = VALUE1
					IF TEXT_INDEX < TEXT_LEN_A
						VALUE1 = ""
						TEXT_INDEX++
						WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
							VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
							TEXT_INDEX++
						END_WHILE
						REV1_DATE = VALUE1
						IF TEXT_INDEX < TEXT_LEN_A
							VALUE1 = ""
							TEXT_INDEX++
							WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
								VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
								TEXT_INDEX++
							END_WHILE
							REV1_BY = VALUE1
							IF TEXT_INDEX < TEXT_LEN_A
								VALUE1 = ""
								TEXT_INDEX++
								WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
									VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
									TEXT_INDEX++
								END_WHILE
								REV2_NUM = VALUE1
								IF TEXT_INDEX < TEXT_LEN_A
									VALUE1 = ""
									TEXT_INDEX++
									WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
										VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
										TEXT_INDEX++
									END_WHILE
									REV2_DATE = VALUE1
									IF TEXT_INDEX < TEXT_LEN_A
										VALUE1 = ""
										TEXT_INDEX++
										WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
											VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
											TEXT_INDEX++
										END_WHILE
										REV2_BY = VALUE1
										IF TEXT_INDEX < TEXT_LEN_A
											VALUE1 = ""
											TEXT_INDEX++
											WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
												VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
												TEXT_INDEX++
											END_WHILE
											REV3_NUM = VALUE1
											IF TEXT_INDEX < TEXT_LEN_A
												VALUE1 = ""
												TEXT_INDEX++
												WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
													VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
													TEXT_INDEX++
												END_WHILE
												REV3_DATE = VALUE1
												IF TEXT_INDEX < TEXT_LEN_A
													VALUE1 = ""
													TEXT_INDEX++
													WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
														VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
														TEXT_INDEX++
													END_WHILE
													REV3_BY = VALUE1
													IF TEXT_INDEX < TEXT_LEN_A
														VALUE1 = ""
														TEXT_INDEX++
														WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
															VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
															TEXT_INDEX++
														END_WHILE
														REV4_NUM = VALUE1
														IF TEXT_INDEX < TEXT_LEN_A
															VALUE1 = ""
															TEXT_INDEX++
															WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
																VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
																TEXT_INDEX++
															END_WHILE
															REV4_DATE = VALUE1
															IF TEXT_INDEX < TEXT_LEN_A
																VALUE1 = ""
																TEXT_INDEX++
																WHILE strmid(HISTORY, TEXT_INDEX,1) <> "^" AND TEXT_INDEX <= TEXT_LEN_A
																	VALUE1 = VALUE1+strmid(HISTORY, TEXT_INDEX,1)
																	TEXT_INDEX++
																END_WHILE
																REV4_BY = VALUE1
															END_IF
														END_IF
													END_IF
												END_IF
											END_IF
										END_IF
									END_IF
								END_IF
							END_IF
						END_IF
					END_IF
				END_IF
			END_IF
		END_IF
	END_IF
END_IF

GET_TIME_STRING "%x" date

! CONFIG_ELEM

IF REV0_NUM <> ""
	HISTORY = REV0_NUM+"^"+REV0_DATE+"^"+REV0_BY
	REV_NUM = REV0_NUM
END_IF
IF REV1_NUM <> ""
	HISTORY = HISTORY +"^"+REV1_NUM+"^"+REV1_DATE+"^"+REV1_BY
	REV_NUM = REV1_NUM
END_IF
IF REV2_NUM <> ""
	HISTORY = HISTORY +"^"+REV2_NUM+"^"+REV2_DATE+"^"+REV2_BY
	REV_NUM = REV2_NUM
END_IF
IF REV3_NUM <> ""
	HISTORY = HISTORY +"^"+REV3_NUM+"^"+REV3_DATE+"^"+REV3_BY
	REV_NUM = REV3_NUM
END_IF
IF REV4_NUM <> ""
	HISTORY = HISTORY +"^"+REV4_NUM+"^"+REV4_DATE+"^"+REV4_BY
	REV_NUM = REV4_NUM
END_IF

EXCEL_SET_VALUE 298 EXCEL_COLUMN HISTORY

! IF OPERATION == 3
	! AS_BUILT = "AS BUILT"+"^"+date+"^"+AS_BUILT_BY
	! EXCEL_SET_VALUE 277	1 AS_BUILT	
! END_IF

END_ASM_DESCR
