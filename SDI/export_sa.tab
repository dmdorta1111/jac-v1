
BEGIN_ASM_DESCR
ENABLE_DATA_CAPTURE_MODE FALSE
GET_CONFIG_OPTION "override_store_back" OSB
SET_CONFIG_OPTION "override_store_back" "no"
!USED TO CONTROL PROCESS
DECLARE_VARIABLE	BOOL 	EOF FALSE
DECLARE_VARIABLE	DOUBLE	LENGTH
DECLARE_VARIABLE	DOUBLE	THICKNESS
DECLARE_VARIABLE	DOUBLE	WIDTH
DECLARE_VARIABLE	DOUBLE	X
DECLARE_VARIABLE	DOUBLE	Y
DECLARE_VARIABLE	DOUBLE	Z
DECLARE_VARIABLE	INTEGER	EXCEL_ROW 0
DECLARE_VARIABLE	INTEGER	FINISH
DECLARE_VARIABLE	INTEGER	GRADE
DECLARE_VARIABLE	INTEGER	STOCKTYPE
DECLARE_VARIABLE	STRING	COMPONENT_NAME
DECLARE_VARIABLE	STRING	CUSTOMER_NAME
DECLARE_VARIABLE	STRING	EXCEL_COMPONENT_NAME ""
DECLARE_VARIABLE	STRING	JOB_NAME
DECLARE_VARIABLE	STRING	STATE
DECLARE_VARIABLE	STRING	SUB_JOB_NAME
DECLARE_VARIABLE	STRING	TYPE
DECLARE_VARIABLE	STRING	SHAPE
DECLARE_VARIABLE	STRING	WO_NUM ""
DECLARE_VARIABLE	STRING	SWIDTH
DECLARE_VARIABLE	STRING	SLENGTH
DECLARE_VARIABLE	STRING	SINDEX
DECLARE_VARIABLE	STRING	COMPONENT_NAME
DECLARE_VARIABLE	STRING	MDLTYPE
DECLARE_VARIABLE	STRING	COMMENTS
DECLARE_VARIABLE	STRING	EMJACDESC
DECLARE_VARIABLE	STRING	EMJACNUM
DECLARE_VARIABLE	STRING	ITEM_DESC
DECLARE_VARIABLE 	STRING 	FEATURE_ID
DECLARE_VARIABLE	INTEGER ITEM_INDEX
DECLARE_VARIABLE	INTEGER BEND_LINES
DECLARE_VARIABLE STRING VIEW ""

DECLARE_REFERENCE FIXED_SURF
DECLARE_REFERENCE PDF1
DECLARE_REFERENCE PDF2
DECLARE_REFERENCE PDF3

DECLARE_ARRAY CSYS_ARRAY
DECLARE_ARRAY SURFACE_ARRAY
DECLARE_ARRAY SURFACES
DECLARE_ARRAY PDF1
DECLARE_ARRAY PDF2
DECLARE_ARRAY PDF3


! BOM_DOCUMENT_NAME = "BOM_"+WO_NUM
EXCEL_ACTIVATE_DOCUMENT BOM_DOCUMENT_NAME
EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "LISTING"

EXCEL_ROW = 6
EXCEL_GET_VALUE EXCEL_ROW 1 EXCEL_COMPONENT_NAME

IF EXCEL_COMPONENT_NAME == ""
	EOF = "TRUE"
ELSE
	EOF = "FALSE"
END_IF

WHILE EOF == "FALSE"
	EXCEL_GET_VALUE EXCEL_ROW 2 STOCKTYPE
	EXCEL_GET_VALUE EXCEL_ROW 16 MDLTYPE

	IF STOCKTYPE == 1 AND MDLTYPE == ""
		EXCEL_GET_VALUE EXCEL_ROW 0 INDEX
		EXCEL_GET_VALUE EXCEL_ROW 1 EXCEL_COMPONENT_NAME
		COMPONENT_NAME = EXCEL_COMPONENT_NAME+".prt"
		RETRIEVE_MDL COMPONENT_NAME DXF_COMP
		SEARCH_MDL_PARAM DXF_COMP "SHAPE" SHAPE
		SEARCH_MDL_PARAM DXF_COMP "TYPE" TYPE
		GET_MDL_SUBTYPE DXF_COMP SUBTYPE
		
		IF SHAPE == "*SHEET*" AND SUBTYPE == "PART_SHEETMETAL"	
			CLEAR_ARRAY CSYS_ARRAY
			SEARCH_MDL_REFS DXF_COMP CSYS "*" CSYS_ARRAY
			CLEAR_ARRAY SURFACE_ARRAY
			SEARCH_MDL_REFS DXF_COMP SURFACE "*" SURFACE_ARRAY
			
			DECLARE_VARIABLE INTEGER CSYS_QTY
			CSYS_QTY = 0
			FOR CSYS_REF REF ARRAY CSYS_ARRAY
				GET_REF_NAME CSYS_REF CSYS_NAME
				IF CSYS_NAME == "DIM*"
					CSYS_QTY = CSYS_QTY + 1
				END_IF
			END_FOR

			IF CSYS_QTY < 1
				PRINT "THERE IS NO DIM CSYS FOR THIS PART"
				STOP
			END_IF

			SEARCH_MDL_REF DXF_COMP CSYS "DIM*" REFCSYS
			SEARCH_MDL_PARAM DXF_COMP "SMT_THICKNESS" THICKNESS
			SEARCH_MDL_PARAM DXF_COMP "TYPE" TYPE
			SEARCH_MDL_PARAM DXF_COMP "GRADE" GRADE
			SEARCH_MDL_PARAM DXF_COMP "FINISH" FINISH
			SEARCH_MDL_PARAM DXF_COMP "GRAIN" GRAIN
			SEARCH_MDL_PARAM DXF_COMP "PVC" PVC
			SEARCH_MDL_PARAM DXF_COMP "DEBUR" DEBUR
			SEARCH_MDL_PARAM DXF_COMP "COMMENTS" COMMENTS
			SEARCH_MDL_PARAM DXF_COMP "EMJACNUM" EMJACNUM
			SEARCH_MDL_PARAM DXF_COMP "EMJACDESC" EMJACDESC
			GET_MDL_NAME DXF_COMP DXF_COMP_NAME
			IF EMJACDESC == "" OR EMJACDESC == "X*" OR EMJACDESC == "EMJACDESC"
				EMJACDESC = DXF_COMP_NAME
			END_IF
			SET_MDL_PARAM DXF_COMP "EMJACDESC" EMJACDESC

			CALC_OUTLINE REFCSYS DXF_COMP outline

			IF outline.x1 < outline.x2
				X = outline.x2 - outline.x1
			ELSE
				X = outline.x1 - outline.x2
			END_IF
				IF X < 0
					X = X*-1
				END_IF
			IF outline.y1 < outline.y2
				Y = outline.y2 - outline.y1
			ELSE
				Y = outline.y1 - outline.y2
			END_IF
				IF Y < 0
					Y = Y*-1
				END_IF
			IF outline.z1 < outline.z2
				Z = outline.z2 - outline.z1
			ELSE
				Z = outline.z1 - outline.z2
			END_IF
				IF Z < 0
					Z = Z*-1
				END_IF

			IF X > THICKNESS*1.25 AND Y > THICKNESS*1.25 AND Z > THICKNESS*1.25
				STATE = "FORMED"
			ELSE
				STATE = "FLAT"
			END_IF

			IF STATE == "FORMED"
				EXCEL_SET_VALUE EXCEL_ROW 16 "FORMED"

				DECLARE_VARIABLE INTEGER SURFACE_QTY
				SURFACE_QTY = 0
				FOR SURFACE_REF REF ARRAY SURFACE_ARRAY
					GET_REF_NAME SURFACE_REF SURFACE_NAME
					IF SURFACE_NAME == "FIXED*"
						SURFACE_QTY = SURFACE_QTY + 1
					END_IF
					IF SURFACE_QTY == 1
						BREAK
					END_IF
				END_FOR

				IF SURFACE_QTY < 1
					IF REF_INSTANCE DXF_COMP
						GET_REF_GENERIC DXF_COMP GENERIC
						SWITCH_TO_MDL GENERIC
						REPAINT
						USER_SELECT SURFACE FIXED
						SET_REF_NAME FIXED "FIXED"
						SAVE_MDL GENERIC
						SWITCH_TO_MDL DXF_COMP
					ELSE
						SWITCH_TO_MDL DXF_COMP
						REPAINT
						USER_SELECT SURFACE FIXED
						SET_REF_NAME FIXED "FIXED"
						SAVE_MDL DXF_COMP
					END_IF
				END_IF

				PRINT "%" DXF_COMP
				SEARCH_MDL_REF DXF_COMP SURFACE "FIXED*" FIRST_SURF
				CREATE_UDF lib:udf\unbend DXF_COMP FLAT_UDF
					UDF_REF surface FIRST_SURF
					UDF_EXP_REF FLAT FEATURE 0
				END_CREATE_UDF
				GET_REF_ID FLAT_UDF REF_ID
				FEATURE_ID = "FID:" + itos(REF_ID)
				
			END_IF
			
			IF STATE == "FLAT"
				SEARCH_MDL_PARAM DXF_COMP "COMMENTS" COMMENTS
				PRINT "%" COMMENTS
				DECLARE_VARIABLE INTEGER FIND_FLAT
				FIND_FLAT = strfind(COMMENTS,"FLAT")
				IF FIND_FLAT < 0
					SET_MDL_PARAM DXF_COMP "COMMENTS" " FLAT - "+COMMENTS
				END_IF
				EXCEL_SET_VALUE EXCEL_ROW 17 "FLAT"
			END_IF
			
			SEARCH_MDL_PARAM DXF_COMP "COMMENTS" COMMENTS
			EXCEL_SET_VALUE EXCEL_ROW 17 COMMENTS
			
			SEARCH_MDL_REF DXF_COMP CSYS "DIM*" REFCSYS
			CALC_OUTLINE_PARAM REFCSYS X_SIZE X
			CALC_OUTLINE_PARAM REFCSYS Y_SIZE Y
			CALC_OUTLINE_PARAM REFCSYS Z_SIZE Z

			LENGTH = X
			WIDTH = Y

			SWIDTH = ftos(WIDTH,3)
			IF strlen(SWIDTH ) == 5
				SWIDTH = "00"+SWIDTH
			ELSE_IF strlen(SWIDTH ) == 6
				SWIDTH = "0"+SWIDTH
			END_IF

			SLENGTH = ftos(LENGTH,3)
			IF strlen(SLENGTH ) == 5
				SLENGTH = "00"+SLENGTH
			ELSE_IF strlen(SLENGTH) == 6
				SLENGTH = "0"+SLENGTH
			END_IF

			IF strlen(FINISH) == 1
				FINISH = "00"+FINISH
			ELSE_IF strlen(FINISH) == 2
				FINISH = "0"+FINISH
			END_IF

			EXCEL_SET_VALUE EXCEL_ROW 4 ftos(THICKNESS,3)
			EXCEL_SET_VALUE EXCEL_ROW 5 TYPE				
			EXCEL_SET_VALUE EXCEL_ROW 6 SHAPE
			EXCEL_SET_VALUE EXCEL_ROW 7 GRADE
			EXCEL_SET_VALUE EXCEL_ROW 8 FINISH
			! EXCEL_SET_VALUE EXCEL_ROW 9 "0"
			! EXCEL_SET_VALUE EXCEL_ROW 10 "0"
			EXCEL_SET_VALUE EXCEL_ROW 11 SWIDTH
			EXCEL_SET_VALUE EXCEL_ROW 12 SLENGTH
			EXCEL_SET_VALUE EXCEL_ROW 13 itos(GRAIN)
			EXCEL_SET_VALUE EXCEL_ROW 14 itos(PVC)
			EXCEL_SET_VALUE EXCEL_ROW 15 itos(DEBUR)
			EXCEL_SET_VALUE EXCEL_ROW 18 EMJACNUM
			EXCEL_SET_VALUE EXCEL_ROW 19 EMJACDESC
			
			IF STATE == "FORMED"
				IF REF_INSTANCE DXF_COMP
					REMOVE_FEATURE FLAT_UDF	
					GET_REF_GENERIC DXF_COMP GENERIC
					SWITCH_TO_MDL GENERIC	
					SEARCH_MDL_REF ALLOW_SUPPRESSED GENERIC FEATURE FEATURE_ID FEAT_REF
					REMOVE_FEATURE FEAT_REF
					SWITCH_TO_MDL DXF_COMP
				ELSE
					REMOVE_FEATURE FLAT_UDF	
				END_IF
			END_IF
			

		END_IF			
		
		IF SHAPE <> "*SHEET*"
		
			SEARCH_MDL_PARAM DXF_COMP "THICKNESS" THICKNESS
			SEARCH_MDL_PARAM DXF_COMP "TYPE" TYPE
			SEARCH_MDL_PARAM DXF_COMP "GRADE" GRADE
			SEARCH_MDL_PARAM DXF_COMP "FINISH" FINISH
			SEARCH_MDL_PARAM DXF_COMP "SIZE1" SIZE1
			SEARCH_MDL_PARAM DXF_COMP "SIZE2" SIZE2
			SEARCH_MDL_PARAM DXF_COMP "CUT1" CUT1
			SEARCH_MDL_PARAM DXF_COMP "CUT2" CUT2
			SEARCH_MDL_PARAM DXF_COMP "COMMENTS" COMMENTS
			SEARCH_MDL_PARAM DXF_COMP "EMJACNUM" EMJACNUM
			SEARCH_MDL_PARAM DXF_COMP "EMJACDESC" EMJACDESC
			
			SWIDTH = ftos(CUT2,3)
			IF strlen(SWIDTH ) == 5
				SWIDTH = "00"+SWIDTH
			ELSE_IF strlen(SWIDTH ) == 6
				SWIDTH = "0"+SWIDTH
			END_IF
			
			IF SWIDTH == "000.000"
				SWIDTH = "000.001"
			END_IF
			
			SLENGTH = ftos(CUT1,3)
			IF strlen(SLENGTH ) == 5
				SLENGTH = "00"+SLENGTH
			ELSE_IF strlen(SLENGTH) == 6
				SLENGTH = "0"+SLENGTH
			END_IF

			IF strlen(FINISH) == 1
				FINISH = "00"+FINISH
			ELSE_IF strlen(FINISH) == 2
				FINISH = "0"+FINISH
			END_IF
			
			EXCEL_SET_VALUE EXCEL_ROW 4 ftos(THICKNESS,3)
			EXCEL_SET_VALUE EXCEL_ROW 5 TYPE
			EXCEL_SET_VALUE EXCEL_ROW 6 SHAPE
			EXCEL_SET_VALUE EXCEL_ROW 7 GRADE
			EXCEL_SET_VALUE EXCEL_ROW 8 FINISH
			EXCEL_SET_VALUE EXCEL_ROW 9 SIZE1
			EXCEL_SET_VALUE EXCEL_ROW 10 SIZE2
			EXCEL_SET_VALUE EXCEL_ROW 11 SWIDTH
			EXCEL_SET_VALUE EXCEL_ROW 12 SLENGTH
			EXCEL_SET_VALUE EXCEL_ROW 13 "0"
			EXCEL_SET_VALUE EXCEL_ROW 14 "0"
			EXCEL_SET_VALUE EXCEL_ROW 15 "0"
			EXCEL_SET_VALUE EXCEL_ROW 17 COMMENTS
			EXCEL_SET_VALUE EXCEL_ROW 18 EMJACNUM
			EXCEL_SET_VALUE EXCEL_ROW 19 EMJACDESC
		END_IF

		IF SHAPE == "SHEET" AND SUBTYPE <> "PART_SHEETMETAL" !TYPE == "PLAST"
		
			SEARCH_MDL_PARAM DXF_COMP "THICKNESS" THICKNESS
			SEARCH_MDL_PARAM DXF_COMP "TYPE" TYPE
			SEARCH_MDL_PARAM DXF_COMP "GRADE" GRADE
			SEARCH_MDL_PARAM DXF_COMP "FINISH" FINISH
			SEARCH_MDL_PARAM DXF_COMP "COMMENTS" COMMENTS
			SEARCH_MDL_PARAM DXF_COMP "EMJACNUM" EMJACNUM
			SEARCH_MDL_PARAM DXF_COMP "EMJACDESC" EMJACDESC
			! SEARCH_MDL_PARAM DXF_COMP "SIZE1" SIZE1
			! SEARCH_MDL_PARAM DXF_COMP "SIZE2" SIZE2
			! SEARCH_MDL_PARAM DXF_COMP "CUT1" CUT1
			! SEARCH_MDL_PARAM DXF_COMP "CUT2" CUT2

			SEARCH_MDL_REF DXF_COMP CSYS "DIM*" REFCSYS
			CALC_OUTLINE_PARAM REFCSYS X_SIZE X
			CALC_OUTLINE_PARAM REFCSYS Y_SIZE Y
			CALC_OUTLINE_PARAM REFCSYS Z_SIZE Z

			LENGTH = X
			WIDTH = Y

			SWIDTH = ftos(WIDTH,3)
			IF strlen(SWIDTH ) == 5
				SWIDTH = "00"+SWIDTH
			ELSE_IF strlen(SWIDTH ) == 6
				SWIDTH = "0"+SWIDTH
			END_IF

			SLENGTH = ftos(LENGTH,3)
			IF strlen(SLENGTH ) == 5
				SLENGTH = "00"+SLENGTH
			ELSE_IF strlen(SLENGTH) == 6
				SLENGTH = "0"+SLENGTH
			END_IF

			IF strlen(FINISH) == 1
				FINISH = "00"+FINISH
			ELSE_IF strlen(FINISH) == 2
				FINISH = "0"+FINISH
			END_IF
			
			! SWIDTH = ftos(CUT2,3)
			! IF strlen(SWIDTH ) == 5
				! SWIDTH = "00"+SWIDTH
			! ELSE_IF strlen(SWIDTH ) == 6
				! SWIDTH = "0"+SWIDTH
			! END_IF
			
			! SLENGTH = ftos(CUT1,3)
			! IF strlen(SLENGTH ) == 5
				! SLENGTH = "00"+SLENGTH
			! ELSE_IF strlen(SLENGTH) == 6
				! SLENGTH = "0"+SLENGTH
			! END_IF

			! IF strlen(FINISH) == 1
				! FINISH = "00"+FINISH
			! ELSE_IF strlen(FINISH) == 2
				! FINISH = "0"+FINISH
			! END_IF
			
			EXCEL_SET_VALUE EXCEL_ROW 4 ftos(THICKNESS,3)
			EXCEL_SET_VALUE EXCEL_ROW 5 TYPE
			EXCEL_SET_VALUE EXCEL_ROW 6 SHAPE
			EXCEL_SET_VALUE EXCEL_ROW 7 GRADE
			EXCEL_SET_VALUE EXCEL_ROW 8 FINISH
			! EXCEL_SET_VALUE EXCEL_ROW 9 SIZE1
			! EXCEL_SET_VALUE EXCEL_ROW 10 SIZE2
			EXCEL_SET_VALUE EXCEL_ROW 11 SWIDTH
			EXCEL_SET_VALUE EXCEL_ROW 12 SLENGTH
			EXCEL_SET_VALUE EXCEL_ROW 13 "0"
			EXCEL_SET_VALUE EXCEL_ROW 14 "0"
			EXCEL_SET_VALUE EXCEL_ROW 15 "0"
			EXCEL_SET_VALUE EXCEL_ROW 18 EMJACNUM
			EXCEL_SET_VALUE EXCEL_ROW 19 EMJACDESC
		END_IF
		
	ELSE_IF STOCKTYPE == 3
		EXCEL_GET_VALUE EXCEL_ROW 1 EXCEL_COMPONENT_NAME
		EXCEL_GET_VALUE EXCEL_ROW 16 MDLTYPE

		IF MDLTYPE == "PART"
			COMPONENT_NAME = EXCEL_COMPONENT_NAME+".prt"
		ELSE_IF MDLTYPE == "ASSEMBLY"
			COMPONENT_NAME = EXCEL_COMPONENT_NAME+".asm"
		END_IF
		RETRIEVE_MDL COMPONENT_NAME DXF_COMP
		SEARCH_MDL_PARAM DXF_COMP "EMJACNUM" EMJACNUM
		SEARCH_MDL_PARAM DXF_COMP "EMJACDESC" EMJACDESC
		EXCEL_SET_VALUE EXCEL_ROW 18 EMJACNUM
		EXCEL_SET_VALUE EXCEL_ROW 19 EMJACDESC
	END_IF

	EXCEL_ROW++
	EXCEL_GET_VALUE EXCEL_ROW 1 EXCEL_COMPONENT_NAME

	IF EXCEL_COMPONENT_NAME == ""
		EOF = "TRUE"
	ELSE
		EOF = "FALSE"
	END_IF
END_WHILE

DECLARE_ARRAY MACRO
EXCEL_RUN_MACRO "macro2" MACRO
EXCEL_RUN_MACRO "macro2" MACRO

!CREATE DXF - FLATS


CALL consolidate.tab


DISPLAY_DATUM PLANES FALSE
DISPLAY_DATUM AXES FALSE
DISPLAY_DATUM POINTS FALSE
DISPLAY_DATUM CSYS FALSE

EXCEL_ROW = 6
EXCEL_ACTIVATE_DOCUMENT BOM_DOCUMENT_NAME
EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "LISTING"
EXCEL_GET_VALUE EXCEL_ROW 1 EXCEL_COMPONENT_NAME

IF EXCEL_COMPONENT_NAME == ""
	EOF = "TRUE"
ELSE
	EOF = "FALSE"
END_IF

CLEAR_ARRAY PDF1
CLEAR_ARRAY PDF2
CLEAR_ARRAY PDF3

WHILE EOF == "FALSE"
	EXCEL_GET_VALUE EXCEL_ROW 2 STOCKTYPE
	EXCEL_GET_VALUE EXCEL_ROW 4 THICKNESS		
	IF STOCKTYPE == 1 !AND stof(THICKNESS) < 1.0
		EXCEL_GET_VALUE EXCEL_ROW 0 INDEX
		EXCEL_GET_VALUE EXCEL_ROW 5 TYPE
		EXCEL_GET_VALUE EXCEL_ROW 13 GRAIN			

					SINDEX = itos(INDEX)
					IF strlen(SINDEX) == 1
						SINDEX = "00"+SINDEX
					ELSE_IF strlen(SINDEX) == 2
						SINDEX = "0"+SINDEX
					END_IF

		EXCEL_GET_VALUE EXCEL_ROW 1 EXCEL_COMPONENT_NAME
		COMPONENT_NAME = EXCEL_COMPONENT_NAME+".prt"

		RETRIEVE_MDL COMPONENT_NAME DXF_COMP
		SET_MDL_PARAM DXF_COMP "EMJACNUM" SINDEX
		EXCEL_SET_VALUE EXCEL_ROW 18 SINDEX+"_"+WO_NUM
		SEARCH_MDL_PARAM DXF_COMP "GRAIN" MDL_GRAIN
		IF GRAIN <> MDL_GRAIN
			SET_MDL_PARAM DXF_COMP "GRAIN" stoi(GRAIN)
		END_IF
		
		SET_MDL_PARAM DXF_COMP "USED" 1
		SET_MDL_PARAM DXF_COMP "WO_NUM" WO_NUM
		SAVE_MDL DXF_COMP
		SEARCH_MDL_PARAM DXF_COMP "SHAPE" SHAPE
		GET_MDL_SUBTYPE DXF_COMP SUBTYPE

		IF SHAPE == "SHEET" AND SUBTYPE == "PART_SHEETMETAL"
			SEARCH_MDL_PARAM DXF_COMP "SMT_THICKNESS" THICKNESS
			EXCEL_GET_VALUE EXCEL_ROW 16 STATE
			EXCEL_GET_VALUE EXCEL_ROW 0 INDEX
			SINDEX = itos(INDEX)
			IF strlen(SINDEX) == 1
				SINDEX = "00"+SINDEX
			ELSE_IF strlen(SINDEX) == 2
				SINDEX = "0"+SINDEX
			END_IF
			
			IF STATE == "FORMED"	
				SEARCH_MDL_REF DXF_COMP SURFACE "FIXED*" FIRST_SURF
				CREATE_UDF lib:udf\unbend DXF_COMP FLAT_UDF
					UDF_REF surface FIRST_SURF
					UDF_EXP_REF FLAT FEATURE 0
				END_CREATE_UDF
				SET_REF_NAME FLAT_UDF "EXPORT_UDF"
			
				BEGIN_CATCH_ERROR
					SEARCH_MDL_PARAM DXF_COMP "BEND_LINES" BEND_LINES
				END_CATCH_ERROR
				IF ERROR
					BEND_LINES = 0
				END_IF
				CLEAR_CATCH_ERROR
	
				IF BEND_LINES == 1 AND FEAT_NOT_EXIST DXF_COMP "BEND_LINE*"
					DECLARE_VARIABLE DOUBLE LENGTH_EDGE_1
					DECLARE_VARIABLE DOUBLE LENGTH_EDGE_2
					DECLARE_VARIABLE STRING SURFACE_NAME
					DECLARE_VARIABLE STRING BEND_SURFACE
					DECLARE_VARIABLE STRING EDGE_NAME
					DECLARE_VARIABLE STRING STATE ""
					DECLARE_REFERENCE refSurface
					DECLARE_REFERENCE CONTOUR
					DECLARE_REFERENCE EDGE1
					DECLARE_REFERENCE EDGE2
					DECLARE_ARRAY SURFACES
					DECLARE_ARRAY FEATURES
					DECLARE_VARIABLE STRING UP90
					DECLARE_VARIABLE STRING DN90
					DECLARE_VARIABLE STRING BND
					
					IF TYPE == "*GALV*"
						UP90 = "lib:udf\\up90_galv"
						DN90 = "lib:udf\\dn90_galv"
						BND = "lib:udf\\bndother_galv"
					ELSE
						UP90 = "lib:udf\\up90"
						DN90 = "lib:udf\\dn90"
						BND = "lib:udf\\bndother"						
					END_IF						

					CLEAR_ARRAY SURFACES
					SEARCH_MDL_REFS DXF_COMP SURFACE "*" SURFACES						
					
					FOR refSurface REF ARRAY SURFACES
						IF IS_SMT_BEND_SURFACE refSurface
							GET_SMT_SURFACE_TYPE refSurface SurfType
							IF SurfType == "GREEN_FACE"
								GET_SMT_BEND_SURFACE_PROPS refSurface surface_props
								PRINT "radius: %" surface_props.radius
								PRINT "angle: %" surface_props.angle
								PRINT "length: %" surface_props.length
								PRINT "bend upwards: %" surface_props.bend_upwards
								GET_SURFACE_CONTOURS refSurface EXTERNAL arrayContours
								LENGTH_EDGE_1 = 0
								FOR contour REF ARRAY arrayContours
									FOR edge REF ARRAY contour.array_edges
										MEASURE_LENGTH edge length_edge
										IF length_edge > LENGTH_EDGE_1
											INVALIDATE_REF EDGE1
											DECLARE_REFERENCE EDGE1 edge
											LENGTH_EDGE_1 = length_edge
										END_IF
									END_FOR
								END_FOR
								LENGTH_EDGE_2 = 0
								FOR contour REF ARRAY arrayContours
									FOR edge REF ARRAY contour.array_edges
										IF REF_UNEQUAL EDGE1 edge
											MEASURE_LENGTH edge length_edge
											IF length_edge > LENGTH_EDGE_2
												INVALIDATE_REF EDGE2
												DECLARE_REFERENCE EDGE2 edge
												LENGTH_EDGE_2 = length_edge
											END_IF
										END_IF
									END_FOR
								END_FOR

								IF surface_props.bend_upwards == FALSE AND surface_props.angle == 90 AND LENGTH_EDGE_1 > 2 AND \
								   ( surface_props.radius == (.03 + THICKNESS) OR surface_props.radius == (THICKNESS*2))
									CREATE_UDF &DN90 DXF_COMP BEND
										UDF_REF EDGE1 EDGE1
										UDF_REF SURFACE refSurface
										UDF_REF EDGE2 EDGE2
									END_CREATE_UDF
								ELSE_IF surface_props.bend_upwards == TRUE AND surface_props.angle == 90  AND LENGTH_EDGE_1 > 2 AND \
								   ( surface_props.radius == .03  OR surface_props.radius == THICKNESS)
									CREATE_UDF &UP90 DXF_COMP BEND
										UDF_REF EDGE1 EDGE1
										UDF_REF SURFACE refSurface
										UDF_REF EDGE2 EDGE2
									END_CREATE_UDF
								ELSE_IF LENGTH_EDGE_1 > 2 AND ((surface_props.radius <> .03 AND surface_props.radius <> THICKNESS AND surface_props.radius <> (.03+THICKNESS) AND surface_props.radius <> (THICKNESS*2 )) \
								   OR surface_props.angle <> 90)
									CREATE_UDF &BND DXF_COMP BEND
										UDF_REF EDGE1 EDGE1
										UDF_REF SURFACE refSurface
										UDF_REF EDGE2 EDGE2
									END_CREATE_UDF
								END_IF
								ADD_ARRAY_ELEM FEATURES BEND
							END_IF
						END_IF
					END_FOR	
				END_IF
			END_IF
			
				! SEARCH_MDL_REF DXF_COMP SURFACE "FIXED*" FIRST_SURF
				! CREATE_UDF lib:udf\unbend DXF_COMP FLAT_UDF
					! UDF_REF surface FIRST_SURF
					! UDF_EXP_REF FLAT FEATURE 0
				! END_CREATE_UDF
				! SET_REF_NAME FLAT_UDF "EXPORT_UDF"
			
			! IF STATE == "FORMED"	
				! SEARCH_MDL_REF DXF_COMP SURFACE "FIXED*" FIRST_SURF
				! CREATE_UDF lib:udf\unbend DXF_COMP FLAT_UDF
					! UDF_REF surface FIRST_SURF
					! UDF_EXP_REF FLAT FEATURE 0
				! END_CREATE_UDF
				! SET_REF_NAME FLAT_UDF "EXPORT_UDF"
			! END_IF
			PRINT "%" DXF_COMP
			SEARCH_MDL_REF DXF_COMP SURFACE "FIXED*" FIXED_SURF
			GET_REF_NAME FIXED_SURF FIXED_SURF_NAME
			
			! IF FIXED_SURF_NAME <> "FIXED"
				! VIEW = FIXED_SURF_NAME
			! ELSE
			SEARCH_MDL_PARAM DXF_COMP "GRAIN" MDL_GRAIN
				VIEW = itos(MDL_GRAIN)
			! END_IF
		PRINT "%" DXF_COMP
		PRINT "VIEW %" VIEW
		
			USE_LIBRARY_MDL lib:dxf_temp DRAWING DXF

			CREATE_DRW_VIEW_GENERAL DXF DXF_COMP &VIEW 1 60 36 0 dxfView
			SET_DRW_VIEW_TANGENT_EDGE_DISPLAY dxfView NONE
			SET_DRW_VIEW_DISPLAY dxfView NO_HIDDEN
			SET_LAYER_STATUS DXF_COMP 03___PRT_ALL_CURVES BLANK		
			SET_DRW_LAYER_STATUS dxfView 03___PRT_ALL_CURVES BLANK
			REPAINT

			SET_WORKING_DIRECTORY DXF_DIRECTORY

			EXPORT_FILE dxf DXF WO_NUM +"_"+ SINDEX
			REPAINT
			DELETE_DRW_MDL DXF DXF_COMP
			
			IF STATE == "FORMED"
				IF REF_INSTANCE DXF_COMP
					REMOVE_FEATURE CLIP_ALL FLAT_UDF	
					GET_REF_GENERIC DXF_COMP GENERIC
					SWITCH_TO_MDL GENERIC
					SEARCH_MDL_REF ALLOW_SUPPRESSED GENERIC FEATURE "EXPORT_UDF" FEAT_REF
					REMOVE_FEATURE CLIP_ALL FEAT_REF
					SWITCH_TO_MDL DXF_COMP
				ELSE
					REMOVE_FEATURE CLIP_ALL FLAT_UDF	
				END_IF
			END_IF

!PDF == 0 (NO PDF)
!PDF == 1 (MAKES A PDF FOR THE GENERIC ITEM ONLY, PROGRAM WILL FAIL IF YOU TRY TO MAKE A PDF OF AN INSTANCE)
!PDF == 2 (MAKES A PDF FOR THE GENERIC ONLY, INCLUDES FAMILY TABEL INFO)
!PDF == 3 (MAKES A PDF OF EACH INSTANCE USED BY THE WORK ORDER BY REPLACING THE GENERIC)

!PDF1 AND PDF2 ARE VERY SIMILAR - ARE INTERCHANGEABLE


			
			CLEAR_CATCH_ERROR
			BEGIN_CATCH_ERROR
			SEARCH_MDL_PARAM DXF_COMP "PDF" PDF
			IF ERROR
				END_CATCH_ERROR
				CLEAR_CATCH_ERROR
			ELSE
				IF PDF == 1
					ADD_ARRAY_ELEM PDF1 DXF_COMP
				ELSE_IF PDF == 2
					FIND_ARRAY_ELEM PDF2 GENERIC PDF_INDEX
					IF PDF_INDEX == -1
						ADD_ARRAY_ELEM PDF2 GENERIC
					END_IF
				ELSE_IF PDF == 3
					IF REF_INSTANCE DXF_COMP
						GET_REF_GENERIC DXF_COMP GENERIC
						FIND_ARRAY_ELEM PDF3 GENERIC PDF_INDEX
						IF PDF_INDEX == -1
							ADD_ARRAY_ELEM PDF3 GENERIC
						END_IF
					END_IF
				END_IF
			END_IF				
		END_IF
	END_IF
	EXCEL_ROW++
	EXCEL_GET_VALUE EXCEL_ROW 1 EXCEL_COMPONENT_NAME

	IF EXCEL_COMPONENT_NAME == ""
		EOF = "TRUE"
	ELSE
		EOF = "FALSE"
	END_IF
	INVALIDATE_REF FIXED_SURF
END_WHILE


GET_ARRAY_SIZE PDF1 PDF_SIZE
IF PDF_SIZE > 0
	FOR PDF REF ARRAY PDF1
		GET_REF_NAME PDF PDF_NAME
		RETRIEVE_MDL PDF_NAME+".prt" PDF_COMP
		RETRIEVE_MDL PDF_NAME+".drw" PDF_DRW	
		REGEN_MDL PDF_DRW FORCE
		REGEN_MDL PDF_DRW FORCE

		SET_CONFIG_OPTION "system_colors_file" "C:\SIGMAXIM\Library\component_engine\SDI\sa.scl"
		DECLARE_STRUCT PDF_OPTION option
		option.title = "sample drawing"
		option.author = "DRAFTER"
		option.subject = "detail"
		option.keywords = "SmartAssembly example"
		option.launch_viewer = "FALSE"
		option.color_depth = "Gray"
		option.layer_mode = "None"
		option.use_pentable = "TRUE"
		option.pentable_file = "C:\pro_stds\ProStandards\emjac_table.pnt"
		! option.use_true_type_fonts = 0
		EXPORT_DRW_PDF PDF_DRW option PDF_NAME
		SET_CONFIG_OPTION "system_colors_file" "C:\SIGMAXIM\Library\component_engine\SDI\initial.scl"
	END_FOR
END_IF
	
GET_ARRAY_SIZE PDF2 PDF_SIZE
IF PDF_SIZE > 0
	FOR PDF REF ARRAY PDF2
		IF PDF <> "GENERIC"
			GET_REF_NAME PDF PDF_NAME
			RETRIEVE_MDL PDF_NAME+".prt" PDF_COMP
			RETRIEVE_MDL PDF_NAME+".drw" PDF_DRW	
			REGEN_MDL PDF_DRW FORCE
			REGEN_MDL PDF_DRW FORCE
			
			SET_CONFIG_OPTION "system_colors_file" "C:\SIGMAXIM\Library\component_engine\SDI\sa.scl"
			DECLARE_STRUCT PDF_OPTION option
			option.title = "sample drawing"
			option.author = "DRAFTER"
			option.subject = "detail"
			option.keywords = "SmartAssembly example"
			option.launch_viewer = "FALSE"
			option.color_depth = "Gray"
			option.layer_mode = "None"
			option.use_pentable = "TRUE"
			option.pentable_file = "C:\pro_stds\ProStandards\emjac_table.pnt"
			! option.use_true_type_fonts = 0
			EXPORT_DRW_PDF PDF_DRW option PDF_NAME
			SET_CONFIG_OPTION "system_colors_file" "C:\SIGMAXIM\Library\component_engine\SDI\initial.scl"
		END_IF
	END_FOR
END_IF

GET_ARRAY_SIZE PDF3 PDF_SIZE
IF PDF_SIZE > 0
	FOR PDF REF ARRAY PDF3
		PRINT "%" PDF
		GET_REF_NAME PDF PDF_NAME
		RETRIEVE_MDL PDF_NAME+".prt" PDF_COMP
		RETRIEVE_MDL PDF_NAME+".drw" PDF_DRW	
		REGEN_MDL PDF_DRW FORCE
		REGEN_MDL PDF_DRW FORCE

		GET_FAMINSTANCE_NAMES PDF PDF_INST_NAMES
		FOR PDF_INST_NAME REF ARRAY PDF_INST_NAMES
			GET_REF_FAMINSTANCE PDF_COMP &PDF_INST_NAME PDF_INST
			SEARCH_MDL_PARAM PDF_INST "STOCKTYPE" STOCKTYPE
			SEARCH_MDL_PARAM PDF_INST "EMJACNUM" EMJACNUM
			IF STOCKTYPE == 1 AND strlen(EMJACNUM) == 3
				SEARCH_DRW_VIEWS PDF_DRW "*" 1 PDF_VIEWS
				FOR PDF_VIEW REF ARRAY PDF_VIEWS
					GET_DRW_VIEW_MDL PDF_VIEW PDF_VIEW_MDL
					GET_REF_FAMINSTANCE PDF_COMP &PDF_INST_NAME PDF_INST
					REPLACE_DRW_VIEW_MDL PDF_VIEW PDF_INST
								
					SET_CONFIG_OPTION "system_colors_file" "C:\SIGMAXIM\Library\component_engine\SDI\sa.scl"
					DECLARE_STRUCT PDF_OPTION option
					option.title = "sample drawing"
					option.author = "DRAFTER"
					option.subject = "detail"
					option.keywords = "SmartAssembly example"
					option.launch_viewer = "FALSE"
					option.color_depth = "Gray"
					option.layer_mode = "None"
					option.use_pentable = "TRUE"
					option.pentable_file = "C:\pro_stds\ProStandards\emjac_table.pnt"
					! option.use_true_type_fonts = 0
					EXPORT_DRW_PDF PDF_DRW option PDF_INST_NAME
					SET_CONFIG_OPTION "system_colors_file" "C:\SIGMAXIM\Library\component_engine\SDI\initial.scl"
				END_FOR
			END_IF
		END_FOR
	END_FOR
END_IF

RETRIEVE_MDL WO_ASSEM.ASM ASSEM

SET_MDL_NAME ASSEM "BOM_"+WO_NUM

CREATE_DRW ASSEM req_template.drw refDrawing

EXCEL_ACTIVATE_DOCUMENT BOM_DOCUMENT_NAME
EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "LISTING"

EXCEL_ROW = 6
EXCEL_GET_VALUE EXCEL_ROW 1 EXCEL_COMPONENT_NAME

IF EXCEL_COMPONENT_NAME == ""
	EOF = "TRUE"
ELSE
	EOF = "FALSE"
END_IF

IF EXCEL_COMPONENT_NAME <> ""
	EOF = "FALSE"
	WHILE EOF == "FALSE"
		EXCEL_ROW++
		EXCEL_GET_VALUE EXCEL_ROW 1 EXCEL_COMPONENT_NAME
PRINT "%" EXCEL_COMPONENT_NAME
		IF EXCEL_COMPONENT_NAME <> "" AND EXCEL_COMPONENT_NAME <> "*XX_*"
			EOF = "FALSE"
		ELSE
			EOF = "TRUE"
		END_IF
	END_WHILE
PRINT "EXCEL_ROW  %" EXCEL_ROW
	DECLARE_ARRAY arrayData
	
	EXCEL_GET_VALUES CELL_BY_INDEX 6 0 CELL_BY_INDEX (EXCEL_ROW-1) 22 arrayData

	DECLARE_ARRAY data
	DECLARE_ARRAY ITEMS

	FOR data REF ARRAY arrayData
		GET_ARRAY_ELEM data 2 value
		ADD_ARRAY_ELEM ITEMS value
	END_FOR

	CLEAR_ARRAY arrayData
	
	GET_ARRAY_SIZE ITEMS SIZE

	SWITCH_TO_MDL refDrawing

	! ERASE_NOT_DISPLAYED

	DECLARE_VARIABLE INTEGER ITP
	DECLARE_VARIABLE INTEGER ITEM_INDEX
	DECLARE_VARIABLE INTEGER MAX_LINES 26
	DECLARE_VARIABLE INTEGER TEMPD
	DECLARE_VARIABLE INTEGER TEMPN
	DECLARE_VARIABLE INTEGER NUMBER
	DECLARE_VARIABLE INTEGER DENOMENATOR 16
	DECLARE_VARIABLE INTEGER QTY
	DECLARE_VARIABLE INTEGER LINE_INDEX
	DECLARE_VARIABLE STRING MAT_NUM
	DECLARE_VARIABLE STRING MAT_DESC
	DECLARE_VARIABLE INTEGER SHEET_INDEX
	DECLARE_VARIABLE INTEGER TOTAL_SHEETS
	DECLARE_VARIABLE INTEGER SHEET
	DECLARE_VARIABLE STRING ADDED_LINES

	ITP = SIZE/23
	ITEM_INDEX = 1
	SHEET_INDEX = 0
	MAT_NUM = "XXX"
	ADDED_LINES = "NO"

	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+0) COL0
	PRINT "COL 0 %" COL0 
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+1) COL1
	PRINT "COL 1 %" COL1
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+2) COL2
	PRINT "COL 2 %" COL2
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+3) COL3
	PRINT "COL 3 %" COL3
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+4) COL4
	PRINT "COL 4 %" COL4
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+5) COL5
	PRINT "COL 5 %" COL5
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+6) COL6
	PRINT "COL 6 %" COL6
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+7) COL7
	PRINT "COL 7 %" COL7
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+8) COL8
	PRINT "COL 8 %" COL8
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+9) COL9
	PRINT "COL 9 %" COL9
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+10) COL10
	PRINT "COL 10 %" COL10
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+11) COL11
	PRINT "COL 11 %" COL11
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+12) COL12
	PRINT "COL 12 %" COL12
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+13) COL13
	PRINT "COL 13 %" COL13
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+14) COL14
	PRINT "COL 14 %" COL14
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+15) COL15
	PRINT "COL 15 %" COL15
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+16) COL16
	PRINT "COL 16 %" COL16
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+17) COL17
	PRINT "COL 17 %" COL17
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+18) COL18
	PRINT "COL 18 %" COL18
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+19) COL19
	PRINT "COL 19 %" COL19
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+20) COL20
	PRINT "COL 20%" COL20
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+21) COL21
	PRINT "COL 21 %" COL21
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+22) COL22
	PRINT "COL 22 %" COL22
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+23) COL23
	PRINT "COL 23 %" COL23

	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+2) STOCKTYPE
	GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+20) SHAPE2

	!CREATE MATERIAL REQUISITION SHEETS

	WHILE ITEM_INDEX <= ITP AND STOCKTYPE == 1 AND SHAPE2 == "1*"
		SHEET_INDEX++
		SHEET = SHEET_INDEX
		LINE_INDEX = 1
		IF SHEET_INDEX == 1
			SET_DRW_FORMAT refDrawing SHEET_INDEX material_req_format.frm
			CREATE_DRW_TABLE refDrawing ASSEM 1 .4375 6.625  "lib:mat_body.tbl"  BODY
		ELSE_IF SHEET_INDEX > 1
			INSERT_DRW_SHEET refDrawing SHEET_INDEX
			SET_DRW_CUR_SHEET refDrawing SHEET_INDEX
			SET_DRW_FORMAT refDrawing SHEET_INDEX material_req_format.frm
			CREATE_DRW_TABLE refDrawing ASSEM SHEET_INDEX .4375 6.625  "lib:mat_body.tbl"  BODY
		END_IF

		CREATE_DRW_NOTE refDrawing 1.0625 7.6875 WO_NUM
		CREATE_DRW_NOTE refDrawing 2.8125 7.6875 "&todays_date" HORIZONTAL CENTER

		IF SUB_JOB_NAME == ""
			CREATE_DRW_NOTE refDrawing 5.5 7.125 JOB_NAME HORIZONTAL CENTER
		ELSE
			CREATE_DRW_NOTE refDrawing 5.5 7.209 JOB_NAME HORIZONTAL CENTER
			CREATE_DRW_NOTE refDrawing 5.5 7.042 SUB_JOB_NAME HORIZONTAL CENTER
		END_IF

		CREATE_DRW_NOTE refDrawing 9.5 7.9375 itos(SHEET)

		CREATE_DRW_NOTE refDrawing 9.0625 7.125 ITEM_DESC HORIZONTAL CENTER

		WHILE ITEM_INDEX <= ITP AND LINE_INDEX <= MAX_LINES AND SHAPE2 == "1*" AND STOCKTYPE == 1
			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+21) MatNum
			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+20) SHAPE2
			IF LINE_INDEX == 1
				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+21) MAT_NUM
				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+22) MAT_DESC
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 1 MAT_NUM+"  -  "+MAT_DESC
				SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 1 HORIZONTAL CENTER VERTICAL MIDDLE
				LINE_INDEX = LINE_INDEX + 1
				ADDED_LINES = "YES"
			END_IF

			IF MAT_NUM <> MatNum AND SHAPE2 == "1*"
				IF LINE_INDEX > 1 AND LINE_INDEX <= MAX_LINES - 4
					MERGE_DRW_TABLE refDrawing BODY LINE_INDEX 1 LINE_INDEX 8
					LINE_INDEX = LINE_INDEX + 1
					MERGE_DRW_TABLE refDrawing BODY LINE_INDEX 1 LINE_INDEX 8
					GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+21) MAT_NUM
					GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+22) MAT_DESC
					SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 1 MAT_NUM+"  -  "+MAT_DESC
					SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 1 HORIZONTAL CENTER VERTICAL MIDDLE
					LINE_INDEX = LINE_INDEX + 1
					ADDED_LINES = "YES"
				ELSE_IF LINE_INDEX > 1 AND LINE_INDEX > MAX_LINES - 4
					LINE_INDEX = MAX_LINES + 1
					BREAK
				END_IF
			END_IF

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+0) INDEX

			SINDEX = itos(INDEX)
			IF strlen(SINDEX) == 1
				SINDEX = "00"+SINDEX
			ELSE_IF strlen(SINDEX) == 2
				SINDEX = "0"+SINDEX
			END_IF


			SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 1 SINDEX
			SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 1 HORIZONTAL CENTER VERTICAL MIDDLE HEIGHT .1

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+1) DESC
			SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 2 DESC
			SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 2 VERTICAL MIDDLE HEIGHT .1

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+3) QTY
			SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 3 itos(QTY)
			SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 3 HORIZONTAL CENTER VERTICAL MIDDLE HEIGHT .1

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+11) SWIDTH
				WIDTH = stof(SWIDTH)
				TEMPD = 1/DENOMENATOR
				TEMPN = ROUND((WIDTH / TEMPD),0)
				NUMBER = FLOOR(TEMPN / DENOMENATOR)
				TEMPN = TEMPN - (NUMBER*DENOMENATOR)
				TEMPD = DENOMENATOR
				WHILE MOD(TEMPN,2) == 0 AND MOD(TEMPD,2) == 0
					TEMPN = TEMPN/2
					TEMPD = TEMPD/2
				END_WHILE

				IF NUMBER > 0 AND TEMPN > 0
					SWIDTH = itos(NUMBER) +"-"+ftos(TEMPN,0)+"/"+ftos(TEMPD,0)
				ELSE_IF NUMBER > 0 AND TEMPN == 0
					SWIDTH = itos(NUMBER)
				ELSE
					SWIDTH = ftos(TEMPN,0)+"/"+ftos(TEMPD,0)
				END_IF

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+12) SLENGTH
				LENGTH = stof(SLENGTH)
				TEMPD = 1/DENOMENATOR
				TEMPN = ROUND((LENGTH / TEMPD),0)
				NUMBER = FLOOR(TEMPN / DENOMENATOR)
				TEMPN = TEMPN - (NUMBER*DENOMENATOR)
				TEMPD = DENOMENATOR
				WHILE MOD(TEMPN,2) == 0 AND MOD(TEMPD,2) == 0
					TEMPN = TEMPN/2
					TEMPD = TEMPD/2
				END_WHILE

				IF NUMBER > 0 AND TEMPN > 0
					SLENGTH = itos(NUMBER) +"-"+ftos(TEMPN,0)+"/"+ftos(TEMPD,0)
				ELSE_IF NUMBER > 0 AND TEMPN == 0
					SLENGTH = itos(NUMBER)
				ELSE
					SLENGTH = ftos(TEMPN,0)+"/"+ftos(TEMPD,0)
				END_IF

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+13) GRAIN
			IF GRAIN == "0"
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 5 "  "+SWIDTH+"   x   "+SLENGTH
			ELSE_IF GRAIN == "1"
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 5 "  "+SWIDTH+"   x   "+SLENGTH+"  **"
			ELSE_IF GRAIN == "2"
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 5 "  "+SLENGTH+"   x   "+SWIDTH+"  **"
			END_IF
			SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 5 VERTICAL MIDDLE HEIGHT .1

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+14) PVC
			IF PVC <> "0"
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 6 "*"
			END_IF

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+15) DEBUR
			IF DEBUR <> "0"
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 7 "*"
			END_IF

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+17) COMMENTS
			IF COMMENTS <> ""
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 8 COMMENTS
			END_IF

			LINE_INDEX++
			ITEM_INDEX++
			
			IF ITEM_INDEX <= ITP
				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+20) SHAPE2
				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+2) STOCKTYPE
			END_IF			
		END_WHILE
	END_WHILE

	!CREATE MATERIAL REQUISITION SHAPES

	WHILE ITEM_INDEX <= ITP AND SHAPE2 == "2*" AND STOCKTYPE == 1
		SHEET_INDEX++
		SHEET = SHEET_INDEX
		LINE_INDEX = 1
		IF SHEET_INDEX == 1
			SET_DRW_FORMAT refDrawing SHEET_INDEX material_req_format.frm
			CREATE_DRW_TABLE refDrawing ASSEM 1 .4375 6.625  "lib:mat_body.tbl"  BODY
		ELSE_IF SHEET_INDEX > 1
			INSERT_DRW_SHEET refDrawing SHEET_INDEX
			SET_DRW_CUR_SHEET refDrawing SHEET_INDEX
			SET_DRW_FORMAT refDrawing SHEET_INDEX material_req_format.frm
			CREATE_DRW_TABLE refDrawing ASSEM SHEET_INDEX .4375 6.625  "lib:mat_body.tbl"  BODY
		END_IF

		CREATE_DRW_NOTE refDrawing 1.0625 7.6875 WO_NUM
		CREATE_DRW_NOTE refDrawing 2.8125 7.6875 "&todays_date" HORIZONTAL CENTER

		IF CUSTOMER_NAME == ""
			PRINT "ENTER CUSTOMER NAME"
			USER_INPUT_PARAM STRING CUSTOMER_NAME
		END_IF
		CREATE_DRW_NOTE refDrawing 1.9375 7.125 CUSTOMER_NAME HORIZONTAL CENTER

		IF JOB_NAME == ""
			PRINT "ENTER JOB/PROJECT NAME"
			USER_INPUT_PARAM STRING JOB_NAME
		END_IF

		IF SUB_JOB_NAME == ""
			CREATE_DRW_NOTE refDrawing 5.5 7.125 JOB_NAME HORIZONTAL CENTER
		ELSE
			CREATE_DRW_NOTE refDrawing 5.5 7.209 JOB_NAME HORIZONTAL CENTER
			CREATE_DRW_NOTE refDrawing 5.5 7.042 SUB_JOB_NAME HORIZONTAL CENTER
		END_IF

		CREATE_DRW_NOTE refDrawing 9.5 7.9375 itos(SHEET)

		CREATE_DRW_NOTE refDrawing 9.0625 7.125 ITEM_DESC HORIZONTAL CENTER

		WHILE ITEM_INDEX <= ITP AND LINE_INDEX <= MAX_LINES AND SHAPE2 == "2*" AND STOCKTYPE == 1
			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+21) MatNuM
			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+20) SHAPE2
			IF LINE_INDEX == 1
				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+21) MAT_NUM
				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+22) MAT_DESC
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 1 MAT_NUM+"  -  "+MAT_DESC
				SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 1 HORIZONTAL CENTER VERTICAL MIDDLE
				LINE_INDEX = LINE_INDEX + 1
				ADDED_LINES = "YES"
			END_IF
			IF MAT_NUM <> MatNum AND SHAPE2 == "2*"
				IF LINE_INDEX > 1 AND LINE_INDEX <= MAX_LINES - 4
					MERGE_DRW_TABLE refDrawing BODY LINE_INDEX 1 LINE_INDEX 8
					LINE_INDEX = LINE_INDEX + 1
					MERGE_DRW_TABLE refDrawing BODY LINE_INDEX 1 LINE_INDEX 8
					GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+21) MAT_NUM
					GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+22) MAT_DESC
					SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 1 MAT_NUM+"  -  "+MAT_DESC
					SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 1 HORIZONTAL CENTER VERTICAL MIDDLE
					LINE_INDEX = LINE_INDEX + 1
					ADDED_LINES = "YES"
				ELSE_IF LINE_INDEX > 1 AND LINE_INDEX > MAX_LINES - 4
					LINE_INDEX = MAX_LINES+1
				END_IF
			END_IF

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+0) INDEX

			SINDEX = itos(INDEX)
			IF strlen(SINDEX) == 1
				SINDEX = "00"+SINDEX
			ELSE_IF strlen(SINDEX) == 2
				SINDEX = "0"+SINDEX
			END_IF

			SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 1 SINDEX
			SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 1 HORIZONTAL CENTER VERTICAL MIDDLE HEIGHT .1

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+1) DESC
			SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 2 DESC
			SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 2 VERTICAL MIDDLE HEIGHT .1

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+3) QTY
			SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 3 itos(QTY)
			SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 3 HORIZONTAL CENTER VERTICAL MIDDLE HEIGHT .1

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+11) SWIDTH
				WIDTH = stof(SWIDTH)
				TEMPD = 1/DENOMENATOR
				TEMPN = ROUND((WIDTH / TEMPD),0)
				NUMBER = FLOOR(TEMPN / DENOMENATOR)
				TEMPN = TEMPN - (NUMBER*DENOMENATOR)
				TEMPD = DENOMENATOR
				WHILE MOD(TEMPN,2) == 0 AND MOD(TEMPD,2) == 0
					TEMPN = TEMPN/2
					TEMPD = TEMPD/2
				END_WHILE

				IF NUMBER > 0 AND TEMPN > 0
					SWIDTH = itos(NUMBER) +"-"+ftos(TEMPN,0)+"/"+ftos(TEMPD,0)
				ELSE_IF NUMBER > 0 AND TEMPN == 0
					SWIDTH = itos(NUMBER)
				ELSE
					SWIDTH = ftos(TEMPN,0)+"/"+ftos(TEMPD,0)
				END_IF

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+12) SLENGTH
				LENGTH = stof(SLENGTH)
				TEMPD = 1/DENOMENATOR
				TEMPN = ROUND((LENGTH / TEMPD),0)
				NUMBER = FLOOR(TEMPN / DENOMENATOR)
				TEMPN = TEMPN - (NUMBER*DENOMENATOR)
				TEMPD = DENOMENATOR
				WHILE MOD(TEMPN,2) == 0 AND MOD(TEMPD,2) == 0
					TEMPN = TEMPN/2
					TEMPD = TEMPD/2
				END_WHILE

				IF NUMBER > 0 AND TEMPN > 0
					SLENGTH = itos(NUMBER) +"-"+ftos(TEMPN,0)+"/"+ftos(TEMPD,0)
				ELSE_IF NUMBER > 0 AND TEMPN == 0
					SLENGTH = itos(NUMBER)
				ELSE
					SLENGTH = ftos(TEMPN,0)+"/"+ftos(TEMPD,0)
				END_IF

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+13) GRAIN

			SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 5 "  "+SLENGTH
			SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 5 VERTICAL MIDDLE HEIGHT .1
			
			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+17) COMMENTS
			IF COMMENTS <> ""
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 8 COMMENTS
			END_IF

			LINE_INDEX++
			ITEM_INDEX++
			
			IF ITEM_INDEX <= ITP
				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+20) SHAPE2
				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+2) STOCKTYPE
			END_IF
			
		END_WHILE
	END_WHILE

	!CREATE MATERIAL REQUISITION FOAM & WOOD

	WHILE ITEM_INDEX <= ITP AND SHAPE2 == "3*" AND STOCKTYPE == 1
		SHEET_INDEX++
		SHEET = SHEET_INDEX
		LINE_INDEX = 1
		IF SHEET_INDEX == 1
			SET_DRW_FORMAT refDrawing SHEET_INDEX material_req_format.frm
			CREATE_DRW_TABLE refDrawing ASSEM 1 .4375 6.625  "lib:mat_body.tbl"  BODY
		ELSE_IF SHEET_INDEX > 1
			INSERT_DRW_SHEET refDrawing SHEET_INDEX
			SET_DRW_CUR_SHEET refDrawing SHEET_INDEX
			SET_DRW_FORMAT refDrawing SHEET_INDEX material_req_format.frm
			CREATE_DRW_TABLE refDrawing ASSEM SHEET_INDEX .4375 6.625  "lib:mat_body.tbl"  BODY
		END_IF

		CREATE_DRW_NOTE refDrawing 1.0625 7.6875 WO_NUM
		CREATE_DRW_NOTE refDrawing 2.8125 7.6875 "&todays_date" HORIZONTAL CENTER

		IF CUSTOMER_NAME == ""
			PRINT "ENTER CUSTOMER NAME"
			USER_INPUT_PARAM STRING CUSTOMER_NAME
		END_IF
		CREATE_DRW_NOTE refDrawing 1.9375 7.125 CUSTOMER_NAME HORIZONTAL CENTER

		IF JOB_NAME == ""
			PRINT "ENTER JOB/PROJECT NAME"
			USER_INPUT_PARAM STRING JOB_NAME
		END_IF

		IF SUB_JOB_NAME == ""
			CREATE_DRW_NOTE refDrawing 5.5 7.125 JOB_NAME HORIZONTAL CENTER
		ELSE
			CREATE_DRW_NOTE refDrawing 5.5 7.209 JOB_NAME HORIZONTAL CENTER
			CREATE_DRW_NOTE refDrawing 5.5 7.042 SUB_JOB_NAME HORIZONTAL CENTER
		END_IF

		CREATE_DRW_NOTE refDrawing 9.5 7.9375 itos(SHEET)

		CREATE_DRW_NOTE refDrawing 9.0625 7.125 ITEM_DESC HORIZONTAL CENTER

		WHILE ITEM_INDEX <= ITP AND LINE_INDEX <= MAX_LINES AND SHAPE2 == "3*" AND STOCKTYPE == 1
			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+21) MatNuM
			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+20) SHAPE2
			IF LINE_INDEX == 1
				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+21) MAT_NUM
				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+22) MAT_DESC
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 1 MAT_NUM+"  -  "+MAT_DESC
				SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 1 HORIZONTAL CENTER VERTICAL MIDDLE
				LINE_INDEX = LINE_INDEX + 1
				ADDED_LINES = "YES"
			END_IF
			IF MAT_NUM <> MatNum AND SHAPE2 == "3*"
				IF LINE_INDEX > 1 AND LINE_INDEX <= MAX_LINES - 4
					MERGE_DRW_TABLE refDrawing BODY LINE_INDEX 1 LINE_INDEX 8
					LINE_INDEX = LINE_INDEX + 1
					MERGE_DRW_TABLE refDrawing BODY LINE_INDEX 1 LINE_INDEX 8
					GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+21) MAT_NUM
					GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+22) MAT_DESC
					SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 1 MAT_NUM+"  -  "+MAT_DESC
					SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 1 HORIZONTAL CENTER VERTICAL MIDDLE
					LINE_INDEX = LINE_INDEX + 1
					ADDED_LINES = "YES"
				ELSE_IF LINE_INDEX > 1 AND LINE_INDEX > MAX_LINES - 4
					LINE_INDEX = MAX_LINES+1
				END_IF
			END_IF

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+0) INDEX

			SINDEX = itos(INDEX)
			IF strlen(SINDEX) == 1
				SINDEX = "00"+SINDEX
			ELSE_IF strlen(SINDEX) == 2
				SINDEX = "0"+SINDEX
			END_IF

			SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 1 SINDEX
			SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 1 HORIZONTAL CENTER VERTICAL MIDDLE HEIGHT .1

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+1) DESC
			SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 2 DESC
			SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 2 VERTICAL MIDDLE HEIGHT .1

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+3) QTY
			SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 3 itos(QTY)
			SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 3 HORIZONTAL CENTER VERTICAL MIDDLE HEIGHT .1

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+11) SWIDTH
				WIDTH = stof(SWIDTH)
				TEMPD = 1/DENOMENATOR
				TEMPN = ROUND((WIDTH / TEMPD),0)
				NUMBER = FLOOR(TEMPN / DENOMENATOR)
				TEMPN = TEMPN - (NUMBER*DENOMENATOR)
				TEMPD = DENOMENATOR
				WHILE MOD(TEMPN,2) == 0 AND MOD(TEMPD,2) == 0
					TEMPN = TEMPN/2
					TEMPD = TEMPD/2
				END_WHILE

				IF NUMBER > 0 AND TEMPN > 0
					SWIDTH = itos(NUMBER) +"-"+ftos(TEMPN,0)+"/"+ftos(TEMPD,0)
				ELSE_IF NUMBER > 0 AND TEMPN == 0
					SWIDTH = itos(NUMBER)
				ELSE
					SWIDTH = ftos(TEMPN,0)+"/"+ftos(TEMPD,0)
				END_IF

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+12) SLENGTH
				LENGTH = stof(SLENGTH)
				TEMPD = 1/DENOMENATOR
				TEMPN = ROUND((LENGTH / TEMPD),0)
				NUMBER = FLOOR(TEMPN / DENOMENATOR)
				TEMPN = TEMPN - (NUMBER*DENOMENATOR)
				TEMPD = DENOMENATOR
				WHILE MOD(TEMPN,2) == 0 AND MOD(TEMPD,2) == 0
					TEMPN = TEMPN/2
					TEMPD = TEMPD/2
				END_WHILE

				IF NUMBER > 0 AND TEMPN > 0
					SLENGTH = itos(NUMBER) +"-"+ftos(TEMPN,0)+"/"+ftos(TEMPD,0)
				ELSE_IF NUMBER > 0 AND TEMPN == 0
					SLENGTH = itos(NUMBER)
				ELSE
					SLENGTH = ftos(TEMPN,0)+"/"+ftos(TEMPD,0)
				END_IF

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+13) GRAIN
			IF GRAIN == "0"
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 5 "  "+SWIDTH+"   x   "+SLENGTH
			ELSE_IF GRAIN == "1"
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 5 "  "+SWIDTH+"   x   "+SLENGTH+"  **"
			ELSE_IF GRAIN == "2"
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 5 "  "+SLENGTH+"   x   "+SWIDTH+"  **"
			END_IF
			SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 5 VERTICAL MIDDLE HEIGHT .1

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+14) PVC
			IF PVC <> "0"
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 6 "*"
			END_IF

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+15) DEBUR
			IF DEBUR <> "0"
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 7 "*"
			END_IF

			GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+17) COMMENTS
			IF COMMENTS <> ""
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 8 COMMENTS
			END_IF				

			LINE_INDEX++
			ITEM_INDEX++

			IF ITEM_INDEX <= ITP
				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+20) SHAPE2
				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+2) STOCKTYPE
			END_IF
			
		END_WHILE
	END_WHILE

	IF SHEET_INDEX > 0
		TOTAL_SHEETS = SHEET_INDEX
		SHEET_INDEX = 1
		WHILE SHEET_INDEX <= TOTAL_SHEETS
			SET_DRW_CUR_SHEET refDrawing SHEET_INDEX
			CREATE_DRW_NOTE refDrawing 10.125 7.9375 itos(TOTAL_SHEETS)
			SHEET_INDEX++
		END_WHILE
	END_IF

	!CREATE STOCK REQUISITION

	SHEET_INDEX = TOTAL_SHEETS
	MAX_LINES = 26
	
	IF ITEM_INDEX <= ITP AND STOCKTYPE == 3
		WHILE ITEM_INDEX <= ITP AND STOCKTYPE == 3
			SHEET_INDEX++
			SHEET = SHEET_INDEX - TOTAL_SHEETS
			LINE_INDEX = 1

			INSERT_DRW_SHEET refDrawing SHEET_INDEX
			SET_DRW_CUR_SHEET refDrawing SHEET_INDEX
			SET_DRW_FORMAT refDrawing SHEET_INDEX "lib:stock_req_format.frm"
			CREATE_DRW_TABLE refDrawing ASSEM SHEET_INDEX .4375 6.625  "lib:stock_body.tbl"  BODY

			CREATE_DRW_NOTE refDrawing 1.0625 7.6875 WO_NUM
			CREATE_DRW_NOTE refDrawing 2.8125 7.6875 "&todays_date" HORIZONTAL CENTER

			IF CUSTOMER_NAME == ""
				PRINT "ENTER CUSTOMER NAME"
				USER_INPUT_PARAM STRING CUSTOMER_NAME
			END_IF
			CREATE_DRW_NOTE refDrawing 1.9375 7.125 CUSTOMER_NAME HORIZONTAL CENTER

			IF JOB_NAME == ""
				PRINT "ENTER JOB/PROJECT NAME"
				USER_INPUT_PARAM STRING JOB_NAME
			END_IF

			IF SUB_JOB_NAME == ""
				CREATE_DRW_NOTE refDrawing 5.5 7.125 JOB_NAME HORIZONTAL CENTER
			ELSE
				CREATE_DRW_NOTE refDrawing 5.5 7.209 JOB_NAME HORIZONTAL CENTER
				CREATE_DRW_NOTE refDrawing 5.5 7.042 SUB_JOB_NAME HORIZONTAL CENTER
			END_IF

			CREATE_DRW_NOTE refDrawing 9.5 7.9375 itos(SHEET)

			CREATE_DRW_NOTE refDrawing 9.0625 7.125 ITEM_DESC HORIZONTAL CENTER

			WHILE ITEM_INDEX <= ITP AND LINE_INDEX <= MAX_LINES

				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+19) EMJACDESC
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 2 EMJACDESC
				SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 2 VERTICAL MIDDLE HEIGHT .1

				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+18) MatNuM
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 3 MatNum
				SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 3 HORIZONTAL CENTER VERTICAL MIDDLE HEIGHT .1

				GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+3) QTY
				SET_DRW_TABLE_TEXT refDrawing BODY LINE_INDEX 4 itos(QTY)
				SET_DRW_TABLE_FORMAT refDrawing BODY LINE_INDEX 4 HORIZONTAL CENTER VERTICAL MIDDLE HEIGHT .1

				LINE_INDEX++
				ITEM_INDEX++

				IF ITEM_INDEX < ITP
					GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+18) SHAPE2
					GET_ARRAY_ELEM ITEMS (((ITEM_INDEX-1)*23)+2) STOCKTYPE
PRINT "STOCKTYPE %" STOCKTYPE
				END_IF
			END_WHILE
		END_WHILE

		DECLARE_VARIABLE INTEGER TOTAL_STOCK_SHEETS
		DECLARE_VARIABLE INTEGER STOCK_SHEET_INDEX

		IF SHEET_INDEX > TOTAL_SHEETS
			TOTAL_STOCK_SHEETS = SHEET_INDEX - TOTAL_SHEETS
			STOCK_SHEET_INDEX = 1
			SHEET_INDEX = TOTAL_SHEETS + 1
			WHILE STOCK_SHEET_INDEX <= TOTAL_STOCK_SHEETS
				SET_DRW_CUR_SHEET refDrawing SHEET_INDEX
				CREATE_DRW_NOTE refDrawing 10.125 7.9375 itos(TOTAL_STOCK_SHEETS)
				SHEET_INDEX++
				STOCK_SHEET_INDEX++
			END_WHILE
		END_IF
	END_IF
	
	DECLARE_STRUCT PDF_OPTION option
	option.title = "sample drawing"
	option.author = "DRAFTER"
	option.subject = "detail"
	option.keywords = "SmartAssembly example"
	option.launch_viewer = "FALSE"
	option.color_depth = "Gray"
	option.layer_mode = "None"
	EXPORT_DRW_PDF refDrawing option WO_NUM
	
END_IF
SET_CONFIG_OPTION "override_store_back" OSB

SAVE_MDL refDrawing
EXCEL_SAVE_DOCUMENT BOM_DOCUMENT_NAME

! ERASE_NOT_DISPLAYED

END_ASM_DESCR
