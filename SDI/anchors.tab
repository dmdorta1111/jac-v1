BEGIN_GUI_DESCR

	CHECKBOX_PARAM INTEGER HELP "YES/NO"

	IF HELP == 1
		GLOBAL_PICTURE ANCHORS.GIF
	END_IF

	SHOW_PARAM STRING ITEM_NUM
	SHOW_PARAM DOUBLE JD
	SHOW_PARAM DOUBLE JAMB_CTR
	SHOW_PARAM DOUBLE STD_ANCHOR_CTR

	SHOW_PARAM STRING ANCHOR_TYPE
	SHOW_PARAM STRING ANCHOR_DESC
	SHOW_PARAM STRING FLOOR_CLIPS
	SHOW_PARAM INTEGER DUST_BOXES
	SHOW_PARAM INTEGER BASE_CLIPS

	IF ANCHOR_TYPE == 8 OR ANCHOR_TYPE == 9 OR ANCHOR_TYPE == 11 
		USER_INPUT_PARAM DOUBLE ANCHOR_CTR REQUIRED DECIMAL_PLACES 4
	ELSE	
		ANCHOR_CTR = JD/2
	END_IF
	
	RADIOBUTTON_PARAM INTEGER ANCHOR_TYPE  "NONE"\
								"GALVANIZED WIRE"\
								"STAINLESS WIRE"\
								"LOOSE T"\
								"LOOSE STUD"\
								"WELDED STUD STRAP"\
								"HD WELDED STUD"\
								"WELDED STUD"\
								"P&D EWA"\
								"CONCEALED EWA"\	
								"ADJUSTABLE MASONARY"\
								"COMPRESSION"

	RADIOBUTTON_PARAM INTEGER FLOOR_CLIPS_ "NONE" "FIXED" "ADJUSTABLE" "HVY DUTY" "CUSTOM" "INVERTED"
						
	RADIOBUTTON_PARAM INTEGER BASE_CLIPS "NONE" "BASE CLIPS" "CEWA" "P&D EWA" "FACE HOLES"

	IF CUSTOM_ANCHORS == 1
		ANCHOR_TYPE = 99
		USER_INPUT_PARAM STRING ANCHOR_DESC
	END_IF

	IF ANCHOR_TYPE == 8 OR ANCHOR_TYPE == 9 OR ANCHOR_TYPE == 99 OR BASE_CLIPS == 2
		CHECKBOX_PARAM INTEGER ANCHOR_BOLTS
	END_IF	

	CHECKBOX_PARAM INTEGER DUST_BOXES "YES/NO"
	
	IF ANCHOR_TYPE == 8 OR ANCHOR_TYPE == 9
		CHECKBOX_PARAM INTEGER GROUT_HOLES "YES/NO"
		IF GROUT_HOLES == 1
			USER_INPUT_PARAM DOUBLE GROUT_HOLE_DIA		
		END_IF
	ELSE
		GROUT_HOLES = 0
		GROUT_HOLE_DIA = 0
	END_IF

	CHECKBOX_PARAM INTEGER BOTTOM_ONLY "YES/NO"
	
	IF ANCHOR_TYPE == 8 OR ANCHOR_TYPE == 9 OR ANCHOR_TYPE == 11
		CHECKBOX_PARAM INTEGER HEAD_ANCHORS
	END_IF
	
	IF FRAME_ELEVATION == 5 AND TRANSOM_SECTION <> SECTION
		USER_INPUT_PARAM DOUBLE TRANSOM_ANCHOR_CENTER REQUIRED
	END_IF

	USER_INPUT_PARAM DOUBLE ANCHOR_RECESS REQUIRED
	
	IF ANCHOR_TYPE == 4 OR ANCHOR_TYPE == 5 OR ANCHOR_TYPE == 6 OR ANCHOR_TYPE == 7
		USER_INPUT_PARAM DOUBLE DRYWALL_ALLOWANCE REQUIRED
	END_IF
	
	USER_INPUT_PARAM DOUBLE ANCHOR_JT_DIST	
	USER_INPUT_PARAM DOUBLE ANCHOR_JB_DIST	
	USER_INPUT_PARAM DOUBLE ANCHOR_HDJ_DIST
	USER_INPUT_PARAM DOUBLE ANCHOR_HMAX

	IF ANCHOR_JMAX == 0 OR (ANCHOR_JMAX > 0 AND ANCHOR_QTY > 0)
		USER_INPUT_PARAM INTEGER ANCHOR_QTY
	END_IF
	IF ANCHOR_QTY == 0 OR (ANCHOR_JMAX > 0 AND ANCHOR_QTY > 0)
		USER_INPUT_PARAM DOUBLE ANCHOR_JMAX
	END_IF
	
	
	IF (ANCHOR_TYPE == 8 OR ANCHOR_TYPE == 9 OR ANCHOR_TYPE == 11) AND HEAD_ANCHORS == 1
		IF ANCHOR_HMAX == 0 OR (ANCHOR_HMAX > 0 AND HEAD_ANCHOR_QTY > 0)
			USER_INPUT_PARAM INTEGER HEAD_ANCHOR_QTY
		END_IF
		IF HEAD_ANCHOR_QTY == 0 OR (ANCHOR_HMAX > 0 AND HEAD_ANCHOR_QTY > 0)
		END_IF
	END_IF
		
	IF ANCHOR_TYPE == 8 OR ANCHOR_TYPE == 9
		RADIOBUTTON_PARAM INTEGER ANCHOR_SURF "SOFFIT" "RABBET"
		RADIOBUTTON_PARAM INTEGER ANCHOR_BOLT_TYPE "EXPANSION" "LAG" "MACHINE"
		IF ANCHOR_TYPE == 9
			RADIOBUTTON_PARAM INTEGER ANCHOR_STRAP_TYPE "FLAT" "CHANNEL"
		END_IF
	END_IF

END_GUI_DESCR

BEGIN_ASM_DESCR
	DECLARE_VARIABLE INTEGER OPERATION	
	DECLARE_VARIABLE INTEGER ANCHOR_TYPE
	DECLARE_VARIABLE STRING ANCHOR_DESC
	DECLARE_VARIABLE INTEGER ANCHOR_BOLTS
	DECLARE_VARIABLE DOUBLE ANCHOR_CTR
	DECLARE_VARIABLE DOUBLE ANCHOR_RECESS
	DECLARE_VARIABLE INTEGER SECTION
	DECLARE_VARIABLE INTEGER FLUSH_BOLTS
	DECLARE_VARIABLE DOUBLE JD
	DECLARE_VARIABLE DOUBLE JOH
	DECLARE_VARIABLE DOUBLE JOW
	DECLARE_VARIABLE DOUBLE JAMB_CTR
	DECLARE_VARIABLE DOUBLE RABBET
	DECLARE_VARIABLE DOUBLE XRABBET
	DECLARE_VARIABLE DOUBLE MINIMUM_SOFFIT
	DECLARE_VARIABLE DOUBLE SOFFIT
	DECLARE_VARIABLE INTEGER DUST_BOXES
	DECLARE_VARIABLE STRING FLOOR_CLIPS
	DECLARE_VARIABLE INTEGER FLOOR_CLIPS_
	DECLARE_VARIABLE STRING SUB_TYPE	
	DECLARE_VARIABLE INTEGER FLOOR_CLIP_GAUGE	
	DECLARE_VARIABLE INTEGER BASE_CLIPS
	DECLARE_VARIABLE DOUBLE TRANSOM_STOPP
	DECLARE_VARIABLE DOUBLE ANCHOR_JT_DIST	
	DECLARE_VARIABLE DOUBLE ANCHOR_JB_DIST	
	DECLARE_VARIABLE INTEGER ANCHOR_QTY
	DECLARE_VARIABLE INTEGER HEAD_ANCHORS
	DECLARE_VARIABLE INTEGER HEAD_ANCHOR_QTY
	DECLARE_VARIABLE DOUBLE ANCHOR_SPACING	
	DECLARE_VARIABLE DOUBLE ANCHOR_JMAX
	DECLARE_VARIABLE INTEGER TRANSOM_SECTION
	DECLARE_VARIABLE INTEGER FRAME_ELEVATION
	DECLARE_VARIABLE INTEGER CUSTOM_ANCHORS
	DECLARE_VARIABLE DOUBLE STD_ANCHOR_CTR
	DECLARE_VARIABLE INTEGER ANCHOR_SURF
	DECLARE_VARIABLE INTEGER ANCHOR_BOLT_TYPE
	DECLARE_VARIABLE INTEGER ANCHOR_STRAP_TYPE
	DECLARE_VARIABLE INTEGER GROUT_HOLES
	DECLARE_VARIABLE INTEGER BOTTOM_ONLY
	DECLARE_VARIABLE DOUBLE GROUT_HOLE_DIA
	DECLARE_VARIABLE DOUBLE HEAD_ANCHOR_SPACING
	DECLARE_VARIABLE DOUBLE DRYWALL_ALLOWANCE
	DECLARE_VARIABLE DOUBLE BOTTOM_ANCHOR
	DECLARE_VARIABLE DOUBLE ANCHOR_HDJ_DIST
	DECLARE_VARIABLE DOUBLE ANCHOR_HMAX
	DECLARE_VARIABLE DOUBLE SIDE_LITE_JOW
	DECLARE_VARIABLE DOUBLE SIDE_LITE_MULLION
	DECLARE_VARIABLE INTEGER SIDE_LITE_QTY
	
	
	DECLARE_REFERENCE COMP
	
	JAMB_CTR = JD/2
	
	IF SECTION == 0 
		STD_ANCHOR_CTR = JD/2
	ELSE
		STD_ANCHOR_CTR = RABBET + SOFFIT/2
	END_IF
	
	IF OPERATION == 0

		IF FLOOR_CLIPS == "NONE"
			FLOOR_CLIPS_ = 0
		ELSE_IF FLOOR_CLIPS == "FIXED"
			FLOOR_CLIPS_ = 1
		ELSE_IF FLOOR_CLIPS == "ADJUSTABLE"
			FLOOR_CLIPS_ = 2
		ELSE_IF FLOOR_CLIPS == "HEAVY DUTY"
			FLOOR_CLIPS_ = 3
		ELSE_IF FLOOR_CLIPS == "CUSTOM"
			FLOOR_CLIPS_ = 4
		ELSE_IF FLOOR_CLIPS == "INVERTED"
			FLOOR_CLIPS_ = 5
		END_IF
	
		IF CUSTOM_ANCHORS == 1
			CONFIG_ELEM NO_TABLES 1200 1200
		ELSE
			CONFIG_ELEM
		END_IF

		WHILE ANCHOR_QTY > 0 AND ANCHOR_JMAX > 0 AND ANCHOR_QTY <> ceil((JOH - ANCHOR_JB_DIST - ANCHOR_JT_DIST)/ANCHOR_JMAX)+1
			MESSAGE_BOX "ANCHOR QTY AND MAXIMUM ANCHOR SPACING ARE IN CONFLICT"
			PRINT "ANCHOR QTY %" ANCHOR_QTY
			PRINT " MAXIMUM SPACING %" ANCHOR_JMAX
			PRINT " ENTER Q TO USE QTY OR M TO USE MAXIMUM SPACING"
			USER_INPUT_PARAM STRING OPTION
			IF OPTION == "Q"
				ANCHOR_JMAX = 0
			ELSE_IF OPTION == "M"
				ANCHOR_QTY = 0
			END_IF
		END_WHILE
 	
		IF ANCHOR_QTY > 0 AND ANCHOR_JMAX > 0
			ANCHOR_SPACING = (JOH - ANCHOR_JB_DIST - ANCHOR_JT_DIST) / (ANCHOR_QTY-1)
		END_IF
				
		IF ANCHOR_QTY == 0 AND ANCHOR_JMAX == 0
			ANCHOR_TYPE = 0
		ELSE_IF ANCHOR_QTY == 0 AND ANCHOR_JMAX > 0 AND ANCHOR_JB_DIST > 0
			ANCHOR_QTY = ceil((JOH - ANCHOR_JB_DIST - ANCHOR_JT_DIST)/ANCHOR_JMAX)+1
			ANCHOR_SPACING = (JOH - ANCHOR_JB_DIST - ANCHOR_JT_DIST) / (ANCHOR_QTY-1)
			BOTTOM_ANCHOR = ANCHOR_JB_DIST
		ELSE_IF ANCHOR_QTY == 0 AND ANCHOR_JMAX > 0 AND ANCHOR_JB_DIST == 0
			ANCHOR_QTY = ceil((JOH - ANCHOR_JT_DIST)/ANCHOR_JMAX)
			ANCHOR_SPACING = (JOH  - ANCHOR_JT_DIST) / (ANCHOR_QTY)
			BOTTOM_ANCHOR = ANCHOR_SPACING
		ELSE_IF ANCHOR_QTY > 0 AND ANCHOR_JMAX == 0 AND ANCHOR_JB_DIST > 0
			ANCHOR_JMAX = ((JOH - ANCHOR_JB_DIST - ANCHOR_JT_DIST)/ANCHOR_QTY-1)
			ANCHOR_SPACING = (JOH - ANCHOR_JB_DIST - ANCHOR_JT_DIST) / (ANCHOR_QTY-1)
			BOTTOM_ANCHOR = ANCHOR_JB_DIST
		ELSE_IF ANCHOR_QTY > 0 AND ANCHOR_JMAX == 0 AND ANCHOR_JB_DIST == 0
			ANCHOR_JMAX = ((JOH - ANCHOR_JT_DIST)/ANCHOR_QTY)
			ANCHOR_SPACING = (JOH  - ANCHOR_JT_DIST) / (ANCHOR_QTY)
			BOTTOM_ANCHOR = ANCHOR_SPACING
		END_IF


		
		! IF ANCHOR_JB_DIST > 0
			! ! ANCHOR_QTY = ceil((JOH - ANCHOR_JB_DIST - ANCHOR_JT_DIST)/ANCHOR_JMAX)+1
			! ANCHOR_SPACING = (JOH - ANCHOR_JB_DIST - ANCHOR_JT_DIST) / (ANCHOR_QTY-1)
			! BOTTOM_ANCHOR = ANCHOR_JB_DIST
		! ELSE_IF ANCHOR_JB_DIST == 0
			! ! ANCHOR_QTY = ceil((JOH - ANCHOR_JT_DIST)/ANCHOR_JMAX)
			! ANCHOR_SPACING = (JOH  - ANCHOR_JT_DIST) / (ANCHOR_QTY)
			! BOTTOM_ANCHOR = ANCHOR_SPACING
		! END_IF
		
		IF FRAME_ELEVATION == 31
			JOW = JOW+SIDE_LITE_MULLION+SIDE_LITE_JOW
		ELSE_IF FRAME_ELEVATION == 32
			JOW = JOW+SIDE_LITE_MULLION+SIDE_LITE_JOW+SIDE_LITE_MULLION+SIDE_LITE_JOW
		END_IF
		
		! JOW = JOW + (SIDE_LITE_JOW + SIDE_LITE_QTY) + (SIDE_LITE_MULLION * SIDE_LITE_QTY)
		
		IF ANCHOR_TYPE == 4 OR ANCHOR_TYPE == 6 OR ANCHOR_TYPE == 7
			IF JOW > 48
				HEAD_ANCHOR_QTY = ceil((JOW-ANCHOR_HDJ_DIST-ANCHOR_HDJ_DIST)/ANCHOR_HMAX)+1
				HEAD_ANCHORS = 1
			ELSE
				HEAD_ANCHORS = 0
				HEAD_ANCHOR_QTY = 0
			END_IF
		ELSE_IF (ANCHOR_TYPE == 8 OR ANCHOR_TYPE == 9 OR ANCHOR_TYPE == 11) AND HEAD_ANCHORS == 1
			IF HEAD_ANCHOR_QTY == 0 AND ANCHOR_HMAX > 0
				HEAD_ANCHOR_QTY = ceil((JOW-ANCHOR_HDJ_DIST-ANCHOR_HDJ_DIST)/ANCHOR_HMAX)+1
			END_IF
			IF ANCHOR_HMAX == 0 AND HEAD_ANCHOR_QTY > 0
				ANCHOR_HMAX = ((JOW - ANCHOR_HDJ_DIST - ANCHOR_HDJ_DIST) / (HEAD_ANCHOR_QTY-1))
			END_IF
			
			! IF JOW > 48 AND JOW <= 72 AND (FLUSH_BOLTS <> 1 AND FLUSH_BOLTS <> 3)
				! HEAD_ANCHORS = 1
				! HEAD_ANCHOR_QTY = 1
			! ELSE_IF JOW > 72 AND JOW <= 96 AND (FLUSH_BOLTS <> 1 AND FLUSH_BOLTS <> 3)
				! HEAD_ANCHORS = 1
				! HEAD_ANCHOR_QTY = 2
			! ELSE_IF JOW > 96 AND JOW <= 120 AND (FLUSH_BOLTS <> 1 AND FLUSH_BOLTS <> 3)
				! HEAD_ANCHORS = 1
				! HEAD_ANCHOR_QTY = 3
			! ELSE_IF JOW > 120 AND (FLUSH_BOLTS <> 1 AND FLUSH_BOLTS <> 3)
				! HEAD_ANCHOR_QTY = ceil((JOW - 120)/24)+4
			! ELSE_IF SUB_TYPE == "P" AND (FLUSH_BOLTS == 1 OR FLUSH_BOLTS == 3)  AND (ANCHOR_TYPE == 8 OR ANCHOR_TYPE == 9)
				! HEAD_ANCHORS = 1
				! HEAD_ANCHOR_QTY = 1
			! END_IF
		ELSE
			HEAD_ANCHORS = 0
			HEAD_ANCHOR_QTY = 0	
		END_IF

		IF ANCHOR_TYPE == 0	
			ANCHOR_DESC = "NONE"
			ANCHOR_MDL = ""
		END_IF
		IF ANCHOR_TYPE == 1	
			ANCHOR_DESC = 	"WIRE"
			ANCHOR_MDL = 	"anchor_wire_galv.prt"
		END_IF
		IF ANCHOR_TYPE == 2	
			ANCHOR_DESC = 	"STAINLESS WIRE"
			ANCHOR_MDL = 	"anchor_wire_ss.prt"
		END_IF
		IF ANCHOR_TYPE == 3	
			ANCHOR_DESC = 	"LOOSE T"
			ANCHOR_MDL = 	"anchor_loose_t.asm"
		END_IF
		IF ANCHOR_TYPE == 4	
			ANCHOR_DESC = 	"LOOSE STUD"
			ANCHOR_MDL = 	"anchor_loose_stud.prt"
		END_IF
		IF ANCHOR_TYPE == 5	
			ANCHOR_DESC = 	"WELDED STUD STRAP"
			ANCHOR_MDL = 	"anchor_weld_stud_strap.prt"
		END_IF
		IF ANCHOR_TYPE == 6	
			ANCHOR_DESC = 	"HD WELDED STUD"
			ANCHOR_MDL = 	"anchor_welded_hd.asm"
		END_IF
		IF ANCHOR_TYPE == 7	
			ANCHOR_DESC = 	"WELDED STUD"	
			ANCHOR_MDL = 	"anchor_welded_stud.prt"
		END_IF
		IF ANCHOR_TYPE == 8	
			ANCHOR_DESC = 	"P&D EWA"
			ANCHOR_MDL = 	"anchor_pd_ewa.asm"
		END_IF
		IF ANCHOR_TYPE == 9	
			ANCHOR_DESC = 	"CONCEALED EWA"	
			ANCHOR_MDL = 	"anchor_concealed_ewa.asm"
		END_IF
		IF ANCHOR_TYPE == 10	
			ANCHOR_DESC = 	"ADJUSTABLE MASONARY"
			ANCHOR_MDL = 	"anchor_adjustable.asm"
		END_IF
		IF ANCHOR_TYPE == 11	
			ANCHOR_DESC = 	"COMPRESSION"
			ANCHOR_MDL = 	"anchor_compression.asm"
		END_IF

		IF FLOOR_CLIPS_ == 0
			FLOOR_CLIPS = "NONE"
		ELSE_IF FLOOR_CLIPS_ == 1
			FLOOR_CLIPS = "FIXED"
		ELSE_IF FLOOR_CLIPS_ == 2
			FLOOR_CLIPS = "ADJUSTABLE"
		ELSE_IF FLOOR_CLIPS_ == 3
			FLOOR_CLIPS = "HEAVY DUTY"
		ELSE_IF FLOOR_CLIPS_ == 4
			FLOOR_CLIPS = "CUSTOM"
		ELSE_IF FLOOR_CLIPS_ == 5
			FLOOR_CLIPS = "INVERTED"
		END_IF
	END_IF

	IF OPERATION == 2
		! BEGIN FRAME PREPS - FLOOR CLIPS & ANCHORS
		DECLARE_ARRAY ANCHORS_ARRAY
		DECLARE_ARRAY HEAD_ANCHORS_ARRAY
		DECLARE_VARIABLE 	INTEGER ANCHOR_INDEX
		DECLARE_VARIABLE	DOUBLE	ANCHOR_SURFACE_OFFSET
					
		SEARCH_MDL_REF FRAME_ASM CSYS "ANCHORS" ATTACH
		
		IF FRAME_ELEVATION == 31
			JOW = JOW+SIDE_LITE_MULLION+SIDE_LITE_JOW
		ELSE_IF FRAME_ELEVATION == 32
			JOW = JOW+SIDE_LITE_MULLION+SIDE_LITE_JOW+SIDE_LITE_MULLION+SIDE_LITE_JOW
		END_IF
		
		CREATE_UDF udf\csys FRAME_ASM
			UDF_REF ATTACH ATTACH
			UDF_DIM	ROTX 180
			UDF_DIM	ROTY 180
			UDF_DIM	ROTZ 0
			UDF_DIM	LOCX ((JOW/2) + FR_THICKNESS + .03)
			UDF_DIM	LOCY BOTTOM_ANCHOR
			UDF_DIM	LOCZ -ANCHOR_CTR
			UDF_EXP_REF ATTACH CSYS 0
		END_CREATE_UDF
		ADD_ARRAY_ELEM ANCHORS_ARRAY ATTACH

		IF BOTTOM_ONLY == 0
			ANCHOR_INDEX = 2
			WHILE ANCHOR_INDEX <= ANCHOR_QTY
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX 0
					UDF_DIM	LOCY -ANCHOR_SPACING
					UDF_DIM	LOCZ 0
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
				ADD_ARRAY_ELEM ANCHORS_ARRAY ATTACH

				ANCHOR_INDEX ++
			END_WHILE
		END_IF
		
		SEARCH_MDL_REF FRAME_ASM CSYS "ANCHORS" ATTACH
		CREATE_UDF udf\csys FRAME_ASM
			UDF_REF ATTACH ATTACH
			UDF_DIM	ROTX 180
			UDF_DIM	ROTY 180
			UDF_DIM	ROTZ 180
			UDF_DIM	LOCX -((JOW/2) + FR_THICKNESS + .03)
			UDF_DIM	LOCY BOTTOM_ANCHOR
			UDF_DIM	LOCZ -ANCHOR_CTR
			UDF_EXP_REF ATTACH CSYS 0
		END_CREATE_UDF
		ADD_ARRAY_ELEM ANCHORS_ARRAY ATTACH

		IF BOTTOM_ONLY == 0
			ANCHOR_INDEX = 2
			WHILE ANCHOR_INDEX <= ANCHOR_QTY
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX 0
					UDF_DIM	LOCY ANCHOR_SPACING
					UDF_DIM	LOCZ 0
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
				ADD_ARRAY_ELEM ANCHORS_ARRAY ATTACH
				ANCHOR_INDEX ++
			END_WHILE
		END_IF

		IF BOTTOM_ONLY == 0 AND HEAD_ANCHORS == 1 AND ANCHOR_TYPE <> 8 AND ANCHOR_TYPE <> 9 AND ANCHOR_TYPE <> 11
			SEARCH_MDL_REF FRAME_ASM CSYS "ANCHORS" ATTACH
			CREATE_UDF udf\csys FRAME_ASM
				UDF_REF ATTACH ATTACH
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 270
				UDF_DIM	LOCX (JOW/2) - ANCHOR_HDJ_DIST !JOW/(HEAD_ANCHOR_QTY*2)
				UDF_DIM	LOCY JOH + FR_THICKNESS + .03
				UDF_DIM	LOCZ -ANCHOR_CTR
				UDF_EXP_REF ATTACH CSYS 0
			END_CREATE_UDF
			ADD_ARRAY_ELEM HEAD_ANCHORS_ARRAY ATTACH

			HEAD_ANCHOR_SPACING = (JOW-ANCHOR_HDJ_DIST-ANCHOR_HDJ_DIST) / (HEAD_ANCHOR_QTY-1)
			ANCHOR_INDEX = 2
			WHILE ANCHOR_INDEX <= HEAD_ANCHOR_QTY
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX 0
					UDF_DIM	LOCY -HEAD_ANCHOR_SPACING
					UDF_DIM	LOCZ 0
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
				ADD_ARRAY_ELEM HEAD_ANCHORS_ARRAY ATTACH
				ANCHOR_INDEX ++
			END_WHILE	
		END_IF

		IF BOTTOM_ONLY == 0 AND HEAD_ANCHORS == 1 AND (ANCHOR_TYPE == 8 OR ANCHOR_TYPE == 9 OR ANCHOR_TYPE == 11)
			SEARCH_MDL_REF FRAME_ASM CSYS "ANCHORS" ATTACH
			CREATE_UDF udf\csys FRAME_ASM
				UDF_REF ATTACH ATTACH
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 270
				UDF_DIM	LOCX (JOW/2) - ANCHOR_HDJ_DIST
				UDF_DIM	LOCY JOH + FR_THICKNESS + .03
				UDF_DIM	LOCZ -ANCHOR_CTR
				UDF_EXP_REF ATTACH CSYS 0
			END_CREATE_UDF
			ADD_ARRAY_ELEM HEAD_ANCHORS_ARRAY ATTACH

			HEAD_ANCHOR_SPACING = (JOW-ANCHOR_HDJ_DIST-ANCHOR_HDJ_DIST) / (HEAD_ANCHOR_QTY-1)
			ANCHOR_INDEX = 2
			WHILE ANCHOR_INDEX <= HEAD_ANCHOR_QTY
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX 0
					UDF_DIM	LOCY -HEAD_ANCHOR_SPACING
					UDF_DIM	LOCZ 0
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
				ADD_ARRAY_ELEM HEAD_ANCHORS_ARRAY ATTACH
				ANCHOR_INDEX ++
			END_WHILE	
		END_IF
		
		IF ANCHOR_MDL == "*wire*"
			RETRIEVE_MDL ANCHOR_MDL ANCHOR
			SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
				FOR ATTACH REF ARRAY ANCHORS_ARRAY
					ASSEMBLE ANCHOR FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				END_FOR
				
			IF HEAD_ANCHORS == 1
				FOR ATTACH REF ARRAY HEAD_ANCHORS_ARRAY
					ASSEMBLE ANCHOR FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				END_FOR
			END_IF
		END_IF

		IF ANCHOR_MDL == "*adjust*"
			RETRIEVE_MDL ANCHOR_MDL ANCHOR
			SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
				FOR ATTACH REF ARRAY ANCHORS_ARRAY
					ASSEMBLE ANCHOR FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				END_FOR
			IF HEAD_ANCHORS == 1
				FOR ATTACH REF ARRAY HEAD_ANCHORS_ARRAY
					ASSEMBLE ANCHOR FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				END_FOR
			END_IF
		END_IF
		
		IF ANCHOR_MDL == "*loose_t*"
		
			IF JD <= 10
				RETRIEVE_MDL ANCHOR_MDL COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			ELSE_IF JD > 10
				RETRIEVE_MDL ANCHOR_LOOSE_T_DOUBLE.ASM COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			END_IF
			
			GET_ARRAY_ELEM ANCHORS_ARRAY 0 ATTACH
				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE

				SET_MDL_PARAM COMP "STOCKTYPE" 1
				SET_MDL_PARAM COMP "EMJACNUM" ""
				IF JD <= 8
					SET_MDL_PARAM COMP "LENGTH" 10
				ELSE
					SET_MDL_PARAM COMP "LENGTH" JD + 2	
				END_IF

				SEARCH_MDL_REF ALLOW_SUPPRESSED COMP COMPONENT FID:41 refFeat
				SET_FEATURE_STATE refFeat RESUMED

				SEARCH_MDL_REF ALLOW_SUPPRESSED COMP FEATURE FID:51 refFeat
				SET_FEATURE_STATE refFeat SUPPRESSED
				
				REGEN_MDL COMP FORCE
				REGEN_MDL COMP FORCE

			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX
					
			DELETE_ARRAY_ELEM ANCHORS_ARRAY 0
			SEARCH_MDL_REF FRAME_ASM COMPONENT "*loose_t*" ANCHOR
			
			SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
				FOR ATTACH REF ARRAY ANCHORS_ARRAY
					ASSEMBLE ANCHOR FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				END_FOR
				
			IF HEAD_ANCHORS == 1
				FOR ATTACH REF ARRAY HEAD_ANCHORS_ARRAY
					ASSEMBLE ANCHOR FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				END_FOR
			END_IF
		END_IF

		IF ANCHOR_MDL == "*loose_stud*"
			RETRIEVE_MDL ANCHOR_MDL COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			GET_ARRAY_ELEM ANCHORS_ARRAY 0 ATTACH
				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE

				SET_MDL_PARAM COMP "STOCKTYPE" 1
				SET_MDL_PARAM COMP  "XX_FR_THICKNESS" FR_THICKNESS
				SET_MDL_PARAM COMP  "XX_FACEE" FACEE
				SET_MDL_PARAM COMP  "RETURN" RETURN
				SET_MDL_PARAM COMP  "XRETRUN" XRETRUN
				SET_MDL_PARAM COMP  "ANCHOR_RECESS" ANCHOR_RECESS
				SET_MDL_PARAM COMP "ITEMNUM" ""

				IF JD >= 5.75 AND JD <= 5.875
					SET_MDL_PARAM COMP "XX_JD" 5.75
				ELSE
					SET_MDL_PARAM COMP "XX_JD" JD
				END_IF
				
			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX
					
			DELETE_ARRAY_ELEM ANCHORS_ARRAY 0
			SEARCH_MDL_REF FRAME_ASM COMPONENT "*loose_stud*" ANCHOR
			
			SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
				FOR ATTACH REF ARRAY ANCHORS_ARRAY
					ASSEMBLE ANCHOR FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				END_FOR
				
				IF HEAD_ANCHORS == 1 AND HEAD < FACEE
					RETRIEVE_MDL ANCHOR_MDL COMP
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					GET_ARRAY_ELEM HEAD_ANCHORS_ARRAY 0 ATTACH
						ASSEMBLE COMP FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE

						SET_MDL_PARAM COMP "STOCKTYPE" 1
						SET_MDL_PARAM COMP  "XX_FR_THICKNESS" FR_THICKNESS
						SET_MDL_PARAM COMP  "XX_FACEE" HEAD
						SET_MDL_PARAM COMP  "RETURN" RETURN
						SET_MDL_PARAM COMP  "XRETRUN" XRETRUN
						SET_MDL_PARAM COMP  "ANCHOR_RECESS" ANCHOR_RECESS
						SET_MDL_PARAM COMP "ITEMNUM" ""

						IF JD >= 5.75 AND JD <= 5.875
							SET_MDL_PARAM COMP "XX_JD" 5.75
						ELSE
							SET_MDL_PARAM COMP "XX_JD" JD
						END_IF
						
					CALL_EX instantiate.tab
						VAR_IN	COMP	COMP
					END_CALL_EX
							
					DELETE_ARRAY_ELEM ANCHORS_ARRAY 0
					SEARCH_MDL_REF FRAME_ASM COMPONENT "*loose_stud*" ANCHOR
					
					SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
						FOR ATTACH REF ARRAY ANCHORS_ARRAY
							ASSEMBLE ANCHOR FRAME_ASM
								CSYS ATTACH PLACEMENT
							END_ASSEMBLE
						END_FOR
				ELSE_IF HEAD_ANCHORS == 1 AND HEAD >= FACEE
					FOR ATTACH REF ARRAY HEAD_ANCHORS_ARRAY
						ASSEMBLE ANCHOR FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
					END_FOR
				END_IF


				SEARCH_MDL_REFS FRAME_ASM COMPONENT "*loose_stud*" ANCHORS
				FOR ANCHOR REF ARRAY ANCHORS
					SET_ON_LAYER ANCHOR "COMPONENTS"
				END_FOR
				
				RETRIEVE_MDL ANCHOR_MDL COMP
								
				SET_MDL_PARAM COMP "STOCKTYPE" 1
				SET_MDL_PARAM COMP  "XX_FR_THICKNESS" FR_THICKNESS
				SET_MDL_PARAM COMP  "XX_FACEE" FACEE
				SET_MDL_PARAM COMP  "FACEE" FACEE
				SET_MDL_PARAM COMP  "XFACEE" XFACEE				
				SET_MDL_PARAM COMP  "RETURN" RETURN
				SET_MDL_PARAM COMP  "XRETRUN" XRETRUN
				SET_MDL_PARAM COMP  "ANCHOR_RECESS" ANCHOR_RECESS
				SET_MDL_PARAM COMP "ITEMNUM" "ANCHOR_"+ITEM_NUM

				IF JD >= 5.75 AND JD <= 5.875
					SET_MDL_PARAM COMP "XX_JD" 5.75
				ELSE
					SET_MDL_PARAM COMP "XX_JD" JD
				END_IF
				
				REGEN_MDL COMP FORCE
				REGEN_MDL COMP FORCE
				
				CALL_EX instantiate.tab
					VAR_IN	COMP	COMP
				END_CALL_EX

				RETRIEVE_MDL ANCHOR_MDL ANCHOR
				DECLARE_VARIABLE INTEGER EXISTING_ANCHOR
				DECLARE_VARIABLE INTEGER REFANCHOR
				GET_FAMINSTANCE_NAMES ANCHOR arrayAnchors
				FOR ANCH REF REVERSE_ARRAY arrayAnchors
					EXISTING_ANCHOR = strfind(ANCH,ITEM_NUM)
					IF EXISTING_ANCHOR <> -1
						REFANCHOR = ANCH
						BREAK
					END_IF
				END_FOR
			
				GET_REF_FAMINSTANCE ANCHOR &REFANCHOR REFINST
				IF SECTION == 0
					SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_0" refFeat
					SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
				END_IF
				IF SECTION == 1
					SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_1" refFeat
					SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
				END_IF
				IF SECTION == 2 OR SECTION == 21
					SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_2" refFeat
					SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
				END_IF
		END_IF

		
		IF ANCHOR_MDL == "*weld_stud_strap*"
			RETRIEVE_MDL ANCHOR_MDL COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			GET_ARRAY_ELEM ANCHORS_ARRAY 0 ATTACH
				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE

				SET_MDL_PARAM COMP "STOCKTYPE" 1
				SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
				SET_MDL_PARAM COMP "XX_FACEE" FACEE
				SET_MDL_PARAM COMP "RETURN" RETURN
				SET_MDL_PARAM COMP "XRETRUN" XRETRUN
				SET_MDL_PARAM COMP "ANCHOR_RECESS" ANCHOR_RECESS
				SET_MDL_PARAM COMP "DRYWALL_ALLOWANCE" DRYWALL_ALLOWANCE
				SET_MDL_PARAM COMP "ITEMNUM" ""
				SET_MDL_PARAM COMP "XX_JD" JD
				
			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX
					
			DELETE_ARRAY_ELEM ANCHORS_ARRAY 0
			SEARCH_MDL_REF FRAME_ASM COMPONENT "*weld_stud*" ANCHOR
			
			SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
				FOR ATTACH REF ARRAY ANCHORS_ARRAY
					ASSEMBLE ANCHOR FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				END_FOR
				
				IF HEAD_ANCHORS == 1 AND HEAD < FACEE
					RETRIEVE_MDL ANCHOR_MDL COMP
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					GET_ARRAY_ELEM HEAD_ANCHORS_ARRAY 0 ATTACH
						ASSEMBLE COMP FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE

						SET_MDL_PARAM COMP "STOCKTYPE" 1
						SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
						SET_MDL_PARAM COMP "XX_FACEE" HEAD
						SET_MDL_PARAM COMP "RETURN" RETURN
						SET_MDL_PARAM COMP "XRETRUN" XRETRUN
						SET_MDL_PARAM COMP "ANCHOR_RECESS" ANCHOR_RECESS
						SET_MDL_PARAM COMP "DRYWALL_ALLOWANCE" DRYWALL_ALLOWANCE
						SET_MDL_PARAM COMP "ITEMNUM" ""
						SET_MDL_PARAM COMP "XX_JD" JD
						
					CALL_EX instantiate.tab
						VAR_IN	COMP	COMP
					END_CALL_EX
							
					DELETE_ARRAY_ELEM ANCHORS_ARRAY 0
					SEARCH_MDL_REF FRAME_ASM COMPONENT "*weld_stud*" ANCHOR
					
					SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
						FOR ATTACH REF ARRAY ANCHORS_ARRAY
							ASSEMBLE ANCHOR FRAME_ASM
								CSYS ATTACH PLACEMENT
							END_ASSEMBLE
						END_FOR
				ELSE_IF HEAD_ANCHORS == 1 AND HEAD >= FACEE
					FOR ATTACH REF ARRAY HEAD_ANCHORS_ARRAY
						ASSEMBLE ANCHOR FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
					END_FOR
				END_IF


				SEARCH_MDL_REFS FRAME_ASM COMPONENT "*weld_stud*" ANCHORS
				FOR ANCHOR REF ARRAY ANCHORS
					SET_ON_LAYER ANCHOR "COMPONENTS"
				END_FOR
				
				RETRIEVE_MDL ANCHOR_MDL COMP
								
				SET_MDL_PARAM COMP "STOCKTYPE" 1
				SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
				SET_MDL_PARAM COMP "XX_FACEE" FACEE
				SET_MDL_PARAM COMP "FACEE" FACEE
				SET_MDL_PARAM COMP "XFACEE" XFACEE				
				SET_MDL_PARAM COMP "RETURN" RETURN
				SET_MDL_PARAM COMP "XRETRUN" XRETRUN
				SET_MDL_PARAM COMP "ANCHOR_RECESS" ANCHOR_RECESS
				SET_MDL_PARAM COMP "DRYWALL_ALLOWANCE" DRYWALL_ALLOWANCE
				SET_MDL_PARAM COMP "ITEMNUM" "ANCHOR_"+ITEM_NUM
				SET_MDL_PARAM COMP "XX_JD" JD
				
				REGEN_MDL COMP FORCE
				REGEN_MDL COMP FORCE
				
				CALL_EX instantiate.tab
					VAR_IN	COMP	COMP
				END_CALL_EX

				RETRIEVE_MDL ANCHOR_MDL ANCHOR
				DECLARE_VARIABLE INTEGER EXISTING_ANCHOR
				DECLARE_VARIABLE INTEGER REFANCHOR
				GET_FAMINSTANCE_NAMES ANCHOR arrayAnchors
				FOR ANCH REF REVERSE_ARRAY arrayAnchors
					EXISTING_ANCHOR = strfind(ANCH,ITEM_NUM)
					IF EXISTING_ANCHOR <> -1
						REFANCHOR = ANCH
						BREAK
					END_IF
				END_FOR
			
				GET_REF_FAMINSTANCE ANCHOR &REFANCHOR REFINST
				IF SECTION == 0
					SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_0" refFeat
					SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
				END_IF
				IF SECTION == 1
					SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_1" refFeat
					SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
				END_IF
				IF SECTION == 2 OR SECTION == 21
					SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_2" refFeat
					SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
				END_IF
		END_IF
		
		IF ANCHOR_MDL == "*welded_stud*"
			RETRIEVE_MDL ANCHOR_MDL COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			GET_ARRAY_ELEM ANCHORS_ARRAY 0 ATTACH
				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE

				
				SET_MDL_PARAM COMP "STOCKTYPE" 1
				SET_MDL_PARAM COMP "XX_JD" JD
				SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
				SET_MDL_PARAM COMP "XX_FACEE" FACEE
				SET_MDL_PARAM COMP "ANCHOR_RECESS" ANCHOR_RECESS + FR_THICKNESS
				SET_MDL_PARAM COMP "RETURN" RETURN
				SET_MDL_PARAM COMP "XRETURN" XRETURN
				SET_MDL_PARAM COMP "ITEMNUM" ""
				SET_MDL_PARAM COMP "XX_SECTION" SECTION
				SET_MDL_PARAM COMP "XX_XFACEE" XFACEE
				SET_MDL_PARAM COMP "XX_STOPP" STOPP
				
				IF DW_RTRN == "IN" AND XDW_RTRN == "IN"
					SET_MDL_PARAM COMP "d429" .4675
					SET_MDL_PARAM COMP "d430" .4675
				ELSE
					SET_MDL_PARAM COMP "d429" 0.03
					SET_MDL_PARAM COMP "d430" 0.03
				END_IF
		
			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX
					
			DELETE_ARRAY_ELEM ANCHORS_ARRAY 0
			SEARCH_MDL_REF FRAME_ASM COMPONENT "*welded_stud*" ANCHOR
			
			SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
				FOR ATTACH REF ARRAY ANCHORS_ARRAY
					ASSEMBLE ANCHOR FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				END_FOR
				
				IF HEAD_ANCHORS == 1 AND HEAD < FACEE
					RETRIEVE_MDL ANCHOR_MDL COMP
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					GET_ARRAY_ELEM HEAD_ANCHORS_ARRAY 0 ATTACH
						ASSEMBLE COMP FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE

					SET_MDL_PARAM COMP "STOCKTYPE" 1
					SET_MDL_PARAM COMP "XX_JD" JD
					SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
					SET_MDL_PARAM COMP "XX_FACEE" HEAD
					SET_MDL_PARAM COMP "ANCHOR_RECESS" ANCHOR_RECESS + FR_THICKNESS
					SET_MDL_PARAM COMP "RETURN" RETURN
					SET_MDL_PARAM COMP "XRETURN" XRETURN
					SET_MDL_PARAM COMP "XX_SECTION" SECTION
					SET_MDL_PARAM COMP "XX_XFACEE" XFACEE
					SET_MDL_PARAM COMP "XX_STOPP" STOPP
					SET_MDL_PARAM COMP "ITEMNUM" ""
					
					IF DW_RTRN == "IN" AND XDW_RTRN == "IN"
						SET_MDL_PARAM COMP "d429" .4375
						SET_MDL_PARAM COMP "d430" .4675
					ELSE
						SET_MDL_PARAM COMP "d429" 0.03
						SET_MDL_PARAM COMP "d430" 0.03
					END_IF
						
					CALL_EX instantiate.tab
						VAR_IN	COMP	COMP
					END_CALL_EX
							
					DELETE_ARRAY_ELEM ANCHORS_ARRAY 0
					SEARCH_MDL_REF FRAME_ASM COMPONENT "*loose_stud*" ANCHOR
					
					SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
						FOR ATTACH REF ARRAY ANCHORS_ARRAY
							ASSEMBLE ANCHOR FRAME_ASM
								CSYS ATTACH PLACEMENT
							END_ASSEMBLE
						END_FOR
				ELSE_IF HEAD_ANCHORS == 1 AND HEAD >= FACEE
					FOR ATTACH REF ARRAY HEAD_ANCHORS_ARRAY
						ASSEMBLE ANCHOR FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
					END_FOR
				END_IF

				SEARCH_MDL_REFS FRAME_ASM COMPONENT "*loose_stud*" ANCHORS
				FOR ANCHOR REF ARRAY ANCHORS
					SET_ON_LAYER ANCHOR "COMPONENTS"
				END_FOR
				
				RETRIEVE_MDL ANCHOR_MDL COMP
								
				SET_MDL_PARAM COMP "STOCKTYPE" 1
				SET_MDL_PARAM COMP "XX_JD" JD
				SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
				SET_MDL_PARAM COMP "XX_FACEE" FACEE
				SET_MDL_PARAM COMP "ANCHOR_RECESS" ANCHOR_RECESS + FR_THICKNESS
				SET_MDL_PARAM COMP "XX_SECTION" SECTION
				SET_MDL_PARAM COMP "XX_XFACEE" XFACEE
				SET_MDL_PARAM COMP "XX_STOPP" STOPP
				SET_MDL_PARAM COMP "ITEMNUM" "ANCHOR_"+ITEM_NUM
							
				REGEN_MDL COMP FORCE
				REGEN_MDL COMP FORCE
				
				CALL_EX instantiate.tab
					VAR_IN	COMP	COMP
				END_CALL_EX

				RETRIEVE_MDL ANCHOR_MDL ANCHOR
				DECLARE_VARIABLE INTEGER EXISTING_ANCHOR
				DECLARE_VARIABLE INTEGER REFANCHOR
				GET_FAMINSTANCE_NAMES ANCHOR arrayAnchors
				FOR ANCH REF REVERSE_ARRAY arrayAnchors
					EXISTING_ANCHOR = strfind(ANCH,ITEM_NUM)
					IF EXISTING_ANCHOR <> -1
						REFANCHOR = ANCH
						BREAK
					END_IF
				END_FOR
			
				GET_REF_FAMINSTANCE ANCHOR &REFANCHOR REFINST
				IF SECTION == 0
					SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_0" refFeat
					SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
				END_IF
				IF SECTION == 1
					SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_1" refFeat
					SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
				END_IF
				IF SECTION == 2 OR SECTION == 21
					SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_2" refFeat
					SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
				END_IF
				IF DW_RTRN == "IN" AND XDW_RTRN == "IN"
					SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "DW_RTRN" refFeat
					SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
				END_IF	
		END_IF

		
		IF ANCHOR_MDL == "*welded_hd*"
				
			RETRIEVE_MDL ANCHOR_MDL COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			GET_ARRAY_ELEM ANCHORS_ARRAY 0 ATTACH
				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE

					SET_MDL_PARAM COMP "STOCKTYPE" 2
					SET_MDL_PARAM COMP "ITEMNUM" ""
					SET_MDL_PARAM COMP "JD" JD
					SET_MDL_PARAM COMP "FACEE" FACEE
					SET_MDL_PARAM COMP "XFACEE" XFACEE
					SET_MDL_PARAM COMP "FR_THICKNESS" FR_THICKNESS
					SET_MDL_PARAM COMP "DRYWALL_ALLOWANCE" DRYWALL_ALLOWANCE
					SET_MDL_PARAM COMP "RETURN" RETURN
					SET_MDL_PARAM COMP "XRETURN" XRETURN
					SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
					SET_MDL_PARAM COMP "STOPP" STOPP
					SET_MDL_PARAM COMP "XX_RABBET" RABBET
					SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
					SET_MDL_PARAM COMP "ITEMNUM" ""
					
					REGEN_MDL COMP FORCE
					REGEN_MDL COMP FORCE
					
					CALL_EX instantiate.tab
						VAR_IN	COMP	COMP
					END_CALL_EX
										
			DELETE_ARRAY_ELEM ANCHORS_ARRAY 0
			SEARCH_MDL_REF FRAME_ASM COMPONENT "*welded_hd**" ANCHOR
			
			SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
				FOR ATTACH REF ARRAY ANCHORS_ARRAY
					ASSEMBLE ANCHOR FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				END_FOR
		
			CLEAR_ARRAY HEAD_ANCHORS_ARRAY
			IF HEAD_ANCHORS == 1
			
				SEARCH_MDL_REF FRAME_ASM CSYS "ANCHORS" ATTACH
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 270
					UDF_DIM	LOCX (JOW/2)-(JOW/(HEAD_ANCHOR_QTY+1))
					UDF_DIM	LOCY (JOH + FR_THICKNESS + .03)
					UDF_DIM	LOCZ -ANCHOR_CTR
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
				ADD_ARRAY_ELEM HEAD_ANCHORS_ARRAY ATTACH
				
				DECLARE_VARIABLE INTEGER HEAD_ANCHOR_INDEX 0
				HEAD_ANCHOR_INDEX = 1
				WHILE HEAD_ANCHOR_INDEX < HEAD_ANCHOR_QTY
					CREATE_UDF udf\csys FRAME_ASM
						UDF_REF ATTACH ATTACH
						UDF_DIM	ROTX 0
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX 0
						UDF_DIM	LOCY -(JOW/(HEAD_ANCHOR_QTY+1))
						UDF_DIM	LOCZ 0
						UDF_EXP_REF ATTACH CSYS 0
					END_CREATE_UDF
					ADD_ARRAY_ELEM HEAD_ANCHORS_ARRAY ATTACH
					HEAD_ANCHOR_INDEX ++
				END_WHILE

				RETRIEVE_MDL ANCHOR_MDL COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
				GET_ARRAY_ELEM HEAD_ANCHORS_ARRAY 0 ATTACH
					ASSEMBLE COMP FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE

						SET_MDL_PARAM COMP "STOCKTYPE" 2
						SET_MDL_PARAM COMP "ITEMNUM" ""
						SET_MDL_PARAM COMP "JD" JD
						SET_MDL_PARAM COMP "FACEE" HEAD
						SET_MDL_PARAM COMP "XFACEE" XHEAD
						SET_MDL_PARAM COMP "FR_THICKNESS" FR_THICKNESS
						SET_MDL_PARAM COMP "DRYWALL_ALLOWANCE" DRYWALL_ALLOWANCE
						SET_MDL_PARAM COMP "RETURN" RETURN
						SET_MDL_PARAM COMP "XRETURN" XRETURN
						SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
						SET_MDL_PARAM COMP "STOPP" STOPP
						SET_MDL_PARAM COMP "XX_RABBET" RABBET
						SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
						SET_MDL_PARAM COMP "ITEMNUM" ""
						
						REGEN_MDL COMP FORCE
						REGEN_MDL COMP FORCE
						
						CALL_EX instantiate.tab
							VAR_IN	COMP	COMP
						END_CALL_EX
											
				DELETE_ARRAY_ELEM HEAD_ANCHORS_ARRAY 0
				SEARCH_MDL_REF FRAME_ASM COMPONENT "*welded_hd*" ANCHOR
				
				SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
					FOR ATTACH REF ARRAY HEAD_ANCHORS_ARRAY
						ASSEMBLE ANCHOR FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
					END_FOR				
			END_IF

			! SEARCH_MDL_REFS FRAME_ASM COMPONENT "*welded_hd*" ANCHORS
			! FOR ANCHOR REF ARRAY ANCHORS
				! SET_ON_LAYER ANCHOR "COMPONENTS"
			! END_FOR
			
			RETRIEVE_MDL ANCHOR_MDL COMP
			SET_MDL_PARAM COMP "STOCKTYPE" 0
			SET_MDL_PARAM COMP "JD" JD
			SET_MDL_PARAM COMP "FACEE" FACEE
			SET_MDL_PARAM COMP "XFACEE" XFACEE
			SET_MDL_PARAM COMP "FR_THICKNESS" FR_THICKNESS
			SET_MDL_PARAM COMP "DRYWALL_ALLOWANCE" DRYWALL_ALLOWANCE
			SET_MDL_PARAM COMP "RETURN" RETURN
			SET_MDL_PARAM COMP "XRETURN" XRETURN
			SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
			SET_MDL_PARAM COMP "STOPP" STOPP
			SET_MDL_PARAM COMP "XX_RABBET" RABBET
			SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
			SET_MDL_PARAM COMP "ITEMNUM" "ANCHOR_"+ITEM_NUM
					
			REGEN_MDL COMP FORCE
			REGEN_MDL COMP FORCE
				
			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX
			
			RETRIEVE_MDL ANCHOR_MDL ANCHOR
			DECLARE_VARIABLE INTEGER EXISTING_ANCHOR
			DECLARE_VARIABLE INTEGER REFANCHOR
			GET_FAMINSTANCE_NAMES ANCHOR arrayAnchors
			FOR ANCH REF REVERSE_ARRAY arrayAnchors
				EXISTING_ANCHOR = strfind(ANCH,ITEM_NUM)
				IF EXISTING_ANCHOR <> -1
					REFANCHOR = ANCH
					BREAK
				END_IF
			END_FOR		

			GET_REF_FAMINSTANCE ANCHOR &REFANCHOR REFINST
			IF SECTION == 0
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_0" refFeat
				SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
			END_IF
			IF SECTION == 1
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_1" refFeat
				SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
			END_IF
			IF SECTION == 2 OR SECTION == 21
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_2" refFeat
				SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
			END_IF
		END_IF
		
		IF ANCHOR_MDL == "*conc*"
			IF ANCHOR_TYPE == 9 AND ANCHOR_SURF == 1
				ANCHOR_SURFACE_OFFSET = STOPP
			ELSE
				ANCHOR_SURFACE_OFFSET = 0
			END_IF

			IF GROUT_HOLES == 1
				GET_ARRAY_SIZE ANCHORS_ARRAY ANCHORSIZE
				GET_ARRAY_ELEM ANCHORS_ARRAY ANCHORSIZE-1 ATTACH
				CREATE_UDF udf\hole FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	DIA GROUT_HOLE_DIA
					UDF_DIM	DEPTH STOPP+.25
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF
				
				RETRIEVE_MDL ANCHOR_MDL COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE

						SET_MDL_PARAM COMP "STOCKTYPE" 2
						
						IF ANCHOR_RECESS == 0
							SET_MDL_PARAM COMP "JD" JD
						ELSE
							SET_MDL_PARAM COMP "JD" JD + .25 - RETURN - XRETURN .15
						END_IF
						
						SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
						SET_MDL_PARAM COMP "FACEE" FACEE
						SET_MDL_PARAM COMP "XFACEE" XFACEE
						SET_MDL_PARAM COMP "XX_RABBET" RABBET
						SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
						SET_MDL_PARAM COMP "XX_ANCHOR_SURFACE_OFFSET" ANCHOR_SURFACE_OFFSET
						SET_MDL_PARAM COMP "STOPP" STOPP
						SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
						SET_MDL_PARAM COMP "HOLE_DIA" GROUT_HOLE_DIA
						SET_MDL_PARAM COMP "GRADE"FRAME_GRADE
						SET_MDL_PARAM COMP "TYPE" MAT_TYPE
						SET_MDL_PARAM COMP "FINISH" FRAME_FINISH		
						SET_MDL_PARAM COMP "SMT_THICKNESS" .075
						SET_MDL_PARAM COMP "ITEMNUM" ""
						SET_MDL_PARAM COMP "ANCHOR_STRAP_TYPE" ANCHOR_STRAP_TYPE
						SET_MDL_PARAM COMP  "ANCHOR_RECESS" ANCHOR_RECESS


						IF ANCHOR_SURF == 0
							SET_MDL_PARAM COMP "XX_SOFFIT" SOFFIT
						ELSE_IF ANCHOR_SURF == 1
							SET_MDL_PARAM COMP "XX_SOFFIT" RABBET
						END_IF
						
						REGEN_MDL COMP FORCE
						REGEN_MDL COMP FORCE
						
						CALL_EX instantiate.tab
							VAR_IN	COMP	COMP
						END_CALL_EX

				IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 0
					RETRIEVE_MDL bolt_ewa_expansion.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 1
					RETRIEVE_MDL bolt_ewa_lag.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 2
					RETRIEVE_MDL bolt_ewa_machine.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				END_IF
				SET_REF_NAME ATTACH "GROUT_1"				
				DELETE_ARRAY_ELEM ANCHORS_ARRAY ANCHORSIZE-1

				GET_ARRAY_ELEM ANCHORS_ARRAY (ANCHORSIZE/2)-1 ATTACH
				CREATE_UDF udf\hole FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	DIA GROUT_HOLE_DIA
					UDF_DIM	DEPTH STOPP+.25
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF

				SEARCH_MDL_REF FRAME_ASM COMPONENT "anchor_concealed_ewa*" ANCHOR
				SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE ANCHOR FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE

				IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 0
					RETRIEVE_MDL bolt_ewa_expansion.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 1
					RETRIEVE_MDL bolt_ewa_lag.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 2
					RETRIEVE_MDL bolt_ewa_machine.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				END_IF
				DELETE_ARRAY_ELEM ANCHORS_ARRAY (ANCHORSIZE/2)-1
				SET_REF_NAME ATTACH "GROUT_2"				
			END_IF
				
			GET_ARRAY_ELEM ANCHORS_ARRAY 0 ATTACH			
			FOR ATTACH REF ARRAY ANCHORS_ARRAY
				CREATE_UDF udf\hole FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	DIA 1.015
					UDF_DIM	DEPTH STOPP+.25
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF
			END_FOR
			
			RETRIEVE_MDL ANCHOR_MDL COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			GET_ARRAY_ELEM ANCHORS_ARRAY 0 ATTACH
				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE

					SET_MDL_PARAM COMP "STOCKTYPE" 2
					
					IF ANCHOR_RECESS == 0
						SET_MDL_PARAM COMP "JD" JD
					ELSE
						SET_MDL_PARAM COMP "JD" JD + .25 - RETURN - XRETURN + .15
					END_IF
						
					SET_MDL_PARAM COMP "XX_JD" JD
					SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
					SET_MDL_PARAM COMP "FACEE" FACEE
					SET_MDL_PARAM COMP "XFACEE" XFACEE
					SET_MDL_PARAM COMP "XX_RABBET" RABBET
					SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
					SET_MDL_PARAM COMP "XX_ANCHOR_SURFACE_OFFSET" ANCHOR_SURFACE_OFFSET
					SET_MDL_PARAM COMP "STOPP" STOPP
					SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
					SET_MDL_PARAM COMP "HOLE_DIA" 1.015
					SET_MDL_PARAM COMP "GRADE"FRAME_GRADE
					SET_MDL_PARAM COMP "TYPE" MAT_TYPE
					SET_MDL_PARAM COMP "FINISH" FRAME_FINISH		
					SET_MDL_PARAM COMP "SMT_THICKNESS" FR_THICKNESS
					SET_MDL_PARAM COMP "ITEMNUM" ""
					SET_MDL_PARAM COMP "ANCHOR_STRAP_TYPE" ANCHOR_STRAP_TYPE
					SET_MDL_PARAM COMP "RETURN" RETURN
					SET_MDL_PARAM COMP "XRETURN" XRETURN
					SET_MDL_PARAM COMP  "ANCHOR_RECESS" ANCHOR_RECESS

					IF ANCHOR_SURF == 0
						SET_MDL_PARAM COMP "XX_SOFFIT" SOFFIT
					ELSE_IF ANCHOR_SURF == 1
						SET_MDL_PARAM COMP "XX_SOFFIT" RABBET
					END_IF
					
					
					REGEN_MDL COMP FORCE
					REGEN_MDL COMP FORCE
					
					CALL_EX instantiate.tab
						VAR_IN	COMP	COMP
					END_CALL_EX
					
			INVALIDATE_REF COMP
			SEARCH_MDL_REFS FRAME_ASM COMPONENT "*" COMPONENTS
			GET_ARRAY_SIZE COMPONENTS COMP_SIZE
			
			GET_ARRAY_ELEM COMPONENTS COMP_SIZE-1 ANCHOR
			
			IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 0
				RETRIEVE_MDL bolt_ewa_expansion.prt PRT
				SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE PRT FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
			ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 1
				RETRIEVE_MDL bolt_ewa_lag.prt PRT
				SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE PRT FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
			ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 2
				RETRIEVE_MDL bolt_ewa_machine.prt PRT
				SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE PRT FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
			END_IF
					
			DELETE_ARRAY_ELEM ANCHORS_ARRAY 0
			
			SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
				FOR ATTACH REF ARRAY ANCHORS_ARRAY
					ASSEMBLE ANCHOR FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE			
				END_FOR
				
			IF ANCHOR_BOLTS == 1
				RETRIEVE_MDL bolt_ewa_expansion.prt PRT
				SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
					FOR ATTACH REF ARRAY ANCHORS_ARRAY
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
					END_FOR
			ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 1
				RETRIEVE_MDL bolt_ewa_lag.prt PRT
				SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE PRT FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
			ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 2
				RETRIEVE_MDL bolt_ewa_machine.prt PRT
				SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE PRT FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
			END_IF
			
			CLEAR_ARRAY HEAD_ANCHORS_ARRAY
			IF HEAD_ANCHORS == 1 AND (FLUSH_BOLTS <> 1 AND FLUSH_BOLTS <> 3)
			
				SEARCH_MDL_REF FRAME_ASM CSYS "ANCHORS" ATTACH
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 270
					UDF_DIM	LOCX (JOW/2)-(JOW/(HEAD_ANCHOR_QTY+1))
					UDF_DIM	LOCY (JOH + FR_THICKNESS + .03)
					UDF_DIM	LOCZ -ANCHOR_CTR
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
				ADD_ARRAY_ELEM HEAD_ANCHORS_ARRAY ATTACH
				
				DECLARE_VARIABLE INTEGER HEAD_ANCHOR_INDEX 0
				HEAD_ANCHOR_INDEX = 1
				WHILE HEAD_ANCHOR_INDEX < HEAD_ANCHOR_QTY
					CREATE_UDF udf\csys FRAME_ASM
						UDF_REF ATTACH ATTACH
						UDF_DIM	ROTX 0
						UDF_DIM	ROTY 0
						UDF_DIM	ROTZ 0
						UDF_DIM	LOCX 0
						UDF_DIM	LOCY -(JOW/(HEAD_ANCHOR_QTY+1))
						UDF_DIM	LOCZ 0
						UDF_EXP_REF ATTACH CSYS 0
					END_CREATE_UDF
					ADD_ARRAY_ELEM HEAD_ANCHORS_ARRAY ATTACH
					HEAD_ANCHOR_INDEX ++
				END_WHILE

				FOR ATTACH REF ARRAY HEAD_ANCHORS_ARRAY
					CREATE_UDF udf\hole FRAME_ASM
						UDF_REF ATTACH ATTACH
						UDF_DIM	DIA 1.015
						UDF_DIM	DEPTH STOPP+.25
						UDF_INTERSECTION * PART_LEVEL
					END_CREATE_UDF
				END_FOR

				! INVALIDATE_REF COMP
				RETRIEVE_MDL ANCHOR_MDL COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
				GET_ARRAY_ELEM HEAD_ANCHORS_ARRAY 0 ATTACH
				
					ASSEMBLE COMP FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE

					SET_MDL_PARAM COMP "STOCKTYPE" 2
					
					IF ANCHOR_RECESS == 0
						SET_MDL_PARAM COMP "JD" JD
					ELSE
						SET_MDL_PARAM COMP "JD" JD + .25 - RETURN - XRETURN + .15
					END_IF
						
					SET_MDL_PARAM COMP "XX_JD" JD
					SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
					SET_MDL_PARAM COMP "FACEE" HEAD
					SET_MDL_PARAM COMP "XFACEE" XHEAD
					SET_MDL_PARAM COMP "XX_RABBET" RABBET
					SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
					SET_MDL_PARAM COMP "XX_ANCHOR_SURFACE_OFFSET" ANCHOR_SURFACE_OFFSET
					SET_MDL_PARAM COMP "STOPP" STOPP
					SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
					SET_MDL_PARAM COMP "XX_SOFFIT" SOFFIT
					SET_MDL_PARAM COMP "HOLE_DIA" 1.015
					SET_MDL_PARAM COMP "GRADE"FRAME_GRADE
					SET_MDL_PARAM COMP "TYPE" MAT_TYPE
					SET_MDL_PARAM COMP "FINISH" FRAME_FINISH		
					SET_MDL_PARAM COMP "SMT_THICKNESS" FR_THICKNESS
					SET_MDL_PARAM COMP "ITEMNUM" ""
					SET_MDL_PARAM COMP "ANCHOR_STRAP_TYPE" ANCHOR_STRAP_TYPE
					SET_MDL_PARAM COMP "RETURN" RETURN
					SET_MDL_PARAM COMP "XRETURN" XRETURN
					SET_MDL_PARAM COMP  "ANCHOR_RECESS" ANCHOR_RECESS
						
						REGEN_MDL COMP FORCE
						REGEN_MDL COMP FORCE
						
						CALL_EX instantiate.tab
							VAR_IN	COMP	COMP
						END_CALL_EX
						
				IF ANCHOR_BOLTS == 1
					RETRIEVE_MDL bolt_pd.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				END_IF	
						
				DELETE_ARRAY_ELEM HEAD_ANCHORS_ARRAY 0
				SEARCH_MDL_REFS FRAME_ASM COMPONENT "anchor_concealed_ewa*" ANCHORS
				GET_ARRAY_SIZE ANCHORS ANCHORSIZE
				GET_ARRAY_ELEM ANCHORS ANCHORSIZE-1 ANCHOR
				
				SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
					FOR ATTACH REF ARRAY HEAD_ANCHORS_ARRAY
						ASSEMBLE ANCHOR FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
					END_FOR
			
				IF ANCHOR_BOLTS == 1
					RETRIEVE_MDL bolt_pd.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						FOR ATTACH REF ARRAY HEAD_ANCHORS_ARRAY
							ASSEMBLE PRT FRAME_ASM
								CSYS ATTACH PLACEMENT
							END_ASSEMBLE
						END_FOR
				END_IF
				
			ELSE_IF HEAD_ANCHORS == 1 AND (FLUSH_BOLTS == 1 OR FLUSH_BOLTS == 3) AND SUB_TYPE == "P"
				SEARCH_MDL_REF ASSEM ASSEMBLY "FRAME_ASM_"+SO_NUM+"_"+ ITEM_NUM FRAME_ASM
				SEARCH_MDL_REF FRAME_ASM CSYS "ANCHORS" ASM_CSYS

				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ASM_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 270
					UDF_DIM	LOCX 0
					UDF_DIM	LOCY 0
					UDF_DIM	LOCZ 0
					UDF_EXP_REF DR_CTR_CSYS CSYS 0
				END_CREATE_UDF
			
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH DR_CTR_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX -(JOH + FR_THICKNESS +.01)
					UDF_DIM	LOCY 0
					UDF_DIM	LOCZ -RABBET/2
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
				ADD_ARRAY_ELEM HEAD_ANCHORS_ARRAY ATTACH
			
				RETRIEVE_MDL ewa_strap.prt COMP
				SEARCH_MDL_REF COMP CSYS "HEAD_PLACEMENT" PLACEMENT
				GET_ARRAY_ELEM HEAD_ANCHORS_ARRAY 0 ATTACH
					ASSEMBLE COMP FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE

					SET_MDL_PARAM COMP "STOCKTYPE" 1
					SET_MDL_PARAM COMP "JD" JD
					SET_MDL_PARAM COMP "ANCHOR_CTR" RABBET/2
					SET_MDL_PARAM COMP "XX_FACEE" HEAD + STOPP
					SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
					SET_MDL_PARAM COMP "ANCHOR_STRAP_TYPE" ANCHOR_STRAP_TYPE					
					
					REGEN_MDL COMP FORCE
					REGEN_MDL COMP FORCE
					
					CALL_EX instantiate.tab
						VAR_IN	COMP	COMP
					END_CALL_EX
					
				INVALIDATE_REF COMP
				SEARCH_MDL_REFS FRAME_ASM COMPONENT "*" COMPONENTS
				GET_ARRAY_SIZE COMPONENTS COMP_SIZE
				
				GET_ARRAY_ELEM COMPONENTS COMP_SIZE-1 ANCHOR
				
				IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 0
					RETRIEVE_MDL bolt_ewa_expansion.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 1
					RETRIEVE_MDL bolt_ewa_lag.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 2
					RETRIEVE_MDL bolt_ewa_machine.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				END_IF
			END_IF
			
			!DRAWING ANCHOR
			RETRIEVE_MDL ANCHOR_MDL COMP

			SET_MDL_PARAM COMP "STOCKTYPE" 0
					
			IF ANCHOR_RECESS == 0
				SET_MDL_PARAM COMP "JD" JD
			ELSE
				SET_MDL_PARAM COMP "JD" JD + .25 - RETURN - XRETURN + .15
			END_IF
				
			SET_MDL_PARAM COMP "XX_JD" JD
			SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
			SET_MDL_PARAM COMP "FACEE" FACEE
			SET_MDL_PARAM COMP "XFACEE" XFACEE
			SET_MDL_PARAM COMP "XX_RABBET" RABBET
			SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
			SET_MDL_PARAM COMP "XX_ANCHOR_SURFACE_OFFSET" ANCHOR_SURFACE_OFFSET
			SET_MDL_PARAM COMP "STOPP" STOPP
			SET_MDL_PARAM COMP "FR_THICKNESS" FR_THICKNESS
			SET_MDL_PARAM COMP "XX_SOFFIT" SOFFIT
			SET_MDL_PARAM COMP "HOLE_DIA" 1.015
			SET_MDL_PARAM COMP "GRADE"FRAME_GRADE
			SET_MDL_PARAM COMP "TYPE" MAT_TYPE
			SET_MDL_PARAM COMP "FINISH" FRAME_FINISH		
			SET_MDL_PARAM COMP "SMT_THICKNESS" FR_THICKNESS
			SET_MDL_PARAM COMP "ITEMNUM" "ANCHOR_"+ITEM_NUM
			SET_MDL_PARAM COMP "ANCHOR_STRAP_TYPE" ANCHOR_STRAP_TYPE
			SET_MDL_PARAM COMP  "ANCHOR_RECESS" ANCHOR_RECESS
			
			REGEN_MDL COMP FORCE
			REGEN_MDL COMP FORCE
			
			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX

			RETRIEVE_MDL ANCHOR_MDL ANCHOR
			DECLARE_VARIABLE INTEGER EXISTING_ANCHOR
			DECLARE_VARIABLE INTEGER REFANCHOR
			GET_FAMINSTANCE_NAMES ANCHOR arrayAnchors
			FOR ANCH REF REVERSE_ARRAY arrayAnchors
				EXISTING_ANCHOR = strfind(ANCH,ITEM_NUM)
				IF EXISTING_ANCHOR <> -1
					REFANCHOR = ANCH
					BREAK
				END_IF
			END_FOR		

			GET_REF_FAMINSTANCE ANCHOR &REFANCHOR REFINST
			IF SECTION == 1
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_1" refFeat
				SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
			END_IF
			IF SECTION == 2 OR SECTION == 21
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_2" refFeat
				SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
			END_IF
			
			SEARCH_MDL_REFS FRAME_ASM COMPONENT "ANCHOR*" ANCHORS
			FOR ANCHOR REF ARRAY ANCHORS
				SET_ON_LAYER ANCHOR "COMPONENTS"
			END_FOR
			
		END_IF

		IF ANCHOR_MDL == "*pd*"
		
			IF ANCHOR_TYPE == 8 AND ANCHOR_SURF == 1
				ANCHOR_SURFACE_OFFSET = STOPP
			ELSE
				ANCHOR_SURFACE_OFFSET = 0
			END_IF

			IF GROUT_HOLES == 1
				GET_ARRAY_SIZE ANCHORS_ARRAY ANCHORSIZE
				GET_ARRAY_ELEM ANCHORS_ARRAY ANCHORSIZE-1 ATTACH
				CREATE_UDF udf\hole FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	DIA GROUT_HOLE_DIA
					UDF_DIM	DEPTH STOPP+.25
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF
				
				RETRIEVE_MDL anchor_concealed_ewa.asm COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE COMP FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE

						SET_MDL_PARAM COMP "STOCKTYPE" 2
						SET_MDL_PARAM COMP "JD" JD
						SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
						SET_MDL_PARAM COMP "FACEE" FACEE
						SET_MDL_PARAM COMP "XFACEE" XFACEE
						SET_MDL_PARAM COMP "XX_RABBET" RABBET
						SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
						SET_MDL_PARAM COMP "XX_ANCHOR_SURFACE_OFFSET" ANCHOR_SURFACE_OFFSET
						SET_MDL_PARAM COMP "STOPP" STOPP
						SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
						SET_MDL_PARAM COMP "XX_SOFFIT" SOFFIT
						SET_MDL_PARAM COMP "HOLE_DIA" GROUT_HOLE_DIA
						SET_MDL_PARAM COMP "GRADE"FRAME_GRADE
						SET_MDL_PARAM COMP "TYPE" MAT_TYPE
						SET_MDL_PARAM COMP "FINISH" FRAME_FINISH		
						SET_MDL_PARAM COMP "SMT_THICKNESS" FR_THICKNESS
						SET_MDL_PARAM COMP "ITEMNUM" ""
						SET_MDL_PARAM COMP "ANCHOR_STRAP_TYPE" ANCHOR_STRAP_TYPE
						
						REGEN_MDL COMP FORCE
						REGEN_MDL COMP FORCE
						
						CALL_EX instantiate.tab
							VAR_IN	COMP	COMP
						END_CALL_EX

				IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 0
					RETRIEVE_MDL bolt_ewa_expansion.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 1
					RETRIEVE_MDL bolt_ewa_lag.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 2
					RETRIEVE_MDL bolt_ewa_machine.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				END_IF
				SET_REF_NAME ATTACH "GROUT_1"				
				DELETE_ARRAY_ELEM ANCHORS_ARRAY ANCHORSIZE-1

				
				
				GET_ARRAY_ELEM ANCHORS_ARRAY (ANCHORSIZE/2)-1 ATTACH
				CREATE_UDF udf\hole FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	DIA GROUT_HOLE_DIA
					UDF_DIM	DEPTH STOPP+.25
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF

				SEARCH_MDL_REF FRAME_ASM COMPONENT "anchor_concealed_ewa*" ANCHOR
				SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE ANCHOR FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE

				IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 0
					RETRIEVE_MDL bolt_ewa_expansion.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 1
					RETRIEVE_MDL bolt_ewa_lag.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 2
					RETRIEVE_MDL bolt_ewa_machine.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				END_IF
				DELETE_ARRAY_ELEM ANCHORS_ARRAY (ANCHORSIZE/2)-1
				SET_REF_NAME ATTACH "GROUT_2"				
			END_IF

			FOR ATTACH REF ARRAY ANCHORS_ARRAY
				CREATE_UDF udf\hole FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	DIA .375
					UDF_DIM	DEPTH STOPP+.25
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF
			END_FOR

			IF CLOSED_BACK == 1
				FOR ATTACH REF ARRAY ANCHORS_ARRAY
					CREATE_UDF udf\hole FRAME_ASM
						UDF_REF ATTACH ATTACH
						UDF_DIM	DIA .5
						UDF_DIM	DEPTH -FACEE-.25
						UDF_INTERSECTION * PART_LEVEL
					END_CREATE_UDF
				END_FOR
			END_IF
			
			! IF HINGE_TYPE == "ELIASON"
				! GET_ARRAY_ELEM ANCHORS_ARRAY 0 ATTACH
				! CREATE_UDF udf\csys FRAME_ASM
					! UDF_REF ATTACH ATTACH
					! UDF_DIM	ROTX 0
					! UDF_DIM	ROTY 0
					! UDF_DIM	ROTZ 0
					! UDF_DIM	LOCX -.375
					! UDF_DIM	LOCY 0
					! UDF_DIM	LOCZ 0
					! UDF_EXP_REF refCsys CSYS 0
				! END_CREATE_UDF

				! CREATE_UDF udf\hole FRAME_ASM
					! UDF_REF ATTACH refCsys
					! UDF_DIM	DIA 1.5
					! UDF_DIM	DEPTH .25
					! UDF_INTERSECTION * PART_LEVEL
				! END_CREATE_UDF
				
				! IF SUB_TYPE == "P"
					! CREATE_UDF udf\csys FRAME_ASM
						! UDF_REF ATTACH ATTACH
						! UDF_DIM	ROTX 0
						! UDF_DIM	ROTY 0
						! UDF_DIM	ROTZ 0
						! UDF_DIM	LOCX JOW + .375
						! UDF_DIM	LOCY 0
						! UDF_DIM	LOCZ 0
						! UDF_EXP_REF refCsys CSYS 0
					! END_CREATE_UDF

					! CREATE_UDF udf\hole FRAME_ASM
						! UDF_REF ATTACH refCsys
						! UDF_DIM	DIA 1.5
						! UDF_DIM	DEPTH .25
						! UDF_INTERSECTION * PART_LEVEL
					! END_CREATE_UDF				
				! END_IF
			! END_IF
			
			RETRIEVE_MDL ANCHOR_MDL COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			GET_ARRAY_ELEM ANCHORS_ARRAY 0 ATTACH
				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE

					SET_MDL_PARAM COMP "STOCKTYPE" 2
					SET_MDL_PARAM COMP "JD" JD
					SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
					SET_MDL_PARAM COMP "STOPP" STOPP
					SET_MDL_PARAM COMP "XX_RABBET" RABBET
					SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
					SET_MDL_PARAM COMP "FR_THICKNESS" FR_THICKNESS
					SET_MDL_PARAM COMP "ITEMNUM" ""
					SET_MDL_PARAM COMP "ANCHOR_STRAP_TYPE" ANCHOR_STRAP_TYPE

					
					IF CLOSED_BACK == 0
						SET_MDL_PARAM COMP "FACEE" FACEE - ANCHOR_SURFACE_OFFSET
						SET_MDL_PARAM COMP "XFACEE" XFACEE- ANCHOR_SURFACE_OFFSET
					ELSE_IF CLOSED_BACK == 1
						SET_MDL_PARAM COMP "FACEE" FACEE - ANCHOR_SURFACE_OFFSET + FR_THICKNESS + .03
						SET_MDL_PARAM COMP "XFACEE" XFACEE- ANCHOR_SURFACE_OFFSET + FR_THICKNESS + .03
						SEARCH_MDL_REF ALLOW_SUPPRESSED COMP COMPONENT "*STRAP" refFeat
						SET_FEATURE_STATE refFeat SUPPRESSED
					END_IF
										
					REGEN_MDL COMP FORCE
					REGEN_MDL COMP FORCE
					
					CALL_EX instantiate.tab
						VAR_IN	COMP	COMP
					END_CALL_EX
					
			IF ANCHOR_BOLTS == 1
				RETRIEVE_MDL bolt_pd.prt PRT
				SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE PRT FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
			END_IF	
					
			DELETE_ARRAY_ELEM ANCHORS_ARRAY 0
			SEARCH_MDL_REF FRAME_ASM COMPONENT "anchor_pd_ewa*" ANCHOR
			
			SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
				FOR ATTACH REF ARRAY ANCHORS_ARRAY
					ASSEMBLE ANCHOR FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
				END_FOR
		
			IF ANCHOR_BOLTS == 1
				RETRIEVE_MDL bolt_pd.prt PRT
				SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
					FOR ATTACH REF ARRAY ANCHORS_ARRAY
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
					END_FOR
			END_IF

			IF HEAD_ANCHORS == 1 AND (FLUSH_BOLTS <> 1 AND FLUSH_BOLTS <> 3)
				! CLEAR_ARRAY HEAD_ANCHORS_ARRAY
			
				! SEARCH_MDL_REF FRAME_ASM CSYS "ANCHORS" ATTACH
				! CREATE_UDF udf\csys FRAME_ASM
					! UDF_REF ATTACH ATTACH
					! UDF_DIM	ROTX 0
					! UDF_DIM	ROTY 0
					! UDF_DIM	ROTZ 270
					! UDF_DIM	LOCX (JOW/2)-ANCHOR_HDJ_DIST
					! UDF_DIM	LOCY (JOH + FR_THICKNESS + .03)
					! UDF_DIM	LOCZ -ANCHOR_CTR
					! UDF_EXP_REF ATTACH CSYS 0
				! END_CREATE_UDF
				! ADD_ARRAY_ELEM HEAD_ANCHORS_ARRAY ATTACH
				
				! DECLARE_VARIABLE INTEGER HEAD_ANCHOR_INDEX 0
				! HEAD_ANCHOR_INDEX = 1
				! WHILE HEAD_ANCHOR_INDEX < HEAD_ANCHOR_QTY
					! CREATE_UDF udf\csys FRAME_ASM
						! UDF_REF ATTACH ATTACH
						! UDF_DIM	ROTX 0
						! UDF_DIM	ROTY 0
						! UDF_DIM	ROTZ 0
						! UDF_DIM	LOCX 0
						! UDF_DIM	LOCY -(JOW/(HEAD_ANCHOR_QTY+1))
						! UDF_DIM	LOCZ 0
						! UDF_EXP_REF ATTACH CSYS 0
					! END_CREATE_UDF
					! ADD_ARRAY_ELEM HEAD_ANCHORS_ARRAY ATTACH
					! HEAD_ANCHOR_INDEX ++
				! END_WHILE

				FOR ATTACH REF ARRAY HEAD_ANCHORS_ARRAY
					CREATE_UDF udf\hole FRAME_ASM
						UDF_REF ATTACH ATTACH
						UDF_DIM	DIA .375
						UDF_DIM	DEPTH HEAD_STOPP+.25
						UDF_INTERSECTION * PART_LEVEL
					END_CREATE_UDF
				END_FOR

				IF CLOSED_BACK == 1
					FOR ATTACH REF ARRAY HEAD_ANCHORS_ARRAY
						CREATE_UDF udf\hole FRAME_ASM
							UDF_REF ATTACH ATTACH
							UDF_DIM	DIA .5
							UDF_DIM	DEPTH -HEAD-.25
							UDF_INTERSECTION * PART_LEVEL
						END_CREATE_UDF
					END_FOR
				END_IF
				
				RETRIEVE_MDL ANCHOR_MDL COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
				GET_ARRAY_ELEM HEAD_ANCHORS_ARRAY 0 ATTACH
					ASSEMBLE COMP FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE

						SET_MDL_PARAM COMP "STOCKTYPE" 2
						SET_MDL_PARAM COMP "JD" JD
						SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
						SET_MDL_PARAM COMP "STOPP" STOPP
						SET_MDL_PARAM COMP "XX_RABBET" RABBET
						SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
						SET_MDL_PARAM COMP "FR_THICKNESS" FR_THICKNESS
						SET_MDL_PARAM COMP "ITEMNUM" ""
						SET_MDL_PARAM COMP "ANCHOR_STRAP_TYPE" ANCHOR_STRAP_TYPE

						IF CLOSED_BACK == 0
							SET_MDL_PARAM COMP "FACEE" HEAD - ANCHOR_SURFACE_OFFSET
							SET_MDL_PARAM COMP "XFACEE" XHEAD- ANCHOR_SURFACE_OFFSET
						ELSE_IF CLOSED_BACK == 1
							SET_MDL_PARAM COMP "FACEE" HEAD - ANCHOR_SURFACE_OFFSET + FR_THICKNESS + .03
							SET_MDL_PARAM COMP "XFACEE" XHEAD- ANCHOR_SURFACE_OFFSET + FR_THICKNESS + .03
							SEARCH_MDL_REF ALLOW_SUPPRESSED COMP COMPONENT "*STRAP" refFeat
							SET_FEATURE_STATE refFeat SUPPRESSED
						END_IF
						
						REGEN_MDL COMP FORCE
						REGEN_MDL COMP FORCE
						
						CALL_EX instantiate.tab
							VAR_IN	COMP	COMP
						END_CALL_EX
						
				IF ANCHOR_BOLTS == 1
					RETRIEVE_MDL bolt_pd.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				END_IF	
						
				DELETE_ARRAY_ELEM HEAD_ANCHORS_ARRAY 0
				SEARCH_MDL_REFS FRAME_ASM COMPONENT "anchor_pd_ewa*" ANCHORS
				GET_ARRAY_SIZE ANCHORS ANCHORSIZE
				GET_ARRAY_ELEM ANCHORS ANCHORSIZE-1 ANCHOR
				
				SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
					FOR ATTACH REF ARRAY HEAD_ANCHORS_ARRAY
						ASSEMBLE ANCHOR FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
					END_FOR
			
				IF ANCHOR_BOLTS == 1
					RETRIEVE_MDL bolt_pd.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						FOR ATTACH REF ARRAY HEAD_ANCHORS_ARRAY
							ASSEMBLE PRT FRAME_ASM
								CSYS ATTACH PLACEMENT
							END_ASSEMBLE
						END_FOR
				END_IF
				
			ELSE_IF HEAD_ANCHORS == 1 AND (FLUSH_BOLTS == 1 OR FLUSH_BOLTS == 3) AND SUB_TYPE == "P"
				SEARCH_MDL_REF ASSEM ASSEMBLY "FRAME_ASM_"+SO_NUM+"_"+ ITEM_NUM FRAME_ASM
				SEARCH_MDL_REF FRAME_ASM CSYS "ANCHORS" ASM_CSYS

				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ASM_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 270
					UDF_DIM	LOCX 0
					UDF_DIM	LOCY 0
					UDF_DIM	LOCZ 0
					UDF_EXP_REF DR_CTR_CSYS CSYS 0
				END_CREATE_UDF
			
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH DR_CTR_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX -(JOH + FR_THICKNESS +.01)
					UDF_DIM	LOCY 0
					UDF_DIM	LOCZ -RABBET/2
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
				ADD_ARRAY_ELEM HEAD_ANCHORS_ARRAY ATTACH
			
				RETRIEVE_MDL ewa_strap.prt COMP
				SEARCH_MDL_REF COMP CSYS "HEAD_PLACEMENT" PLACEMENT
				GET_ARRAY_ELEM HEAD_ANCHORS_ARRAY 0 ATTACH
					ASSEMBLE COMP FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE

					SET_MDL_PARAM COMP "STOCKTYPE" 1
					SET_MDL_PARAM COMP "JD" JD
					SET_MDL_PARAM COMP "ANCHOR_CTR" RABBET/2
					SET_MDL_PARAM COMP "XX_FACEE" HEAD + STOPP
					SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
					SET_MDL_PARAM COMP "ANCHOR_STRAP_TYPE" ANCHOR_STRAP_TYPE
					
					REGEN_MDL COMP FORCE
					REGEN_MDL COMP FORCE
					
					CALL_EX instantiate.tab
						VAR_IN	COMP	COMP
					END_CALL_EX
					
				INVALIDATE_REF COMP
				SEARCH_MDL_REFS FRAME_ASM COMPONENT "*" COMPONENTS
				GET_ARRAY_SIZE COMPONENTS COMP_SIZE
				
				GET_ARRAY_ELEM COMPONENTS COMP_SIZE-1 ANCHOR
				
				IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 0
					RETRIEVE_MDL bolt_ewa_expansion.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 1
					RETRIEVE_MDL bolt_ewa_lag.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				ELSE_IF ANCHOR_BOLTS == 1 AND ANCHOR_BOLT_TYPE == 2
					RETRIEVE_MDL bolt_ewa_machine.prt PRT
					SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
						ASSEMBLE PRT FRAME_ASM
							CSYS ATTACH PLACEMENT
						END_ASSEMBLE
				END_IF
			END_IF

			
			RETRIEVE_MDL ANCHOR_MDL COMP

			SET_MDL_PARAM COMP "STOCKTYPE" 0
			SET_MDL_PARAM COMP "JD" JD
			SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
			! SET_MDL_PARAM COMP "FACEE" FACEE - ANCHOR_SURFACE_OFFSET
			! SET_MDL_PARAM COMP "XFACEE" XFACEE- ANCHOR_SURFACE_OFFSET
			SET_MDL_PARAM COMP "STOPP" STOPP
			SET_MDL_PARAM COMP "FR_THICKNESS" FR_THICKNESS
			SET_MDL_PARAM COMP "ITEMNUM" "ANCHOR_"+ITEM_NUM
			SET_MDL_PARAM COMP "ANCHOR_STRAP_TYPE" ANCHOR_STRAP_TYPE

			IF CLOSED_BACK == 0
				SET_MDL_PARAM COMP "FACEE" FACEE - ANCHOR_SURFACE_OFFSET
				SET_MDL_PARAM COMP "XFACEE" XFACEE- ANCHOR_SURFACE_OFFSET
			ELSE_IF CLOSED_BACK == 1
				SET_MDL_PARAM COMP "FACEE" FACEE - ANCHOR_SURFACE_OFFSET + FR_THICKNESS + .03
				SET_MDL_PARAM COMP "XFACEE" XFACEE- ANCHOR_SURFACE_OFFSET + FR_THICKNESS + .03
				SEARCH_MDL_REF ALLOW_SUPPRESSED COMP COMPONENT "*STRAP" refFeat
				SET_FEATURE_STATE refFeat SUPPRESSED
			END_IF
			
			REGEN_MDL COMP FORCE
			REGEN_MDL COMP FORCE
			
			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX
			
			RETRIEVE_MDL ANCHOR_MDL ANCHOR
			DECLARE_VARIABLE INTEGER EXISTING_ANCHOR
			DECLARE_VARIABLE INTEGER REFANCHOR
			GET_FAMINSTANCE_NAMES ANCHOR arrayAnchors
			FOR ANCH REF REVERSE_ARRAY arrayAnchors
				EXISTING_ANCHOR = strfind(ANCH,ITEM_NUM)
				IF EXISTING_ANCHOR <> -1
					REFANCHOR = ANCH
					BREAK
				END_IF
			END_FOR		

			GET_REF_FAMINSTANCE ANCHOR &REFANCHOR REFINST
			GET_REF_NAME REFINST INSTNAME
			! SET_FAMITEM_VALUE ANCHOR INSTNAME "STOCKTYPE" 6

			IF CLOSED_BACK == 1				
				SET_FAMITEM_VALUE ANCHOR INSTNAME "M51" "N"
				SET_FAMITEM_VALUE ANCHOR INSTNAME "F451" "Y"
			ELSE_IF CLOSED_BACK == 0
				SET_FAMITEM_VALUE ANCHOR INSTNAME "M51" "Y"
				SET_FAMITEM_VALUE ANCHOR INSTNAME "F451" "N"
			END_IF
			
			IF SECTION == 0
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_0A" refFeat
				SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_0B" refFeat
				SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
			END_IF
			IF SECTION == 1
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_1A" refFeat
				SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_1B" refFeat
				SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
			END_IF
			IF SECTION == 2 OR SECTION == 21
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_2A" refFeat
				SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_2B" refFeat
				SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
			END_IF
			
			! IF CLOSED_BACK == 1				
				! SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "CLOSED_BACK" refFeat
				! SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
			! ELSE
				! SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "CLOSED_BACK" refFeat
				! SET_FAMITEM_STATE ANCHOR REFINST refFeat SUPPRESSED
			! END_IF
							
			IF CLOSED_BACK == 1
				RETRIEVE_MDL ANCHOR_MDL COMP
				SEARCH_MDL_REF ALLOW_SUPPRESSED COMP COMPONENT "*STRAP" refFeat
				SET_FEATURE_STATE refFeat RESUMED
			END_IF
		END_IF
		
		! FLOOR CLIPS
		IF FLOOR_CLIPS == "FIXED" AND ANCHOR_RECESS == 0
			RETRIEVE_MDL fixed_floor_clip.prt COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT

				SEARCH_MDL_REF FRAME_ASM CSYS "FLOOR_CLIPS" ATTACH
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX ((JOW/2) + FR_THICKNESS + .03)
					UDF_DIM	LOCY 0
					UDF_DIM	LOCZ -JD/2
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF

				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE
			
			SET_MDL_PARAM COMP "STOCKTYPE" 1			
			SET_MDL_PARAM COMP "XX_JD" JD
			SET_MDL_PARAM COMP "XX_FACEE" FACEE
			SET_MDL_PARAM COMP "XX_RETURN" RETURN
			SET_MDL_PARAM COMP "XX_XRETURN" XRETURN
			SET_MDL_PARAM COMP "XX_RABBET" RABBET
			SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
			SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
			SET_MDL_PARAM COMP "RECESS" ANCHOR_RECESS
			SET_MDL_PARAM COMP "SMT_THICKNESS" .075
			SET_MDL_PARAM COMP "ITEMNUM" ""
			SET_MDL_PARAM COMP "d51" 0.5

			IF JD >= 5.75 AND JD <= 5.875 AND ANCHOR_RECESS == 0
				SET_MDL_PARAM COMP "d41" 5.5
			ELSE
				SET_MDL_PARAM COMP "d41" JD-.25
			END_IF
			
			IF FACEE < 1.5
				SET_MDL_PARAM COMP "d40" FACEE - .25
			ELSE
				SET_MDL_PARAM COMP "d40" 1.25
			END_IF
			
			IF DW_RTRN == "IN" AND XDW_RTRN == "IN"
				SET_MDL_PARAM COMP "XX_DW_RTRN" 0.4375
			ELSE
				SET_MDL_PARAM COMP "XX_DW_RTRN" 0
			END_IF
			
			REGEN_MDL COMP FORCE
			REGEN_MDL COMP FORCE
				
			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX
						
			SEARCH_MDL_REF FRAME_ASM COMPONENT "*floor_clip*" COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT

			SEARCH_MDL_REF FRAME_ASM CSYS "FLOOR_CLIPS" ATTACH
			
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 180
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX -((JOW/2) + FR_THICKNESS + .03)
					UDF_DIM	LOCY 0
					UDF_DIM	LOCZ -JD/2
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
			
			ASSEMBLE COMP FRAME_ASM
				CSYS ATTACH PLACEMENT
			END_ASSEMBLE
			
			RETRIEVE_MDL fixed_floor_clip.prt COMP
								
			SET_MDL_PARAM COMP "STOCKTYPE" 0
			SET_MDL_PARAM COMP "XX_JD" JD
			SET_MDL_PARAM COMP "XX_FACEE" FACEE
			SET_MDL_PARAM COMP "XX_RETURN" RETURN
			SET_MDL_PARAM COMP "XX_XRETURN" XRETURN
			SET_MDL_PARAM COMP "XX_RABBET" RABBET
			SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
			SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
			SET_MDL_PARAM COMP "RECESS" ANCHOR_RECESS
			SET_MDL_PARAM COMP "SMT_THICKNESS" .075
			SET_MDL_PARAM COMP "ITEMNUM" "FLCLIP_"+ITEM_NUM
			SET_MDL_PARAM COMP "d51" 0.5

			IF JD >= 5.75 AND JD <= 5.875 AND ANCHOR_RECESS == 0
				SET_MDL_PARAM COMP "d41" 5.5
			ELSE
				SET_MDL_PARAM COMP "d41" JD-.25
			END_IF
			
			IF FACEE < 1.5
				SET_MDL_PARAM COMP "d40" FACEE - .25
			ELSE
				SET_MDL_PARAM COMP "d40" 1.25
			END_IF
			
			IF DW_RTRN == "IN" AND XDW_RTRN == "IN"
				SET_MDL_PARAM COMP "XX_DW_RTRN" 0.4375
			ELSE
				SET_MDL_PARAM COMP "XX_DW_RTRN" 0
			END_IF
			
				REGEN_MDL COMP FORCE
				REGEN_MDL COMP FORCE
				
				CALL_EX instantiate.tab
					VAR_IN	COMP	COMP
				END_CALL_EX

			RETRIEVE_MDL fixed_floor_clip.prt FLCLIPISO_MDL
			DECLARE_VARIABLE INTEGER EXISTING_FLCLIPISO
			DECLARE_VARIABLE INTEGER REFFLCLIP
			GET_FAMINSTANCE_NAMES FLCLIPISO_MDL arrayFLCLIPISOS
			FOR FLCLIPISO REF REVERSE_ARRAY arrayFLCLIPISOS
				EXISTING_FLCLIPISO = strfind(FLCLIPISO,ITEM_NUM)
				IF EXISTING_FLCLIPISO <> -1
					REFFLCLIP = FLCLIPISO
					BREAK
				END_IF
			END_FOR		
			GET_REF_FAMINSTANCE FLCLIPISO_MDL &REFFLCLIP REFINST
			IF SECTION == 0
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_0" refFeat
				SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
			END_IF
			IF SECTION == 1
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_1" refFeat
				SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
			END_IF
			IF SECTION == 2 OR SECTION == 21
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_2" refFeat
				SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
			END_IF
			IF DW_RTRN == "IN" AND XDW_RTRN == "IN"
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "DW_RTRN" refFeat
				SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
			END_IF			
		END_IF
		
		
		IF FLOOR_CLIPS == "FIXED" AND ANCHOR_RECESS > 0
			RETRIEVE_MDL fixed_floor_clip_recess.prt COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT

				SEARCH_MDL_REF FRAME_ASM CSYS "FLOOR_CLIPS" ATTACH
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX ((JOW/2) + FR_THICKNESS + .03)
					UDF_DIM	LOCY 0
					UDF_DIM	LOCZ -JD/2
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF

				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE
												
			SET_MDL_PARAM COMP "STOCKTYPE" 1
			SET_MDL_PARAM COMP "d41" JD - RETURN - XRETURN - .06
			SET_MDL_PARAM COMP "d51" 0.75
			SET_MDL_PARAM COMP "XX_JD" JD
			SET_MDL_PARAM COMP "XX_FACEE" FACEE
			SET_MDL_PARAM COMP "XX_RETURN" RETURN
			SET_MDL_PARAM COMP "XX_XRETURN" XRETURN
			SET_MDL_PARAM COMP "XX_RABBET" RABBET
			SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
			SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
			SET_MDL_PARAM COMP "RECESS" ANCHOR_RECESS
			SET_MDL_PARAM COMP "SMT_THICKNESS" .075
			SET_MDL_PARAM COMP "ITEMNUM" ""
			SET_MDL_PARAM COMP "d61" 1.5
			SET_MDL_PARAM COMP "d65" 1.5
			

			IF FACEE - ANCHOR_RECESS < 1.5
				SET_MDL_PARAM COMP "d40" FACEE - ANCHOR_RECESS - .25
			ELSE
				SET_MDL_PARAM COMP "d40" 1.25
			END_IF
			
			IF DW_RTRN == "IN" AND XDW_RTRN == "IN"
				SET_MDL_PARAM COMP "XX_DW_RTRN" 0.4375
			ELSE
				SET_MDL_PARAM COMP "XX_DW_RTRN" 0
			END_IF

			
			REGEN_MDL COMP FORCE
			REGEN_MDL COMP FORCE
				
			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX
						
			SEARCH_MDL_REF FRAME_ASM COMPONENT "*floor_clip*" COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT

			SEARCH_MDL_REF FRAME_ASM CSYS "FLOOR_CLIPS" ATTACH
			
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 180
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX -((JOW/2) + FR_THICKNESS + .03)
					UDF_DIM	LOCY 0
					UDF_DIM	LOCZ -JD/2
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
			
			ASSEMBLE COMP FRAME_ASM
				CSYS ATTACH PLACEMENT
			END_ASSEMBLE
			
			RETRIEVE_MDL fixed_floor_clip_recess.prt COMP

			SET_MDL_PARAM COMP "STOCKTYPE" 0
			SET_MDL_PARAM COMP "d41" JD - RETURN - XRETURN - .06
			SET_MDL_PARAM COMP "d51" 0.75
			SET_MDL_PARAM COMP "XX_JD" JD
			SET_MDL_PARAM COMP "XX_FACEE" FACEE
			SET_MDL_PARAM COMP "XX_RETURN" RETURN
			SET_MDL_PARAM COMP "XX_XRETURN" XRETURN
			SET_MDL_PARAM COMP "XX_RABBET" RABBET
			SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
			SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
			SET_MDL_PARAM COMP "RECESS" ANCHOR_RECESS
			SET_MDL_PARAM COMP "SMT_THICKNESS" .075
			SET_MDL_PARAM COMP "ITEMNUM" "FLCLIP_"+ITEM_NUM

			IF FACEE - ANCHOR_RECESS < 1.5
				SET_MDL_PARAM COMP "d40" FACEE - ANCHOR_RECESS - .25
			ELSE
				SET_MDL_PARAM COMP "d40" 1.25
			END_IF
			
			IF DW_RTRN == "IN" AND XDW_RTRN == "IN"
				SET_MDL_PARAM COMP "XX_DW_RTRN" 0.4375
			ELSE
				SET_MDL_PARAM COMP "XX_DW_RTRN" 0
			END_IF
			
				REGEN_MDL COMP FORCE
				REGEN_MDL COMP FORCE
				
				CALL_EX instantiate.tab
					VAR_IN	COMP	COMP
				END_CALL_EX

			RETRIEVE_MDL fixed_floor_clip_recess.prt FLCLIPISO_MDL
			DECLARE_VARIABLE INTEGER EXISTING_FLCLIPISO
			DECLARE_VARIABLE INTEGER REFFLCLIP
			GET_FAMINSTANCE_NAMES FLCLIPISO_MDL arrayFLCLIPISOS
			FOR FLCLIPISO REF REVERSE_ARRAY arrayFLCLIPISOS
				EXISTING_FLCLIPISO = strfind(FLCLIPISO,ITEM_NUM)
				IF EXISTING_FLCLIPISO <> -1
					REFFLCLIP = FLCLIPISO
					BREAK
				END_IF
			END_FOR		
			GET_REF_FAMINSTANCE FLCLIPISO_MDL &REFFLCLIP REFINST
			IF SECTION == 0
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_0" refFeat
				SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
			END_IF
			IF SECTION == 1
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_1" refFeat
				SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
			END_IF
			IF SECTION == 2 OR SECTION == 21
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_2" refFeat
				SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
			END_IF
			IF DW_RTRN == "IN" AND XDW_RTRN == "IN"
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "DW_RTRN" refFeat
				SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
			END_IF
		END_IF

		IF FLOOR_CLIPS == "HEAVY DUTY" AND ANCHOR_RECESS == 0
		
			SEARCH_MDL_REF FRAME_ASM CSYS "FLOOR_CLIPS" ATTACH
			CREATE_UDF udf\csys FRAME_ASM
				UDF_REF ATTACH ATTACH
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX ((JOW/2) + FR_THICKNESS + .03)
				UDF_DIM	LOCY 0
				UDF_DIM	LOCZ -JD/2
				UDF_EXP_REF ATTACH CSYS 0
			END_CREATE_UDF
		
			RETRIEVE_MDL FLOOR_CLIP_HD.ASM COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT

			ASSEMBLE COMP FRAME_ASM
				CSYS ATTACH PLACEMENT
			END_ASSEMBLE
			
			SET_MDL_PARAM COMP "STOCKTYPE" 2
			SET_MDL_PARAM COMP "ITEMNUM" ""
			SET_MDL_PARAM COMP "JD" JD
			SET_MDL_PARAM COMP "FACEE" FACEE
			SET_MDL_PARAM COMP "XFACEE" XFACEE
			SET_MDL_PARAM COMP "FR_THICKNESS" FR_THICKNESS
			SET_MDL_PARAM COMP "DRYWALL_ALLOWANCE" DRYWALL_ALLOWANCE
			SET_MDL_PARAM COMP "RETURN" RETURN
			SET_MDL_PARAM COMP "XRETURN" XRETURN
			SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
			SET_MDL_PARAM COMP "STOPP" STOPP
			SET_MDL_PARAM COMP "XX_RABBET" RABBET
			SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
			
			REGEN_MDL COMP FORCE
			REGEN_MDL COMP FORCE
			
			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX
					
			SEARCH_MDL_REF FRAME_ASM COMPONENT "*floor_clip_hd*" COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT

			SEARCH_MDL_REF FRAME_ASM CSYS "FLOOR_CLIPS" ATTACH
			
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 180
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX -((JOW/2) + FR_THICKNESS + .03)
					UDF_DIM	LOCY 0
					UDF_DIM	LOCZ -JD/2
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF
			
			ASSEMBLE COMP FRAME_ASM
				CSYS ATTACH PLACEMENT
			END_ASSEMBLE
			
			RETRIEVE_MDL FLOOR_CLIP_HD.ASM COMP
			SET_MDL_PARAM COMP "STOCKTYPE" 0
			SET_MDL_PARAM COMP "JD" JD
			SET_MDL_PARAM COMP "FACEE" FACEE
			SET_MDL_PARAM COMP "XFACEE" XFACEE
			SET_MDL_PARAM COMP "FR_THICKNESS" FR_THICKNESS
			SET_MDL_PARAM COMP "DRYWALL_ALLOWANCE" DRYWALL_ALLOWANCE
			SET_MDL_PARAM COMP "RETURN" RETURN
			SET_MDL_PARAM COMP "XRETURN" XRETURN
			SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
			SET_MDL_PARAM COMP "STOPP" STOPP
			SET_MDL_PARAM COMP "XX_RABBET" RABBET
			SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
			SET_MDL_PARAM COMP "ITEMNUM" "FLCLIPHD_"+ITEM_NUM
					
			REGEN_MDL COMP FORCE
			REGEN_MDL COMP FORCE
				
			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX

			RETRIEVE_MDL FLOOR_CLIP_HD.ASM FLCLIPISO_MDL
			
			
			DECLARE_VARIABLE INTEGER EXISTING_FLCLIPISO
			DECLARE_VARIABLE INTEGER REFFLCLIP
			GET_FAMINSTANCE_NAMES FLCLIPISO_MDL arrayFLCLIPISOS
			FOR FLCLIPISO REF REVERSE_ARRAY arrayFLCLIPISOS
				EXISTING_FLCLIPISO = strfind(FLCLIPISO,ITEM_NUM)
				IF EXISTING_FLCLIPISO <> -1
					REFFLCLIP = FLCLIPISO
					BREAK
				END_IF
			END_FOR		
			
			GET_REF_FAMINSTANCE FLCLIPISO_MDL &REFFLCLIP REFINST
			IF SECTION == 0
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_0" refFeat
				SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
			END_IF
			IF SECTION == 1
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_1" refFeat
				SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
			END_IF
			IF SECTION == 2 OR SECTION == 21
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_2" refFeat
				SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
			END_IF
			IF DW_RTRN == "IN" AND XDW_RTRN == "IN"
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "DW_RTRN" refFeat
				SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
			END_IF		
		END_IF
		
		IF FLOOR_CLIPS == "ADJUSTABLE"
			RETRIEVE_MDL FLOOR_CLIP_ADJUSTABLE.ASM COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			
				SEARCH_MDL_REF FRAME_ASM CSYS "FLOOR_CLIPS" ATTACH
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX ((JOW/2) + FACEE - 1.25)
					UDF_DIM	LOCY 0
					UDF_DIM	LOCZ -JD/2
					UDF_EXP_REF ATTACH CSYS 0
				END_CREATE_UDF

				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE
			
			SET_MDL_PARAM COMP "STOCKTYPE" 1
			SET_MDL_PARAM COMP "RETURN" RETURN
			SET_MDL_PARAM COMP "FACEE" FACEE
			SET_MDL_PARAM COMP "XRETURN" XRETURN
			SET_MDL_PARAM COMP "XFACEE" XFACEE
			SET_MDL_PARAM COMP "JD" JD
			SET_MDL_PARAM COMP "XX_JD" JD
			SET_MDL_PARAM COMP "STOPP" STOPP
			SET_MDL_PARAM COMP "RABBET" RABBET
			SET_MDL_PARAM COMP "XRABBET" XRABBET
			SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
			SET_MDL_PARAM COMP "FR_THICKNESS" FR_THICKNESS
			SET_MDL_PARAM COMP "SMT_THICKNESS" 0.075
			SET_MDL_PARAM COMP "ITEMNUM" ""

			IF DW_RTRN == "IN"
				SET_MDL_PARAM COMP "DWRTRN" 1
			END_IF
			
			SEARCH_MDL_REF ALLOW_SUPPRESSED COMP FEATURE "SECTION_2" refFeat
			SET_FEATURE_STATE refFeat SUPPRESSED
			SEARCH_MDL_REF ALLOW_SUPPRESSED COMP FEATURE "DW_RTRN" refFeat
			SET_FEATURE_STATE refFeat SUPPRESSED
			SEARCH_MDL_REF ALLOW_SUPPRESSED COMP FEATURE "XDW_RTRN" refFeat
			SET_FEATURE_STATE refFeat SUPPRESSED

			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX
			
			SEARCH_MDL_REF FRAME_ASM COMPONENT "floor_clip*" COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT

			SEARCH_MDL_REF FRAME_ASM CSYS "FLOOR_CLIPS" ATTACH
			CREATE_UDF udf\csys FRAME_ASM
				UDF_REF ATTACH ATTACH
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 180
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX -((JOW/2) + FACEE - 1.25)
				UDF_DIM	LOCY 0
				UDF_DIM	LOCZ -JD/2
				UDF_EXP_REF ATTACH CSYS 0
			END_CREATE_UDF

			ASSEMBLE COMP FRAME_ASM
				CSYS ATTACH PLACEMENT
			END_ASSEMBLE

			RETRIEVE_MDL FLOOR_CLIP_ADJUSTABLE.ASM COMP
			
			SET_MDL_PARAM COMP "STOCKTYPE" 0
			SET_MDL_PARAM COMP "RETURN" RETURN
			SET_MDL_PARAM COMP "FACEE" FACEE
			SET_MDL_PARAM COMP "XRETURN" XRETURN
			SET_MDL_PARAM COMP "XFACEE" XFACEE
			SET_MDL_PARAM COMP "JD" JD
			SET_MDL_PARAM COMP "XX_JD" JD
			SET_MDL_PARAM COMP "STOPP" STOPP
			SET_MDL_PARAM COMP "RABBET" RABBET
			SET_MDL_PARAM COMP "XRABBET" XRABBET
			SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
			SET_MDL_PARAM COMP "FR_THICKNESS" FR_THICKNESS
			SET_MDL_PARAM COMP "SMT_THICKNESS" 0.075
			SET_MDL_PARAM COMP "ITEMNUM" "FLCLIP_"+ITEM_NUM

			IF DW_RTRN == "IN"
				SET_MDL_PARAM COMP "DWRTRN" 1
			END_IF
			
			REGEN_MDL COMP FORCE
			REGEN_MDL COMP FORCE
			
			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX

			RETRIEVE_MDL FLOOR_CLIP_ADJUSTABLE.ASM FLCLIPISO_MDL
			DECLARE_VARIABLE INTEGER EXISTING_FLCLIPISO
			DECLARE_VARIABLE INTEGER REFFLCLIP
			GET_FAMINSTANCE_NAMES FLCLIPISO_MDL arrayFLCLIPISOS
			FOR FLCLIPISO REF REVERSE_ARRAY arrayFLCLIPISOS
				EXISTING_FLCLIPISO = strfind(FLCLIPISO,ITEM_NUM)
				IF EXISTING_FLCLIPISO <> -1
					REFFLCLIP = FLCLIPISO
					BREAK
				END_IF
			END_FOR		
			
			GET_REF_FAMINSTANCE FLCLIPISO_MDL &REFFLCLIP REFINST
			IF SECTION == 2 OR SECTION == 21
				SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_2" refFeat
				SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
				IF DW_RTRN == "IN"
					SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "DW_RTRN" refFeat
					SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
					SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "XDW_RTRN" refFeat
					SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
				END_IF					
			END_IF
		END_IF

		IF FLOOR_CLIPS == "INVERTED" AND ANCHOR_RECESS == 0
			RETRIEVE_MDL fixed_floor_clip.prt COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT1" PLACEMENT1

				SEARCH_MDL_REF JAMB1 CSYS "INVERTED_CSYS" ATTACH

				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT1
				END_ASSEMBLE
			
			SET_MDL_PARAM COMP "STOCKTYPE" 1			
			SET_MDL_PARAM COMP "XX_JD" JD
			SET_MDL_PARAM COMP "XX_FACEE" FACEE
			SET_MDL_PARAM COMP "XX_RETURN" RETURN
			SET_MDL_PARAM COMP "XX_XRETURN" XRETURN
			SET_MDL_PARAM COMP "XX_RABBET" RABBET
			SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
			SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
			SET_MDL_PARAM COMP "XX_DW_RTRN" 0
			SET_MDL_PARAM COMP "RECESS" ANCHOR_RECESS
			SET_MDL_PARAM COMP "SMT_THICKNESS" .075
			SET_MDL_PARAM COMP "ITEMNUM" ""
			SET_MDL_PARAM COMP "d51" 0.5
			SET_MDL_PARAM COMP "d61" 0.5
			SET_MDL_PARAM COMP "d65" 0.5

			SET_MDL_PARAM COMP "d41" JD - RABBET - XRABBET - FR_THICKNESS - FR_THICKNESS - .06
			SET_MDL_PARAM COMP "d40" 1.25
			
			
			REGEN_MDL COMP FORCE
			REGEN_MDL COMP FORCE
				
			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX
						
			SEARCH_MDL_REF FRAME_ASM COMPONENT "*floor_clip*" COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT1" PLACEMENT1

				SEARCH_MDL_REF JAMB2 CSYS "INVERTED_CSYS" ATTACH

				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT1
				END_ASSEMBLE
			
			! RETRIEVE_MDL fixed_floor_clip.prt COMP
								
			! SET_MDL_PARAM COMP "STOCKTYPE" 0
			! SET_MDL_PARAM COMP "XX_JD" JD
			! SET_MDL_PARAM COMP "XX_FACEE" FACEE
			! SET_MDL_PARAM COMP "XX_RETURN" RETURN
			! SET_MDL_PARAM COMP "XX_XRETURN" XRETURN
			! SET_MDL_PARAM COMP "XX_RABBET" RABBET
			! SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
			! SET_MDL_PARAM COMP "XX_FR_THICKNESS" FR_THICKNESS
			! SET_MDL_PARAM COMP "RECESS" ANCHOR_RECESS
			! SET_MDL_PARAM COMP "SMT_THICKNESS" .075
			! SET_MDL_PARAM COMP "ITEMNUM" "FLCLIP_"+ITEM_NUM
			! SET_MDL_PARAM COMP "d51" 0.5

			! IF JD >= 5.75 AND JD <= 5.875 AND ANCHOR_RECESS == 0
				! SET_MDL_PARAM COMP "d41" 5.5
			! ELSE
				! SET_MDL_PARAM COMP "d41" JD-.25
			! END_IF
			
			! IF FACEE < 1.5
				! SET_MDL_PARAM COMP "d40" FACEE - .25
			! ELSE
				! SET_MDL_PARAM COMP "d40" 1.25
			! END_IF
			
			! IF DW_RTRN == "IN" AND XDW_RTRN == "IN"
				! SET_MDL_PARAM COMP "XX_DW_RTRN" 0.4375
			! ELSE
				! SET_MDL_PARAM COMP "XX_DW_RTRN" 0
			! END_IF
			
				! REGEN_MDL COMP FORCE
				! REGEN_MDL COMP FORCE
				
				! CALL_EX instantiate.tab
					! VAR_IN	COMP	COMP
				! END_CALL_EX

			! RETRIEVE_MDL fixed_floor_clip.prt FLCLIPISO_MDL
			! DECLARE_VARIABLE INTEGER EXISTING_FLCLIPISO
			! DECLARE_VARIABLE INTEGER REFFLCLIP
			! GET_FAMINSTANCE_NAMES FLCLIPISO_MDL arrayFLCLIPISOS
			! FOR FLCLIPISO REF REVERSE_ARRAY arrayFLCLIPISOS
				! EXISTING_FLCLIPISO = strfind(FLCLIPISO,ITEM_NUM)
				! IF EXISTING_FLCLIPISO <> -1
					! REFFLCLIP = FLCLIPISO
					! BREAK
				! END_IF
			! END_FOR		
			! GET_REF_FAMINSTANCE FLCLIPISO_MDL &REFFLCLIP REFINST
			! IF SECTION == 0
				! SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_0" refFeat
				! SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
			! END_IF
			! IF SECTION == 1
				! SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_1" refFeat
				! SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
			! END_IF
			! IF SECTION == 2 OR SECTION == 21
				! SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "SECTION_2" refFeat
				! SET_FAMITEM_STATE FLCLIPISO_MDL REFINST refFeat RESUMED
			! END_IF
			! IF DW_RTRN == "IN" AND XDW_RTRN == "IN"
				! SEARCH_MDL_REF ALLOW_SUPPRESSED REFINST FEATURE "DW_RTRN" refFeat
				! SET_FAMITEM_STATE ANCHOR REFINST refFeat RESUMED
			! END_IF			
		END_IF
		
		
		
		
		
		
		IF ANCHOR_MDL == "*compression*"
			GET_ARRAY_ELEM ANCHORS_ARRAY ANCHOR_QTY-1 ATTACH
		
			CREATE_UDF udf\hole FRAME_ASM
				UDF_REF ATTACH ATTACH
				UDF_DIM	DIA .4375
				UDF_DIM	DEPTH STOPP+.25
				UDF_INTERSECTION * PART_LEVEL
			END_CREATE_UDF

			RETRIEVE_MDL ANCHOR_MDL COMP
				IF SECTION == 0
					SEARCH_MDL_REF COMP CSYS "PLACEMENT_0" PLACEMENT
				ELSE
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
				END_IF
			
				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE

			GET_ARRAY_ELEM ANCHORS_ARRAY (ANCHOR_QTY*2)-1 ATTACH
		
			CREATE_UDF udf\hole FRAME_ASM
				UDF_REF ATTACH ATTACH
				UDF_DIM	DIA .4375
				UDF_DIM	DEPTH STOPP+.25
				UDF_INTERSECTION * PART_LEVEL
			END_CREATE_UDF

			RETRIEVE_MDL ANCHOR_MDL COMP
				IF SECTION == 0
					SEARCH_MDL_REF COMP CSYS "PLACEMENT_0" PLACEMENT
				ELSE
					SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
				END_IF
			
				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE				
		END_IF
		
		IF BASE_CLIPS == 1
			SEARCH_MDL_REF FRAME_ASM CSYS "ORIENT" ATTACH
			CREATE_UDF udf\csys FRAME_ASM
				UDF_REF ATTACH ATTACH
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX -((JOW/2) + FR_THICKNESS + .03)
				UDF_DIM	LOCY .5
				UDF_DIM	LOCZ JD/2-RETURN-((JD-RETURN-XRETURN)/2)
				UDF_EXP_REF ATTACH CSYS 0
			END_CREATE_UDF
		
			RETRIEVE_MDL base_clip.prt COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			
				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE
			
			SET_MDL_PARAM COMP "STOCKTYPE" 1
			SET_MDL_PARAM COMP  "JD" JD
			SET_MDL_PARAM COMP  "RETURN" RETURN
			SET_MDL_PARAM COMP  "XRETURN" XRETURN
			SET_MDL_PARAM COMP  "FACEE" FACEE
			SET_MDL_PARAM COMP  "XFACEE" XFACEE

			SEARCH_MDL_REF ALLOW_SUPPRESSED COMP FEATURE SECTION_2 refFeat
			SET_FEATURE_STATE refFeat SUPPRESSED

			CALL_EX instantiate.tab
				VAR_IN	COMP	COMP
			END_CALL_EX
			
			SEARCH_MDL_REF FRAME_ASM COMPONENT "base_clip*" COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT

			CREATE_UDF udf\csys FRAME_ASM
				UDF_REF ATTACH ATTACH
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 180
				UDF_DIM	LOCX JOW + ((FR_THICKNESS+.03)*2)
				UDF_DIM	LOCY 0
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ATTACH CSYS 0
			END_CREATE_UDF

			ASSEMBLE COMP FRAME_ASM
				CSYS ATTACH PLACEMENT
			END_ASSEMBLE
		END_IF
		
		IF BASE_CLIPS == 2
			GET_ARRAY_ELEM ANCHORS_ARRAY 0 ATTACH
				CREATE_UDF udf\hole FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	DIA 1.015
					UDF_DIM	DEPTH STOPP+.25
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF
						
			RETRIEVE_MDL ANCHOR_CONCEALED_EWA.ASM COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
				ASSEMBLE COMP FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE

					SET_MDL_PARAM COMP "STOCKTYPE" 1
					SET_MDL_PARAM COMP "JD" JD
					SET_MDL_PARAM COMP "ANCHOR_CTR" ANCHOR_CTR
					SET_MDL_PARAM COMP "FACEE" FACEE
					SET_MDL_PARAM COMP "XFACEE" XFACEE
					SET_MDL_PARAM COMP "XX_RABBET" RABBET
					SET_MDL_PARAM COMP "XX_XRABBET" XRABBET
					SET_MDL_PARAM COMP "STOPP" STOPP
					SET_MDL_PARAM COMP "FR_THICKNESS" FR_THICKNESS
					SET_MDL_PARAM COMP "SOFFIT" SOFFIT
					SET_MDL_PARAM COMP "GRADE"FRAME_GRADE
					SET_MDL_PARAM COMP "TYPE" MAT_TYPE
					SET_MDL_PARAM COMP "FINISH" FRAME_FINISH		
					SET_MDL_PARAM COMP "SMT_THICKNESS" FR_THICKNESS
					SET_MDL_PARAM COMP "ITEMNUM" ""
					
					REGEN_MDL COMP FORCE
					REGEN_MDL COMP FORCE
					
					CALL_EX instantiate.tab
						VAR_IN	COMP	COMP
					END_CALL_EX

			IF ANCHOR_BOLTS == 1
				RETRIEVE_MDL bolt_ewa.prt PRT
				SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE PRT FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
			END_IF

			GET_ARRAY_SIZE ANCHORS_ARRAY ANCHORSIZE
			GET_ARRAY_ELEM ANCHORS_ARRAY ANCHORSIZE/2 ATTACH
			
				CREATE_UDF udf\hole FRAME_ASM
					UDF_REF ATTACH ATTACH
					UDF_DIM	DIA 1.015
					UDF_DIM	DEPTH STOPP+.25
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF
			
			SEARCH_MDL_REF FRAME_ASM COMPONENT "anchor_concealed_ewa*" ANCHOR						
			SEARCH_MDL_REF ANCHOR CSYS "PLACEMENT" PLACEMENT
				ASSEMBLE ANCHOR FRAME_ASM
					CSYS ATTACH PLACEMENT
				END_ASSEMBLE
				
			IF ANCHOR_BOLTS == 1
				RETRIEVE_MDL bolt_ewa.prt PRT
				SEARCH_MDL_REF PRT CSYS "PLACEMENT" PLACEMENT
					ASSEMBLE PRT FRAME_ASM
						CSYS ATTACH PLACEMENT
					END_ASSEMBLE
			END_IF			
		END_IF
		
		IF BASE_CLIPS == 4 AND ANCHOR_TYPE == 11

			SEARCH_MDL_REF FRAME_ASM CSYS "ORIENT" ASM_CSYS
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ASM_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 90
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX (JOW/2) + FACEE - .5625
					UDF_DIM	LOCY .75
					UDF_DIM	LOCZ (JD/2)
					UDF_EXP_REF refCsys CSYS 0
				END_CREATE_UDF
				CREATE_UDF udf\hole FRAME_ASM
					UDF_REF ATTACH refCsys
					UDF_DIM	DIA .165
					UDF_DIM	DEPTH FR_THICKNESS
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF
				
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ASM_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 90
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX -((JOW/2) + FACEE - .5625)
					UDF_DIM	LOCY .75
					UDF_DIM	LOCZ (JD/2)
					UDF_EXP_REF refCsys CSYS 0
				END_CREATE_UDF
				CREATE_UDF udf\hole FRAME_ASM
					UDF_REF ATTACH refCsys
					UDF_DIM	DIA .165
					UDF_DIM	DEPTH FR_THICKNESS
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF
				
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ASM_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 270
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX (JOW/2) + FACEE - .5625
					UDF_DIM	LOCY .75
					UDF_DIM	LOCZ -(JD/2)
					UDF_EXP_REF refCsys CSYS 0
				END_CREATE_UDF
				CREATE_UDF udf\hole FRAME_ASM
					UDF_REF ATTACH refCsys
					UDF_DIM	DIA .165
					UDF_DIM	DEPTH FR_THICKNESS
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF
				
				CREATE_UDF udf\csys FRAME_ASM
					UDF_REF ATTACH ASM_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 270
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX -((JOW/2) + FACEE - .5625)
					UDF_DIM	LOCY .75
					UDF_DIM	LOCZ -(JD/2)
					UDF_EXP_REF refCsys CSYS 0
				END_CREATE_UDF
				CREATE_UDF udf\hole FRAME_ASM
					UDF_REF ATTACH refCsys
					UDF_DIM	DIA .165
					UDF_DIM	DEPTH FR_THICKNESS
					UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF
		END_IF
		
	END_IF	
END_ASM_DESCR
