
BEGIN_ASM_DESCR
ENABLE_DATA_CAPTURE_MODE FALSE

PRINT "******************************************** REPLACE ********************************"

DECLARE_REFERENCE COMP
DECLARE_VARIABLE STRING MATCH
DECLARE_ARRAY GENERIC_ITEMS
DECLARE_ARRAY COMPONENT_GENERIC_INSTANCE_NAMES
DECLARE_ARRAY ITEMS_FOR_DELETION

SEARCH_MDL_REFS RECURSIVE COMP COMPONENT "*" ALL_COMPONENTS

GET_REF_NAME COMP COMP_NAME
PRINT "COMP NAME % " COMP_NAME 
FOR COMPS REF ARRAY ALL_COMPONENTS
	GET_REF_NAME COMPS NAME
	! PRINT "%" COMPS
	PRINT "%" NAME	
END_FOR
! EXI

FOR COMPONENT_TO_CHECK REF REVERSE_ARRAY ALL_COMPONENTS
	SEARCH_MDL_PARAM COMPONENT_TO_CHECK "STOCKTYPE" COMPONENT_STOCKTYPE
	IF COMPONENT_STOCKTYPE <> 3
		! GET_MDL_EXTENSION COMPONENT_TO_CHECK COMPONENT_EXTENSION
		GET_REF_PARENT COMPONENT_TO_CHECK  COMPONENT_PARENT
		! SEARCH_MDL_PARAM COMPONENT_PARENT "STOCKTYPE" COMPONENT_PARENT_STOCKTYPE
		! IF COMPONENT_PARENT_STOCKTYPE == 1
			GET_REF_GENERIC COMPONENT_TO_CHECK COMPONENT_GENERIC
			GET_REF_NAME COMPONENT_GENERIC COMPONENT_GENERIC_NAME
			GET_MDL_EXTENSION COMPONENT_GENERIC CG_EXT
			GET_REF_NAME COMPONENT_TO_CHECK COMPONENT_NAME
			GET_MDL_EXTENSION COMPONENT_TO_CHECK CTC_EXT
			IF COMPONENT_NAME+"."+CTC_EXT <> COMPONENT_GENERIC_NAME+"."+CG_EXT
				CLEAR_ARRAY COMPONENT_GENERIC_INSTANCE_NAMES
				GET_FAMINSTANCE_NAMES COMPONENT_GENERIC COMPONENT_GENERIC_INSTANCE_NAMES

! FOR INSTANCE_NAME REF ARRAY COMPONENT_GENERIC_INSTANCE_NAMES
	! PRINT "INSTANCE NAME %  " INSTANCE_NAME
! END_FOR

				FOR INSTANCE_NAME REF ARRAY COMPONENT_GENERIC_INSTANCE_NAMES
					GET_REF_FAMINSTANCE COMPONENT_TO_CHECK INSTANCE_NAME INSTANCE_TO_CHECK
					IF INSTANCE_NAME == COMPONENT_NAME
						BREAK
					ELSE
						CLEAR_ARRAY GENERIC_ITEMS
						GET_FAMITEMS COMPONENT_GENERIC GENERIC_ITEMS
! FOR ITEM REF ARRAY GENERIC_ITEMS
	! PRINT "%" ITEM
! END_FOR

						MATCH = "YES"
						FOR ITEM REF ARRAY GENERIC_ITEMS

							IF ITEM <> "INDEX" AND ITEM <> "M*"	\
								AND ITEM <> "STOCKTYPE"		\
								AND ITEM <> "EMJACNUM"		\
								AND ITEM <> "EMJACDESC"		\
								AND ITEM <> "USED" 			\
								AND ITEM <> "STOCKED"		\
								AND ITEM <> "CSYS_CHECK"	\
								AND ITEM <> "INDEX"			\
								AND ITEM <> "Common Name"	\
								AND ITEM <> "XX*"				\
								AND ITEM <> "ITEMNUM"		\
								AND ITEM <> "PDF"						
							! IF ITEM == "CSYS_CHECK" OR ITEM == "STOCKTYPE" OR ITEME == "STOCKED" OR ITEM == "EMJACNUM" OR \
							   ! ITEM == "SINDEX" OR ITEM == "Common Name" OR ITEM == "USED" OR ITEM == "PDF"
							   ! MATCH = "YES"
							! ELSE
								GET_FAMITEM_VALUE COMPONENT_GENERIC INSTANCE_NAME ITEM INSTANCE_ITEM_VALUE
								GET_FAMITEM_VALUE COMPONENT_GENERIC COMPONENT_NAME ITEM COMPONENT_ITEM_VALUE
								
					PRINT "ITEM   %    NEW   %   EXIST  %" ITEM INSTANCE_ITEM_VALUE COMPONENT_ITEM_VALUE

								IF COMPONENT_ITEM_VALUE == INSTANCE_ITEM_VALUE
									MATCH = "YES"
! PRINT "ITEM   %  %  " ITEM MATCH
								ELSE
									MATCH = "NO"
! PRINT "ITEM   %  %  " ITEM MATCH
									BREAK
								END_IF

							END_IF
						END_FOR
PRINT "*****************************                    %                         *************"	MATCH
						
						IF MATCH == "YES"
PRINT "THIS ONE MATCHES"
							GET_REF_GENERIC COMPONENT_PARENT COMPONENT_PARENT_GENERIC
							GET_REF_NAME COMPONENT_PARENT_GENERIC COMPONENT_PARENT_GENERIC_NAME
							GET_REF_NAME COMPONENT_PARENT COMPONENT_PARENT_NAME

PRINT "%  " COMPONENT_PARENT_GENERIC_NAME
PRINT "%  " COMPONENT_PARENT_NAME
							
							IF COMPONENT_PARENT_GENERIC_NAME == COMPONENT_PARENT_NAME
								REPLACE_COMPONENT COMPONENT_TO_CHECK INSTANCE_TO_CHECK
								ADD_ARRAY_ELEM ITEMS_FOR_DELETION COMPONENT_GENERIC
								ADD_ARRAY_ELEM ITEMS_FOR_DELETION COMPONENT_NAME
								! DELETE_FAMINSTANCE COMPONENT_GENERIC COMPONENT_NAME
								BREAK
							ELSE
								CLEAR_ARRAY GENERIC_ITEMS
								GET_FAMITEMS COMPONENT_PARENT_GENERIC GENERIC_ITEMS
								FOR ITEM REF ARRAY GENERIC_ITEMS
									GET_FAMITEM_VALUE COMPONENT_PARENT_GENERIC COMPONENT_PARENT_NAME ITEM ITEM_VALUE
									IF ITEM_VALUE == COMPONENT_NAME
										SET_FAMITEM_VALUE COMPONENT_PARENT_GENERIC COMPONENT_PARENT_NAME ITEM INSTANCE_NAME
									END_IF
								END_FOR
								GET_REF_OWNER COMPONENT_TO_CHECK CTC_OWNER
								REGEN_MDL COMP
								ADD_ARRAY_ELEM ITEMS_FOR_DELETION COMPONENT_GENERIC
								ADD_ARRAY_ELEM ITEMS_FOR_DELETION COMPONENT_NAME
							END_IF
						END_IF
					END_IF
				END_FOR
			END_IF
		! END_IF
	END_IF
END_FOR

DECLARE_VARIABLE INTEGER DITP

GET_ARRAY_SIZE ITEMS_FOR_DELETION SIZE
DITP = 0

WHILE DITP < SIZE
	GET_ARRAY_ELEM ITEMS_FOR_DELETION DITP COMPONENT_GENERIC
	DITP++
	GET_ARRAY_ELEM ITEMS_FOR_DELETION DITP COMPONENT_NAME
	DELETE_FAMINSTANCE COMPONENT_GENERIC COMPONENT_NAME
	DITP++
END_WHILE	

CLEAR_ARRAY ITEMS_FOR_DELETION

REGEN_MDL COMP FORCE

! EXCEL_SET_VALUE 4 EXCEL_COLUMN "REPLACED"
! EXCEL_SAVE_DOCUMENT EXCEL_DOCUMENT_NAME

END_ASM_DESCR
