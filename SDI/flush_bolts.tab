BEGIN_ASM_DESCR

INVALIDATE_REF ASM_CSYS
DECLARE_VARIABLE STRING PREP
DECLARE_VARIABLE DOUBLE ARMOR_BEVEL
DECLARE_VARIABLE DOUBLE ARMOR_WIDTH 1.03
DECLARE_VARIABLE DOUBLE ARMOR_HEIGHT 6.78
DECLARE_VARIABLE STRING ARMOR_INST

IF WELDED_PREPS <> 1 AND DOOR_CONSTRUCTION == "SEAMLESS"
	IF DOOR_CONSTRUCTION == "SEAMLESS" AND DOOR_THICKNESS - .125 - ARMOR_WIDTH <= .4
			ARMOR_INST = "WITH_TAB"
	ELSE_IF DOOR_CONSTRUCTION == "SEAMLESS" AND DOOR_THICKNESS - .125 - ARMOR_WIDTH > .4
			ARMOR_INST = "NO_TAB"
	END_IF
	
	IF STRIKE_EDGE_SHAPE == "BEVEL"
		ARMOR_BEVEL = 4
	ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
		ARMOR_BEVEL = 0
	END_IF

	IF	HAND_ == "LHI*" OR HAND_ == "RHRI*"
		SEARCH_MDL_REF DOOR_ASM CSYS "ACS3" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
		IF DOOR_CONSTRUCTION == "SEAMLESS"
			SEARCH_MDL_REF BODY SURFACE "SURFACE_S1" BODY_ARMOR
			SEARCH_MDL_REF COVER SURFACE "SURFACE_S1" COVER_ARMOR
			BODY_ROTATION = 180
			COVER_ROTATION = 0
		END_IF
	END_IF

	IF	HAND_ == "RHI*" OR HAND_ == "LHRI*"
		SEARCH_MDL_REF DOOR_ASM CSYS "ACS4" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
		IF DOOR_CONSTRUCTION == "SEAMLESS"
			SEARCH_MDL_REF BODY SURFACE "SURFACE_S2" BODY_ARMOR
			SEARCH_MDL_REF COVER SURFACE "SURFACE_S2" COVER_ARMOR
			BODY_ROTATION = 0
			COVER_ROTATION = 180
		END_IF
	END_IF

	IF FLUSH_BOLTS == 1 OR FLUSH_BOLTS == 3
		CREATE_UDF udf\csys DOOR_ASM
			UDF_REF ATTACH ATTACH
			UDF_DIM	ROTX 0
			UDF_DIM	ROTY 0
			UDF_DIM	ROTZ 0
			UDF_DIM	LOCX -2.5
			UDF_DIM	LOCY UNDERCUT + DOOR_HEIGHT - FLUSH_BOLT_CENTER_TOP
			UDF_DIM	LOCZ 0
			UDF_EXP_REF FBTC CSYS 0
		END_CREATE_UDF
			SET_REF_NAME FBTC "FBTC"
		
		CREATE_UDF udf\face_plate COVER
			UDF_INSTANCE ARMOR_INST
			UDF_REF ATTACH ATTACH
			UDF_REF ARMOR_SURFACE COVER_ARMOR		
			UDF_DIM STRIKE_CTR UNDERCUT + DOOR_HEIGHT - FLUSH_BOLT_CENTER_TOP
			UDF_DIM OFFSET 0
			UDF_DIM ROTATION COVER_ROTATION
			UDF_DIM BEVEL ARMOR_BEVEL
			UDF_DIM ARMOR_WIDTH ARMOR_WIDTH
			UDF_DIM ARMOR_HEIGHT ARMOR_HEIGHT
			UDF_EXP_REF ATTACH2 CSYS 1
			UDF_INTERSECTION * PART_LEVEL
		END_CREATE_UDF

		CREATE_UDF udf\face_plate BODY
			UDF_INSTANCE ARMOR_INST
			UDF_REF ATTACH ATTACH
			UDF_REF ARMOR_SURFACE BODY_ARMOR	
			UDF_DIM STRIKE_CTR UNDERCUT + DOOR_HEIGHT - FLUSH_BOLT_CENTER_TOP
			UDF_DIM OFFSET 0
			UDF_DIM ROTATION BODY_ROTATION
			UDF_DIM BEVEL ARMOR_BEVEL
			UDF_DIM ARMOR_WIDTH ARMOR_WIDTH
			UDF_DIM ARMOR_HEIGHT ARMOR_HEIGHT
			UDF_EXP_REF ATTACH2 CSYS 1
			UDF_INTERSECTION * PART_LEVEL
		END_CREATE_UDF

		RETRIEVE_MDL FLUSH_BOLT_TABS.ASM COMP
		SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
		
		ASSEMBLE COMP DOOR_ASM
			 CSYS ATTACH2 PLACEMENT
		END_ASSEMBLE

		IF TOP_EDGE == "SEAMLESS" OR TOP_EDGE == "WELDED" OR TOP_EDGE == "TACKED"		
			CREATE_UDF udf\std_fb_cutout DOOR_ASM
				UDF_REF ATTACH ATTACH
				UDF_DIM d1165 UNDERCUT+DOOR_HEIGHT-.25
				UDF_INTERSECTION * PART_LEVEL
				UDF_EXP_REF ATTACH2 CSYS 0
			END_CREATE_UDF
			
			RETRIEVE_MDL FB_BU_DOOR.PRT COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			
			ASSEMBLE COMP DOOR_ASM
				 CSYS ATTACH2 PLACEMENT
			END_ASSEMBLE
		END_IF		
	END_IF

	IF FLUSH_BOLTS == 2 OR FLUSH_BOLTS == 3
		CREATE_UDF udf\csys DOOR_ASM
			UDF_REF ATTACH ATTACH
			UDF_DIM	ROTX 0
			UDF_DIM	ROTY 0
			UDF_DIM	ROTZ 0
			UDF_DIM	LOCX -2.5
			UDF_DIM	LOCY UNDERCUT+FLUSH_BOLT_CENTER_BOTTOM
			UDF_DIM	LOCZ 0
			UDF_EXP_REF FBBC CSYS 0
		END_CREATE_UDF
			SET_REF_NAME FBBC "FBBC"
		
		CREATE_UDF udf\face_plate COVER
			UDF_INSTANCE ARMOR_INST
			UDF_REF ATTACH ATTACH
			UDF_REF ARMOR_SURFACE COVER_ARMOR		
			UDF_DIM STRIKE_CTR UNDERCUT + FLUSH_BOLT_CENTER_BOTTOM
			UDF_DIM OFFSET 0
			UDF_DIM ROTATION COVER_ROTATION
			UDF_DIM BEVEL ARMOR_BEVEL
			UDF_DIM ARMOR_WIDTH ARMOR_WIDTH
			UDF_DIM ARMOR_HEIGHT ARMOR_HEIGHT
			UDF_EXP_REF ATTACH2 CSYS 1
			UDF_INTERSECTION * PART_LEVEL
		END_CREATE_UDF

		CREATE_UDF udf\face_plate BODY
			UDF_INSTANCE ARMOR_INST
			UDF_REF ATTACH ATTACH
			UDF_REF ARMOR_SURFACE BODY_ARMOR	
			UDF_DIM STRIKE_CTR UNDERCUT + FLUSH_BOLT_CENTER_BOTTOM
			UDF_DIM OFFSET 0
			UDF_DIM ROTATION BODY_ROTATION
			UDF_DIM BEVEL ARMOR_BEVEL
			UDF_DIM ARMOR_WIDTH ARMOR_WIDTH
			UDF_DIM ARMOR_HEIGHT ARMOR_HEIGHT
			UDF_EXP_REF ATTACH2 CSYS 1
			UDF_INTERSECTION * PART_LEVEL
		END_CREATE_UDF			

		RETRIEVE_MDL FLUSH_BOLT_TABS.ASM COMP
		SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
				
		ASSEMBLE COMP DOOR_ASM
			 CSYS ATTACH2 PLACEMENT
		END_ASSEMBLE

		IF BOTTOM_EDGE == "SEAMLESS" OR BOTTOM_EDGE == "WELDED" OR BOTTOM_EDGE == "TACKED"		
			CREATE_UDF udf\std_fb_cutout DOOR_ASM
				UDF_REF ATTACH ATTACH
				UDF_DIM d1165 UNDERCUT + .25
				UDF_INTERSECTION * PART_LEVEL
				UDF_EXP_REF ATTACH2 CSYS 0
			END_CREATE_UDF

			RETRIEVE_MDL FB_BU_DOOR.PRT COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			
			ASSEMBLE COMP DOOR_ASM
				 CSYS ATTACH2 PLACEMENT
			END_ASSEMBLE			
		END_IF		
	END_IF	
END_IF


IF WELDED_PREPS <> 1 AND DOOR_CONSTRUCTION == "LOCKSEAM"
	ARMOR_INST = "WITH_TAB"
	
	IF STRIKE_EDGE_SHAPE == "BEVEL"
		ARMOR_BEVEL = 4
	ELSE_IF STRIKE_EDGE_SHAPE == "SQUARE"
		ARMOR_BEVEL = 0
	END_IF

	IF	HAND_ == "LHI*" OR HAND_ == "RHRI*"
		SEARCH_MDL_REF DOOR_ASM CSYS "ACS3" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
			SEARCH_MDL_REF BODY SURFACE "SURFACE_L1" BODY_ARMOR
			BODY_ROTATION = 180
			COVER_ROTATION = 0
	END_IF

	IF	HAND_ == "RHI*" OR HAND_ == "LHRI*"
		SEARCH_MDL_REF DOOR_ASM CSYS "ACS4" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
			SEARCH_MDL_REF BODY SURFACE "SURFACE_L2" BODY_ARMOR
			BODY_ROTATION = 0
			COVER_ROTATION = 180
	END_IF

	IF FLUSH_BOLTS == 1 OR FLUSH_BOLTS == 3
		CREATE_UDF udf\csys DOOR_ASM
			UDF_REF ATTACH ATTACH
			UDF_DIM	ROTX 0
			UDF_DIM	ROTY 0
			UDF_DIM	ROTZ 0
			UDF_DIM	LOCX -2.5
			UDF_DIM	LOCY UNDERCUT + DOOR_HEIGHT - FLUSH_BOLT_CENTER_TOP
			UDF_DIM	LOCZ 0
			UDF_EXP_REF FBTC CSYS 0
		END_CREATE_UDF
			SET_REF_NAME FBTC "FBTC"
		
		! CREATE_UDF udf\face_plate COVER
			! UDF_INSTANCE ARMOR_INST
			! UDF_REF ATTACH ATTACH
			! UDF_REF ARMOR_SURFACE COVER_ARMOR		
			! UDF_DIM STRIKE_CTR UNDERCUT + DOOR_HEIGHT - FLUSH_BOLT_CENTER_TOP
			! UDF_DIM OFFSET 0
			! UDF_DIM ROTATION COVER_ROTATION
			! UDF_DIM BEVEL ARMOR_BEVEL
			! UDF_DIM ARMOR_WIDTH ARMOR_WIDTH
			! UDF_DIM ARMOR_HEIGHT ARMOR_HEIGHT
			! UDF_EXP_REF ATTACH2 CSYS 1
			! UDF_INTERSECTION * PART_LEVEL
		! END_CREATE_UDF

		CREATE_UDF udf\face_plate BODY
			UDF_INSTANCE ARMOR_INST
			UDF_REF ATTACH ATTACH
			UDF_REF ARMOR_SURFACE BODY_ARMOR	
			UDF_DIM STRIKE_CTR UNDERCUT + DOOR_HEIGHT - FLUSH_BOLT_CENTER_TOP
			UDF_DIM OFFSET 0
			UDF_DIM ROTATION BODY_ROTATION
			UDF_DIM BEVEL ARMOR_BEVEL
			UDF_DIM ARMOR_WIDTH ARMOR_WIDTH
			UDF_DIM ARMOR_HEIGHT ARMOR_HEIGHT
			UDF_EXP_REF ATTACH2 CSYS 1
			UDF_INTERSECTION * PART_LEVEL
		END_CREATE_UDF

		RETRIEVE_MDL FLUSH_BOLT_TABS.ASM COMP
		SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
		
		ASSEMBLE COMP DOOR_ASM
			 CSYS ATTACH2 PLACEMENT
		END_ASSEMBLE
		
		CREATE_UDF udf\csys DOOR_ASM
			UDF_REF ATTACH ATTACH2
			UDF_DIM	ROTX 0
			UDF_DIM	ROTY 0
			UDF_DIM	ROTZ 0
			UDF_DIM	LOCX -.75
			UDF_DIM	LOCY FLUSH_BOLT_CENTER_TOP - .125
			UDF_DIM	LOCZ 0
			UDF_EXP_REF ATTACH2 CSYS 0
		END_CREATE_UDF

		RETRIEVE_MDL FB_BRKT_6537.PRT COMP
		SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
		
		ASSEMBLE COMP DOOR_ASM
			 CSYS ATTACH2 PLACEMENT
		END_ASSEMBLE
		
		
		! IF TOP_EDGE == "SEAMLESS" OR TOP_EDGE == "WELDED" OR TOP_EDGE == "TACKED"
			! CREATE_UDF udf\std_fb_cutout DOOR_ASM
				! UDF_REF ATTACH ATTACH
				! UDF_DIM d1165 UNDERCUT+DOOR_HEIGHT-.25
				! UDF_INTERSECTION * PART_LEVEL
				! UDF_EXP_REF ATTACH2 CSYS 0
			! END_CREATE_UDF
			
			! RETRIEVE_MDL FB_BU_DOOR.PRT COMP
			! SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			
			! ASSEMBLE COMP DOOR_ASM
				 ! CSYS ATTACH2 PLACEMENT
			! END_ASSEMBLE
		! END_IF		
	END_IF

	IF FLUSH_BOLTS == 2 OR FLUSH_BOLTS == 3
		CREATE_UDF udf\csys DOOR_ASM
			UDF_REF ATTACH ATTACH
			UDF_DIM	ROTX 0
			UDF_DIM	ROTY 0
			UDF_DIM	ROTZ 0
			UDF_DIM	LOCX -2.5
			UDF_DIM	LOCY UNDERCUT+FLUSH_BOLT_CENTER_BOTTOM
			UDF_DIM	LOCZ 0
			UDF_EXP_REF FBBC CSYS 0
		END_CREATE_UDF
			SET_REF_NAME FBBC "FBBC"
		
		! CREATE_UDF udf\face_plate COVER
			! UDF_INSTANCE ARMOR_INST
			! UDF_REF ATTACH ATTACH
			! UDF_REF ARMOR_SURFACE COVER_ARMOR		
			! UDF_DIM STRIKE_CTR UNDERCUT + FLUSH_BOLT_CENTER_BOTTOM
			! UDF_DIM OFFSET 0
			! UDF_DIM ROTATION COVER_ROTATION
			! UDF_DIM BEVEL ARMOR_BEVEL
			! UDF_DIM ARMOR_WIDTH ARMOR_WIDTH
			! UDF_DIM ARMOR_HEIGHT ARMOR_HEIGHT
			! UDF_EXP_REF ATTACH2 CSYS 1
			! UDF_INTERSECTION * PART_LEVEL
		! END_CREATE_UDF

		CREATE_UDF udf\face_plate BODY
			UDF_INSTANCE ARMOR_INST
			UDF_REF ATTACH ATTACH
			UDF_REF ARMOR_SURFACE BODY_ARMOR	
			UDF_DIM STRIKE_CTR UNDERCUT + FLUSH_BOLT_CENTER_BOTTOM
			UDF_DIM OFFSET 0
			UDF_DIM ROTATION BODY_ROTATION
			UDF_DIM BEVEL ARMOR_BEVEL
			UDF_DIM ARMOR_WIDTH ARMOR_WIDTH
			UDF_DIM ARMOR_HEIGHT ARMOR_HEIGHT
			UDF_EXP_REF ATTACH2 CSYS 1
			UDF_INTERSECTION * PART_LEVEL
		END_CREATE_UDF			

		RETRIEVE_MDL FLUSH_BOLT_TABS.ASM COMP
		SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
				
		ASSEMBLE COMP DOOR_ASM
			 CSYS ATTACH2 PLACEMENT
		END_ASSEMBLE

		CREATE_UDF udf\csys DOOR_ASM
			UDF_REF ATTACH ATTACH2
			UDF_DIM	ROTX 180
			UDF_DIM	ROTY 0
			UDF_DIM	ROTZ 0
			UDF_DIM	LOCX -.75
			UDF_DIM	LOCY -FLUSH_BOLT_CENTER_BOTTOM + .125
			UDF_DIM	LOCZ 0
			UDF_EXP_REF ATTACH2 CSYS 0
		END_CREATE_UDF

		RETRIEVE_MDL FB_BRKT_6537.PRT COMP
		SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
		
		ASSEMBLE COMP DOOR_ASM
			 CSYS ATTACH2 PLACEMENT
		END_ASSEMBLE
		
		
		! IF BOTTOM_EDGE == "SEAMLESS" OR BOTTOM_EDGE == "WELDED" OR BOTTOM_EDGE == "TACKED"
			! CREATE_UDF udf\std_fb_cutout DOOR_ASM
				! UDF_REF ATTACH ATTACH
				! UDF_DIM d1165 UNDERCUT + .25
				! UDF_INTERSECTION * PART_LEVEL
				! UDF_EXP_REF ATTACH2 CSYS 0
			! END_CREATE_UDF

			! RETRIEVE_MDL FB_BU_DOOR.PRT COMP
			! SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			
			! ASSEMBLE COMP DOOR_ASM
				 ! CSYS ATTACH2 PLACEMENT
			! END_ASSEMBLE			
		! END_IF		
	END_IF	
END_IF
END_ASM_DESCR
