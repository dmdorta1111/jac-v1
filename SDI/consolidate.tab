BEGIN_ASM_DESCR

	DECLARE_VARIABLE STRING EEOF
	DECLARE_VARIABLE INTEGER TEST_ROW
	DECLARE_VARIABLE STRING EXCEL_COMPONENT_NAME
	DECLARE_VARIABLE STRING TEST_NAME

	EXCEL_ACTIVATE_DOCUMENT BOM_DOCUMENT_NAME
	EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "LISTING"

	DECLARE_STRUCT MASS_PROPERTIES comprops
	DECLARE_STRUCT MASS_PROPERTIES testprops

	EXCEL_ROW = 6
	EXCEL_GET_VALUE EXCEL_ROW 1 EXCEL_COMPONENT_NAME
	EXCEL_GET_VALUE EXCEL_ROW 2 STOCKTYPE

	IF EXCEL_COMPONENT_NAME == "" OR STOCKTYPE <> 1
		EEOF = "TRUE"
	ELSE
		EEOF = "FALSE"
	END_IF

	WHILE EEOF == "FALSE"
		EXCEL_GET_VALUE EXCEL_ROW 0 INDEX
		
		SINDEX = itos(INDEX)
		IF strlen(SINDEX) == 1
			SINDEX = "00"+SINDEX
		ELSE_IF strlen(SINDEX) == 2
			SINDEX = "0"+SINDEX
		END_IF
		
		EXCEL_GET_VALUE EXCEL_ROW 1 EXCEL_COMPONENT_NAME
		EXCEL_GET_VALUE EXCEL_ROW 2 STOCKTYPE
		EXCEL_GET_VALUE EXCEL_ROW 2 QUANTITY
		EXCEL_GET_VALUE EXCEL_ROW 4 THICKNESS
		EXCEL_GET_VALUE EXCEL_ROW 5 TYPE
		EXCEL_GET_VALUE EXCEL_ROW 6 SHAPE
		EXCEL_GET_VALUE EXCEL_ROW 7 GRADE
		EXCEL_GET_VALUE EXCEL_ROW 8 FINISH
		EXCEL_GET_VALUE EXCEL_ROW 9 SIZE1
		EXCEL_GET_VALUE EXCEL_ROW 10 SIZE2
		EXCEL_GET_VALUE EXCEL_ROW 11 WIDTH
		EXCEL_GET_VALUE EXCEL_ROW 12 LENGHT
		EXCEL_GET_VALUE EXCEL_ROW 13 GRAIN
		EXCEL_GET_VALUE EXCEL_ROW 14 PVC
		EXCEL_GET_VALUE EXCEL_ROW 15 DEBURR
		EXCEL_GET_VALUE EXCEL_ROW 15 EMJACDESC

		COMPONENT_NAME = EXCEL_COMPONENT_NAME+".prt"
		RETRIEVE_MDL COMPONENT_NAME COMP_
		
		SEARCH_MDL_REF COMP_ CSYS "DIM" DIM
		GET_MASS_PROPERTIES COMP_ DIM comprops
		
		EOF = "FALSE"
		TEST_ROW = EXCEL_ROW + 1
		WHILE EOF == "FALSE"
			EXCEL_GET_VALUE TEST_ROW 1 TEST_COMPONENT_NAME
			EXCEL_GET_VALUE TEST_ROW 2 TEST_STOCKTYPE
			IF TEST_COMPONENT_NAME == "" OR TEST_STOCKTYPE <> 1
				EOF = "TRUE"
			ELSE
				EXCEL_GET_VALUE TEST_ROW 3 TEST_QUANTITY
				EXCEL_GET_VALUE TEST_ROW 4 TEST_THICKNESS
				IF TEST_THICKNESS == THICKNESS
					EXCEL_GET_VALUE TEST_ROW 5 TEST_TYPE
					IF TEST_TYPE == TYPE
						EXCEL_GET_VALUE TEST_ROW 6 TEST_SHAPE
						IF TEST_SHAPE == SHAPE
							EXCEL_GET_VALUE TEST_ROW 7 TEST_GRADE
							IF GRADE == TEST_GRADE
								EXCEL_GET_VALUE TEST_ROW 8 TEST_FINISH
								IF TEST_FINISH == FINISH
									EXCEL_GET_VALUE TEST_ROW 9 TEST_SIZE1
									IF TEST_SIZE1 == SIZE1
										EXCEL_GET_VALUE TEST_ROW 10 TEST_SIZE2
										IF TEST_SIZE2 == SIZE2
											EXCEL_GET_VALUE TEST_ROW 11 TEST_WIDTH
											IF TEST_WIDTH == WIDTH
												EXCEL_GET_VALUE TEST_ROW 12 TEST_LENGHT
												IF TEST_LENGHT == LENGHT
													EXCEL_GET_VALUE TEST_ROW 13 TEST_GRAIN
													IF TEST_GRAIN == GRAIN
														EXCEL_GET_VALUE TEST_ROW 14 TEST_PVC
														IF TEST_PVC == PVC
															EXCEL_GET_VALUE TEST_ROW 15 TEST_DEBURR
															IF TEST_DEBURR == DEBURR				

																TEST_NAME = TEST_COMPONENT_NAME+".prt"
																RETRIEVE_MDL TEST_NAME TEST_COMP
																SEARCH_MDL_REF TEST_COMP CSYS "DIM" DIM
																GET_MASS_PROPERTIES TEST_COMP DIM testprops
																IF comprops.volume == testprops.volume AND comprops.center_of_gravity.x == testprops.center_of_gravity.x AND \
																  comprops.center_of_gravity.y == testprops.center_of_gravity.y AND comprops.center_of_gravity.z == testprops.center_of_gravity.z
																	EXCEL_GET_VALUE EXCEL_ROW 3 QUANTITY
																	EXCEL_SET_VALUE EXCEL_ROW 3 QUANTITY + TEST_QUANTITY
																	EXCEL_SET_VALUE TEST_ROW  1 "XX_"+TEST_COMPONENT_NAME
																	EXCEL_SET_VALUE TEST_ROW  2 "99"
																	SET_MDL_PARAM TEST_COMP "EMJACNUM" SINDEX
																	SET_MDL_PARAM TEST_COMP "EMJACDESC" EXCEL_COMPONENT_NAME
																	
																	SAVE_MDL TEST_COMP
																	DECLARE_ARRAY MACRO
																	EXCEL_RUN_MACRO "macro2" MACRO
																	EXCEL_RUN_MACRO "macro2" MACRO
																END_IF
															END_IF
														END_IF
													END_IF
												END_IF
											END_IF
										END_IF
									END_IF
								END_IF
							END_IF
						END_IF
					END_IF
				END_IF
			END_IF
			TEST_ROW ++
		END_WHILE
		EXCEL_ROW ++
		EXCEL_GET_VALUE EXCEL_ROW 1 EXCEL_COMPONENT_NAME
		EXCEL_GET_VALUE EXCEL_ROW 2 STOCKTYPE
		IF EXCEL_COMPONENT_NAME == "" OR STOCKTYPE <> 1
			EEOF = "TRUE"
		ELSE
			EEOF = "FALSE"
		END_IF		
	END_WHILE

END_ASM_DESCR