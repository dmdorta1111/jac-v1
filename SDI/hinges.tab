
BEGIN_ASM_DESCR

	IF HINGE_TYPE == "BUTT"
		DECLARE_VARIABLE STRING LOOKUPSTRINGNO
						LOOKUPSTRINGNO = "HINGE_HEIGHT == " + ftos(HINGE_HEIGHT,3) + " AND HINGE_THICKNESS == " + ftos(HINGE_THICKNESS,3) + \
						 " AND DR_GA == " + ftos(SM_THICK,3) + " AND GRADE == " + DOOR_GRADE + " AND ELEC == 0"+ " AND WELDED_BOX == " + itos(WELDED_BOXES)
		DECLARE_VARIABLE STRING LOOKUPSTRINGYES
						LOOKUPSTRINGYES = "HINGE_HEIGHT == " + ftos(HINGE_HEIGHT,3) + " AND HINGE_THICKNESS == " + ftos(HINGE_THICKNESS,3)	 + \
						" AND DR_GA == " + ftos(SM_THICK,3) + " AND GRADE == " + DOOR_GRADE	+ " AND ELEC == 1"+ " AND WELDED_BOX == " + itos(WELDED_BOXES)

		IF	HAND_ == "LHR" OR HAND_ == "RH" OR \
			HAND_ == "LHR1" OR HAND_ == "LHRA1" OR HAND_ == "LHRI1" OR \
			HAND_ == "RH2" OR HAND_ == "RHA2" OR HAND_ == "RHI2"

			SEARCH_MDL_REF DOOR_ASM CSYS "ACS11" ASM_CSYS
			CREATE_UDF udf\csys DOOR_ASM
			UDF_REF ATTACH ASM_CSYS
			UDF_DIM	ROTX 0
			UDF_DIM	ROTY 0
			UDF_DIM	ROTZ 0
			UDF_DIM	LOCX 0
			UDF_DIM	LOCY JOH
			UDF_DIM	LOCZ 0
			UDF_EXP_REF refCsys CSYS 0
			END_CREATE_UDF

				HINGE_INDEX = 1
			FOR LOCY REF ARRAY HINGE_LOCATIONS_ARRAY
				CREATE_UDF udf\door_hinge DOOR_ASM
				UDF_INSTANCE HINGE_UDF
				UDF_REF ATTACH refCsys
				UDF_DIM LOCY -LOCY
				UDF_DIM HINGE_Z SM_THICK + SM_THICK + DOOR_THICKNESS -.12 - DOOR_HINGE_SETBACK
				UDF_DIM HINGE_Y HINGE_HEIGHT + DOOR_HINGE_HEIGHT_ALLOWANCE
				UDF_DIM HINGE_X -(HINGE_THICKNESS+ DOOR_HINGE_THICKNESS_ALLOWANCE)
				UDF_EXP_REF LOC+itos(HINGE_INDEX) CSYS 0
				UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF

				RETRIEVE_MDL door_hinge_asm.asm HINGE_ASM
				SEARCH_MDL_REF HINGE_ASM CSYS "PLACEMENT" PLACEMENT
				ASSEMBLE HINGE_ASM DOOR_ASM
					CSYS LOC+itos(HINGE_INDEX) PLACEMENT
				END_ASSEMBLE

				IF ELECTRIC_HINGE_POSITION == HINGE_INDEX
					LOOKUP_FAMINSTANCE HINGE_ASM LOOKUPSTRINGYES instance_name
					GET_REF_FAMINSTANCE HINGE_ASM instance_name instance
					REPLACE_COMPONENT HINGE_ASM instance

				ELSE
					LOOKUP_FAMINSTANCE HINGE_ASM LOOKUPSTRINGNO instance_name
					GET_REF_FAMINSTANCE HINGE_ASM instance_name instance
					REPLACE_COMPONENT HINGE_ASM instance
				END_IF

				REGEN_MDL DOOR_ASM
				COPY_REF LOC+itos(HINGE_INDEX) DIM_REF
				HINGE_INDEX ++
			END_FOR
		END_IF

		IF	HAND_ == "RHR" OR HAND_ == "LH" OR \
			HAND_ == "RHR2" OR HAND_ == "RHRA2" OR HAND_ == "RHRI2" OR \
			HAND_ == "LH1" OR HAND_ == "LHA1" OR HAND_ == "LHI1"

			SEARCH_MDL_REF DOOR_ASM CSYS "ACS12" ASM_CSYS
			CREATE_UDF udf\csys DOOR_ASM
			UDF_REF ATTACH ASM_CSYS
			UDF_DIM	ROTX 0
			UDF_DIM	ROTY 0
			UDF_DIM	ROTZ 0
			UDF_DIM	LOCX 0
			UDF_DIM	LOCY -JOH
			UDF_DIM	LOCZ 0
			UDF_EXP_REF refCsys CSYS 0
			END_CREATE_UDF

				HINGE_INDEX = 1
			FOR LOCY REF ARRAY HINGE_LOCATIONS_ARRAY
				CREATE_UDF udf\door_hinge DOOR_ASM
				UDF_INSTANCE HINGE_UDF
				UDF_REF ATTACH refCsys
				UDF_DIM LOCY LOCY
				UDF_DIM HINGE_Z SM_THICK + SM_THICK + DOOR_THICKNESS -.12 - DOOR_HINGE_SETBACK
				UDF_DIM HINGE_Y HINGE_HEIGHT + DOOR_HINGE_HEIGHT_ALLOWANCE
				UDF_DIM HINGE_X -(HINGE_THICKNESS+ DOOR_HINGE_THICKNESS_ALLOWANCE)
				UDF_EXP_REF LOC+itos(HINGE_INDEX) CSYS 0
				UDF_INTERSECTION * PART_LEVEL
				END_CREATE_UDF

				RETRIEVE_MDL door_hinge_asm.asm HINGE_ASM
				SEARCH_MDL_REF HINGE_ASM CSYS "PLACEMENT" PLACEMENT
				ASSEMBLE HINGE_ASM DOOR_ASM
					CSYS LOC+itos(HINGE_INDEX) PLACEMENT
				END_ASSEMBLE

				IF ELECTRIC_HINGE_POSITION == HINGE_INDEX
					LOOKUP_FAMINSTANCE HINGE_ASM LOOKUPSTRINGYES instance_name
					GET_REF_FAMINSTANCE HINGE_ASM instance_name instance
					REPLACE_COMPONENT HINGE_ASM instance
				ELSE
					LOOKUP_FAMINSTANCE HINGE_ASM LOOKUPSTRINGNO instance_name
					GET_REF_FAMINSTANCE HINGE_ASM instance_name instance
					REPLACE_COMPONENT HINGE_ASM instance
				END_IF

				REGEN_MDL DOOR_ASM
				COPY_REF LOC+itos(HINGE_INDEX) DIM_REF
				HINGE_INDEX ++
			END_FOR
		END_IF
	END_IF
	! END DOOR BUTT HINGE PREPS

	! BEGIN DOOR PREPS - CONTINUOUS HINGE
	IF HINGE_TYPE == "CONTINUOUS"

		DECLARE_VARIABLE DOUBLE BU_WIDTH
		DECLARE_VARIABLE DOUBLE BU_LOC

		IF DOOR_CONSTRUCTION == "SEAMLESS"
			BU_WIDTH = DOOR_THICKNESS - .25
			BU_LOC = SM_THICK - .0625 + (DOOR_THICKNESS/2)
		ELSE_IF DOOR_CONSTRUCTION == "LOCKSEAM"
			BU_WIDTH = DOOR_THICKNESS - .4375
			BU_LOC = (SM_THICK - .0625 + (DOOR_THICKNESS/2)) - .09375
		END_IF

		IF	HAND_ == "LHR" OR HAND_ == "RH" OR \
			HAND_ == "LHR1" OR HAND_ == "LHRA1" OR HAND_ == "LHRI1" OR \
			HAND_ == "RH2" OR HAND_ == "RHA2" OR HAND_ == "RHI2"

			SEARCH_MDL_REF DOOR_ASM CSYS "ACS11" ASM_CSYS
			CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ASM_CSYS
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX -SM_THICK
				UDF_DIM	LOCY JOH - TOP_GAP -.25
				UDF_DIM	LOCZ BU_LOC
				UDF_EXP_REF ASM_CSYS CSYS 0
			END_CREATE_UDF

			RETRIEVE_MDL BU_FLAT.PRT COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			ASSEMBLE COMP DOOR_ASM
				 CSYS ASM_CSYS PLACEMENT
			END_ASSEMBLE

			INSERT_FAMINSTANCE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
				IF EPT == 1
					SET_FAMITEM_VALUE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" EPT_CTR - (EPT_HEIGHT/2) - .5
				ELSE
					SET_FAMITEM_VALUE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" JOH - TOP_GAP - TOP_CHANNEL_DEPTH - UNDERCUT - BOTTOM_CHANNEL_DEPTH
				END_IF
			SET_FAMITEM_VALUE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" BU_WIDTH
			SET_FAMITEM_VALUE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "SMT_THICKNESS" .075
			GET_REF_FAMINSTANCE COMP "COMP_1_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
			REPLACE_COMPONENT COMP INST
			
			IF EPT == 1
				CREATE_UDF udf\csys DOOR_ASM
					UDF_REF ATTACH ASM_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX 0
					UDF_DIM	LOCY -(EPT_CTR + (EPT_HEIGHT/2)-.25)
					UDF_DIM	LOCZ 0
					UDF_EXP_REF ASM_CSYS CSYS 0
				END_CREATE_UDF

				RETRIEVE_MDL BU_FLAT.PRT COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
				ASSEMBLE COMP DOOR_ASM
					 CSYS ASM_CSYS PLACEMENT
				END_ASSEMBLE

				INSERT_FAMINSTANCE COMP "COMP_1A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
				SET_FAMITEM_VALUE COMP "COMP_1A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" JOH - TOP_GAP - TOP_CHANNEL_DEPTH - UNDERCUT - EPT_CTR - (EPT_HEIGHT/2) - BOTTOM_CHANNEL_DEPTH
				SET_FAMITEM_VALUE COMP "COMP_1A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" BU_WIDTH
				SET_FAMITEM_VALUE COMP "COMP_1A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "SMT_THICKNESS" 0.075
				GET_REF_FAMINSTANCE COMP "COMP_1A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
				REPLACE_COMPONENT COMP INST
				INVALIDATE_REF COMP
			END_IF							
			
		END_IF

		IF	HAND_ == "RHR" OR HAND_ == "LH" OR \
			HAND_ == "RHR2" OR HAND_ == "RHRA2" OR HAND_ == "RHRI2" OR \
			HAND_ == "LH1" OR HAND_ == "LHA1" OR HAND_ == "LHI1"

			SEARCH_MDL_REF DOOR_ASM CSYS "ACS12" ASM_CSYS
			CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ASM_CSYS
				UDF_DIM	ROTX 180
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX -SM_THICK
				UDF_DIM	LOCY -(JOH - TOP_GAP -.25)
				UDF_DIM	LOCZ BU_LOC
				UDF_EXP_REF ASM_CSYS CSYS 0
			END_CREATE_UDF

			RETRIEVE_MDL BU_FLAT.PRT COMP
			SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
			ASSEMBLE COMP DOOR_ASM
				 CSYS ASM_CSYS PLACEMENT
			END_ASSEMBLE

			INSERT_FAMINSTANCE COMP "COMP_2_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
			IF EPT == 1
				SET_FAMITEM_VALUE COMP "COMP_2_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" EPT_CTR - (EPT_HEIGHT/2) - .5
			ELSE
				SET_FAMITEM_VALUE COMP "COMP_2_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" JOH - TOP_GAP - TOP_CHANNEL_DEPTH - UNDERCUT - BOTTOM_CHANNEL_DEPTH
			END_IF
			SET_FAMITEM_VALUE COMP "COMP_2_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" BU_WIDTH
			SET_FAMITEM_VALUE COMP "COMP_2_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "SMT_THICKNESS" .075
			GET_REF_FAMINSTANCE COMP "COMP_2_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
			REPLACE_COMPONENT COMP INST
			INVALIDATE_REF COMP
			
			IF EPT == 1
				CREATE_UDF udf\csys DOOR_ASM
					UDF_REF ATTACH ASM_CSYS
					UDF_DIM	ROTX 0
					UDF_DIM	ROTY 0
					UDF_DIM	ROTZ 0
					UDF_DIM	LOCX 0
					UDF_DIM	LOCY -(EPT_CTR + (EPT_HEIGHT/2)-.25)
					UDF_DIM	LOCZ 0
					UDF_EXP_REF ASM_CSYS CSYS 0
				END_CREATE_UDF

				RETRIEVE_MDL BU_FLAT.PRT COMP
				SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT
				ASSEMBLE COMP DOOR_ASM
					 CSYS ASM_CSYS PLACEMENT
				END_ASSEMBLE

				INSERT_FAMINSTANCE COMP "COMP_2A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM
				SET_FAMITEM_VALUE COMP "COMP_2A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "LENGTH" JOH - TOP_GAP - TOP_CHANNEL_DEPTH - UNDERCUT - EPT_CTR - (EPT_HEIGHT/2) - BOTTOM_CHANNEL_DEPTH
				SET_FAMITEM_VALUE COMP "COMP_2A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "WIDTH" BU_WIDTH
				SET_FAMITEM_VALUE COMP "COMP_2A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM "SMT_THICKNESS" .075
				GET_REF_FAMINSTANCE COMP "COMP_2A_"+itos(DOOR_INDEX)+"_"+ ITEM_NUM INST
				REPLACE_COMPONENT COMP INST
				INVALIDATE_REF COMP
			END_IF							
		END_IF
	END_IF
END_ASM_DESCR
