BEGIN_GUI_DESCR

END_GUI_DESCR

BEGIN_ASM_DESCR

DECLARE_VARIABLE INTEGER 	BUILD_INDEX 
DECLARE_VARIABLE INTEGER 	EXCEL_COLUMN 0
DECLARE_VARIABLE INTEGER 	EXCEL_ROW 0
DECLARE_VARIABLE STRING 	PROJECT_FOLDER ""
DECLARE_VARIABLE STRING 	ITEM_FOLDER "" 
DECLARE_VARIABLE STRING 	TEST_EOF FALSE
DECLARE_VARIABLE BOOL 		EOF FALSE


DECLARE_VARIABLE	STRING	CUSTOMER
DECLARE_VARIABLE	STRING	JOB_NAME
DECLARE_VARIABLE	STRING	SO_NUM
DECLARE_VARIABLE	STRING	READY
DECLARE_VARIABLE	STRING	DONE
DECLARE_VARIABLE	STRING	ITEM_NUM
DECLARE_VARIABLE	STRING	SUB_JOB_NAME
DECLARE_VARIABLE	STRING	FRAME_WO
DECLARE_VARIABLE	STRING	DOOR_WO
DECLARE_VARIABLE	STRING	MDL
DECLARE_VARIABLE	STRING	DRW_MDL
DECLARE_VARIABLE 	DOUBLE	TBLX
DECLARE_VARIABLE 	DOUBLE	TBLY
DECLARE_ARRAY TABLES

WINDOW_CLOSE
 ERASE_NOT_DISPLAYED

DECLARE_VARIABLE STRING SO_NUM "27655"

DECLARE_VARIABLE STRING EXCEL_DOCUMENT
EXCEL_DOCUMENT = "C:\SIGMAXIM\Library\component_engine\SDI\SO_"+SO_NUM+".xls"
EXCEL_CONNECT 
EXCEL_LOAD_DOCUMENT EXCEL_DOCUMENT

EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "OPENING"

DECLARE_VARIABLE INTEGER COL 1
COL = 1
EOF = FALSE

EXCEL_GET_VALUE 0 COL CUSTOMER

EOF = "FALSE"
WHILE EOF == "FALSE"
	EXCEL_GET_VALUE 2 COL SO_NUM
	EXCEL_GET_VALUE 3 COL READY
	EXCEL_GET_VALUE 4 COL DONE
	EXCEL_GET_VALUE 5 COL ITEM_NUM
	EXCEL_GET_VALUE 54 COL SUB_TYPE
	EXCEL_GET_VALUE 55 COL DOOR_ITEM_DESC
	EXCEL_GET_VALUE 126 COL FRAME_ITEM_DESC
	EXCEL_GET_VALUE 265	COL	FRAME_WO
	EXCEL_GET_VALUE 266	COL	DOOR_WO
	EXCEL_GET_VALUE 223	COL	DWG
	EXCEL_GET_VALUE 258	COL	SHEET

	TBLX = 11.0625
	TBLY = 10.375	
	
	IF READY == "YES" AND DONE == "YES" AND DWG == "YES"	
		MDL = "ASM_"+SO_NUM+"_"+ITEM_NUM+".ASM"
		DRW_MDL = "ASM_"+SO_NUM+"_"+ITEM_NUM+".DRW"

		RETRIEVE_MDL MDL ASSEM
		RETRIEVE_MDL DRW_MDL refDrawing

		SEARCH_MDL_REFS refDrawing DRAWING_TABLE "*" TABLES

		IF FRAME_ITEM_DESC == "FRAME"
			CLEAR_ARRAY TABLES
			SEARCH_MDL_REFS refDrawing DRAWING_TABLE "*" TABLES
			SEARCH_MDL_REF ASSEM ASSEMBLY "FRAME_ASM_"+SO_NUM+"_"+ITEM_NUM FRAME_ASM
			FOR TABLE REF REVERSE_ARRAY TABLES
			GET_REF_ID TABLE TABLE_ID
			GET_DRW_TABLE_TEXT refDrawing TABLE_ID 1 1 text
				IF text == "FRAME*"
					! GET_DRW_TABLE_POS refDrawing TABLE_ID TBLX TBLY
					REMOVE_DRW_TABLE refDrawing TABLE_ID
					CREATE_DRW_TABLE refDrawing FRAME_ASM 1 TBLX TBLY "lib:subasm.tbl" FRAME
					GET_MDL_NAME FRAME_ASM FR_NAME
					SET_DRW_TABLE_TEXT refDrawing FRAME 1 1 FR_NAME
					GET_DRW_TABLE_OUTLINE refDrawing FRAME x1 y1 x2 y2
					TBLY = y2 - .0625
					BREAK
				END_IF
			END_FOR
			INVALIDATE_REF TABLE
		END_IF

		IF DOOR_ITEM_DESC == "DOOR"
			CLEAR_ARRAY TABLES
			SEARCH_MDL_REFS refDrawing DRAWING_TABLE "*" TABLES
			SEARCH_MDL_REF ASSEM ASSEMBLY "DOOR_ASM_1_"+SO_NUM+"_"+ITEM_NUM DOOR1_ASM
			FOR TABLE REF REVERSE_ARRAY TABLES
			GET_REF_ID TABLE TABLE_ID
			GET_DRW_TABLE_TEXT refDrawing TABLE_ID 1 1 text
				IF text == "DOOR_ASM_1*"
					! GET_DRW_TABLE_POS refDrawing TABLE_ID TBLX TBLYY		
					REMOVE_DRW_TABLE refDrawing TABLE_ID
					CREATE_DRW_TABLE refDrawing DOOR1_ASM 1 TBLX TBLY "lib:subasm.tbl" DOOR
					GET_MDL_NAME DOOR1_ASM DR_NAME
					SET_DRW_TABLE_TEXT refDrawing DOOR 1 1 DR_NAME
					GET_DRW_TABLE_OUTLINE refDrawing DOOR x1 y1 x2 y2
					TBLY = y2 - .0625
					BREAK
				END_IF
			END_FOR
			INVALIDATE_REF TABLE
		END_IF

		IF DOOR_ITEM_DESC == "DOOR" AND SUB_TYPE == "P"
			CLEAR_ARRAY TABLES
			SEARCH_MDL_REFS refDrawing DRAWING_TABLE "*" TABLES
			SEARCH_MDL_REF ASSEM ASSEMBLY "DOOR_ASM_2_"+SO_NUM+"_"+ITEM_NUM DOOR2_ASM
			FOR TABLE REF REVERSE_ARRAY TABLES
			GET_REF_ID TABLE TABLE_ID
			GET_DRW_TABLE_TEXT refDrawing TABLE_ID 1 1 text
				IF text == "DOOR_ASM_2*"
					! GET_DRW_TABLE_POS refDrawing TABLE_ID TBLX TBLYY		
					REMOVE_DRW_TABLE refDrawing TABLE_ID
					CREATE_DRW_TABLE refDrawing DOOR2_ASM 1 TBLX TBLY "lib:subasm.tbl" DOOR
					GET_MDL_NAME DOOR2_ASM DR_NAME
					SET_DRW_TABLE_TEXT refDrawing DOOR 1 1 DR_NAME
					GET_DRW_TABLE_OUTLINE refDrawing DOOR x1 y1 x2 y2
					IF y2 < 0.5
						SET_DRW_TABLE_POS refDrawing DOOR 8.0 9.75
					END_IF
					BREAK
				END_IF
			END_FOR
			INVALIDATE_REF TABLE
		END_IF
		
		UPDATE_DRW_VIEWS refDrawing 1

		CREATE_DRW_NOTE refDrawing 14.875 9.03125 "&todays_date" HORIZONTAL CENTER HEIGHT .09
		CREATE_DRW_NOTE refDrawing 15.500 9.03125 "SA" HORIZONTAL CENTER HEIGHT .09

			SAVE_MDL refDrawing
			DECLARE_STRUCT PDF_OPTION option
			option.title = "sample drawing"
			option.author = "DRAFTER"
			option.subject = "detail"
			option.keywords = "SmartAssembly example"
			option.launch_viewer = "FALSE"
			option.color_depth = "Gray"
			
			IF SHEET > 0 AND SHEET < 10
				EXPORT_DRW_PDF refDrawing option "AB_"+"00"+itos(SHEET)+"_"+SO_NUM+"_"+ITEM_NUM
			ELSE_IF SHEET > 9 AND SHEET < 100
				EXPORT_DRW_PDF refDrawing option "AB_"+"0"+itos(SHEET)+"_"+SO_NUM+"_"+ITEM_NUM
			ELSE_IF SHEET > 99
				EXPORT_DRW_PDF refDrawing option "AB_"+itos(SHEET)+"_"+SO_NUM+"_"+ITEM_NUM
			END_IF
		WINDOW_CLOSE
		ERASE_NOT_DISPLAYED
	END_IF
	COL++
	EXCEL_GET_VALUE 0 COL CUSTOMER
	IF CUSTOMER == ""
		EOF = "TRUE"
	ELSE
		EOF = "FALSE"
	END_IF
END_WHILE

EXCEL_DISCONNECT

END_ASM_DESCR
