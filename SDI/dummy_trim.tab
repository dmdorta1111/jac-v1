BEGIN_GUI_DESCR

	SHOW_PARAM	STRING		ITEM_NUM
	SHOW_PARAM	STRING		SUB_TYPE
	SHOW_PARAM	INTEGER		OPENING_TYPE
	SHOW_PARAM	STRING		DOOR_ITEM_DESC
	SHOW_PARAM	STRING		FRAME_ITEM_DESC
	SHOW_PARAM	STRING		DUMMY_TRIM_SHEET_NAME
	SHOW_PARAM	INTEGER		DUMMY_TRIM_ROW
	SHOW_PARAM	STRING		DUMMY_TRIM_DESC
	
	USER_INPUT_PARAM DOUBLE STRIKE_CENTER
		
	CHECKBOX_PARAM INTEGER SELECT_TRIM "YES/NO"
	
END_GUI_DESCR

BEGIN_ASM_DESCR

DECLARE_ARRAY			SELCELLS
DECLARE_ARRAY			TRIM_INFO
DECLARE_ARRAY			TRIMCELLS

DECLARE_REFERENCE 	LOCREF

DECLARE_VARIABLE	INTEGER		OPERATION
DECLARE_VARIABLE	STRING		ITEM_NUM
DECLARE_VARIABLE	STRING		SUB_TYPE
DECLARE_VARIABLE	INTEGER		OPENING_TYPE
DECLARE_VARIABLE	STRING		DOOR_ITEM_DESC
DECLARE_VARIABLE	STRING		FRAME_ITEM_DESC
DECLARE_VARIABLE	DOUBLE		DOOR_THICKNESS
DECLARE_VARIABLE	DOUBLE		STRIKE_CENTER

DECLARE_VARIABLE	STRING 		DUMMY_TRIM_SHEET_NAME
DECLARE_VARIABLE	INTEGER		DUMMY_TRIM_ROW
DECLARE_VARIABLE	STRING 		DUMMY_TRIM_DESC
DECLARE_VARIABLE	DOUBLE		DUMMY_TRIM_OFFSET

DECLARE_VARIABLE 	INTEGER 	COLDIA
DECLARE_VARIABLE 	INTEGER 	COLSHAPE
DECLARE_VARIABLE 	INTEGER 	COLSIDE
DECLARE_VARIABLE 	INTEGER 	COLX
DECLARE_VARIABLE 	INTEGER 	COLY
DECLARE_VARIABLE 	DOUBLE 		DIA
DECLARE_VARIABLE 	INTEGER 	HINDEX
DECLARE_VARIABLE 	INTEGER 	HTP
DECLARE_VARIABLE 	DOUBLE 		IS
DECLARE_VARIABLE	DOUBLE		DUMMY_TRIM_BACKSET
DECLARE_VARIABLE	STRING		DUMMY_TRIM_REINFORCEMENT
DECLARE_VARIABLE	DOUBLE		DUMMY_TRIM_TRIM_BACKSET
DECLARE_VARIABLE	STRING 		DUMMY_TRIM_TRIM_MANUFACTURER
DECLARE_VARIABLE	DOUBLE		DUMMY_TRIM_TRIM_OFFSET
DECLARE_VARIABLE 	DOUBLE		LOCX
DECLARE_VARIABLE 	DOUBLE 		LOCY
DECLARE_VARIABLE 	DOUBLE 		OS
DECLARE_VARIABLE 	STRING 		SHAPE
DECLARE_VARIABLE 	INTEGER 	SIDE
DECLARE_VARIABLE	STRING		SHAPE_UDF

IF OPERATION == 0
	CONFIG_ELEM
	
	IF SELECT_TRIM == 1
		PRINT "SELECT ONE CELL IN THE ROW YOU WANT"
		WAIT
		EXCEL_GET_ACTIVE_SHEET EXCEL_INDEX
		EXCEL_GET_SHEET_NAME EXCEL_INDEX DUMMY_TRIM_SHEET_NAME
		
		CLEAR_ARRAY TRIMCELLS
		EXCEL_GET_SELECTION TRIMCELLS
		FOR CELL REF ARRAY TRIMCELLS
			GET_ARRAY_ELEM CELL 0 DUMMY_TRIM_ROW
			BREAK
		END_FOR
		EXCEL_GET_VALUE DUMMY_TRIM_ROW 4 DUMMY_TRIM_DESC

		PRINT "LOCK TRIM SHEET NAME  %" DUMMY_TRIM_SHEET_NAME
		PRINT "LOCK TRIM ROW  %" DUMMY_TRIM_ROW			
		PRINT "LOCK TRIM DESC  %" DUMMY_TRIM_DESC
		
		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "OPENING"
	END_IF	
END_IF				

IF OPERATION == 1

	IF	HAND_ == "RHRI2" OR HAND_ == "LHI1"
		SEARCH_MDL_REF DOOR_ASM CSYS "ACS3" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
	END_IF

	IF	HAND_ == "LHRI1" OR HAND_ == "RHI2"
		SEARCH_MDL_REF DOOR_ASM CSYS "ACS4" ATTACH
		SEARCH_MDL_REF DOOR_ASM CSYS "ASM_DEF_CSYS" ATTACH1
	END_IF

! TRIM	
	IF DUMMY_TRIM_ROW <> 0 AND DUMMY_TRIM_ROW <> ""
	
		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME DUMMY_TRIM_SHEET_NAME
		CLEAR_ARRAY SELCELLS
		EXCEL_GET_VALUES CELL_BY_INDEX DUMMY_TRIM_ROW 0 CELL_BY_INDEX DUMMY_TRIM_ROW 255 SELCELLS
		EXCEL_ACTIVATE_SHEET SHEET_BY_NAME "OPENING"
	
		CLEAR_ARRAY TRIM_INFO
		FOR CELL REF ARRAY SELCELLS
			! GET_ARRAY_ELEM CELL 0 row
			! GET_ARRAY_ELEM CELL 1 col
			GET_ARRAY_ELEM CELL 2 content
			
			IF content == ""
				BREAK
			ELSE
				ADD_ARRAY_ELEM TRIM_INFO content
				PRINT "CONTENT - %  " content
			END_IF
		END_FOR
	
		GET_ARRAY_ELEM TRIM_INFO 6 DUMMY_TRIM_REINFORCEMENT
		GET_ARRAY_ELEM TRIM_INFO 7 DUMMY_TRIM_OFFSET
		GET_ARRAY_ELEM TRIM_INFO 8 DUMMY_TRIM_BACKSET

			CREATE_UDF udf\lock_dtms DOOR_ASM
				UDF_REF ATTACH1 ATTACH
				UDF_REF ATTACH2 ATTACH1
				UDF_DIM STRIKE_CTR STRIKE_CENTER
				UDF_DIM OFFSET -DUMMY_TRIM_OFFSET
				UDF_DIM BACKSET DUMMY_TRIM_BACKSET
				UDF_EXP_REF ATTACH2 CSYS 2
				UDF_EXP_REF ODCTR PLANE 3
				UDF_EXP_REF TOPP PLANE 4
			END_CREATE_UDF

		GET_ARRAY_SIZE TRIM_INFO SIZE
		HTP = (SIZE-8)/5
		HINDEX = 1
		COLX = 12
		COLY = 13
		COLSHAPE = 14
		COLDIA = 15
		COLSIDE = 16

		WHILE HINDEX <= HTP	
			GET_ARRAY_ELEM TRIM_INFO COLX LOCX
			GET_ARRAY_ELEM TRIM_INFO COLY LOCY
			GET_ARRAY_ELEM TRIM_INFO COLSHAPE SHAPE
			GET_ARRAY_ELEM TRIM_INFO COLDIA DIA
			GET_ARRAY_ELEM TRIM_INFO COLSIDE SIDE
			
			CREATE_UDF udf\xycsys DOOR_ASM
				UDF_REF ATTACH ATTACH2
				UDF_DIM	DIMX LOCX
				UDF_DIM	DIMY LOCY
				UDF_EXP_REF LOCREF CSYS 0
			END_CREATE_UDF
			
			IF SIDE == 0
				OS = 1
				IS = .1
			END_IF
			IF SIDE == 1
				OS = .1
				IS = 1
			END_IF
			IF SIDE == 2
				OS = 1
				IS = 1
			END_IF

			IF SHAPE == 1
				SHAPE_UDF = "udf\circle"
			ELSE
				SHAPE_UDF = "udf\\" + itos(SHAPE)
			END_IF
			
			PRINT "%" SHAPE_UDF
			
			IF WELDED_PREPS == 1
				DIA = DIA+.0625
			END_IF
			CREATE_UDF &SHAPE_UDF DOOR_ASM
				UDF_REF ODCTR ODCTR
				UDF_REF TOPP TOPP
				UDF_REF LOCREF LOCREF
				UDF_DIM DIA DIA
				UDF_DIM IS IS
				UDF_DIM OS OS
				UDF_INTERSECTION * PART_LEVEL		
			END_CREATE_UDF
			
			HINDEX++
			COLX = COLX + 5
			COLY = COLY + 5
			COLSHAPE = COLSHAPE + 5
			COLDIA = COLDIA + 5
			COLSIDE = COLSIDE + 5
		END_WHILE		
	END_IF

! REINFORCEMENT	


	IF	HAND_ == "RHRI2" OR HAND_ == "RHI2"
			CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ATTACH2
				UDF_DIM	ROTX 180
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX DUMMY_TRIM_BACKSET
				UDF_DIM	LOCY 0
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ATTACH2 CSYS 0
			END_CREATE_UDF
	END_IF

	IF	HAND_ == "LHRI1" OR HAND_ == "LHI1"
			CREATE_UDF udf\csys DOOR_ASM
				UDF_REF ATTACH ATTACH2
				UDF_DIM	ROTX 0
				UDF_DIM	ROTY 0
				UDF_DIM	ROTZ 0
				UDF_DIM	LOCX DUMMY_TRIM_BACKSET
				UDF_DIM	LOCY 0
				UDF_DIM	LOCZ 0
				UDF_EXP_REF ATTACH2 CSYS 0
			END_CREATE_UDF
	END_IF

	PRINT "%" DUMMY_TRIM_REINFORCEMENT	
	RETRIEVE_MDL &DUMMY_TRIM_REINFORCEMENT COMP
	SEARCH_MDL_REF COMP CSYS "PLACEMENT" PLACEMENT

	ASSEMBLE COMP DOOR_ASM
		 CSYS ATTACH2 PLACEMENT
	END_ASSEMBLE
END_IF

END_ASM_DESCR
